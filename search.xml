<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>如何在hexo中安装next主题</title>
    <url>/2024/01/12/%E5%A6%82%E4%BD%95%E5%9C%A8hexo%E4%B8%AD%E5%AE%89%E8%A3%85next%E4%B8%BB%E9%A2%98/</url>
    <content><![CDATA[<h1 id="1-安装hexo"><a href="#1-安装hexo" class="headerlink" title="1. 安装hexo"></a>1. 安装hexo</h1><p>npm install -g hexo-cli</p>
<h1 id="2-主题下载安装"><a href="#2-主题下载安装" class="headerlink" title="2. 主题下载安装"></a>2. 主题下载安装</h1><p>进入命令行，下载 NexT 主题，输入：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<p>修改站点配置文件<code>_config.yml</code>，找到如下代码：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">landscape</span></span><br></pre></td></tr></table></figure>

<p>将 landscape 修改为 next 即可。</p>
<span id="more"></span>





<h1 id="3-配置文件"><a href="#3-配置文件" class="headerlink" title="3. 配置文件"></a>3. 配置文件</h1><p>在 Hexo 中有<strong>两份</strong>主要的配置文件，其名称都是 <strong>_config.yml</strong>。 其中，一份位于站点根目录下，主要包含 Hexo 本身的站点配置；另一份位于<strong>主题目录</strong>下，这份配置由主题作者提供，主要用于配置主题相关的选项。</p>
<p>为了描述方便，在以下说明中，将前者称为 <strong>站点配置文件</strong>， 后者称为 <strong>主题配置文件</strong>。</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">/hexo/_config.yml</span></span><br><span class="line"><span class="string">/hexo/themes/next/_config.yml</span></span><br></pre></td></tr></table></figure>

<h1 id="4-修改语言"><a href="#4-修改语言" class="headerlink" title="4. 修改语言"></a>4. 修改语言</h1><p>打开站点配置文件，搜索 language，找到如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">author: waterdance</span><br><span class="line">language: zh-Hans</span><br><span class="line">timezone: Asia/Shanghai</span><br></pre></td></tr></table></figure>

<h1 id="5-新建标签及分类界面"><a href="#5-新建标签及分类界面" class="headerlink" title="5. 新建标签及分类界面"></a>5. 新建标签及分类界面</h1><p>打开 <strong>主题配置文件</strong>，搜索 menu，找到如下代码：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">home</span></span><br><span class="line">  <span class="comment">#about: /about/ || user</span></span><br><span class="line">  <span class="comment">#tags: /tags/ || tags</span></span><br><span class="line">  <span class="comment">#categories: /categories/ || th</span></span><br><span class="line">  <span class="attr">archives:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">archive</span></span><br><span class="line">  <span class="comment">#schedule: /schedule/ || calendar</span></span><br><span class="line">  <span class="comment">#sitemap: /sitemap.xml || sitemap</span></span><br><span class="line">  <span class="comment">#commonweal: /404/ || heartbeat</span></span><br></pre></td></tr></table></figure>

<p>把 tags 和 categories 前面的 # 删除</p>
<h1 id="6-切换主题"><a href="#6-切换主题" class="headerlink" title="6. 切换主题"></a>6. 切换主题</h1><p>在主题配置文件<code>/next/_config.yml</code>中查找：<code>scheme</code>，找到如下代码：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Schemes</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">Muse</span></span><br><span class="line"><span class="comment">#scheme: Mist</span></span><br><span class="line"><span class="comment">#scheme: Pisces</span></span><br><span class="line"><span class="comment">#scheme: Gemini</span></span><br><span class="line"><span class="string">选择你喜欢的一种样式，去掉前面的</span> <span class="comment">#，其他主题前加上 # 即可。</span></span><br></pre></td></tr></table></figure>

<h1 id="7-隐藏网页底部-powered-By-Hexo-强力驱动"><a href="#7-隐藏网页底部-powered-By-Hexo-强力驱动" class="headerlink" title="7. 隐藏网页底部 powered By Hexo &#x2F; 强力驱动"></a>7. 隐藏网页底部 powered By Hexo &#x2F; 强力驱动</h1><p>打开 themes&#x2F;next&#x2F;layout&#x2F;_partials&#x2F;footer.swig</p>
<p>找到：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">%</span> <span class="string">if</span> <span class="string">theme.footer.powered.enable</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="string">&lt;div</span> <span class="string">class=&quot;powered-by&quot;&gt;&#123;#</span></span><br><span class="line"><span class="comment">#&#125;&#123;&#123; __(&#x27;footer.powered&#x27;, &#x27;&lt;a class=&quot;theme-link&quot; target=&quot;_blank&quot;&#x27; + nofollow + &#x27; href=&quot;https://hexo.io&quot;&gt;Hexo&lt;/a&gt;&#x27;) &#125;&#125;&#123;% if theme.footer.powered.version %&#125; v&#123;&#123; hexo_env(&#x27;version&#x27;) &#125;&#125;&#123;% endif %&#125;&#123;#</span></span><br><span class="line"><span class="comment">#&#125;&lt;/div&gt;</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">endif</span> <span class="string">%</span>&#125;</span><br><span class="line">&#123;<span class="string">%</span> <span class="string">if</span> <span class="string">theme.footer.powered.enable</span> <span class="string">and</span> <span class="string">theme.footer.theme.enable</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="string">&lt;span</span> <span class="string">class=&quot;post-meta-divider&quot;&gt;|&lt;/span&gt;</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">endif</span> <span class="string">%</span>&#125;</span><br><span class="line">&#123;<span class="string">%</span> <span class="string">if</span> <span class="string">theme.footer.theme.enable</span> <span class="string">%</span>&#125;</span><br><span class="line"><span class="string">&lt;div</span> <span class="string">class=&quot;theme-info&quot;&gt;&#123;#</span></span><br><span class="line"><span class="comment">#&#125;&#123;&#123; __(&#x27;footer.theme&#x27;) &#125;&#125; – &#123;#</span></span><br><span class="line"><span class="comment">#&#125;&lt;a class=&quot;theme-link&quot; target=&quot;_blank&quot;&#123;&#123; nofollow &#125;&#125; href=&quot;https://theme-next.org&quot;&gt;&#123;#</span></span><br><span class="line"><span class="comment">#&#125;NexT.&#123;&#123; theme.scheme &#125;&#125;&#123;#</span></span><br><span class="line"><span class="comment">#&#125;&lt;/a&gt;&#123;% if theme.footer.theme.version %&#125; v&#123;&#123; version &#125;&#125;&#123;% endif %&#125;&#123;#</span></span><br><span class="line"><span class="comment">#&#125;&lt;/div&gt;</span></span><br><span class="line">&#123;<span class="string">%</span> <span class="string">endif</span> <span class="string">%</span>&#125;</span><br></pre></td></tr></table></figure>

<p>把这段代码首尾分别加上：<code>&lt;!--</code> 和<code>--&gt;</code>，或者直接删除。</p>
<h1 id="8-文章加上阴影"><a href="#8-文章加上阴影" class="headerlink" title="8. 文章加上阴影"></a>8. 文章加上阴影</h1><p>打开 &#x2F;themes&#x2F;next&#x2F;source&#x2F;css&#x2F;_custom&#x2F;custom.styl，添加：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.post</span> &#123;</span><br><span class="line"><span class="attribute">margin-top</span>: <span class="number">60px</span>;</span><br><span class="line"><span class="attribute">margin-bottom</span>: <span class="number">60px</span>;</span><br><span class="line"><span class="attribute">padding</span>: <span class="number">25px</span>;</span><br><span class="line">-webkit-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">202</span>, <span class="number">203</span>, <span class="number">203</span>, .<span class="number">5</span>);</span><br><span class="line">-moz-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">202</span>, <span class="number">203</span>, <span class="number">204</span>, .<span class="number">5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-浏览页面显示当前浏览进度"><a href="#9-浏览页面显示当前浏览进度" class="headerlink" title="9. 浏览页面显示当前浏览进度"></a>9. 浏览页面显示当前浏览进度</h1><p>打开 themes&#x2F;next&#x2F;_config.yml，搜索关键字 <code>scrollpercent</code>，把 false 改为 true。</p>
<p><img src="/2024/01/12/%E5%A6%82%E4%BD%95%E5%9C%A8hexo%E4%B8%AD%E5%AE%89%E8%A3%85next%E4%B8%BB%E9%A2%98/image-20240115193347448.png" alt="image-20240115193347448"></p>
<h1 id="10-Local-Search本地搜索"><a href="#10-Local-Search本地搜索" class="headerlink" title="10. Local Search本地搜索"></a>10. Local Search本地搜索</h1><p>安装插件<code>hexo-generator-searchdb</code>,执行以下命令:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>

<p>修改<code>hexo/_config.yml</code>站点配置文件，新增以下内容到任意位置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line"><span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line"><span class="attr">field:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">format:</span> <span class="string">html</span></span><br><span class="line"><span class="attr">limit:</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>

<h1 id="11-设置网站图标"><a href="#11-设置网站图标" class="headerlink" title="11. 设置网站图标"></a>11. 设置网站图标</h1><p>在 EasyIcon 中找一张（32 * 32）的 ico 图标，或者去别的网站下载或者制作，并将图标名称改为 favicon.ico，然后把图标放在 &#x2F;themes&#x2F;next&#x2F;source&#x2F;images 里，并且修改主题配置文件：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="string">Put</span> <span class="string">your</span> <span class="string">favicon.ico</span> <span class="string">into</span> <span class="string">`hexo-site/source/`</span> <span class="string">directory.</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">/favicon.ico</span></span><br></pre></td></tr></table></figure>

<h1 id="12-修改文章底部的-号的标签，改为图标"><a href="#12-修改文章底部的-号的标签，改为图标" class="headerlink" title="12. 修改文章底部的#号的标签，改为图标"></a>12. 修改文章底部的#号的标签，改为图标</h1><p>修改模板<code>/themes/next/layout/_macro/post.swig</code></p>
<p>搜索 rel&#x3D;“tag”&gt;#，将 # 换成<code>&lt;i class=&quot;fa fa-tag&quot;&gt;&lt;/i&gt;</code></p>
<h1 id="13-文章分享功能"><a href="#13-文章分享功能" class="headerlink" title="13. 文章分享功能"></a>13. 文章分享功能</h1><p>打开<code>themes/next/_config.yml</code> 搜索关键字<code>needmoreshare2</code> 修改为下面设置</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">needmoreshare2:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">postbottom:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">iconStyle:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">boxForm:</span> <span class="string">horizontal</span></span><br><span class="line">      <span class="comment">#位置</span></span><br><span class="line">      <span class="attr">position:</span> <span class="string">bottomCenter</span></span><br><span class="line">      <span class="comment">#可分享网站</span></span><br><span class="line">      <span class="attr">networks:</span> <span class="string">Weibo,Wechat,Douban,QQZone,Twitter,Facebook</span></span><br><span class="line">  <span class="attr">float:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">iconStyle:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">boxForm:</span> <span class="string">vertical</span></span><br><span class="line">      <span class="comment">#位置</span></span><br><span class="line">      <span class="attr">position:</span> <span class="string">topRight</span></span><br><span class="line">       <span class="comment">#可分享网站</span></span><br><span class="line">      <span class="attr">networks:</span> <span class="string">Weibo,Wechat,Douban,QQZone,Twitter,Facebook</span></span><br></pre></td></tr></table></figure>

<h1 id="14-文章加密访问"><a href="#14-文章加密访问" class="headerlink" title="14. 文章加密访问"></a>14. 文章加密访问</h1><p>打开<code>themes-&gt;next-&gt;layout-&gt;_partials-&gt;head.swig</code>文件,插入这样一段代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">(function()&#123;</span><br><span class="line">    if(&#x27;&#123;&#123; page.password &#125;&#125;&#x27;)&#123;</span><br><span class="line">        if (prompt(&#x27;请输入文章密码&#x27;) !== &#x27;&#123;&#123; page.password &#125;&#125;&#x27;)&#123;</span><br><span class="line">            alert(&#x27;密码错误！&#x27;);</span><br><span class="line">            history.back();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h1 id="15-增加文章字数统计及阅读时常功能"><a href="#15-增加文章字数统计及阅读时常功能" class="headerlink" title="15. 增加文章字数统计及阅读时常功能"></a>15. 增加文章字数统计及阅读时常功能</h1><p>安装插件<code>hexo-wordcount</code>,执行以下命令:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install hexo-wordcount --save</span><br></pre></td></tr></table></figure>

<p>修改<code>themes/next/_config.yml</code>主题配置文件，搜索关键字<code>post_wordcount</code>,修改如下:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">post_wordcount:</span><br><span class="line">  item_text: true</span><br><span class="line">  wordcount: true #单篇文章字数</span><br><span class="line">  min2read: true #单篇阅读时长</span><br><span class="line">  totalcount: true #站点总字数</span><br><span class="line">  separated_meta: true</span><br></pre></td></tr></table></figure>

<h1 id="16-文章置顶功能"><a href="#16-文章置顶功能" class="headerlink" title="16. 文章置顶功能"></a>16. 文章置顶功能</h1><p>移除默认安装的插件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-generator-index --save</span><br></pre></td></tr></table></figure>

<p>安装新插件:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-index-pin-top --save</span><br></pre></td></tr></table></figure>

<p>最后编辑有这需求的相关文章时，在Front-matter（文件最上方以—分隔的区域）加上一行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">top: true</span><br></pre></td></tr></table></figure>

<p>如果你置顶了多篇，怎么控制顺序呢？设置top的值（大的在前面），比如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"># Post a.md</span><br><span class="line">title: a</span><br><span class="line">top: <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># Post b.md</span><br><span class="line">title: b</span><br><span class="line">top: <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>文章 b 便会显示在文章 a 的前面</p>
<p>设置置顶图标<br>打开&#x2F;themes&#x2F;next&#x2F;layout&#x2F;_macro&#x2F;post.swig文件，在<code>&lt;div class=&quot;post-meta&quot;&gt;</code>下方，插入如下代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% if post.top %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-thumb-tack&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">7D26CD</span>&gt;</span>置顶<span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/12/%E5%A6%82%E4%BD%95%E5%9C%A8hexo%E4%B8%AD%E5%AE%89%E8%A3%85next%E4%B8%BB%E9%A2%98/image-20240115194810928.png" alt="image-20240115194810928"></p>
<h1 id="17-修改【Read-More】按钮样式"><a href="#17-修改【Read-More】按钮样式" class="headerlink" title="17. 修改【Read More】按钮样式"></a>17. 修改【Read More】按钮样式</h1><p>修改<code>themes\next\source\css\_custom\custom.styl</code>文件，加入自定义样式</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// <span class="selector-attr">[Read More]</span>按钮样式</span><br><span class="line"><span class="selector-class">.post-button</span> <span class="selector-class">.btn</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#555</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: inset <span class="number">0px</span> <span class="number">0px</span> <span class="number">10px</span> <span class="number">0px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.35</span>);</span><br><span class="line">    <span class="attribute">border</span>: none <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">transition-property</span>: unset;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0px</span> <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-button</span> <span class="selector-class">.btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">15px</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: inset <span class="number">0px</span> <span class="number">0px</span> <span class="number">10px</span> <span class="number">0px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.35</span>);</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(<span class="number">90deg</span>, <span class="number">#a166ab</span> <span class="number">0%</span>, <span class="number">#ef4e7b</span> <span class="number">25%</span>, <span class="number">#f37055</span> <span class="number">50%</span>, <span class="number">#ef4e7b</span> <span class="number">75%</span>, <span class="number">#a166ab</span> <span class="number">100%</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>效果图</strong></p>
<p><img src="/2024/01/12/%E5%A6%82%E4%BD%95%E5%9C%A8hexo%E4%B8%AD%E5%AE%89%E8%A3%85next%E4%B8%BB%E9%A2%98/image-20240116143513555.png" alt="image-20240116143513555"></p>
<p><strong>修改阅读全文前显示文字数量即位置</strong></p>
<p>打开 <code>themes/next/_config.yml</code>，搜索关键字 <code>auto_excerpt</code>， 修改length即可修改阅读全文前显示文字数量</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">150</span></span><br></pre></td></tr></table></figure>



<h1 id="18-修改链接文字样式"><a href="#18-修改链接文字样式" class="headerlink" title="18. 修改链接文字样式"></a>18. 修改链接文字样式</h1><p>打开<code>themes\next\source\css\_common\components\post\post.styl</code>添加以下代码:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.post-body</span> <span class="selector-tag">p</span> a&#123;</span><br><span class="line"></span><br><span class="line"> <span class="attribute">color</span>: <span class="number">#0593d3</span>;</span><br><span class="line"> <span class="attribute">border-bottom</span>: none;</span><br><span class="line"> <span class="selector-pseudo">&amp;:hover</span> &#123;</span><br><span class="line">   <span class="attribute">color</span>: <span class="number">#ff106c</span>;</span><br><span class="line">   <span class="attribute">text-decoration</span>: underline;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="19-头像设置图形，停留旋转效果"><a href="#19-头像设置图形，停留旋转效果" class="headerlink" title="19. 头像设置图形，停留旋转效果"></a>19. 头像设置图形，停留旋转效果</h1><p>修改<code>themes\next\source\css\_common\components\sidebar\sidebar-author.styl</code>,新增以下代码:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.site-author-image</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="variable">$site</span>-author-image-padding;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="variable">$site</span>-author-image-width;</span><br><span class="line">  <span class="attribute">height</span>: <span class="variable">$site</span>-author-image-height;</span><br><span class="line">  <span class="attribute">border</span>: <span class="variable">$site</span>-author-image-border-width solid <span class="variable">$site</span>-author-image-border-color;</span><br><span class="line">  <span class="comment">//设置圆形</span></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">2s</span> all;</span><br><span class="line">&#125;</span><br><span class="line">   <span class="comment">//旋转</span></span><br><span class="line"><span class="selector-class">.site-author-image</span>:hover&#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="20-文章添加阴影效果-文章边框"><a href="#20-文章添加阴影效果-文章边框" class="headerlink" title="20.文章添加阴影效果(文章边框)"></a>20.文章添加阴影效果(文章边框)</h1><p>打开<code>themes/next/source/css/_custom/custom.styl</code>文件添加:</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.post</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">25px</span>;</span><br><span class="line">  -webkit-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">202</span>, <span class="number">203</span>, <span class="number">203</span>, .<span class="number">5</span>);</span><br><span class="line">  -moz-<span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="built_in">rgba</span>(<span class="number">202</span>, <span class="number">203</span>, <span class="number">204</span>, .<span class="number">5</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h1 id="21-近期文章"><a href="#21-近期文章" class="headerlink" title="21. 近期文章"></a>21. 近期文章</h1><p>修改<code>themes/next/layout/_macro/sidebar.swig</code> 。找到<code>theme.social</code>板块代码，在该板块最后的endif后隔一行添加如下代码。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;# recent posts #&#125;</span><br><span class="line">&#123;% if theme.recent_posts %&#125;</span><br><span class="line">  &lt;div class=&quot;links-of-blogroll motion-element &#123;&#123; &quot;links-of-blogroll-&quot; + theme.recent_posts_layout  &#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;links-of-blogroll-title&quot;&gt;</span><br><span class="line">      &lt;!-- modify icon to fire by szw --&gt;</span><br><span class="line">      &lt;i class=&quot;fa fa-history fa-&#123;&#123; theme.recent_posts_icon | lower &#125;&#125;&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt;</span><br><span class="line">      &#123;&#123; theme.recent_posts_title &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;ul class=&quot;links-of-blogroll-list&quot;&gt;</span><br><span class="line">      &#123;% set posts = site.posts.sort(&#x27;-date&#x27;) %&#125;</span><br><span class="line">      &#123;% for post in posts.slice(&#x27;0&#x27;, &#x27;5&#x27;) %&#125;</span><br><span class="line">        &lt;li class=&quot;recent_posts_li&quot;&gt;</span><br><span class="line">          &lt;a href=&quot;&#123;&#123; url_for(post.path) &#125;&#125;&quot; title=&quot;&#123;&#123; post.title &#125;&#125;&quot; target=&quot;_blank&quot;&gt;&#123;&#123; post.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &#123;% endfor %&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>编辑<code>themes/next/source/css/_common/components/sidebar/sidebar-0blogroll.styl</code></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-class">.recent_posts_li</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: cengter;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">word-break</span>: keep-all;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>themes/next/_config.yml</code>中添加下方代码</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 近期文章设置</span></span><br><span class="line"><span class="attr">recent_posts_title:</span> <span class="string">近期文章</span></span><br><span class="line"><span class="attr">recent_posts_layout:</span> <span class="string">block</span></span><br><span class="line"><span class="attr">recent_posts:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>



<h1 id="22-文章末尾添加“文本结束”标记"><a href="#22-文章末尾添加“文本结束”标记" class="headerlink" title="22. 文章末尾添加“文本结束”标记"></a>22. 文章末尾添加“文本结束”标记</h1><p>修改在themes&#x2F;next&#x2F;layout&#x2F;_macro&#x2F;post.swig中，在wechat-subscriber.swig之前添加如下代码：</p>
<p>—————- The End —————-</p>




<h1 id="23-代码块复制选项"><a href="#23-代码块复制选项" class="headerlink" title="23. 代码块复制选项"></a>23. 代码块复制选项</h1><p>Next6 中自带了复制代码按钮，Next5 需要自己手动配置。</p>
<p>搜索 codeblock，找到如下配置：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">codeblock:</span></span><br><span class="line"><span class="attr">border_radius:</span> <span class="number">8</span>   <span class="comment"># 按钮圆滑度</span></span><br><span class="line"><span class="attr">copy_button:</span>  <span class="comment"># 设置是否开启代码块复制按钮</span></span><br><span class="line">	<span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">	<span class="attr">show_result:</span> <span class="literal">true</span>  <span class="comment"># 是否显示复制成功信息</span></span><br></pre></td></tr></table></figure>





<h1 id="24-修改加载特效"><a href="#24-修改加载特效" class="headerlink" title="24. 修改加载特效"></a>24. 修改加载特效</h1><p>由于网页不可能一直都秒进，总会等待一段时间的，所以可以设置顶部加载条。Next 已经集成了很多加载特效，可以在下面选项中在线调试测试一下。</p>
<p>搜索<code>pace</code>，找到如下代码：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 页面顶部加载条</span></span><br><span class="line"><span class="comment"># Progress bar in the top during page loading.</span></span><br><span class="line"><span class="attr">pace:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># Themes list:</span></span><br><span class="line"><span class="comment">#pace-theme-big-counter</span></span><br><span class="line"><span class="comment">#pace-theme-bounce</span></span><br><span class="line"><span class="comment">#pace-theme-barber-shop</span></span><br><span class="line"><span class="comment">#pace-theme-center-atom</span></span><br><span class="line"><span class="comment">#pace-theme-center-circle</span></span><br><span class="line"><span class="comment">#pace-theme-center-radar</span></span><br><span class="line"><span class="comment">#pace-theme-center-simple</span></span><br><span class="line"><span class="comment">#pace-theme-corner-indicator</span></span><br><span class="line"><span class="comment">#pace-theme-fill-left</span></span><br><span class="line"><span class="comment">#pace-theme-flash</span></span><br><span class="line"><span class="comment">#pace-theme-loading-bar</span></span><br><span class="line"><span class="comment">#pace-theme-mac-osx</span></span><br><span class="line"><span class="comment">#pace-theme-minimal</span></span><br><span class="line"><span class="comment"># For example</span></span><br><span class="line"><span class="comment"># pace_theme: pace-theme-center-simple</span></span><br><span class="line"><span class="attr">pace_theme:</span> <span class="string">pace-theme-minimal</span>  <span class="comment">#默认设置，可以修改为上述任何一个</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>博客</category>
      </categories>
  </entry>
  <entry>
    <title>苍穹外卖-day03-菜品管理</title>
    <url>/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h1 id="问题分析和实现思路"><a href="#问题分析和实现思路" class="headerlink" title="问题分析和实现思路"></a>问题分析和实现思路</h1><p>具体要求：新建菜品、修改菜品、删除菜品、启用禁用菜品，菜品分页查询</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240221223949538.png" alt="image-20240221223949538"></p>
<h1 id="公共字段自动填充"><a href="#公共字段自动填充" class="headerlink" title="公共字段自动填充"></a>公共字段自动填充</h1><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>业务表中的公共字段：</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240221224200823.png" alt="image-20240221224200823"></p>
<p>前面课程开发的员工管理模块和直接导入的分类管理模块，对应两张表，一个是员工表，一个是分类表，两个表中都有这四个字段。菜品表，套餐表这些业务表中都有这几个公共字段，当我们向这些表中插入数据时，需要为这些公共字段赋值。即很有可能会多次看到这种代码。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240221224523173.png" alt="image-20240221224523173">\</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240221224605012.png" alt="image-20240221224605012"></p>
<p><font color="red">在程序中存在冗余的代码，如果后期表结构发生了变化，这部分的代码都要修改。现在问题是：业务表中存在公共字段，导致Java代码中存在冗余的代码，后期如果发生变更，代码维护复杂。</font></p>
<h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><ol>
<li><p>明确公共字段在什么操作类型下会被修改。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240221224853616.png" alt="image-20240221224853616"></p>
</li>
<li><p>对于公共字段，该如何处理呢？</p>
<p>我们可以通过切面的方式处理公共字段。通过切面拦截Mapper层，统一为其赋值。但是Mapper层还有其他方法是不需要切面拦截的，例如Select。通过定义注解，表示当前方法需要被拦截，需要为这几个公共字段赋值，如果不加，则不需要处理。</p>
</li>
</ol>
<p><strong>解决办法</strong></p>
<ul>
<li>自定义注解AutoFill，用于标识需要进行公共字段自动填充的方法</li>
<li>自定义切面类AutoFillAspect，统一拦截加入了AutoFill注解的方法，通过反射为公共字段赋值</li>
<li>在Mapper的方法上加上AutoFill注解</li>
</ul>
<p>技术点：枚举、注解、AOP、反射</p>
<h2 id="代码开发"><a href="#代码开发" class="headerlink" title="代码开发"></a>代码开发</h2><ol>
<li><p>创建自定义注解AutoFill</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义注解，用于标识某个方法需要进行功能字段自动填充处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoFill &#123;</span><br><span class="line">    <span class="comment">//数据库操作类型</span></span><br><span class="line">    OperationType <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240221231935143.png" alt="image-20240221231935143"></p>
</li>
<li><p>实现自定义切面类（加上@Aspect注解确定他是切面类，设置@PointCut，指定代拦截的方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义切面，实现公共字段自动填充处理逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span> <span class="comment">//log</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//切面类</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//交由IOC容器的Bean对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定切入点（对哪些类的哪些方法指定）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span>  <span class="comment">//拦截mapper包下所有类和接口的所有方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知，在通知中进行公共字段的赋值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始进行公共字段的自动填充...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>给待测试的方法insert和update分别加上@AutoFill字段，使其成为AOP的拦截方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.AutoFill;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PutMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.image.RescaleOp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入员工数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into employee (name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user) &quot; +</span></span><br><span class="line"><span class="meta">        &quot;values(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,#&#123;createUser&#125;,#&#123;updateUser&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@AutoFill(value = OperationType.INSERT)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据主键动态修改属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AutoFill(value = OperationType.UPDATE)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>前后端联调测试</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240221233716527.png" alt="image-20240221233716527"></p>
</li>
</ol>
<p>autoFill前置通知方法执行时，拦截了@PointCut设置的符合条件的mapper方法（加了@AutoFill注解）。</p>
<p>在切面类中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;开始进行公共字段的自动填充...&quot;</span>);</span><br><span class="line">    <span class="comment">//获取当前被拦截的方法上的数据库操作类型（这个数据库操作类型加载@AutoFill注解的value属性上）</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>的具体编写思路如下：</p>
<ol>
<li>获取当前被拦截的方法的数据库的操作类型</li>
<li>获取到方法的参数（实体类，可以是员工实体，分类实体，套餐实体，菜品实体）</li>
<li>准备待赋值的数据，为实体对象赋值（有createTime，updateTime，createUser，updateUser）</li>
<li>根据当前不同的操作类型，为对应的属性赋值（通过反射）</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.AutoFill;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.AutoFillConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.Signature;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义切面，实现公共字段自动填充处理逻辑</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span> <span class="comment">//log</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//切面类</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//交由IOC容器的Bean对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定切入点（对哪些类的哪些方法指定）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span>  <span class="comment">//拦截mapper包下所有类和接口的所有方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知，在通知中进行公共字段的赋值，这个切面的执行会直接修改通过这些mapper方法传递的参数实体。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始进行公共字段的自动填充...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*        Signature signature = joinPoint.getSignature(); //获取目标方法签名</span></span><br><span class="line"><span class="comment">        String name = joinPoint.getSignature().getName();</span></span><br><span class="line"><span class="comment">        Object[] args = joinPoint.getArgs();</span></span><br><span class="line"><span class="comment">        System.out.println(signature);</span></span><br><span class="line"><span class="comment">        System.out.println(name);</span></span><br><span class="line"><span class="comment">        System.out.println(args);*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        1. 获取当前被拦截的方法的数据库的操作类型（上面是反射包的相关代码，可读性相对差一些）</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature(); <span class="comment">//方法签名对象</span></span><br><span class="line"><span class="comment">//        void com.sky.mapper.EmployeeMapper.update(Employee)</span></span><br><span class="line"><span class="comment">//        System.out.println(signature);</span></span><br><span class="line">        <span class="type">AutoFill</span> <span class="variable">autoFill</span> <span class="operator">=</span> signature.getMethod().getAnnotation(AutoFill.class);  <span class="comment">//获得方法上的注解对象</span></span><br><span class="line"><span class="comment">//        System.out.println(autoFill);</span></span><br><span class="line"><span class="comment">//        @com.sky.annotation.AutoFill(UPDATE)</span></span><br><span class="line">        <span class="type">OperationType</span> <span class="variable">operationType</span> <span class="operator">=</span> autoFill.value(); <span class="comment">//获得数据库操作类型</span></span><br><span class="line"><span class="comment">//        System.out.println(operationType);</span></span><br><span class="line"><span class="comment">//        UPDATE</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        2. 获取到方法的参数（实体类，可以是员工实体，分类实体，套餐实体，菜品实体），确保实体类对象放在第一个参数</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line"><span class="comment">//        System.out.println(args);</span></span><br><span class="line"><span class="comment">//        [Ljava.lang.Object;@6f17c9e0</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;\n\n&quot;);</span></span><br><span class="line">        <span class="keyword">if</span>(args == <span class="literal">null</span> &amp;&amp; args.length == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">entity</span> <span class="operator">=</span> args[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(args[0]);</span></span><br><span class="line"><span class="comment">//        Employee(id=8, username=wangwu, name=王五, password=null, phone=15988853410, sex=1, idNumber=112233445566778989, status=null, createTime=null, updateTime=2024-02-22T12:08:43.927707700, createUser=null, updateUser=1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        3. 准备待赋值的数据，为实体对象赋值（有createTime，updateTime，createUser，updateUser）</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">currentId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        4. 根据当前不同的操作类型，为对应的属性赋值（通过反射）</span></span><br><span class="line">        <span class="keyword">if</span>(operationType == OperationType.INSERT)&#123;</span><br><span class="line">            <span class="comment">//为4个公共字段赋值</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//直接用方法名去取method，是硬编码，如果获取的类方法发生了变化，整个代码就要重构</span></span><br><span class="line">                <span class="comment">//使用类常量命名，防止手敲出错</span></span><br><span class="line">                <span class="type">Method</span> <span class="variable">setCreateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME, LocalDateTime.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setCreateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER, Long.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//通过反射为对象属性赋值</span></span><br><span class="line">                setCreateTime.invoke(entity,now);</span><br><span class="line">                setUpdateTime.invoke(entity,now);</span><br><span class="line">                setCreateUser.invoke(entity,currentId);</span><br><span class="line">                setUpdateUser.invoke(entity,currentId);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(operationType == OperationType.UPDATE)&#123;</span><br><span class="line">            <span class="comment">//为2个公共字段赋值</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateTime</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME, LocalDateTime.class);</span><br><span class="line">                <span class="type">Method</span> <span class="variable">setUpdateUser</span> <span class="operator">=</span> entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER, Long.class);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//通过反射为对象属性赋值</span></span><br><span class="line">                setUpdateTime.invoke(entity,now);</span><br><span class="line">                setUpdateUser.invoke(entity,currentId);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将分类模块下的更新和插入方法加上@AutoFill注解</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222124141927.png" alt="image-20240222124141927"></p>
<p>将员工模块下的更新和插入方法加上@AutoFill注解</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222124243680.png" alt="image-20240222124243680"></p>
<p>修改EmpServiceImpl和CategoryServiceImpl下的实现方法，注释掉对应的代码</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222124454312.png" alt="image-20240222124454312"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222124620554.png" alt="image-20240222124620554"></p>
<h2 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h2><p><strong>前后端联调测试</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222125401691.png" alt="image-20240222125401691"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222125445984.png" alt="image-20240222125445984"></p>
<h1 id="新增菜品"><a href="#新增菜品" class="headerlink" title="新增菜品"></a>新增菜品</h1><h2 id="需求分析和设计"><a href="#需求分析和设计" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型页面</strong></p>
<p>要新增一个菜品，需要录入菜品名称、菜品分类（从分类表中查询，可以调用分类管理的接口，获取对应的数据，最终展示在下拉框中）、菜品价格、口味做法配置、菜品图片、菜品描述）</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222125801979.png" alt="image-20240222125801979"></p>
<p>业务规则：</p>
<ul>
<li>菜品名称必须是唯一的</li>
<li>菜品必须属于某个分类下 ，不能单独存在</li>
<li>新增菜品时可以根据情况选择菜品的品味</li>
<li>每个菜品必须对应一张图片</li>
</ul>
<p><strong>接口设计</strong></p>
<ul>
<li><p>根据类型查询分类（已完成）</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222130510250.png" alt="image-20240222130510250"></p>
</li>
<li><p>文件上传</p>
<p>请求方式是POST方式，请求路径是&#x2F;admin&#x2F;common&#x2F;upload，因为是文件上传，要在请求头中设置键值对，Content-Type:multipart&#x2F;form-data。返回数据要求返回文件上传的路径url（实际上是阿里云绝对的访问地址），为什么要返回的是url，因为希望获取url，在页面回显时显示该图片。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222131025056.png" alt="image-20240222131025056"></p>
</li>
<li><p>新增菜品</p>
<p>请求方式是POST方式，请求地址是&#x2F;admin&#x2F;dish，以JSON格式提交数据。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222131851174.png" alt="image-20240222131851174"></p>
<p><strong>数据库设计（dish菜品表和dish_flavor口味表，dish菜品表包含分类id）</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222132532058.png" alt="image-20240222132532058"></p>
</li>
</ul>
<h2 id="代码开发-1"><a href="#代码开发-1" class="headerlink" title="代码开发"></a>代码开发</h2><p>分析下来，新增菜品要涉及到三个接口，第一个接口是查询分类接口，第二个接口，文件上传接口，新增菜品接口。</p>
<p><strong>开发文件上传接口：</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222133731966.png" alt="image-20240222133731966"></p>
<p><strong>创建CommonController层代码</strong>(注意接收的参数是二进制的multipart&#x2F;form-data，请求体中的参数是file)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/common&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;通用接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件上传</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;文件上传&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;文件上传：&#123;&#125;&quot;</span>,file);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222152625240.png" alt="image-20240222152625240"></p>
<p><strong>application-dev.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">sky_take_out</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint :</span> <span class="string">https://oss-cn-hangzhou.aliyuncs.com</span></span><br><span class="line">    <span class="attr">access-key-id :</span> <span class="string">xxx</span></span><br><span class="line">    <span class="attr">access-key-secret :</span> <span class="string">xxx</span></span><br><span class="line">    <span class="attr">bucket-name :</span> <span class="string">waterdance-web-tlias</span></span><br></pre></td></tr></table></figure>

<p><strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-circular-references:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">$&#123;sky.datasource.driver-class-name&#125;</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://$&#123;sky.datasource.host&#125;:$&#123;sky.datasource.port&#125;/$&#123;sky.datasource.database&#125;?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">$&#123;sky.datasource.username&#125;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">$&#123;sky.datasource.password&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment">#mapper配置文件</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.sky.entity</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#开启驼峰命名</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com:</span></span><br><span class="line">      <span class="attr">sky:</span></span><br><span class="line">        <span class="attr">mapper:</span> <span class="string">debug</span></span><br><span class="line">        <span class="attr">service:</span> <span class="string">info</span></span><br><span class="line">        <span class="attr">controller:</span> <span class="string">info</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="comment"># 设置jwt签名加密时使用的秘钥</span></span><br><span class="line">    <span class="attr">admin-secret-key:</span> <span class="string">itcast</span></span><br><span class="line">    <span class="comment"># 设置jwt过期时间</span></span><br><span class="line">    <span class="attr">admin-ttl:</span>  <span class="number">864000000</span></span><br><span class="line">    <span class="comment"># 设置前端传递过来的令牌名称</span></span><br><span class="line">    <span class="attr">admin-token-name:</span> <span class="string">token</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">$&#123;sky.alioss.endpoint&#125;</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">$&#123;sky.alioss.access-key-id&#125;</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">$&#123;sky.alioss.access-key-secret&#125;</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">$&#123;sky.alioss.bucket-name&#125;</span></span><br></pre></td></tr></table></figure>

<p><font color="red">为什么在application.yml中定义aliyun参数时可以不用硬编码，因为我们定义了属性配置类，在com.sky.properties下。且我们特意将具体的配置写在了application-dev.yml文件中，是因为开发环境下硬编码写入的OSS配置可能不是生产环境的配置文件。</font></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222154924046.png" alt="image-20240222154924046"></p>
<p><font color="red">application.yml文件中指定了具体的配置文件，这里设置了spring.profiles.active的属性为dev，即可以导入application-dev.yml中的配置而不用硬编码。</font></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240222160207606.png" alt="image-20240222160207606"></p>
<p>查看AliOssUtil.java文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClientBuilder;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSException;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件上传</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] bytes, String objectName)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建PutObject请求。</span></span><br><span class="line">            ossClient.putObject(bucketName, objectName, <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (OSSException oe) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;but was rejected with an error response for some reason.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + oe.getErrorMessage());</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Code:&quot;</span> + oe.getErrorCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Request ID:&quot;</span> + oe.getRequestId());</span><br><span class="line">            System.out.println(<span class="string">&quot;Host ID:&quot;</span> + oe.getHostId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException ce) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an ClientException, which means the client encountered &quot;</span></span><br><span class="line">                    + <span class="string">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;such as not being able to access the network.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + ce.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ossClient != <span class="literal">null</span>) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//文件访问路径规则 https://BucketName.Endpoint/ObjectName</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;https://&quot;</span>);</span><br><span class="line">        stringBuilder</span><br><span class="line">                .append(bucketName)</span><br><span class="line">                .append(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">                .append(endpoint)</span><br><span class="line">                .append(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                .append(objectName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;文件上传到:&#123;&#125;&quot;</span>, stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><font color="red">AliOssUtil类还没有实体化，他的属性值是空的，我们要在配置类中声明该类的对象，加上@Bean注解，将其加入到IOC容器中。</font></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.properties.AliOssProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.AliOssUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置类，用于创建AliOssUtil对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> AliOssUtil <span class="title function_">aliOssUtil</span><span class="params">(AliOssProperties aliOssProperties)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始创建阿里云文件上传工具类对象：&#123;&#125;&quot;</span>,aliOssProperties);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AliOssUtil</span>(aliOssProperties.getEndpoint(),</span><br><span class="line">                                aliOssProperties.getAccessKeyId(),</span><br><span class="line">                                aliOssProperties.getAccessKeySecret(),</span><br><span class="line">                                aliOssProperties.getBucketName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实现上传图片至阿里云服务器的功能</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.AliOssUtil;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/common&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;通用接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliOssUtil aliOssUtil;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件上传</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;文件上传&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;文件上传：&#123;&#125;&quot;</span>,file);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//原始文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="comment">//截取原始文件名的后缀 dfdfdf.png</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="comment">//构造新文件名称</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> UUID.randomUUID().toString() + extension;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//为了防止文件重名导致文件覆盖，使用UUID重命名，</span></span><br><span class="line">            <span class="comment">//文件的请求路径</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> aliOssUtil.upload(file.getBytes(), objectName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Result.success(filePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;文件上传失败：&#123;&#125;&quot;</span>,e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.error(MessageConstant.UPLOAD_FAILED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>前后端联调</strong></p>
<p>前端请求了我们返回的路径，从而展示了图片的信息。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223174439657.png" alt="image-20240223174439657"></p>
<p><strong>新增菜品接口</strong></p>
<p><strong>DishController层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;菜品相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增菜品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;新增菜品接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;新增菜品：&#123;&#125;&quot;</span>,dishDTO);</span><br><span class="line">        dishService.saveWithFlavor(dishDTO);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写DishServiceImpl层代码</strong></p>
<p>注意，这边加了@Transactional注解，表示将方法作为事务执行，要么全部成功，要么一起失败。</p>
<ol>
<li>dish表插入插入菜品</li>
<li>dishFlavor表插入口味</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishFlavorMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增菜品和对应的口味</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span> <span class="comment">//要么全成功，要么全失败</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建实体类Dish对象（属性命名必须保持一致才能拷贝）</span></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        BeanUtils.copyProperties(dishDTO,dish);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向菜品表插入1条数据</span></span><br><span class="line">        dishMapper.insert(dish);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取insert语句生成的主键值</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dish.getId();</span><br><span class="line"></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">        <span class="keyword">if</span>(flavors != <span class="literal">null</span> &amp;&amp; flavors.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//为口味表的元素设置dishId。</span></span><br><span class="line">            flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">                dishFlavor.setDishId(dishId);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//向口味表插入n条数据</span></span><br><span class="line">            <span class="comment">//sql支持批量插入，直接把集合对象传入</span></span><br><span class="line">            dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>DishMapper.xml</strong>（插入语句要返回对应的id主键，所以设置了useGeneratedKeys&#x3D;”true” keyProperty&#x3D;”id”）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span> # 获得insert语句插入所生成的主键值</span><br><span class="line">        insert into dish (name, category_id, price, image, description, create_time, update_time, create_user,</span><br><span class="line">                          update_user, status)</span><br><span class="line">        VALUES (#&#123;name&#125;, #&#123;categoryId&#125;, #&#123;price&#125;, #&#123;image&#125;, #&#123;description&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;,</span><br><span class="line">                #&#123;updateUser&#125;, #&#123;status&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>DishFlavorMapper.xml</strong>（将集合直接foreach遍历插入到dishflavor表）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sky.mapper.DishFlavorMapper&quot;</span>&gt;</span><br><span class="line">    &lt;insert id=<span class="string">&quot;insertBatch&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">dish_flavor</span> <span class="params">(dish_id, name, value)</span></span><br><span class="line">        values</span><br><span class="line">        &lt;foreach collection=<span class="string">&quot;flavors&quot;</span> item=<span class="string">&quot;df&quot;</span> separator=<span class="string">&quot;,&quot;</span>&gt;</span><br><span class="line">            (#&#123;df.dishId&#125;,#&#123;df.name&#125;,#&#123;df.value&#125;)</span><br><span class="line">        &lt;/foreach&gt;</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>





<h2 id="功能测试-1"><a href="#功能测试-1" class="headerlink" title="功能测试"></a>功能测试</h2><p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223192947602.png" alt="image-20240223192947602"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223193053795.png" alt="image-20240223193053795"></p>
<h1 id="菜品分页查询"><a href="#菜品分页查询" class="headerlink" title="菜品分页查询"></a>菜品分页查询</h1><h2 id="需求分析和设计-1"><a href="#需求分析和设计-1" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型：</strong></p>
<p>这里有菜品名称、图片、分类、售价、状态等等。因为是分页查询，所以在右下角需要展示分页条。分页条展示总计记录数和页码。搜索栏中有菜品的名称、菜品的分类、售卖状态等等。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223215642367.png" alt="image-20240223215642367"></p>
<p>业务规则：</p>
<ul>
<li>根据页码展示菜品信息</li>
<li>每页展示10条数据</li>
<li>分页查询时可以根据需要输入菜品名称、菜品分类、菜品状态进行查询</li>
</ul>
<p><strong>接口设计</strong></p>
<p>因为分页查询是查询类的操作，所以它的请求方式是GET，请求路径还是&#x2F;admin&#x2F;dish&#x2F;page，注意，在返回数据中，categoryName字段不在dish表中</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223221213389.png" alt="image-20240223221213389"></p>
<h2 id="代码开发-2"><a href="#代码开发-2" class="headerlink" title="代码开发"></a>代码开发</h2><p>根据菜品分页查询接口定义设计对应的DTO：（DTO接收前端传来的参数）</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223221625402.png" alt="image-20240223221625402"></p>
<p>根据菜品分页查询接口定义设计对应的VO：（VO是返回前端的数据）</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223222003240.png" alt="image-20240223222003240"></p>
<p><strong>controller层代码编写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;菜品相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;菜品分页查询接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;菜品分页查询:&#123;&#125;&quot;</span>,dishPageQueryDTO);</span><br><span class="line"></span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> dishService.pageQuery(dishPageQueryDTO);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishFlavorMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 菜品分页查询</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishPageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;</span><br><span class="line">        PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">        Page&lt;DishVO&gt; page = dishMapper.pageQuery(dishPageQueryDTO);</span><br><span class="line"></span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(),page.getResult());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.AutoFill;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入菜品数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AutoFill(value= OperationType.INSERT)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Dish dish)</span>;</span><br><span class="line"></span><br><span class="line">    Page&lt;DishVO&gt; <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>mapper.xml编写</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.vo.DishVO&quot;</span>&gt;</span></span><br><span class="line">        select d.*, c.name as categoryName from dish d left join category c on d.category_id = c.id</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span> d.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;),<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status!=null&quot;</span>&gt;</span> d.status = #&#123;status&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span> d.category_id = #&#123;categoryId&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by d.create_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="功能测试-2"><a href="#功能测试-2" class="headerlink" title="功能测试"></a>功能测试</h2><p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240223231956652.png" alt="image-20240223231956652"></p>
<h1 id="删除菜品"><a href="#删除菜品" class="headerlink" title="删除菜品"></a>删除菜品</h1><h2 id="需求分析和设计-2"><a href="#需求分析和设计-2" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型：</strong></p>
<p>在操作列有删除按钮，点击删除可以删除单个菜品，勾选多个菜品点击批量删除可以删除多个菜品。在逻辑实现功能上，如果菜品正在启售，是不能删除菜品的。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224131914657.png" alt="image-20240224131914657"></p>
<p>业务规则：</p>
<ul>
<li>可以一次删除一个菜品，也可以批量删除菜品</li>
<li>起售中的菜品不能删除</li>
<li>被套餐关联的菜品不能删除</li>
<li>删除菜品后，关联的口味数据也需要删除掉</li>
</ul>
<p><strong>接口分析</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224132421431.png" alt="image-20240224132421431"></p>
<p><strong>数据库设计</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224132745888.png" alt="image-20240224132745888"></p>
<ul>
<li>dish表</li>
<li>dish_flavor表（菜品的口味表）</li>
<li>setmeal_dish表（套餐和菜品的关联表）</li>
</ul>
<h2 id="代码开发-3"><a href="#代码开发-3" class="headerlink" title="代码开发"></a>代码开发</h2><p>如果传入的参数是string类型逗号分隔的数组，请求方式是query。接收该参数的方法有以下几种。网址：<a href="https://localhost:8080/admin/dish?ids=1,2,3">https://localhost:8080/admin/dish?ids=1,2,3</a></p>
<ol>
<li>String ids</li>
<li><font color="red">@RequestParam List&lt;Long&gt; ids（加注解@RequestParam之后，MVC才会动态解析自动串并将其封装到ids中)</font></li>
</ol>
<p><strong>controller层代码编写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;菜品相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 菜品批量删除接口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;菜品批量删除接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;菜品批量删除：&#123;&#125;&quot;</span>, ids);</span><br><span class="line">        dishService.deleteBatch(ids);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service层代码编写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.DeletionNotAllowedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishFlavorMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.SetmealDishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 菜品批量删除功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        <span class="comment">//判断当前菜品是否能够删除--是否存在起售中的菜品？？</span></span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line">            <span class="keyword">if</span>(dish.getStatus() == StatusConstant.ENABLE)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断当前菜品是否能够删除--是否被套餐关联了？？</span></span><br><span class="line">        List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(ids);</span><br><span class="line">        <span class="keyword">if</span>(setmealIds != <span class="literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//当前菜品被套餐关联了，不能删除</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_BE_RELATED_BY_SETMEAL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除菜品表中的菜品数据</span></span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            dishMapper.deleteById(id);</span><br><span class="line">            <span class="comment">//删除菜品关联的口味数据</span></span><br><span class="line">            dishFlavorMapper.deleteByDishId(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码编写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.AutoFill;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据主删除菜品数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from dish where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDishMapper</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据菜品ID查询对应的套餐id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishIds</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//select setmeal_id from setmeal_dish where dishId in dishIds;</span></span><br><span class="line">    List&lt;Long&gt; <span class="title function_">getSetmealIdsByDishIds</span><span class="params">(List&lt;Long&gt; dishIds)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.SetmealDishMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSetmealIdsByDishIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">        select setmeal_id from setmeal_dish where setmeal_id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;dishIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;dishId&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;dishId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="功能测试-3"><a href="#功能测试-3" class="headerlink" title="功能测试"></a>功能测试</h2><p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224141308731.png" alt="image-20240224141308731"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224141320685.png" alt="image-20240224141320685"></p>
<p><strong>改进空间</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.DeletionNotAllowedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishFlavorMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.SetmealDishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 菜品批量删除功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        <span class="comment">//判断当前菜品是否能够删除--是否存在起售中的菜品？？</span></span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line">            <span class="keyword">if</span>(dish.getStatus() == StatusConstant.ENABLE)&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断当前菜品是否能够删除--是否被套餐关联了？？</span></span><br><span class="line">        List&lt;Long&gt; setmealIds = setmealDishMapper.getSetmealIdsByDishIds(ids);</span><br><span class="line">        <span class="keyword">if</span>(setmealIds != <span class="literal">null</span> &amp;&amp; setmealIds.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//当前菜品被套餐关联了，不能删除</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_BE_RELATED_BY_SETMEAL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除菜品表中的菜品数据</span></span><br><span class="line">        <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">            dishMapper.deleteById(id);</span><br><span class="line">            <span class="comment">//删除菜品关联的口味数据</span></span><br><span class="line">            dishFlavorMapper.deleteByDishId(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的删除菜品表中菜品要求对数据库频繁操作。能够只发一条sql，就删除菜品口味表中所有相关数据。</p>
<p>创建deleteByIds和deleteByDishIds，传入ids参数，直接在sql语句中删除对应的数据</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishFlavorMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByDishIds&quot;</span>&gt;</span></span><br><span class="line">        delete from dish_flavor where dish_id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span> &gt;</span></span><br><span class="line">        delete from dish where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="修改菜品"><a href="#修改菜品" class="headerlink" title="修改菜品"></a>修改菜品</h1><h2 id="需求分析和设计-3"><a href="#需求分析和设计-3" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224151756233.png" alt="image-20240224151756233"></p>
<p><strong>接口设计</strong></p>
<ul>
<li>根据id查询菜品</li>
<li>根据类型查询分类（已经实现）</li>
<li>文件上传（已实现）</li>
<li>修改菜品</li>
</ul>
<p><strong>根据id查询菜品</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224152053594.png" alt="image-20240224152053594"></p>
<p><strong>修改菜品</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224152241187.png" alt="image-20240224152241187"></p>
<h2 id="代码开发-4"><a href="#代码开发-4" class="headerlink" title="代码开发"></a>代码开发</h2><p><strong>根据id查询菜品</strong></p>
<p><strong>controller层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;菜品相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据id查询菜品&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;DishVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;根据id查询菜品：&#123;&#125;&quot;</span>,id);</span><br><span class="line">        <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(dishVO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.DeletionNotAllowedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishFlavorMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.SetmealDishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询菜品和对应的口味数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> DishVO <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//1. 查询id查询菜品相关信息</span></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> dishMapper.getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 查询菜品查询口味数据</span></span><br><span class="line">        List&lt;DishFlavor&gt; dishFlavors =  dishFlavorMapper.getByDishId(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 将查询到的数据封装为VO</span></span><br><span class="line">        <span class="type">DishVO</span> <span class="variable">dishVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(dish,dishVO);</span><br><span class="line">        dishVO.setFlavors(dishFlavors);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dishVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishFlavorMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据菜品id查询对应的口味数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from dish_flavor where dish_id = #&#123;dishId&#125;&quot;)</span></span><br><span class="line">    List&lt;DishFlavor&gt; <span class="title function_">getByDishId</span><span class="params">(Long dishId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>修改菜品</strong></p>
<p><strong>编写controller层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;菜品相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;修改菜品接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;修改菜品:&#123;&#125;&quot;</span>,dishDTO);</span><br><span class="line">        dishService.updateWithFlavor(dishDTO);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.DeletionNotAllowedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishFlavorMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.SetmealDishMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishMapper setmealDishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id修改菜品和对应的口味数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line">        <span class="comment">//修改菜品表基本信息</span></span><br><span class="line">        <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        BeanUtils.copyProperties(dishDTO,dish);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除原有的口味数据</span></span><br><span class="line">        dishMapper.update(dish);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除原有口味数据</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> dishDTO.getId();</span><br><span class="line">        dishFlavorMapper.deleteByDishId(id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//重新插入口味数据</span></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDTO.getFlavors();</span><br><span class="line">        <span class="keyword">if</span> (flavors != <span class="literal">null</span> &amp;&amp; flavors.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//为口味表的元素设置dishId。</span></span><br><span class="line">            flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">                dishFlavor.setDishId(id);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//向口味表插入n条数据</span></span><br><span class="line">            <span class="comment">//sql支持批量插入，直接把集合对象传入</span></span><br><span class="line">            dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.annotation.AutoFill;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.DishPageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.sky.enumeration.OperationType;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.DishVO;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ID动态修改菜品数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AutoFill(value = OperationType.UPDATE)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Dish dish)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.Dish&quot;</span>&gt;</span></span><br><span class="line">        update dish</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;name != null&quot;</span>&gt;</span>name=#&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;categoryId != null&quot;</span>&gt;</span>category_id=#&#123;categoryId&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;price != null&quot;</span>&gt;</span>price=#&#123;price&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;image != null&quot;</span>&gt;</span>image=#&#123;image&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;description != null&quot;</span>&gt;</span>description=#&#123;description&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;status != null&quot;</span>&gt;</span>status=#&#123;status&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;name != null&quot;</span>&gt;</span>name=#&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span> update_time = #&#123;updateTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span> update_user = #&#123;updateUser&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="功能测试-4"><a href="#功能测试-4" class="headerlink" title="功能测试"></a>功能测试</h2><p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224155659378.png" alt="image-20240224155659378"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day03-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86/image-20240224155719158.png" alt="image-20240224155719158"></p>
]]></content>
      <categories>
        <category>苍穹外卖</category>
      </categories>
  </entry>
  <entry>
    <title>苍穹外卖-day02-员工管理、分类管理</title>
    <url>/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<h1 id="员工管理、分类管理"><a href="#员工管理、分类管理" class="headerlink" title="员工管理、分类管理"></a>员工管理、分类管理</h1><p>本节主要完成商家管理部分的员工管理和分类管理。</p>
<p><strong>员工管理模块</strong>有添加员工、分页查询员工、修改员工、禁用员工等实现功能。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221122736390.png" alt="image-20240221122736390"></p>
<p><strong>分类管理模块</strong>有新建菜品分类和新增套餐分类，查询分类，对分类进行修改、删除、禁用等功能。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221122850337.png" alt="image-20240221122850337"></p>
<h1 id="新增员工"><a href="#新增员工" class="headerlink" title="新增员工"></a>新增员工</h1><h2 id="需求分析和设计"><a href="#需求分析和设计" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型：</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221123500727.png" alt="image-20240221123500727"></p>
<ul>
<li><p>账号必须是唯一的</p>
</li>
<li><p>手机号为合法的11位手机号码</p>
</li>
<li><p>身份证为合法的18位身份证号码</p>
</li>
<li><p>密码默认为123456</p>
</li>
</ul>
<p>接口的请求方式应该是POST，提交的数据是表单项中的数据，以json格式提交，后端返回的设计格式也是json。</p>
<p><strong>接口设计</strong>：</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221124004779.png" alt="image-20240221124004779"></p>
<p>本项目约定：</p>
<ul>
<li>管理端发出的请求，统一使用&#x2F;admin作为前缀</li>
<li>用户端发出的请求，统一使用&#x2F;user作为前缀</li>
</ul>
<p><strong>数据库设计（employee表）</strong>：</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221124246494.png" alt="image-20240221124246494"></p>
<h2 id="代码开发"><a href="#代码开发" class="headerlink" title="代码开发"></a>代码开发</h2><p>根据新增员工接口设计对应的DTO，封装前端提交过来的数据。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221124508384.png" alt="image-20240221124508384"></p>
<p>为什么不用实体类来封装前端提交的数据？</p>
<p><font color="red">原因：当前端提交的数据和实体类中对应的属性差别较大时，建议使用DTO来封装数据。</font></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221124722772.png" alt="image-20240221124722772"></p>
<p><strong>编写controller层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.JwtClaimsConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.EmployeeLoginVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;员工相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增员工</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增员工&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;新增员工：&#123;&#125;&quot;</span>, employeeDTO);</span><br><span class="line">        employeeService.save(employeeDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.JwtClaimsConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.EmployeeLoginVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;员工相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增员工</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增员工&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;新增员工：&#123;&#125;&quot;</span>, employeeDTO);</span><br><span class="line">        employeeService.save(employeeDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入员工数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into employee (name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user) &quot; +</span></span><br><span class="line"><span class="meta">        &quot;values(#&#123;name&#125;,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,#&#123;sex&#125;,#&#123;idNumber&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;,#&#123;createUser&#125;,#&#123;updateUser&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h2><p>功能测试方式</p>
<ul>
<li>通过接口文档测试</li>
<li>通过前后端联调测试</li>
</ul>
<p>注意：由于开发阶段前端和后端是并行开发的，后端完成某个功能后，此时前端对应的功能可能还没有开发完成，导致无法进行前后端联调测试。所以在开发阶段，后端测试主要以接口文档测试为主。</p>
<p>先通过员工登录接口获取token，并将其设置在文档管理的全局参数设置中。</p>
<p><strong>获取token</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221134158354.png" alt="image-20240221134158354"></p>
<p><strong>将token配置到全局参数设置中</strong>（参数类型是header）</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221134241220.png" alt="image-20240221134241220"></p>
<p><strong>再次测试新增员工方法</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221134327794.png" alt="image-20240221134327794"></p>
<p><strong>前后端联调</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221134704428.png" alt="image-20240221134704428"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221134910323.png" alt="image-20240221134910323"></p>
<h2 id="代码完善"><a href="#代码完善" class="headerlink" title="代码完善"></a>代码完善</h2><p>程序存在的问题：</p>
<ul>
<li><p>录入的用户名已经存在，抛出异常后没有处理</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221135055314.png" alt="image-20240221135055314"></p>
<p>解决办法：在全局异常处理器中捕获异常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.BaseException;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.message.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLIntegrityConstraintViolationException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理器，处理项目中抛出的业务异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理SQL异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line"><span class="comment">//        Duplicate entry &#x27;zhangsan&#x27; for key &#x27;employee.idx_username&#x27;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">        <span class="keyword">if</span>(message.contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String[] split = message.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> split[<span class="number">2</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> username + MessageConstant.ALREADY_EXISTS;</span><br><span class="line">            <span class="keyword">return</span> Result.error(msg);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新增员工时，创建人id和修改人id设置为了固定值</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221135135315.png" alt="image-20240221135135315"></p>
<p>解决办法：针对第二个问题，需要通过某种方式动态获取当前登录员工的id。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221145518597.png" alt="image-20240221145518597"></p>
<p>JWT认证流程</p>
<p>前端发起请求，把用户名和密码提交给后端。后端校验之后认证通过，生成JWT token并返回给前端，前端会在本地保存JWT令牌。后续前端的每次操作请求后端接口都会在请求头中携带JWT，后端接收到请求后会用拦截器拦截请求，检查token，如果通过，就放行，不通过就返回错误信息。</p>
<p>拦截器验证的token中存在用户名和密码。如果新增员工业务在拦截器拦截时能够获取JWT中的信息，就能确定当前登录员工的ID。</p>
</li>
</ul>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221150141394.png" alt="image-20240221150141394"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221150254097.png" alt="image-20240221150254097"></p>
<p>解析出登录员工ID之后，如何传递给Service的save方法?</p>
<p>答：ThreadLocal。</p>
<p>ThreadLocal并不是一个Thread，而是Thread的局部变量。</p>
<p><font color="red">ThreadLocal为每个线程提供单独一份存储空间，具有线程隔离的效果，只有在线程内才能获取对应的值，线程外则不能访问。</font></p>
<p><font color="red">客户端发起的每一次请求，tomcat都会为其分配单独的线程，在线程上可能要执行不同的代码，比如拦截器代码，controller代码，service代码，它们都属于同一个线程。只要满足这个条件，就可以使用ThreadLocal，将我们的数据存进去，在对应的地方取出来。</font></p>
<p>ThreadLocal常用方法</p>
<ul>
<li>public void set(T value) 设置当前线程的线程局部变量的值</li>
<li>public T get() 返回当前线程所对应的线程局部变量的值</li>
<li>public void remove() 移除当前线程的线程局部变量</li>
</ul>
<p>我们使用ThreadLocal时通常的做法是将其封装为工具类，这样使用起来更方便。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221151624886.png" alt="image-20240221151624886"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>实现步骤</p>
<ol>
<li><p>在JWT拦截器部分将解析出来的ID值加入到Thread中。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221152153763.png" alt="image-20240221152153763"></p>
</li>
<li><p>在新增员工业务将对应的Thread值存入数据表中</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221152257216.png" alt="image-20240221152257216"></p>
</li>
</ol>
<h1 id="员工分页查询"><a href="#员工分页查询" class="headerlink" title="员工分页查询"></a>员工分页查询</h1><h2 id="需求分析和设计-1"><a href="#需求分析和设计-1" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型：</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221152741313.png" alt="image-20240221152741313"></p>
<p>业务规则：</p>
<ul>
<li>根据页码展示员工信息</li>
<li>每页展示10条数据</li>
<li>分页查询时可以根据需要，输入员工姓名进行查询</li>
</ul>
<p><strong>接口设计</strong></p>
<p>操作是查询操作，请求方式是get类型，分页查询需要将页码，每一页的记录数，员工姓名作为查询参数发送给后端，后端需要展示总的记录数，并且将当前页展示的数据集合响应给前端。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221153439677.png" alt="image-20240221153439677"></p>
<p>请求参数是以Query的方式传到后端的，相当于在url后面加参数和值。这意味着controller层对应方法要加上与之同名的形参。</p>
<h2 id="代码开发-1"><a href="#代码开发-1" class="headerlink" title="代码开发"></a>代码开发</h2><p>根据分页查询接口设计对应的DTO。</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221154353897.png" alt="image-20240221154353897"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221154344482.png" alt="image-20240221154344482"></p>
<p>后面所有的分页查询，统一都封装成PageResult对象：</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221154906603.png" alt="image-20240221154906603"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221154939771.png" alt="image-20240221154939771"></p>
<p>员工信息分页查询后端返回的对象类型为：Result&lt;PageResult&gt;</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221155025472.png" alt="image-20240221155025472"></p>
<p><strong>controller层代码编写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.JwtClaimsConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.EmployeeLoginVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;员工相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;员工分页查询&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;员工分页查询：参数为：&#123;&#125;&quot;</span>,employeePageQueryDTO);</span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> employeeService.pageQuery(employeePageQueryDTO);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service层代码编写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.PasswordConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountLockedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountNotFoundException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.PasswordErrorException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeePageQueryDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;</span><br><span class="line"><span class="comment">//        //1.设置分页参数</span></span><br><span class="line"><span class="comment">//        PageHelper.startPage(employeePageQueryDTO.getPage(),employeePageQueryDTO.getPageSize());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        //2.执行查询</span></span><br><span class="line"><span class="comment">//        List&lt;Employee&gt; empList = employeeMapper.list();</span></span><br><span class="line"><span class="comment">//        Page&lt;Employee&gt; p = (Page&lt;Employee&gt;) empList;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        // 3. 封装PageBean对象</span></span><br><span class="line"><span class="comment">//        PageResult pageResult = new PageResult(p.getTotal(),p.getResult());</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        return pageResult;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//开始分页查询</span></span><br><span class="line">        PageHelper.startPage(employeePageQueryDTO.getPage(),employeePageQueryDTO.getPageSize());</span><br><span class="line"></span><br><span class="line">        Page&lt;Employee&gt; page = employeeMapper.pageQuery(employeePageQueryDTO);</span><br><span class="line"></span><br><span class="line">        <span class="type">PageResult</span> <span class="variable">pageResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(), page.getResult());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码编写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from employee&quot;)</span></span><br><span class="line">    List&lt;Employee&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    Page&lt;Employee&gt; <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的mapper.xml文件编写pageQuery实现</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">        select * from employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by create_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="功能测试-1"><a href="#功能测试-1" class="headerlink" title="功能测试"></a>功能测试</h2><p>可以通过接口文档进行测试，也可以通过前后端联调测试，最后操作时间字段展示有问题，如下所示：</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221162938244.png" alt="image-20240221162938244"></p>
<h2 id="代码完善-1"><a href="#代码完善-1" class="headerlink" title="代码完善"></a>代码完善</h2><p>解决方式：</p>
<ul>
<li><p>方式一：在属性上加入注解，对日期进行格式化（缺点：只能给单个成员变量加注释）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221164702793.png" alt="image-20240221164702793"></p>
</li>
<li><p>方式二：在WebMvcConfiguration中拓展Spring MVC的消息转换器，统一对日期类型进行格式化处理</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221164331753.png" alt="image-20240221164331753"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.interceptor.JwtTokenAdminInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.sky.json.JacksonObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置类，注册web层相关组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenAdminInterceptor jwtTokenAdminInterceptor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扩展Spring MVC框架的消息转化器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个消息转换器对象</span></span><br><span class="line">        <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要为消息转换器设置一个对象转换器，对象转换器可以将Java对象序列化为json数组</span></span><br><span class="line">        converter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将我们自己的转换器放入spring MVC框架的容器中</span></span><br><span class="line">        converters.add(<span class="number">0</span>,converter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JacksonObjectMapper相关代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.json;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象</span></span><br><span class="line"><span class="comment"> * 将JSON解析为Java对象的过程称为 [从JSON反序列化Java对象]</span></span><br><span class="line"><span class="comment"> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonObjectMapper</span> <span class="keyword">extends</span> <span class="title class_">ObjectMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="comment">//public static final String DEFAULT_DATE_TIME_FORMAT = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JacksonObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">//收到未知属性时不报异常</span></span><br><span class="line">        <span class="built_in">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//反序列化时，属性不存在的兼容处理</span></span><br><span class="line">        <span class="built_in">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line">        <span class="type">SimpleModule</span> <span class="variable">simpleModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleModule</span>()</span><br><span class="line">                .addDeserializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addDeserializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))</span><br><span class="line">                .addSerializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .addSerializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .addSerializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span></span><br><span class="line">        <span class="built_in">this</span>.registerModule(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="启用禁用员工账号"><a href="#启用禁用员工账号" class="headerlink" title="启用禁用员工账号"></a>启用禁用员工账号</h1><h2 id="需求分析和设计-2"><a href="#需求分析和设计-2" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型：</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221170119891.png" alt="image-20240221170119891"></p>
<p>业务规则：</p>
<ul>
<li>可以对状态为“启用”的员工账号进行“禁用”操作</li>
<li>可以对状态为“禁用”的员工账号进行“启用”操作</li>
<li>状态为“禁用”的员工账号不能登录系统</li>
</ul>
<p><strong>接口设计</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221170325406.png" alt="image-20240221170325406"></p>
<p><font color="red">注意这里的status是路径参数，但是id是query方式传上去的。于是我们在controller层接受这个两个参数时，status要用@PathVariable注解。id则直接作为函数的参数形参传入即可。</font></p>
<h2 id="代码开发-2"><a href="#代码开发-2" class="headerlink" title="代码开发"></a>代码开发</h2><p><strong>编写controller层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.JwtClaimsConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.EmployeeLoginVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;员工相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启用禁用员工账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;启用禁用员工账号&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status,Long id)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;启用禁用员工账号:&#123;&#125;,&#123;&#125;&quot;</span>,status,id);</span><br><span class="line"></span><br><span class="line">        employeeService.startOrStop(status,id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.PasswordConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountLockedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountNotFoundException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.PasswordErrorException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启用禁用员工账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// update employee set status = ? where id = ?</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*Employee employee = new Employee();</span></span><br><span class="line"><span class="comment">        employee.setStatus(status);</span></span><br><span class="line"><span class="comment">        employee.setId(id);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> Employee.builder()</span><br><span class="line">            .status(status)</span><br><span class="line">            .id(id)</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">        employeeMapper.update(employee);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>编写mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据主键动态修改属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Employee&quot;</span>&gt;</span></span><br><span class="line">        update employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span>password = #&#123;password&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span>username = #&#123;username&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span>phone = #&#123;phone&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span>sex = #&#123;sex&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idNumber != null&quot;</span>&gt;</span>id_Number = #&#123;idNumber&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #&#123;updateTime&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span>update_user = #&#123;updateUser&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="功能测试-2"><a href="#功能测试-2" class="headerlink" title="功能测试"></a>功能测试</h2><p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221174844571.png" alt="image-20240221174844571"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221174911640.png" alt="image-20240221174911640"></p>
<h1 id="编辑员工"><a href="#编辑员工" class="headerlink" title="编辑员工"></a>编辑员工</h1><h2 id="需求分析和设计-3"><a href="#需求分析和设计-3" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221175433011.png" alt="image-20240221175433011"></p>
<p>对员工信息进行操作，能够修改的选项如上图所示。</p>
<p>要完成编辑员工的业务，可以看到，这边有一个回显操作，回写需要根据员工的ID查询出数据，然后才能在这个页面回显数据。</p>
<p>所以第一步要根据ID查询用户信息，第二步在表单页面进行信息修改。</p>
<p>编辑员工功能涉及到两个接口：</p>
<ul>
<li><p>根据id查询员工信息</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221180539074.png" alt="image-20240221180539074"></p>
</li>
<li><p>编辑员工信息（它属于修改类的操作，所以请求方式是PUT）</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221180634012.png" alt="image-20240221180634012"></p>
</li>
</ul>
<h2 id="代码开发-3"><a href="#代码开发-3" class="headerlink" title="代码开发"></a>代码开发</h2><ul>
<li><p>根据id查询员工信息</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221180539074.png" alt="image-20240221180539074"></p>
</li>
</ul>
<p><strong>controller层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.JwtClaimsConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.EmployeeLoginVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;员工相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据id查询用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success(employee);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.PasswordConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountLockedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountNotFoundException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.PasswordErrorException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询员工</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeMapper.getById(id);</span><br><span class="line">        employee.setPassword(<span class="string">&quot;****&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PutMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.image.RescaleOp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据主键动态修改属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">        select * from employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by create_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;Employee&quot;</span>&gt;</span></span><br><span class="line">        update employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span>password = #&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span>username = #&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span>phone = #&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span>sex = #&#123;sex&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idNumber != null&quot;</span>&gt;</span>id_Number = #&#123;idNumber&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #&#123;updateTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span>update_user = #&#123;updateUser&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p>编辑员工信息（它属于修改类的操作，所以请求方式是PUT）</p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221180634012.png" alt="image-20240221180634012"></p>
</li>
</ul>
<p><strong>controller层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.controller.admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.JwtClaimsConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sky.vo.EmployeeLoginVO;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/employee&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;员工相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编辑员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;编辑员工信息&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;编辑员工信息：&#123;&#125;&quot;</span>,employeeDTO);</span><br><span class="line">        employeeService.update(employeeDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.MessageConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.PasswordConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.constant.StatusConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeLoginDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountLockedException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.AccountNotFoundException;</span><br><span class="line"><span class="keyword">import</span> com.sky.exception.PasswordErrorException;</span><br><span class="line"><span class="keyword">import</span> com.sky.mapper.EmployeeMapper;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.PageResult;</span><br><span class="line"><span class="keyword">import</span> com.sky.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编辑员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employeeDTO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">        BeanUtils.copyProperties(employeeDTO, employee);</span><br><span class="line">        employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        employee.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">        employeeMapper.update(employee);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeeDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.dto.EmployeePageQueryDTO;</span><br><span class="line"><span class="keyword">import</span> com.sky.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.sky.result.Result;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PutMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.image.RescaleOp;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据主键动态修改属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="功能测试-3"><a href="#功能测试-3" class="headerlink" title="功能测试"></a>功能测试</h2><p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221193142242.png" alt="image-20240221193142242"></p>
<h1 id="导入分类模块功能代码"><a href="#导入分类模块功能代码" class="headerlink" title="导入分类模块功能代码"></a>导入分类模块功能代码</h1><h2 id="需求分析和设计-4"><a href="#需求分析和设计-4" class="headerlink" title="需求分析和设计"></a>需求分析和设计</h2><p><strong>产品原型</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221193359609.png" alt="image-20240221193359609"></p>
<p>菜品分类和套餐分类，还有修改、查询、禁用操作。</p>
<p>业务规则：</p>
<ul>
<li>分类名称必须是唯一的。</li>
<li>分类按照类型可以分为菜品分类和套餐分类。</li>
<li>新添加的分类状态默认为“禁用”。</li>
</ul>
<p><strong>接口设计</strong></p>
<ul>
<li>新增分类</li>
<li>分类分页查询</li>
<li>根据id删除分类</li>
<li>修改分类</li>
<li>启用禁用分类</li>
<li>根据类型查询分类</li>
</ul>
<p><strong>分类接口</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221193942346.png" alt="image-20240221193942346"></p>
<p><strong>数据库设计（category表）</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221194404816.png" alt="image-20240221194404816"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221222612780.png" alt="image-20240221222612780"></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221223226040.png" alt="image-20240221223226040"></p>
<p><strong>第三方导入的类建议最好再编译一下</strong></p>
<p><img src="/2024/02/21/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day02-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E3%80%81%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86/image-20240221223333510.png" alt="image-20240221223333510"></p>
]]></content>
      <categories>
        <category>苍穹外卖</category>
      </categories>
  </entry>
  <entry>
    <title>苍穹外卖-day01-项目概述、环境搭建</title>
    <url>/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/</url>
    <content><![CDATA[<h1 id="课程优势"><a href="#课程优势" class="headerlink" title="课程优势"></a>课程优势</h1><p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220181432990.png" alt="image-20240220181432990"></p>
<h1 id="课程安排"><a href="#课程安排" class="headerlink" title="课程安排"></a>课程安排</h1><p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220181624181.png" alt="image-20240220181624181"></p>
<h1 id="项目效果演示"><a href="#项目效果演示" class="headerlink" title="项目效果演示"></a>项目效果演示</h1><p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220181837351.png" alt="image-20240220181837351"></p>
<p><strong>管理端</strong></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220181935488.png" alt="image-20240220181935488"></p>
<p><strong>用户端</strong></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220181957327.png" alt="image-20240220181957327"></p>
<h1 id="项目概述、环境搭建"><a href="#项目概述、环境搭建" class="headerlink" title="项目概述、环境搭建"></a>项目概述、环境搭建</h1><h2 id="软件开发整体介绍"><a href="#软件开发整体介绍" class="headerlink" title="软件开发整体介绍"></a>软件开发整体介绍</h2><h3 id="软件开发流程"><a href="#软件开发流程" class="headerlink" title="软件开发流程"></a>软件开发流程</h3><p><strong>需求分析</strong>：需求规格说明书、产品原型</p>
<p>需求规格说明书：word规格的内容。</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184001140.png" alt="image-20240220184001140"></p>
<p>产品原型：通过静态网页的形式来展示项目当中一个个业务功能。</p>
<p>以下是新增员工的业务功能的页面原型。</p>
<p> <img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184155834.png" alt="image-20240220184155834"></p>
<p><strong>设计</strong>：UI设计、数据库设计、接口设计</p>
<p>UI设计：最终项目做完之后的界面效果，小到一个按钮的效果，大到页面布局，包括人机交互的逻辑</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184312846.png" alt="image-20240220184312846"></p>
<p>数据库设计：数据库结构，每个表的字段，类型，定义出来，包括表之间的关系</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184434245.png" alt="image-20240220184434245"></p>
<p>接口设计：请求方式、请求路径、传的参数，返回数据等规定</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184516432.png" alt="image-20240220184516432"></p>
<p><strong>编码</strong>：项目代码、单元测试（开发人员测试代码，确保代码正确有效）</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184549237.png" alt="image-20240220184549237"></p>
<p><strong>测试</strong>：编写测试用例、测试报告</p>
<p><strong>上线运维</strong>：软件环境的安装、配置</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184638064.png" alt="image-20240220184638064"></p>
<h3 id="角色分工"><a href="#角色分工" class="headerlink" title="角色分工"></a>角色分工</h3><ul>
<li><p>项目经理：对整个项目负责、任务分配，把控进度（管理角色）</p>
</li>
<li><p>产品经理：进行需求调研，输出需求调研文档，产品原型等</p>
</li>
<li><p>UI设计师：根据产品原型输出界面效果图</p>
</li>
<li><p>架构师：项目整体架构设计、技术选型</p>
</li>
<li><p>开发工程师：代码实现</p>
</li>
<li><p>测试工程师：编写测试用例，输出测试报告</p>
</li>
<li><p>运维工程师：软件环境搭建、项目上线</p>
</li>
</ul>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220184900920.png" alt="image-20240220184900920"></p>
<h3 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h3><ul>
<li>开发环境（development）：开发人员在开发阶段使用的环境，一般外部用户无法访问</li>
<li>测试环境（testing）：专门给测试人员使用的环境，用于测试项目，一般外部用户无法访问</li>
<li>生产环境（production）：即线上环境，正式提供对外服务的环境</li>
</ul>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220191425242.png" alt="image-20240220191425242"></p>
<h2 id="苍穹外卖项目介绍"><a href="#苍穹外卖项目介绍" class="headerlink" title="苍穹外卖项目介绍"></a>苍穹外卖项目介绍</h2><h3 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h3><p>定位：专门为餐饮企业（餐厅、饭店）定制的一款软件产品</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220191757076.png" alt="image-20240220191757076"></p>
<p>功能架构：体现项目中的业务功能模块</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220191908865.png" alt="image-20240220191908865"></p>
<h3 id="产品原型"><a href="#产品原型" class="headerlink" title="产品原型"></a>产品原型</h3><p>产品原型：用于展示项目的业务功能：一般由产品经理进行设计</p>
<p><strong>管理端</strong></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220192009154.png" alt="image-20240220192009154"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220192627836.png" alt="image-20240220192627836"></p>
<p><strong>用户端</strong></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220192018972.png" alt="image-20240220192018972"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220192554198.png" alt="image-20240220192554198"></p>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p>技术选型：<font color="red">展示项目中使用到的技术框架和中间件等</font></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220192934832.png" alt="image-20240220192934832"></p>
<h2 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h2><h3 id="前端环境搭建"><a href="#前端环境搭建" class="headerlink" title="前端环境搭建"></a>前端环境搭建</h3><p>前端代码已经开发好，只要环境运行起来就可。已经提供了Nginx服务器。</p>
<h4 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h4><p>管理端（Web）是基于Nginx服务器运行的，至于用户端（小程序）的搭建，在开发到相应阶段时再设置。</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220193245072.png" alt="image-20240220193245072"></p>
<p>前端工程基于nginx运行。</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220193724490.png" alt="image-20240220193724490"></p>
<p>启动nginx：双击nginx.exe即可启动nginx服务，访问端口号默认为80（注意nginx要求在原英文路径下才能正常运行）</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220193911190.png" alt="image-20240220193911190"></p>
<h3 id="后端环境搭建"><a href="#后端环境搭建" class="headerlink" title="后端环境搭建"></a>后端环境搭建</h3><p>后端工程基于maven进行项目构建，并且进行分模块开发</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220194118617.png" alt="image-20240220194118617"></p>
<p>用IDEA打开初始工程，了解项目的整体结构</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220194259776.png" alt="image-20240220194259776"></p>
<table>
<thead>
<tr>
<th>序号</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>sky-take-out</td>
<td>maven父工程，统一管理以来版本，聚合其他子模块</td>
</tr>
<tr>
<td>2</td>
<td>sky-common</td>
<td>子模块，存放公共类，例如：工具类，常量类，异常类等</td>
</tr>
<tr>
<td>3</td>
<td>sky-pojo</td>
<td>子模块，存放实体类，VO，DTO等</td>
</tr>
<tr>
<td>4</td>
<td>sky-server</td>
<td>子模块，后端服务，存放配置文件、Controller、Service、Mapper等</td>
</tr>
</tbody></table>
<p>sky-common子模块中存放的是一些公共类，可以供其他模块使用</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220194544087.png" alt="image-20240220194544087"></p>
<p>sky-pojo子模块中存放的是一些entity、DTO、VO</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220194710799.png" alt="image-20240220194710799"></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Entity</td>
<td>实体、通常和数据库中的表对应</td>
</tr>
<tr>
<td>DTO</td>
<td>数据传输对象、通常用于程序中各层之间传递数据（前端提供JSON，后端使用DTO作为类封装JSON）</td>
</tr>
<tr>
<td>VO</td>
<td>视图对象，为前端展示数据提供的对象（列表数据，表单数据等）</td>
</tr>
<tr>
<td>POJO</td>
<td>普通Java对象，只有属性和对应的getter和setter</td>
</tr>
</tbody></table>
<p>sky-server子模块中存放的是配置文件、配置类、拦截器、controller、service、mapper、启动类等</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220195029539.png" alt="image-20240220195029539"></p>
<h4 id="使用Git进行版本控制"><a href="#使用Git进行版本控制" class="headerlink" title="使用Git进行版本控制"></a>使用Git进行版本控制</h4><p>使用Git进行版本代码的版本控制，具体操作：</p>
<ul>
<li><p>创建Git本地仓库</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220201845559.png" alt="image-20240220201845559"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220201900511.png" alt="image-20240220201900511"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220201713170.png" alt="image-20240220201713170"></p>
</li>
<li><p>创建Git远程仓库</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220202018386.png" alt="image-20240220202018386"></p>
</li>
<li><p>将本地文件推送至Git远程仓库</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220202041009.png" alt="image-20240220202041009"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220202403868.png" alt="image-20240220202403868"></p>
</li>
</ul>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220202637021.png" alt="image-20240220202637021"></p>
<h4 id="数据库环境搭建"><a href="#数据库环境搭建" class="headerlink" title="数据库环境搭建"></a>数据库环境搭建</h4><p>通过数据库建表语句创建数据库表结构：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE  IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `sky_take_out` ;</span><br><span class="line">USE `sky_take_out`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `address_book`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `address_book` (</span><br><span class="line">                                `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                                `user_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">                                `consignee` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人&#x27;</span>,</span><br><span class="line">                                `sex` <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">                                `phone` <span class="type">varchar</span>(<span class="number">11</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">                                `province_code` <span class="type">varchar</span>(<span class="number">12</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;省级区划编号&#x27;</span>,</span><br><span class="line">                                `province_name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;省级名称&#x27;</span>,</span><br><span class="line">                                `city_code` <span class="type">varchar</span>(<span class="number">12</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;市级区划编号&#x27;</span>,</span><br><span class="line">                                `city_name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;市级名称&#x27;</span>,</span><br><span class="line">                                `district_code` <span class="type">varchar</span>(<span class="number">12</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;区级区划编号&#x27;</span>,</span><br><span class="line">                                `district_name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;区级名称&#x27;</span>,</span><br><span class="line">                                `detail` <span class="type">varchar</span>(<span class="number">200</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;详细地址&#x27;</span>,</span><br><span class="line">                                `label` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;标签&#x27;</span>,</span><br><span class="line">                                `is_default` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;默认 0 否 1是&#x27;</span>,</span><br><span class="line">                                <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;地址簿&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `category`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `category` (</span><br><span class="line">                            `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                            `type` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;类型   1 菜品分类 2 套餐分类&#x27;</span>,</span><br><span class="line">                            `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分类名称&#x27;</span>,</span><br><span class="line">                            `sort` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;顺序&#x27;</span>,</span><br><span class="line">                            `status` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;分类状态 0:禁用，1:启用&#x27;</span>,</span><br><span class="line">                            `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                            `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">                            `create_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">                            `update_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">                            <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">                            <span class="keyword">UNIQUE</span> KEY `idx_category_name` (`name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">23</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;菜品及套餐分类&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">11</span>,<span class="number">1</span>,<span class="string">&#x27;酒水饮料&#x27;</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:09:18&#x27;</span>,<span class="string">&#x27;2022-06-09 22:09:18&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">12</span>,<span class="number">1</span>,<span class="string">&#x27;传统主食&#x27;</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:09:32&#x27;</span>,<span class="string">&#x27;2022-06-09 22:18:53&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">13</span>,<span class="number">2</span>,<span class="string">&#x27;人气套餐&#x27;</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:11:38&#x27;</span>,<span class="string">&#x27;2022-06-10 11:04:40&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">15</span>,<span class="number">2</span>,<span class="string">&#x27;商务套餐&#x27;</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:14:10&#x27;</span>,<span class="string">&#x27;2022-06-10 11:04:48&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">16</span>,<span class="number">1</span>,<span class="string">&#x27;蜀味烤鱼&#x27;</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:15:37&#x27;</span>,<span class="string">&#x27;2022-08-31 14:27:25&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">17</span>,<span class="number">1</span>,<span class="string">&#x27;蜀味牛蛙&#x27;</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:16:14&#x27;</span>,<span class="string">&#x27;2022-08-31 14:39:44&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">18</span>,<span class="number">1</span>,<span class="string">&#x27;特色蒸菜&#x27;</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:17:42&#x27;</span>,<span class="string">&#x27;2022-06-09 22:17:42&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">19</span>,<span class="number">1</span>,<span class="string">&#x27;新鲜时蔬&#x27;</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:18:12&#x27;</span>,<span class="string">&#x27;2022-06-09 22:18:28&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">20</span>,<span class="number">1</span>,<span class="string">&#x27;水煮鱼&#x27;</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:22:29&#x27;</span>,<span class="string">&#x27;2022-06-09 22:23:45&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `category` <span class="keyword">VALUES</span> (<span class="number">21</span>,<span class="number">1</span>,<span class="string">&#x27;汤类&#x27;</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:51:47&#x27;</span>,<span class="string">&#x27;2022-06-10 10:51:47&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `dish`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `dish` (</span><br><span class="line">                        `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                        `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品名称&#x27;</span>,</span><br><span class="line">                        `category_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品分类id&#x27;</span>,</span><br><span class="line">                        `price` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品价格&#x27;</span>,</span><br><span class="line">                        `image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片&#x27;</span>,</span><br><span class="line">                        `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;描述信息&#x27;</span>,</span><br><span class="line">                        `status` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;0 停售 1 起售&#x27;</span>,</span><br><span class="line">                        `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                        `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">                        `create_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">                        `update_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">                        <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">                        <span class="keyword">UNIQUE</span> KEY `idx_dish_name` (`name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">70</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;菜品&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">46</span>,<span class="string">&#x27;王老吉&#x27;</span>,<span class="number">11</span>,<span class="number">6.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/41bfcacf-7ad4-4927-8b26-df366553a94c.png&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-09 22:40:47&#x27;</span>,<span class="string">&#x27;2022-06-09 22:40:47&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">47</span>,<span class="string">&#x27;北冰洋&#x27;</span>,<span class="number">11</span>,<span class="number">4.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/4451d4be-89a2-4939-9c69-3a87151cb979.png&#x27;</span>,<span class="string">&#x27;还是小时候的味道&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:18:49&#x27;</span>,<span class="string">&#x27;2022-06-10 09:18:49&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">48</span>,<span class="string">&#x27;雪花啤酒&#x27;</span>,<span class="number">11</span>,<span class="number">4.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/bf8cbfc1-04d2-40e8-9826-061ee41ab87c.png&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:22:54&#x27;</span>,<span class="string">&#x27;2022-06-10 09:22:54&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">49</span>,<span class="string">&#x27;米饭&#x27;</span>,<span class="number">12</span>,<span class="number">2.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/76752350-2121-44d2-b477-10791c23a8ec.png&#x27;</span>,<span class="string">&#x27;精选五常大米&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:30:17&#x27;</span>,<span class="string">&#x27;2022-06-10 09:30:17&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">50</span>,<span class="string">&#x27;馒头&#x27;</span>,<span class="number">12</span>,<span class="number">1.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/475cc599-8661-4899-8f9e-121dd8ef7d02.png&#x27;</span>,<span class="string">&#x27;优质面粉&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:34:28&#x27;</span>,<span class="string">&#x27;2022-06-10 09:34:28&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">51</span>,<span class="string">&#x27;老坛酸菜鱼&#x27;</span>,<span class="number">20</span>,<span class="number">56.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/4a9cefba-6a74-467e-9fde-6e687ea725d7.png&#x27;</span>,<span class="string">&#x27;原料：汤，草鱼，酸菜&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:40:51&#x27;</span>,<span class="string">&#x27;2022-06-10 09:40:51&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">52</span>,<span class="string">&#x27;经典酸菜鮰鱼&#x27;</span>,<span class="number">20</span>,<span class="number">66.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/5260ff39-986c-4a97-8850-2ec8c7583efc.png&#x27;</span>,<span class="string">&#x27;原料：酸菜，江团，鮰鱼&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:46:02&#x27;</span>,<span class="string">&#x27;2022-06-10 09:46:02&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">53</span>,<span class="string">&#x27;蜀味水煮草鱼&#x27;</span>,<span class="number">20</span>,<span class="number">38.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/a6953d5a-4c18-4b30-9319-4926ee77261f.png&#x27;</span>,<span class="string">&#x27;原料：草鱼，汤&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:48:37&#x27;</span>,<span class="string">&#x27;2022-06-10 09:48:37&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">54</span>,<span class="string">&#x27;清炒小油菜&#x27;</span>,<span class="number">19</span>,<span class="number">18.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/3613d38e-5614-41c2-90ed-ff175bf50716.png&#x27;</span>,<span class="string">&#x27;原料：小油菜&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:51:46&#x27;</span>,<span class="string">&#x27;2022-06-10 09:51:46&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">55</span>,<span class="string">&#x27;蒜蓉娃娃菜&#x27;</span>,<span class="number">19</span>,<span class="number">18.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/4879ed66-3860-4b28-ba14-306ac025fdec.png&#x27;</span>,<span class="string">&#x27;原料：蒜，娃娃菜&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:53:37&#x27;</span>,<span class="string">&#x27;2022-06-10 09:53:37&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">56</span>,<span class="string">&#x27;清炒西兰花&#x27;</span>,<span class="number">19</span>,<span class="number">18.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/e9ec4ba4-4b22-4fc8-9be0-4946e6aeb937.png&#x27;</span>,<span class="string">&#x27;原料：西兰花&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:55:44&#x27;</span>,<span class="string">&#x27;2022-06-10 09:55:44&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">57</span>,<span class="string">&#x27;炝炒圆白菜&#x27;</span>,<span class="number">19</span>,<span class="number">18.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/22f59feb-0d44-430e-a6cd-6a49f27453ca.png&#x27;</span>,<span class="string">&#x27;原料：圆白菜&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 09:58:35&#x27;</span>,<span class="string">&#x27;2022-06-10 09:58:35&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">58</span>,<span class="string">&#x27;清蒸鲈鱼&#x27;</span>,<span class="number">18</span>,<span class="number">98.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/c18b5c67-3b71-466c-a75a-e63c6449f21c.png&#x27;</span>,<span class="string">&#x27;原料：鲈鱼&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:12:28&#x27;</span>,<span class="string">&#x27;2022-06-10 10:12:28&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">59</span>,<span class="string">&#x27;东坡肘子&#x27;</span>,<span class="number">18</span>,<span class="number">138.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/a80a4b8c-c93e-4f43-ac8a-856b0d5cc451.png&#x27;</span>,<span class="string">&#x27;原料：猪肘棒&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:24:03&#x27;</span>,<span class="string">&#x27;2022-06-10 10:24:03&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">60</span>,<span class="string">&#x27;梅菜扣肉&#x27;</span>,<span class="number">18</span>,<span class="number">58.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/6080b118-e30a-4577-aab4-45042e3f88be.png&#x27;</span>,<span class="string">&#x27;原料：猪肉，梅菜&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:26:03&#x27;</span>,<span class="string">&#x27;2022-06-10 10:26:03&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">61</span>,<span class="string">&#x27;剁椒鱼头&#x27;</span>,<span class="number">18</span>,<span class="number">66.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/13da832f-ef2c-484d-8370-5934a1045a06.png&#x27;</span>,<span class="string">&#x27;原料：鲢鱼，剁椒&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:28:54&#x27;</span>,<span class="string">&#x27;2022-06-10 10:28:54&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">62</span>,<span class="string">&#x27;金汤酸菜牛蛙&#x27;</span>,<span class="number">17</span>,<span class="number">88.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/7694a5d8-7938-4e9d-8b9e-2075983a2e38.png&#x27;</span>,<span class="string">&#x27;原料：鲜活牛蛙，酸菜&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:33:05&#x27;</span>,<span class="string">&#x27;2022-06-10 10:33:05&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">63</span>,<span class="string">&#x27;香锅牛蛙&#x27;</span>,<span class="number">17</span>,<span class="number">88.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/f5ac8455-4793-450c-97ba-173795c34626.png&#x27;</span>,<span class="string">&#x27;配料：鲜活牛蛙，莲藕，青笋&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:35:40&#x27;</span>,<span class="string">&#x27;2022-06-10 10:35:40&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">64</span>,<span class="string">&#x27;馋嘴牛蛙&#x27;</span>,<span class="number">17</span>,<span class="number">88.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/7a55b845-1f2b-41fa-9486-76d187ee9ee1.png&#x27;</span>,<span class="string">&#x27;配料：鲜活牛蛙，丝瓜，黄豆芽&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:37:52&#x27;</span>,<span class="string">&#x27;2022-06-10 10:37:52&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">65</span>,<span class="string">&#x27;草鱼2斤&#x27;</span>,<span class="number">16</span>,<span class="number">68.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/b544d3ba-a1ae-4d20-a860-81cb5dec9e03.png&#x27;</span>,<span class="string">&#x27;原料：草鱼，黄豆芽，莲藕&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:41:08&#x27;</span>,<span class="string">&#x27;2022-06-10 10:41:08&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">66</span>,<span class="string">&#x27;江团鱼2斤&#x27;</span>,<span class="number">16</span>,<span class="number">119.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/a101a1e9-8f8b-47b2-afa4-1abd47ea0a87.png&#x27;</span>,<span class="string">&#x27;配料：江团鱼，黄豆芽，莲藕&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:42:42&#x27;</span>,<span class="string">&#x27;2022-06-10 10:42:42&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">67</span>,<span class="string">&#x27;鮰鱼2斤&#x27;</span>,<span class="number">16</span>,<span class="number">72.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/8cfcc576-4b66-4a09-ac68-ad5b273c2590.png&#x27;</span>,<span class="string">&#x27;原料：鮰鱼，黄豆芽，莲藕&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:43:56&#x27;</span>,<span class="string">&#x27;2022-06-10 10:43:56&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">68</span>,<span class="string">&#x27;鸡蛋汤&#x27;</span>,<span class="number">21</span>,<span class="number">4.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/c09a0ee8-9d19-428d-81b9-746221824113.png&#x27;</span>,<span class="string">&#x27;配料：鸡蛋，紫菜&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:54:25&#x27;</span>,<span class="string">&#x27;2022-06-10 10:54:25&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish` <span class="keyword">VALUES</span> (<span class="number">69</span>,<span class="string">&#x27;平菇豆腐汤&#x27;</span>,<span class="number">21</span>,<span class="number">6.00</span>,<span class="string">&#x27;https://sky-itcast.oss-cn-beijing.aliyuncs.com/16d0a3d6-2253-4cfc-9b49-bf7bd9eb2ad2.png&#x27;</span>,<span class="string">&#x27;配料：豆腐，平菇&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-06-10 10:55:02&#x27;</span>,<span class="string">&#x27;2022-06-10 10:55:02&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `dish_flavor`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `dish_flavor` (</span><br><span class="line">                               `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                               `dish_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品&#x27;</span>,</span><br><span class="line">                               `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;口味名称&#x27;</span>,</span><br><span class="line">                               `<span class="keyword">value</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;口味数据list&#x27;</span>,</span><br><span class="line">                               <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">104</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;菜品口味关系表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">40</span>,<span class="number">10</span>,<span class="string">&#x27;甜味&#x27;</span>,<span class="string">&#x27;[\&quot;无糖\&quot;,\&quot;少糖\&quot;,\&quot;半糖\&quot;,\&quot;多糖\&quot;,\&quot;全糖\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">41</span>,<span class="number">7</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">42</span>,<span class="number">7</span>,<span class="string">&#x27;温度&#x27;</span>,<span class="string">&#x27;[\&quot;热饮\&quot;,\&quot;常温\&quot;,\&quot;去冰\&quot;,\&quot;少冰\&quot;,\&quot;多冰\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">45</span>,<span class="number">6</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">46</span>,<span class="number">6</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">47</span>,<span class="number">5</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">48</span>,<span class="number">5</span>,<span class="string">&#x27;甜味&#x27;</span>,<span class="string">&#x27;[\&quot;无糖\&quot;,\&quot;少糖\&quot;,\&quot;半糖\&quot;,\&quot;多糖\&quot;,\&quot;全糖\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">49</span>,<span class="number">2</span>,<span class="string">&#x27;甜味&#x27;</span>,<span class="string">&#x27;[\&quot;无糖\&quot;,\&quot;少糖\&quot;,\&quot;半糖\&quot;,\&quot;多糖\&quot;,\&quot;全糖\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">50</span>,<span class="number">4</span>,<span class="string">&#x27;甜味&#x27;</span>,<span class="string">&#x27;[\&quot;无糖\&quot;,\&quot;少糖\&quot;,\&quot;半糖\&quot;,\&quot;多糖\&quot;,\&quot;全糖\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">51</span>,<span class="number">3</span>,<span class="string">&#x27;甜味&#x27;</span>,<span class="string">&#x27;[\&quot;无糖\&quot;,\&quot;少糖\&quot;,\&quot;半糖\&quot;,\&quot;多糖\&quot;,\&quot;全糖\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">52</span>,<span class="number">3</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">86</span>,<span class="number">52</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">87</span>,<span class="number">52</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">88</span>,<span class="number">51</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">89</span>,<span class="number">51</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">92</span>,<span class="number">53</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">93</span>,<span class="number">53</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">94</span>,<span class="number">54</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">95</span>,<span class="number">56</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">96</span>,<span class="number">57</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">97</span>,<span class="number">60</span>,<span class="string">&#x27;忌口&#x27;</span>,<span class="string">&#x27;[\&quot;不要葱\&quot;,\&quot;不要蒜\&quot;,\&quot;不要香菜\&quot;,\&quot;不要辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">101</span>,<span class="number">66</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">102</span>,<span class="number">67</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `dish_flavor` <span class="keyword">VALUES</span> (<span class="number">103</span>,<span class="number">65</span>,<span class="string">&#x27;辣度&#x27;</span>,<span class="string">&#x27;[\&quot;不辣\&quot;,\&quot;微辣\&quot;,\&quot;中辣\&quot;,\&quot;重辣\&quot;]&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `employee`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `employee` (</span><br><span class="line">                            `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                            `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">                            `username` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">                            `password` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">                            `phone` <span class="type">varchar</span>(<span class="number">11</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">                            `sex` <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">                            `id_number` <span class="type">varchar</span>(<span class="number">18</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;身份证号&#x27;</span>,</span><br><span class="line">                            `status` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;状态 0:禁用，1:启用&#x27;</span>,</span><br><span class="line">                            `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                            `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">                            `create_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">                            `update_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">                            <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">                            <span class="keyword">UNIQUE</span> KEY `idx_username` (`username`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;员工信息&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `employee` <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;管理员&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;13812312312&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;110101199001010047&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2022-02-15 15:51:20&#x27;</span>,<span class="string">&#x27;2022-02-17 09:16:20&#x27;</span>,<span class="number">10</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `order_detail`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_detail` (</span><br><span class="line">                                `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                                `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名字&#x27;</span>,</span><br><span class="line">                                `image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片&#x27;</span>,</span><br><span class="line">                                `order_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">                                `dish_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品id&#x27;</span>,</span><br><span class="line">                                `setmeal_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;套餐id&#x27;</span>,</span><br><span class="line">                                `dish_flavor` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;口味&#x27;</span>,</span><br><span class="line">                                `number` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">                                `amount` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;金额&#x27;</span>,</span><br><span class="line">                                <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;订单明细表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `orders`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `orders` (</span><br><span class="line">                          `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                          `number` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单号&#x27;</span>,</span><br><span class="line">                          `status` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;订单状态 1待付款 2待接单 3已接单 4派送中 5已完成 6已取消 7退款&#x27;</span>,</span><br><span class="line">                          `user_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;下单用户&#x27;</span>,</span><br><span class="line">                          `address_book_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;地址id&#x27;</span>,</span><br><span class="line">                          `order_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;下单时间&#x27;</span>,</span><br><span class="line">                          `checkout_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;结账时间&#x27;</span>,</span><br><span class="line">                          `pay_method` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;支付方式 1微信,2支付宝&#x27;</span>,</span><br><span class="line">                          `pay_status` tinyint <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;支付状态 0未支付 1已支付 2退款&#x27;</span>,</span><br><span class="line">                          `amount` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;实收金额&#x27;</span>,</span><br><span class="line">                          `remark` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">                          `phone` <span class="type">varchar</span>(<span class="number">11</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">                          `address` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;地址&#x27;</span>,</span><br><span class="line">                          `user_name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名称&#x27;</span>,</span><br><span class="line">                          `consignee` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;收货人&#x27;</span>,</span><br><span class="line">                          `cancel_reason` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单取消原因&#x27;</span>,</span><br><span class="line">                          `rejection_reason` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单拒绝原因&#x27;</span>,</span><br><span class="line">                          `cancel_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单取消时间&#x27;</span>,</span><br><span class="line">                          `estimated_delivery_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;预计送达时间&#x27;</span>,</span><br><span class="line">                          `delivery_status` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;配送状态  1立即送出  0选择具体时间&#x27;</span>,</span><br><span class="line">                          `delivery_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;送达时间&#x27;</span>,</span><br><span class="line">                          `pack_amount` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;打包费&#x27;</span>,</span><br><span class="line">                          `tableware_number` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;餐具数量&#x27;</span>,</span><br><span class="line">                          `tableware_status` tinyint(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;餐具数量状态  1按餐量提供  0选择具体数量&#x27;</span>,</span><br><span class="line">                          <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;订单表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `setmeal`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `setmeal` (</span><br><span class="line">                           `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                           `category_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品分类id&#x27;</span>,</span><br><span class="line">                           `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;套餐名称&#x27;</span>,</span><br><span class="line">                           `price` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;套餐价格&#x27;</span>,</span><br><span class="line">                           `status` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;售卖状态 0:停售 1:起售&#x27;</span>,</span><br><span class="line">                           `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;描述信息&#x27;</span>,</span><br><span class="line">                           `image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片&#x27;</span>,</span><br><span class="line">                           `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                           `update_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">                           `create_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建人&#x27;</span>,</span><br><span class="line">                           `update_user` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;修改人&#x27;</span>,</span><br><span class="line">                           <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">                           <span class="keyword">UNIQUE</span> KEY `idx_setmeal_name` (`name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">32</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;套餐&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `setmeal_dish`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `setmeal_dish` (</span><br><span class="line">                                `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                                `setmeal_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;套餐id&#x27;</span>,</span><br><span class="line">                                `dish_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品id&#x27;</span>,</span><br><span class="line">                                `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品名称 （冗余字段）&#x27;</span>,</span><br><span class="line">                                `price` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品单价（冗余字段）&#x27;</span>,</span><br><span class="line">                                `copies` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品份数&#x27;</span>,</span><br><span class="line">                                <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">47</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;套餐菜品关系&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `shopping_cart`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `shopping_cart` (</span><br><span class="line">                                 `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                                 `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;商品名称&#x27;</span>,</span><br><span class="line">                                 `image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图片&#x27;</span>,</span><br><span class="line">                                 `user_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                                 `dish_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品id&#x27;</span>,</span><br><span class="line">                                 `setmeal_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;套餐id&#x27;</span>,</span><br><span class="line">                                 `dish_flavor` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;口味&#x27;</span>,</span><br><span class="line">                                 `number` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">                                 `amount` <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;金额&#x27;</span>,</span><br><span class="line">                                 `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                                 <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">9</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;购物车&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">                        `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">                        `openid` <span class="type">varchar</span>(<span class="number">45</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;微信用户唯一标识&#x27;</span>,</span><br><span class="line">                        `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">                        `phone` <span class="type">varchar</span>(<span class="number">11</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">                        `sex` <span class="type">varchar</span>(<span class="number">2</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">                        `id_number` <span class="type">varchar</span>(<span class="number">18</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;身份证号&#x27;</span>,</span><br><span class="line">                        `avatar` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">COLLATE</span> utf8_bin <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;头像&#x27;</span>,</span><br><span class="line">                        `create_time` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">                        <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin COMMENT<span class="operator">=</span><span class="string">&#x27;用户信息&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220210022362.png" alt="image-20240220210022362"></p>
<h4 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h4><p>后端的初始工程已经实现了登录功能，直接进行前后端联调测试即可</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220210553806.png" alt="image-20240220210553806"></p>
<ol>
<li><p>编译文件</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220225310010.png" alt="image-20240220225310010"></p>
</li>
<li><p>运行启动类</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220225423436.png" alt="image-20240220225423436"></p>
</li>
<li><p>修改配置页面，确保数据库用户密码正确</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220231214419.png" alt="image-20240220231214419"></p>
</li>
</ol>
<h4 id="Nginx反向代理和负载均衡概念"><a href="#Nginx反向代理和负载均衡概念" class="headerlink" title="Nginx反向代理和负载均衡概念"></a>Nginx反向代理和负载均衡概念</h4><p><strong>前端发送的请求，是如何请求到后端服务的？</strong></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220232059536.png" alt="image-20240220232059536"></p>
<p>前端的请求地址是localhost，没有指定端口号，默认80，后面的路径是api&#x2F;employee&#x2F;login。前端的请求地址：<a href="http://localhost/api/employee/login">http://localhost/api/employee/login</a></p>
<p>后端的接口地址是 <a href="http://localhost:8080/admin/employee/login">http://localhost:8080/admin/employee/login</a></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220232208186.png" alt="image-20240220232208186"></p>
<p>前后端的接口地址并未匹配，但是请求成功了，这是问什么呢？</p>
<p>原因：nginx反向代理，就是将前端发送的动态请求由nginx转发到后端服务器。nginx在之前的课程中主要用来部署静态资源，把它当作HTTP服务器。实际上nginx还可以作为反向代理服务器，一般通过nginx做反向代理，把前端发过来的动态请求转发到后端服务器。</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220232459573.png" alt="image-20240220232459573"></p>
<p>也就是说，之前的登录请求过程实际可以看作如下的过程（nginx通过反向代理转发前端请求到后端的tomcat服务器）：</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220232723613.png" alt="image-20240220232723613"></p>
<p>为何不直接将前端的请求发送到后端的tomcat服务器，而是要用nginx服务器呢？</p>
<p>nginx反向代理的好处：</p>
<ul>
<li><p>提高访问速度（向nginx发送相同请求，nginx可以缓存后端数据，直接返回相应的后端数据）</p>
</li>
<li><p>进行负载均衡（<font color="red">将大量的请求按照我们指定的方式均衡的分配给集群中的每台服务器</font>）</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220232959729.png" alt="image-20240220232959729"></p>
</li>
<li><p>保证后端服务安全（服务器往往部署在公司内部的局域网内，不是对外开放的，通过前端不能直接请求到后端的，所以这个时候要请求后端服务，只有这个入口，即前端发来的请求，先请求到nginx服务器，然后再由nginx服务器走内网，将这个请求转发给后端服务）</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220233224248.png" alt="image-20240220233224248"></p>
</li>
</ul>
<h4 id="Nginx反向代理和负载均衡配置"><a href="#Nginx反向代理和负载均衡配置" class="headerlink" title="Nginx反向代理和负载均衡配置"></a>Nginx反向代理和负载均衡配置</h4><p><strong>nginx反向代理的配置方式</strong>(配置nginx的配置文件nginx.conf)：</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220233455762.png" alt="image-20240220233455762"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220233556775.png" alt="image-20240220233556775"></p>
<p><strong>nginx负载均衡的配置方式</strong>((配置nginx的配置文件nginx.conf)：</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220233837975.png" alt="image-20240220233837975"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220233846731.png" alt="image-20240220233846731"></p>
<p>主要配置webservers，声明了两个后端服务器的8080端口。让两个服务器来接受前端的请求，底层还是基于反向代理。只不过负载均衡转发时需要转发到任意一台服务器。</p>
<p>nginx负载均衡策略：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>轮询</td>
<td>默认方式</td>
</tr>
<tr>
<td>weight</td>
<td>权重方式，默认为1，权重越高，被分配的客户端请求就越多</td>
</tr>
<tr>
<td>ip_hash</td>
<td>根据ip分配方式，这样每个访客可以固定访问一个后端服务</td>
</tr>
<tr>
<td>least_conn</td>
<td>依据最少连接方式，把请求优先分配给连接数少的后端服务</td>
</tr>
<tr>
<td>url_hash</td>
<td>依据url分配方式，这样相同的url会被分配到同一个后端服务</td>
</tr>
<tr>
<td>fair</td>
<td>依据响应时间方式，响应时间短的服务将会被优先分配</td>
</tr>
</tbody></table>
<h3 id="完善登录功能"><a href="#完善登录功能" class="headerlink" title="完善登录功能"></a>完善登录功能</h3><p>问题：员工表中的密码是明文存储，安全性太低。</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220235038781.png" alt="image-20240220235038781"></p>
<ol>
<li><p>将密码加密之后存储，提高安全性</p>
</li>
<li><p>使用MD5 加密方式对明文密码加密</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220235218252.png" alt="image-20240220235218252"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220235408563.png" alt="image-20240220235408563"></p>
</li>
</ol>
<p>实现步骤</p>
<ol>
<li><p>修改数据库中明文密码，改为MD5加密后的密文</p>
</li>
<li><p>修改Java代码，前端提交的代码进行MD5加密后再跟数据库中密码对比</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240220235547628.png" alt="image-20240220235547628"></p>
</li>
</ol>
<p><font color="red">找到TODO标签页，里面有所有遗留问题的链接</font></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221000308322.png" alt="image-20240221000308322"></p>
<p>完成TODO内容，先对前端来的password做md5加密。</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221001526426.png" alt="image-20240221001526426"></p>
<h2 id="导入接口文档"><a href="#导入接口文档" class="headerlink" title="导入接口文档"></a>导入接口文档</h2><p>前面完成了开发环境的搭建，后面要导入接口文档，开发方式是基于前后端分离的开发方式，要求开发之前，先将接口定义好，然后呢，前后端开发人员才能并行开发。我们需要将项目的接口导入到接口管理平台，为业务开发做好准备。</p>
<p>接口是开发过程中前后端多次开会决定的，且会不断地改进。</p>
<h4 id="前后端分离开发流程"><a href="#前后端分离开发流程" class="headerlink" title="前后端分离开发流程"></a>前后端分离开发流程</h4><p>前后端分离开发流程：</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221002030439.png" alt="image-20240221002030439"></p>
<h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><p>将课程资料中提供的项目接口导入YApi。</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221002137198.png" alt="image-20240221002137198"></p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221002354144.png" alt="image-20240221002354144"></p>
<p>导入对应的管理端JSON文件</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221002444885.png" alt="image-20240221002444885"></p>
<p>查看接口内容</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221002651360.png" alt="image-20240221002651360"></p>
<p>同理上传完客户端接口</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221002807634.png" alt="image-20240221002807634"></p>
<h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><p>前面已经导入了接口文档，有了接口文档，我们就可以开发后端的代码了，如果开发完了某个功能，后端如何来验证功能是否正确，这个时候就需要测试，如何测试，之前使用的是postman。</p>
<p>使用postman有个问题，有的接口请求参数过多，如果用postman测试，要构建许多参数， 效率还是比较低的，swagger应运而生。</p>
<p>swagger帮助后端高效生成接口文档，并且可以进行后端的接口测试，它是后端开发的常见技术。</p>
<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>使用Swagger只需要按照它的规范去定义接口及接口相关的信息，就可以做到<strong>生成接口文档</strong>，以及<strong>在线接口调试页面</strong>。</p>
<p>官网：<a href="https://swagger.io/">https://swagger.io/</a></p>
<p>Knife4j是为Java MVC框架集成Swagger生成APi文档的增强解决方案。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221114241942.png" alt="image-20240221114241942"></p>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><ol>
<li><p>导入knife4j的maven坐标</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221114507874.png" alt="image-20240221114507874"></p>
</li>
<li><p>在配置类中加入knife4j的相关配置</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221114520003.png" alt="image-20240221114520003"></p>
</li>
<li><p>设置静态资源映射，否则接口文档页面无法访问</p>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221115134316.png" alt="image-20240221115134316"></p>
</li>
</ol>
<p>完整代码(WebMvcConfiguration加了@Configuration，是配置类，且继承自WebMvcConfigurationSupport)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.interceptor.JwtTokenAdminInterceptor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 配置类，注册web层相关组件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过knife4j生成接口文档</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;准备生成接口文档...&quot;</span>);</span><br><span class="line">        <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> docket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;开始设置静态资源映射...&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>通过Swagger就可以生成接口文档，那么我们就不需要Yapi了？</p>
<ol>
<li>Yapi是涉及阶段使用的工具，管理和维护接口</li>
<li>Swagger在开发阶段使用的框架，帮助后端人员做后端的接口测试</li>
</ol>
<h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><p>通过注解可以控制生成的接口文档，使接口文档拥有更好的可读性，常用注解如下：</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Api</td>
<td>用在类上，例如Controller，表示对类的说明</td>
</tr>
<tr>
<td>@ApiModel</td>
<td>用在类上，例如entity、DTO、VO，表示对用途的说明</td>
</tr>
<tr>
<td>@ApiModelProperty</td>
<td>用在属性上，描述属性信息</td>
</tr>
<tr>
<td>@ApiOperation</td>
<td>用在方法上，例如Controller的方法，说明方法的用途、作用</td>
</tr>
</tbody></table>
<p>例如</p>
<ul>
<li>@Api(tags &#x3D; “员工相关接口”)</li>
<li>@ApiOperation(value &#x3D; “员工登录”)</li>
<li>@ApiModel(description &#x3D; “员工登录返回的数据格式”)</li>
<li>@ApiModelProperty(“用户名”)</li>
</ul>
<p><img src="/2024/02/20/%E8%8B%8D%E7%A9%B9%E5%A4%96%E5%8D%96-day01/image-20240221122024885.png" alt="image-20240221122024885"></p>
]]></content>
      <categories>
        <category>苍穹外卖</category>
      </categories>
  </entry>
  <entry>
    <title>mybatisplus-day01</title>
    <url>/2024/02/18/mybatisplus-day01/</url>
    <content><![CDATA[<h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><h2 id="入门案例Mybatis"><a href="#入门案例Mybatis" class="headerlink" title="入门案例Mybatis"></a>入门案例Mybatis</h2><p>需求：基于课程资料提供的项目，实现以下功能：</p>
<ol>
<li>新增用户功能</li>
<li>根据id查询用户</li>
<li>根据id批量查询用户</li>
<li>根据id更新用户</li>
<li>根据id删除用户</li>
</ol>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218131908492.png" alt="image-20240218131908492"></p>
<p>创建对应的数据库表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 导出 mp 的数据库结构</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `mp` <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci */</span> <span class="comment">/*!80016 DEFAULT ENCRYPTION=&#x27;N&#x27; */</span>;</span><br><span class="line">USE `mp`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 导出  表 mp.address 结构</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `address` (</span><br><span class="line">                                         `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">                                         `user_id` <span class="type">bigint</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户ID&#x27;</span>,</span><br><span class="line">                                         `province` <span class="type">varchar</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;省&#x27;</span>,</span><br><span class="line">                                         `city` <span class="type">varchar</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;市&#x27;</span>,</span><br><span class="line">                                         `town` <span class="type">varchar</span>(<span class="number">10</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;县/区&#x27;</span>,</span><br><span class="line">                                         `mobile` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;手机&#x27;</span>,</span><br><span class="line">                                         `street` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;详细地址&#x27;</span>,</span><br><span class="line">                                         `contact` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;联系人&#x27;</span>,</span><br><span class="line">                                         `is_default` bit(<span class="number">1</span>) <span class="keyword">DEFAULT</span> b<span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;是否是默认 1默认 0否&#x27;</span>,</span><br><span class="line">                                         `notes` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">                                         `deleted` bit(<span class="number">1</span>) <span class="keyword">DEFAULT</span> b<span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除&#x27;</span>,</span><br><span class="line">                                         <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">                                         KEY `user_id` (`user_id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">71</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3 ROW_FORMAT<span class="operator">=</span>COMPACT;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正在导出表  mp.address 的数据：~11 rows (大约)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `address` (`id`, `user_id`, `province`, `city`, `town`, `mobile`, `street`, `contact`, `is_default`, `notes`, `deleted`) <span class="keyword">VALUES</span></span><br><span class="line">                                                                                                                                         (<span class="number">59</span>, <span class="number">2</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;朝阳区&#x27;</span>, <span class="string">&#x27;13900112222&#x27;</span>, <span class="string">&#x27;金燕龙办公楼&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>, b<span class="string">&#x27;1&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">60</span>, <span class="number">1</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;北京&#x27;</span>, <span class="string">&#x27;朝阳区&#x27;</span>, <span class="string">&#x27;13700221122&#x27;</span>, <span class="string">&#x27;修正大厦&#x27;</span>, <span class="string">&#x27;Jack&#x27;</span>, b<span class="string">&#x27;0&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">61</span>, <span class="number">1</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;上海&#x27;</span>, <span class="string">&#x27;浦东新区&#x27;</span>, <span class="string">&#x27;13301212233&#x27;</span>, <span class="string">&#x27;航头镇航头路&#x27;</span>, <span class="string">&#x27;Jack&#x27;</span>, b<span class="string">&#x27;1&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">63</span>, <span class="number">2</span>, <span class="string">&#x27;广东&#x27;</span>, <span class="string">&#x27;佛山&#x27;</span>, <span class="string">&#x27;永春&#x27;</span>, <span class="string">&#x27;13301212233&#x27;</span>, <span class="string">&#x27;永春武馆&#x27;</span>, <span class="string">&#x27;Rose&#x27;</span>, b<span class="string">&#x27;0&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">64</span>, <span class="number">3</span>, <span class="string">&#x27;浙江&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;拱墅区&#x27;</span>, <span class="string">&#x27;13567809102&#x27;</span>, <span class="string">&#x27;浙江大学&#x27;</span>, <span class="string">&#x27;Hope&#x27;</span>, b<span class="string">&#x27;1&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">65</span>, <span class="number">3</span>, <span class="string">&#x27;浙江&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;拱墅区&#x27;</span>, <span class="string">&#x27;13967589201&#x27;</span>, <span class="string">&#x27;左岸花园&#x27;</span>, <span class="string">&#x27;Hope&#x27;</span>, b<span class="string">&#x27;0&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">66</span>, <span class="number">4</span>, <span class="string">&#x27;湖北&#x27;</span>, <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;汉口&#x27;</span>, <span class="string">&#x27;13967519202&#x27;</span>, <span class="string">&#x27;天天花园&#x27;</span>, <span class="string">&#x27;Thomas&#x27;</span>, b<span class="string">&#x27;1&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">67</span>, <span class="number">3</span>, <span class="string">&#x27;浙江&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;拱墅区&#x27;</span>, <span class="string">&#x27;13967589201&#x27;</span>, <span class="string">&#x27;左岸花园&#x27;</span>, <span class="string">&#x27;Hopey&#x27;</span>, b<span class="string">&#x27;0&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">68</span>, <span class="number">4</span>, <span class="string">&#x27;湖北&#x27;</span>, <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;汉口&#x27;</span>, <span class="string">&#x27;13967519202&#x27;</span>, <span class="string">&#x27;天天花园&#x27;</span>, <span class="string">&#x27;Thomas&#x27;</span>, b<span class="string">&#x27;1&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">69</span>, <span class="number">3</span>, <span class="string">&#x27;浙江&#x27;</span>, <span class="string">&#x27;杭州&#x27;</span>, <span class="string">&#x27;拱墅区&#x27;</span>, <span class="string">&#x27;13967589201&#x27;</span>, <span class="string">&#x27;左岸花园&#x27;</span>, <span class="string">&#x27;Hopey&#x27;</span>, b<span class="string">&#x27;0&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>),</span><br><span class="line">                                                                                                                                         (<span class="number">70</span>, <span class="number">4</span>, <span class="string">&#x27;湖北&#x27;</span>, <span class="string">&#x27;武汉&#x27;</span>, <span class="string">&#x27;汉口&#x27;</span>, <span class="string">&#x27;13967519202&#x27;</span>, <span class="string">&#x27;天天花园&#x27;</span>, <span class="string">&#x27;Thomas&#x27;</span>, b<span class="string">&#x27;1&#x27;</span>, <span class="keyword">NULL</span>, b<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 导出  表 mp.user 结构</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">                        `id` <span class="type">BIGINT</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">                        `username` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">                        `password` <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">                        `phone` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;注册手机号&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">                        `info` JSON <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;详细信息&#x27;</span>,</span><br><span class="line">                        `status` <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;使用状态（1正常 2冻结）&#x27;</span>,</span><br><span class="line">                        `balance` <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;账户余额&#x27;</span>,</span><br><span class="line">                        `create_time` DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">                        `update_time` DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">                        <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">                        <span class="keyword">UNIQUE</span> INDEX `username` (`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">)</span><br><span class="line">    COMMENT<span class="operator">=</span><span class="string">&#x27;用户表&#x27;</span></span><br><span class="line">    <span class="keyword">COLLATE</span><span class="operator">=</span><span class="string">&#x27;utf8_general_ci&#x27;</span></span><br><span class="line">    ENGINE<span class="operator">=</span>InnoDB</span><br><span class="line">    ROW_FORMAT<span class="operator">=</span>COMPACT</span><br><span class="line">    AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正在导出表  mp.user 的数据：~4 rows (大约)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` (`id`, `username`, `password`, `phone`, `info`, `status`, `balance`, `create_time`, `update_time`) <span class="keyword">VALUES</span></span><br><span class="line">                                                                                                                          (<span class="number">1</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;13900112224&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 20, &quot;intro&quot;: &quot;佛系青年&quot;, &quot;gender&quot;: &quot;male&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">1600</span>, <span class="string">&#x27;2023-05-19 20:50:21&#x27;</span>, <span class="string">&#x27;2023-06-19 20:50:21&#x27;</span>),</span><br><span class="line">                                                                                                                          (<span class="number">2</span>, <span class="string">&#x27;Rose&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;13900112223&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 19, &quot;intro&quot;: &quot;青涩少女&quot;, &quot;gender&quot;: &quot;female&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">600</span>, <span class="string">&#x27;2023-05-19 21:00:23&#x27;</span>, <span class="string">&#x27;2023-06-19 21:00:23&#x27;</span>),</span><br><span class="line">                                                                                                                          (<span class="number">3</span>, <span class="string">&#x27;Hope&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;13900112222&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 25, &quot;intro&quot;: &quot;上进青年&quot;, &quot;gender&quot;: &quot;male&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">100000</span>, <span class="string">&#x27;2023-06-19 22:37:44&#x27;</span>, <span class="string">&#x27;2023-06-19 22:37:44&#x27;</span>),</span><br><span class="line">                                                                                                                          (<span class="number">4</span>, <span class="string">&#x27;Thomas&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;17701265258&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 29, &quot;intro&quot;: &quot;伏地魔&quot;, &quot;gender&quot;: &quot;male&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">800</span>, <span class="string">&#x27;2023-06-19 23:44:45&#x27;</span>, <span class="string">&#x27;2023-06-19 23:44:45&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>在application.yml中设置数据库连接相关信息</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line"><span class="comment">#    url: jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/mp</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置mybatis的日志信息，指定输出至控制台</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.example:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>

<p>设置pom.xml配置信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">3.1</span><span class="number">.6</span>&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;groupId&gt;com.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mp-demo&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;<span class="number">17</span>&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">3.5</span><span class="number">.3</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;excludes&gt;</span><br><span class="line">                        &lt;exclude&gt;</span><br><span class="line">                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">                        &lt;/exclude&gt;</span><br><span class="line">                    &lt;/excludes&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<p>设置Mapper</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//public interface UserMapper extends BaseMapper&lt;User&gt; &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">queryUserByIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>设置User实体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.pojo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">//用户id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//用户名</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">//密码</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//注册手机号</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="comment">//详细信息</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line">    <span class="comment">//使用状态（1正常2冻结）</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编写UserMapper.xml实现接口的sql语句</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.example.mapper.UserMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;insert id=<span class="string">&quot;saveUser&quot;</span> parameterType=<span class="string">&quot;com.example.pojo.User&quot;</span>&gt;</span><br><span class="line">        insert into <span class="title function_">user</span><span class="params">(id, username, password, phone, info, balance)</span></span><br><span class="line">        values (#&#123;id&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;phone&#125;, #&#123;info&#125;, #&#123;balance&#125;)</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;update id=<span class="string">&quot;updateUser&quot;</span> parameterType=<span class="string">&quot;com.example.pojo.User&quot;</span>&gt;</span><br><span class="line">        update user</span><br><span class="line">        &lt;set&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;username != null&quot;</span>&gt;</span><br><span class="line">                username = #&#123;username&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;password != null&quot;</span>&gt;</span><br><span class="line">                password = #&#123;password&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;phone != null&quot;</span>&gt;</span><br><span class="line">                phone = #&#123;phone&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;info != null&quot;</span>&gt;</span><br><span class="line">                info = #&#123;info&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;</span><br><span class="line">                status = #&#123;status&#125;,</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">if</span> test=<span class="string">&quot;balance != null&quot;</span>&gt;</span><br><span class="line">                balance = #&#123;balance&#125;</span><br><span class="line">            &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;/set&gt;</span><br><span class="line">        <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;;</span><br><span class="line">    &lt;/update&gt;</span><br><span class="line">    &lt;delete id=<span class="string">&quot;deleteUser&quot;</span> parameterType=<span class="string">&quot;com.example.pojo.User&quot;</span>&gt;</span><br><span class="line">        delete</span><br><span class="line">        from user</span><br><span class="line">        <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/delete&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;queryUserById&quot;</span> resultType=<span class="string">&quot;com.example.pojo.User&quot;</span>&gt;</span><br><span class="line">        select *</span><br><span class="line">        from user</span><br><span class="line">        <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=<span class="string">&quot;queryUserByIds&quot;</span> resultType=<span class="string">&quot;com.example.pojo.User&quot;</span>&gt;</span><br><span class="line">        select * from user</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;ids != null&quot;</span>&gt;</span><br><span class="line">            where id in</span><br><span class="line">            &lt;foreach collection=<span class="string">&quot;ids&quot;</span> open=<span class="string">&quot;(&quot;</span> close=<span class="string">&quot;)&quot;</span> item=<span class="string">&quot;id&quot;</span> separator=<span class="string">&quot;,&quot;</span>&gt;</span><br><span class="line">                #&#123;id&#125;</span><br><span class="line">            &lt;/foreach&gt;</span><br><span class="line">        &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        LIMIT <span class="number">10</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在单元测试中编写相应的测试方法完成测试案例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MpDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="comment">//        user.setId(1L); // 假设ID是自动生成的，这里只是示例</span></span><br><span class="line">        user.setUsername(<span class="string">&quot;TestUser&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;password123&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;1234567890&quot;</span>);</span><br><span class="line">        user.setInfo(<span class="string">&quot;&#123;\&quot;age\&quot;:30,\&quot;gender\&quot;:\&quot;male\&quot;&#125;&quot;</span>);</span><br><span class="line">        user.setBalance(<span class="number">1000</span>);</span><br><span class="line">        userMapper.saveUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 假设要删除的用户ID为1</span></span><br><span class="line">        userMapper.deleteUser(<span class="number">5L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdateUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1L</span>); <span class="comment">// 更新ID为1的用户</span></span><br><span class="line">        user.setUsername(<span class="string">&quot;UpdatedUser&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;newPassword123&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;0987654321&quot;</span>);</span><br><span class="line">        user.setInfo(<span class="string">&quot;&#123;\&quot;age\&quot;:31,\&quot;gender\&quot;:\&quot;male\&quot;&#125;&quot;</span>);</span><br><span class="line"><span class="comment">//        user.setBalance(1500);</span></span><br><span class="line">        user.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        userMapper.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQueryUserById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询ID为1的用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.queryUserById(<span class="number">5L</span>);</span><br><span class="line">        log.info(String.valueOf(user));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQueryUserByIds</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询ID为1和2的用户</span></span><br><span class="line">        List&lt;Long&gt; ids = Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>);</span><br><span class="line">        List&lt;User&gt; users = userMapper.queryUserByIds(ids);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="快速开始MybatisPlus"><a href="#快速开始MybatisPlus" class="headerlink" title="快速开始MybatisPlus"></a>快速开始MybatisPlus</h2><p>我们要实现User表的CRUD，需要以下几步：</p>
<ul>
<li>引入MybatisPlus依赖</li>
<li>定义Mapper</li>
</ul>
<h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>MybatisPlus提供了starter，实现了自动Mybatis以及MybatisPlus的自动装配功能，坐标如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于这个starter包含了对mybatis的自动装配，因此完全可以替换掉Mybatis的starter。</p>
<p>最终，项目的依赖如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mp-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="定义Mapper接口"><a href="#定义Mapper接口" class="headerlink" title="定义Mapper接口"></a>定义Mapper接口</h3><p>为了简化表CRUD，MybatisPlus提供了一个基础的BaseMapper接口，其中已经实现了表单的CRUD：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218132852524.png" alt="image-20240218132852524"></p>
<p>因此我们定义的Mapper只要实现了这个BaseMapper，就无需自己实现表单CRUD了。修改mp-demo中的com.example包下的UserMapper接口，让其继承BaseMapper；</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用MP的sql方法完成功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MpDemoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">6L</span>); <span class="comment">// 假设ID是自动生成的，这里只是示例</span></span><br><span class="line">        user.setUsername(<span class="string">&quot;TestUser2&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;password123&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;1234567890&quot;</span>);</span><br><span class="line">        user.setInfo(<span class="string">&quot;&#123;\&quot;age\&quot;:30,\&quot;gender\&quot;:\&quot;male\&quot;&#125;&quot;</span>);</span><br><span class="line">        user.setBalance(<span class="number">1000</span>);</span><br><span class="line">        user.setCreateTime(LocalDateTime.now());</span><br><span class="line">        user.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 假设要删除的用户ID为1</span></span><br><span class="line">        userMapper.deleteById(<span class="number">5L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdateUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1L</span>); <span class="comment">// 更新ID为1的用户</span></span><br><span class="line">        user.setUsername(<span class="string">&quot;UpdatedUser&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;newPassword123&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;0987654321&quot;</span>);</span><br><span class="line">        user.setInfo(<span class="string">&quot;&#123;\&quot;age\&quot;:31,\&quot;gender\&quot;:\&quot;male\&quot;&#125;&quot;</span>);</span><br><span class="line">        user.setBalance(<span class="number">1500</span>);</span><br><span class="line">        user.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询ID为1的用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">5L</span>);</span><br><span class="line">        log.info(String.valueOf(<span class="string">&quot;user = &quot;</span> + user));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQueryByIds</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询ID为1和2的用户</span></span><br><span class="line">        List&lt;Long&gt; ids = Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>, <span class="number">4L</span>);</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectBatchIds(ids);</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<p>使用MybatisPlus的基本步骤：</p>
<ol>
<li><p>引入MybatisPlus依赖，代替Mybatis依赖</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218155025974.png" alt="image-20240218155025974"></p>
</li>
<li><p>定义Mapper接口并集成BaseMapper</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218155032709.png" alt="image-20240218155032709"></p>
</li>
</ol>
<h2 id="常见注解"><a href="#常见注解" class="headerlink" title="常见注解"></a>常见注解</h2><p>MyBatisPlus通过扫描实体类，并基于反射获取实体类信息作为数据库表信息。</p>
<p><font color="red">MP是泛型，当输入具体的实体类时，会通过反射获取该实体类的相关信息。</font></p>
<p>默认约定的具体映射关系如下所示：</p>
<ul>
<li>类名驼峰命名，对应的表名是类名驼峰转下划线</li>
<li>表中名为id的字段作为主键</li>
<li>类名的属性驼峰命名，对应的表名字段是类名属性驼峰转下划线</li>
</ul>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218155556926.png" alt="image-20240218155556926"></p>
<p>如果没有遵循默认约定，要求显式用注解来指定相关规则</p>
<p>MybatisPlus中比较常见的几个注解如下：</p>
<ul>
<li><p>@TableName：用来指定表名（当实体类名和表名不符合规则时）</p>
</li>
<li><p>@TableId：用来指定表中的主键字段信息（当类名中不存在值为id的属性）</p>
<p>@TableId（value&#x3D;”id”, type&#x3D;…)，这里的type是IdType枚举类型</p>
<ul>
<li>AUTO：数据库自增长（数据库决定）</li>
<li>INPUT：通过set方法自行输入（用户决定）</li>
<li>ASSIGN_ID：分配ID，接口IdentifierGenerator的方法nextId来生成id，默认实现类为DefaultIdentifierGenerator雪花算法（默认方法）</li>
</ul>
</li>
<li><p>@TableField：用来指定表中的普通字段信息（使用场景如下）</p>
<ul>
<li>当成员变量名与数据库字段名不一致</li>
<li>当成员变量名以is开头，且是布尔值</li>
<li>当成员变量名与数据库关键字冲突</li>
<li>当成员变量不是数据库字段</li>
</ul>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218161312143.png" alt="image-20240218161312143"></p>
</li>
</ul>
<p><strong>总结</strong></p>
<p>MybatisPlus是如何获取实现CRUD的数据库表信息的？</p>
<blockquote>
<p> MP会根据你给的实体类信息，获取数据库的表信息，从而帮我们生成单表数据。</p>
<p>约定</p>
<ul>
<li>类的名称为表名下划线转驼峰</li>
<li>类的成员变量为字段名下划线转驼峰</li>
<li>类中名为id的成员变量作为主键</li>
</ul>
</blockquote>
<p>MybatisPlus的常见注解有哪些？</p>
<blockquote>
<ul>
<li>@TableName：指定表名称及相关配置</li>
<li>@TableId：指定id字段及相关配置</li>
<li>@TableField：指定普通字段及相关配置</li>
</ul>
</blockquote>
<p>IdType的常见类型有哪些?</p>
<blockquote>
<p>AUTO、ASSIGN（默认方式）、INPUT</p>
</blockquote>
<p>使用@TableField的常见场景是什么？</p>
<blockquote>
<ul>
<li>当成员变量名与数据库字段名不一致</li>
<li>当成员变量名以is开头，且是布尔值</li>
<li>当成员变量名与数据库关键字冲突</li>
<li>当成员变量不是数据库字段</li>
</ul>
</blockquote>
<h2 id="常见配置"><a href="#常见配置" class="headerlink" title="常见配置"></a>常见配置</h2><p>在application.yml中添加MybatisPlus的配置项。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218164921377.png" alt="image-20240218164921377"></p>
<p>MybatisPlus的配置项继承了Mybatis原生配置和自己特有的配置，例如：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.itheima.mp.domain.po</span>  <span class="comment"># 别名扫描包</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">&quot;classpath*:/mapper/**/*.xml&quot;</span> <span class="comment"># Mapper.xml文件地址，当前这个是默认值。</span></span><br><span class="line">  <span class="string">configuration：</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span> <span class="comment"># 是否开启下划线和驼峰的映射</span></span><br><span class="line">    <span class="attr">cache-enable:</span> <span class="string">falase</span> <span class="comment"># 是否开启二级缓存</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span> <span class="comment"># id为雪花算法生成</span></span><br><span class="line">      <span class="attr">update-strategy:</span> <span class="string">not_null</span> <span class="comment"># 更新策略：只更新非空字段</span></span><br></pre></td></tr></table></figure>

<ul>
<li>type-aliases-package，给类名起别称，以后不用写全类名，直接写简化名</li>
<li>mapper-locations：mapper.xml的文件地址默认值（mp适合单表查询，如果是多表查询，还是需要mybatis，允许用户通过xml自定义sql语句实现多表查询）</li>
<li>map-underscore-to-camel-case: true # 是否开启下划线和驼峰的映射    </li>
<li>cache-enable: falase # 是否开启二级缓存</li>
<li>id-type: assign_id # id为雪花算法生成（相当于修改TableId的type的默认值）</li>
<li>update-strategy: not_null # 更新策略：只更新非空字段</li>
</ul>
<p>MyBatisPlus使用的基本流程是什么？</p>
<ol>
<li>引入起步依赖</li>
<li>自定义Mapper基础BaseMapper</li>
<li>在实体类上添加注解声明 表信息</li>
<li>在application.yml中根据需要添加配置信息</li>
</ol>
<h1 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h1><h2 id="条件构造器"><a href="#条件构造器" class="headerlink" title="条件构造器"></a>条件构造器</h2><p>MyBatisPlus支持各种复杂的where条件，可以满足日常开发的所有需求。</p>
<p>Wrapper就是条件构造器。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218172927436.png" alt="image-20240218172927436"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218172950865.png" alt="image-20240218172950865"></p>
<p>其中的AbstractWrapper内容如下</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218173036392.png" alt="image-20240218173036392"></p>
<p>querywrapper内容（查询条件相关）</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218173210559.png" alt="image-20240218173210559"></p>
<p>updatewrapper内容（set部分）</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218173237833.png" alt="image-20240218173237833"></p>
<h3 id="案例：基于QueryWrapper的查询"><a href="#案例：基于QueryWrapper的查询" class="headerlink" title="案例：基于QueryWrapper的查询"></a>案例：基于QueryWrapper的查询</h3><p>需求：</p>
<ol>
<li><p>查询出名字中带o的，存款大于等于1000元的人的id、username、info、balance字段</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username,info,balance <span class="keyword">from</span> tb_user <span class="keyword">where</span> username <span class="keyword">like</span> <span class="string">&#x27;%o%&#x27;</span> <span class="keyword">and</span> balance <span class="operator">&gt;=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testQueryWrapper</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.构建查询条件</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;()</span><br><span class="line">        .select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;username&quot;</span>,<span class="string">&quot;info&quot;</span>,<span class="string">&quot;balance&quot;</span>)</span><br><span class="line">        .like(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;o&quot;</span>)</span><br><span class="line">        .ge(<span class="string">&quot;balance&quot;</span>,<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.查询</span></span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line"></span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新用户名为jack的用户的余额为2000</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_user <span class="keyword">set</span> balance <span class="operator">=</span> <span class="number">2000</span> <span class="keyword">where</span> username <span class="operator">=</span> jack;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateByQueryWrapper</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 1. 待更新的数据</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setBalance(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 更新的条件</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;jack&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 执行更新</span></span><br><span class="line">    userMapper.update(user,wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="案例：基于UpdateWrapper的更新"><a href="#案例：基于UpdateWrapper的更新" class="headerlink" title="案例：基于UpdateWrapper的更新"></a>案例：基于UpdateWrapper的更新</h3><p>需求：更新id为1，2，4的用户的余额，扣200</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_user <span class="keyword">set</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">200</span> <span class="keyword">where</span> id <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateWrapper</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Long&gt; ids = List.of(<span class="number">1L</span>,<span class="number">2L</span>,<span class="number">4L</span>);</span><br><span class="line"></span><br><span class="line">    UpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;User&gt;()</span><br><span class="line">        .setSql(<span class="string">&quot;balance = balance - 200&quot;</span>)</span><br><span class="line">        .in(<span class="string">&quot;id&quot;</span>,ids);</span><br><span class="line"></span><br><span class="line">    userMapper.update(<span class="literal">null</span>,wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="案例：基于LambdaQueryWrapper的查询"><a href="#案例：基于LambdaQueryWrapper的查询" class="headerlink" title="案例：基于LambdaQueryWrapper的查询"></a>案例：基于LambdaQueryWrapper的查询</h3><p><font color="red">LambdaQueryWrapper防止硬编码，确保select语句传入的是函数而不是具体的值。</font></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testLambdaQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//1.构建查询条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;()</span><br><span class="line">        .select(User::getId, User::getUsername, User::getInfo, User::getBalance)</span><br><span class="line">        .like(User::getUsername, <span class="string">&quot;o&quot;</span>)</span><br><span class="line">        .ge(User::getBalance, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.查询</span></span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line"></span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>条件构造器的用法：</p>
<ul>
<li>QueryWrapper和LambdaQueryWrapper通常是用来构建select、delete、update和where条件部分</li>
<li>UpdateWrapper和LambdaUpdateWrapper通常只有在set语句比较特殊才使用</li>
<li><font color="red">尽量使用LamdbaQueryWrapper和LambdaUpdateWrapper，避免硬编码</font></li>
</ul>
<h2 id="自定义SQL"><a href="#自定义SQL" class="headerlink" title="自定义SQL"></a>自定义SQL</h2><p>我们可以利用MyBatisPlus中的wrapper来构建复杂的where条件，然后自己定义SQL语句中剩下的部分。</p>
<p>案例：自定义SQL</p>
<p>需求：将id在指定范围的用户（例如1，2，4）的余额扣减指定值。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateBalanceByIds&quot;</span>&gt;</span></span><br><span class="line">	UPDATE tb_user</span><br><span class="line">    SET balance = balance - #&#123;amount&#125;</span><br><span class="line">    WHERE id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">seperator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">end</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">    	#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Long&gt; ids = List.of(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">4L</span>);</span><br><span class="line"></span><br><span class="line">    UpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;User&gt;()</span><br><span class="line">        .setSql(<span class="string">&quot;balance = balance - 200&quot;</span>)</span><br><span class="line">        .in(<span class="string">&quot;id&quot;</span>, ids);</span><br><span class="line"></span><br><span class="line">    userMapper.update(<span class="literal">null</span>, wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/18/mybatisplus-day01/image-20240218181322133.png" alt="image-20240218181322133"></p>
<p>对于复杂的sql语句，wrapper不一定能够完全实现，这个时候可以用MyBatisPlus的wrapper来构建复杂的Where条件，然后自己自定义SQL语句中剩下的部分。</p>
<ol>
<li><p>基于Wrapper构建where条件</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218182806514.png" alt="image-20240218182806514"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Long&gt; ids = List.of(<span class="number">1L</span>,<span class="number">2L</span>,<span class="number">4L</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.构建条件</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;.in(User::getId,ids);</span><br><span class="line"><span class="comment">//2.自定义SQL方法调用</span></span><br><span class="line">userMapper.updateBalanceByIds(wrapper,amount);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在mapper方法参数中用Param注解声明wrapper变量名称，必须是ew</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218182832870.png" alt="image-20240218182832870"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">updateBalanceByIds</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> LambdaQueryWrapper&lt;User&gt; wrapper, <span class="meta">@Param(&quot;amount&quot;)</span> <span class="type">int</span> amount)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义SQL，并使用Wrapper条件</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218182855128.png" alt="image-20240218182855128"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span> = <span class="string">&quot;updateBalanceByIds&quot;</span>&gt;</span></span><br><span class="line">	UPDATE tb_user SET balance = balance - #&#123;amount&#125; $&#123;ew.customSqlSegment&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Service接口"><a href="#Service接口" class="headerlink" title="Service接口"></a>Service接口</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p><strong>service接口汇总</strong></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218183050358.png" alt="image-20240218183050358"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218210152819.png" alt="image-20240218210152819"></p>
<p>原来我们是定义UserService接口，再用UserServiceImpl继承和实现其接口方法。</p>
<p>现在我们让UserService接口去继承IService接口，（IService接口定义了许多有用的service层的方法），再让UserServiceImpl类去继承ServiceImpl类，实现UserService接口（ServiceImpl类实现了IService接口定义的所有方法），通过继承ServiceImpl类，UserServiceImpl拥有和实现了许多IService接口定义的方法，以至于他也能够实现UserService接口的所有方法。</p>
<ol>
<li><p>让UserService接口去继承IService接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span>  <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>让UserServiceImpl类去继承ServiceImpl类，实现UserService接口（泛型，要指定对应的mapper类UserMapper和要操作的实体类User）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper,User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写测试用例测试service类功能（注意，这个时候已经实现了不用mapper层，直接用service层即可进行数据库操作）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IUserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="comment">//        user.setId(1L); // 更新ID为1的用户</span></span><br><span class="line">        user.setUsername(<span class="string">&quot;UpdatedUser&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;newPassword123&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;0987654321&quot;</span>);</span><br><span class="line">        user.setInfo(<span class="string">&quot;&#123;\&quot;age\&quot;:31,\&quot;gender\&quot;:\&quot;male\&quot;&#125;&quot;</span>);</span><br><span class="line">        user.setBalance(<span class="number">1500</span>);</span><br><span class="line">        user.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        userService.save(user);</span><br><span class="line"><span class="comment">//        userMapper.updateById(user);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; users = userService.listByIds(List.of(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">4L</span>));</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<p>MP的Service接口使用流程是怎么样的？</p>
<ul>
<li><p>自定义Service接口继承IService接口。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218214647313.png" alt="image-20240218214647313"></p>
</li>
<li><p>自定义Service实现类，实现自定义接口并继承ServiceImpl类。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240218214653369.png" alt="image-20240218214653369"></p>
</li>
</ul>
</li>
</ol>
<h3 id="基础业务接口"><a href="#基础业务接口" class="headerlink" title="基础业务接口"></a>基础业务接口</h3><p>需求：基于Restful风格实现下面的接口：</p>
<table>
<thead>
<tr>
<th>编号</th>
<th>接口</th>
<th>请求方式</th>
<th>请求路径</th>
<th>请求参数</th>
<th>返回值</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>新增用户</td>
<td>POST</td>
<td>&#x2F;users</td>
<td>用户表单实体</td>
<td>无</td>
</tr>
<tr>
<td>2</td>
<td>删除用户</td>
<td>DELETE</td>
<td>&#x2F;users&#x2F;{id}</td>
<td>用户id</td>
<td>无</td>
</tr>
<tr>
<td>3</td>
<td>根据id查询用户</td>
<td>GET</td>
<td>&#x2F;users&#x2F;{id}</td>
<td>用户id</td>
<td>用户V0</td>
</tr>
<tr>
<td>4</td>
<td>根据id批量查询</td>
<td>GET</td>
<td>&#x2F;users</td>
<td>用户id集合</td>
<td>用户V0集合</td>
</tr>
<tr>
<td>5</td>
<td>根据id扣减余额</td>
<td>GET</td>
<td>&#x2F;users&#x2F;{id}&#x2F;deduction&#x2F;{money}</td>
<td>用户id<br>扣减金额</td>
<td>无</td>
</tr>
</tbody></table>
<p>首先，在项目pom.xml中引入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--HuTool--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--web--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在application.yaml中配置swagger信息</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">knife4j:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">openapi:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">用户管理接口文档</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">&quot;用户管理接口文档&quot;</span></span><br><span class="line">    <span class="attr">email:</span> <span class="string">zhanghuyi@itcast.cn</span></span><br><span class="line">    <span class="attr">concat:</span> <span class="string">虎哥</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">https://www.itcast.cn</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">v1.0.0</span></span><br><span class="line">    <span class="attr">group:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">group-name:</span> <span class="string">default</span></span><br><span class="line">        <span class="attr">api-rule:</span> <span class="string">package</span></span><br><span class="line">        <span class="attr">api-rule-resources:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">com.example.controller</span></span><br></pre></td></tr></table></figure>

<p>然后，接口需要两个实体：</p>
<ul>
<li>UserFormDTO：代表新增时的用户表单</li>
<li>UserVO：代表查询的返回结果</li>
</ul>
<p>首先是UserFormDTO</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;用户表单实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserFormDTO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;注册手机号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;详细信息，JSON风格&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;账户余额&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后是UserVO：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;用户VO实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserVO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;详细信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;使用状态（1正常 2冻结）&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;账户余额&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最后，按照Restful风格编写Controller接口方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.dto.UserFormDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiParam;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Api(tags=&quot;用户管理接口&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span>  <span class="comment">//对那些对象初始化需要初始的成员变量初始化</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IUserService userService;  <span class="comment">//final代表它是常量，必须在类的对象初始化时将该成员变量初始化</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;新增用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(<span class="meta">@RequestBody</span> UserFormDTO userFormDTO)</span>&#123; <span class="comment">//RequestBody接收浏览器发送来的数据</span></span><br><span class="line">        <span class="comment">// 1.把DTO拷贝到POJO</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span>  BeanUtil.copyProperties(userFormDTO, User.class);  <span class="comment">//使用hutool工具中的静态方法将DTO转化为实体类</span></span><br><span class="line">        <span class="comment">// 2.新增</span></span><br><span class="line">        userService.save(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;删除用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@PathVariable</span> Long id)</span>&#123; <span class="comment">//PathVariable接收浏览器页面请求的id</span></span><br><span class="line">        userService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据ID查询用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserVO <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@PathVariable</span> Long id)</span>&#123; <span class="comment">//PathVariable接收浏览器页面请求的id</span></span><br><span class="line">        <span class="comment">//1.查询用户POJO</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.把PO拷贝到VO</span></span><br><span class="line">        <span class="keyword">return</span> BeanUtil.copyProperties(user,UserVO.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;根据ID批量查询用户接口&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id集合&quot;)</span> <span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span>&#123; <span class="comment">//RequestParam代表数组</span></span><br><span class="line">        <span class="comment">//1.查询用户集合POJO</span></span><br><span class="line">        List&lt;User&gt; users = userService.listByIds(ids);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.把PO拷贝到VO</span></span><br><span class="line">        <span class="keyword">return</span> BeanUtil.copyToList(users,UserVO.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="复杂业务接口"><a href="#复杂业务接口" class="headerlink" title="复杂业务接口"></a>复杂业务接口</h3><p>扣减金额：先根据status判断是否执行扣减操作，再根据balance判断金额是否足够扣减</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219115537636.png" alt="image-20240219115537636"></p>
<p>controller层定义相应的实现方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;扣减用户余额接口&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/&#123;id&#125;/deduction/&#123;money&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductMoneyById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@PathVariable(&quot;id&quot;)</span> Long id,</span></span><br><span class="line"><span class="params">                            <span class="meta">@ApiParam(&quot;扣减的金额&quot;)</span> <span class="meta">@PathVariable(&quot;money&quot;)</span> Integer money)</span>&#123; <span class="comment">//RequestParam代表数组</span></span><br><span class="line"></span><br><span class="line">    userService.deductBalance(id, money);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service接口创建对应的方法头</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span>  <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service实现类实现该方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper,User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span> &#123;</span><br><span class="line">        <span class="comment">//1. 查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 校验用户状态</span></span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span> || user.getStatus() != <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 校验余额是否充足</span></span><br><span class="line">        <span class="keyword">if</span>(user.getBalance() &lt; money)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户余额不足！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 扣减余额 update tb_user set balance = balance = ?</span></span><br><span class="line">        baseMapper.deductBalance(id,money);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper层的UserMapper实现deductBalance方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt;&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateBalanceByIds</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> LambdaUpdateWrapper&lt;User&gt; wrapper,<span class="meta">@Param(&quot;amount&quot;)</span> <span class="type">int</span> amount)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;UPDATE tb_user SET balance = balance - #&#123;money&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id,<span class="meta">@Param(&quot;money&quot;)</span> Integer money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行项目</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219124424902.png" alt="image-20240219124424902"></p>
<p>访问页面localhost:8080&#x2F;doc.html#name</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219124457932.png" alt="image-20240219124457932"></p>
<p>测试接口是否正常运行</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219132003865.png" alt="image-20240219132003865"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219132013295.png" alt="image-20240219132013295"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219132043263.png" alt="image-20240219132043263"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219132123079.png" alt="image-20240219132123079"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219132140012.png" alt="image-20240219132140012"></p>
<h3 id="Lambda方法"><a href="#Lambda方法" class="headerlink" title="Lambda方法"></a>Lambda方法</h3><p>案例：IService的Lambda查询</p>
<p>需求：实现一个根据复杂条件查询用户的接口，查询条件如下：</p>
<ul>
<li>name：用户名关键字，可以为空</li>
<li>status：用户状态，可以为空</li>
<li>minBalance：最小余额，可以为空</li>
<li>maxBalance：最大余额，可以为空</li>
</ul>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219133315138.png" alt="image-20240219133315138"></p>
<p><strong>controller层</strong>（将传入的数据封装到UserQuery类中）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;用户查询条件实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名关键字&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户状态：1-正常，2-冻结&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;余额最小值&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer minBalance;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;余额最大值&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxBalance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>controller层</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据复杂条件查询用户接口&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUsers</span><span class="params">(UserQuery query)</span>&#123;</span><br><span class="line">    <span class="comment">//1. 查询用户PO</span></span><br><span class="line">    List&lt;User&gt; users = userService.queryUsers(query.getName(),query.getStatus(),query.getMinBalance(),query.getMaxBalance());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 把PO拷贝到VO</span></span><br><span class="line">    <span class="keyword">return</span> BeanUtil.copyToList(users,UserVO.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在Service接口层声明对应的方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span>  <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">(String name, Integer status, Integer minBalance, Integer maxBalance)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在UserService接口实现类中实现对应的方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">(String name, Integer status, Integer minBalance, Integer maxBalance)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; users = lambdaQuery()  <span class="comment">//使用lambdaQuery()方法实现对应的增删改查操作</span></span><br><span class="line">            .like(name != <span class="literal">null</span>, User::getUsername, name)</span><br><span class="line">            .eq(status != <span class="literal">null</span>, User::getStatus, status)</span><br><span class="line">            .ge(minBalance != <span class="literal">null</span>, User::getBalance, minBalance)</span><br><span class="line">            .le(maxBalance != <span class="literal">null</span>, User::getBalance, maxBalance)</span><br><span class="line">            .list();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>案例：IService的Lambda更新</p>
<p>需求：改造根据id修改用户余额的接口，查询条件如下：</p>
<ul>
<li><p>完成对用户状态校验</p>
</li>
<li><p>完成对用户余额校验</p>
</li>
<li><p>如果扣减后余额为0，则将用户status修改为冻结状态</p>
</li>
</ul>
<p><strong>修改UserService接口实现类中实现对应的方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer money)</span> &#123;</span><br><span class="line">    <span class="comment">//1. 查询用户</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 校验用户状态</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span> || user.getStatus() != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 校验余额是否充足</span></span><br><span class="line">    <span class="keyword">if</span> (user.getBalance() &lt; money) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户余额不足！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">remainBalance</span> <span class="operator">=</span> user.getBalance() - money;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. 扣减余额 update tb_user set balance = balance = ?</span></span><br><span class="line">    lambdaUpdate()</span><br><span class="line">        .set(User::getBalance,remainBalance)</span><br><span class="line">        .set(remainBalance &lt;= <span class="number">0</span>,User::getStatus,<span class="number">2</span>)</span><br><span class="line">        .eq(User::getId,id)</span><br><span class="line">        .update();  <span class="comment">//加update实行sql操作</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="批量新增"><a href="#批量新增" class="headerlink" title="批量新增"></a>批量新增</h3><p>需求：批量插入10万条用户数据，并作出对比：</p>
<ul>
<li>普通for循环插入</li>
<li>IService的批量插入</li>
<li>开启rewriteBatchedStatements&#x3D;true参数</li>
</ul>
<p>在test目录下IUserServiceTest测试类中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveOneByOne</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            userService.save(buildUser(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">e</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时：&quot;</span> + (e - b));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveBatch</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//我们每次批量插入1000条件，插入100次即10万条数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.准备一个容器为1000的集合</span></span><br><span class="line">        ArrayList&lt;User&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//2.添加一个user</span></span><br><span class="line">            list.add(buildUser(i));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.每100条批量插入一次</span></span><br><span class="line">            <span class="keyword">if</span>(i % <span class="number">1000</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                userService.saveBatch(list);</span><br><span class="line">                list.clear(); <span class="comment">//将集合再次清空</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">e</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时：&quot;</span> + (e - b));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>普通for循环插入</strong></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219150341222.png" alt="image-20240219150341222"></p>
<p><strong>IService的批量插入</strong></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219150621143.png" alt="image-20240219150621143"></p>
<p><strong>开启rewriteBatchedStatements&#x3D;true</strong>参数</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219150701124.png" alt="image-20240219150701124"></p>
<p>在application.yml配置中在数据库配置项spring.datasource.url后加上rewriteBatchedStatements&#x3D;true</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219151256254.png" alt="image-20240219151256254"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219151416654.png" alt="image-20240219151416654"></p>
<p>批处理方案：</p>
<ul>
<li>普通for循环逐条插入，速度极差，不推荐</li>
<li>MP的批量新增，基于预编译的批处理，性能不错</li>
<li>配置jdbc参数，开rewriteBatchedStatements&#x3D;true，性能最好</li>
</ul>
<h1 id="扩展功能"><a href="#扩展功能" class="headerlink" title="扩展功能"></a>扩展功能</h1><h2 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h2><p>目前MP的使用方法</p>
<ol>
<li><p>引入对应的MP依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>准备实体类（设置TableName将实体类与数据库表做映射）</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219211202183.png" alt="image-20240219211202183"></p>
</li>
<li><p>设置mapper接口继承BaseMapper&lt;User&gt;接口，指定泛型类型</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219211348617.png" alt="image-20240219211348617"></p>
</li>
<li><p>设置service接口继承IService&lt;User&gt;接口，指定泛型类型</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219211501734.png" alt="image-20240219211501734"></p>
</li>
<li><p>编写Service实现类UserServiceImpl，继承ServiceImpl&lt;UserMapper，User&gt;，同时实现IUserService接口</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219211714367.png" alt="image-20240219211714367"></p>
</li>
</ol>
<p>代码简化操作</p>
<ol>
<li><p>下载MyBatisPlus插件</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219212822585.png" alt="image-20240219212822585"></p>
</li>
<li><p>连接数据库</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219225926496.png" alt="image-20240219225926496"></p>
</li>
<li><p>代码生成设置界面</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219225448458.png" alt="image-20240219225448458"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219230651368.png" alt="image-20240219230651368"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240219233633273.png" alt="image-20240219233633273"></p>
</li>
</ol>
<h2 id="静态工具"><a href="#静态工具" class="headerlink" title="静态工具"></a>静态工具</h2><p><img src="/2024/02/18/mybatisplus-day01/image-20240219233757262.png" alt="image-20240219233757262"></p>
<p>与IService接口基本一致，但是Db是静态方法。</p>
<p>IService接口是非静态的，需要自定义接口去继承它，同时还要创建类实现该接口的方法。而静态的方法是没法读取到类上的泛型，因而无法得到实体类的类型，进而无法获知表信息。因此它的方法还要穿一个额外的参数，Class&lt;T&gt;，即实体类的字节码。只有传了这个，才能用反射拿到实体类的相关信息，从而得到注解上的类名，表名，才能实现增删改查。</p>
<p>案例：静态工具查询</p>
<p>需求：</p>
<ol>
<li>改造根据id查询用户的接口，查询用户的同时，查询出用户对应的所有地址</li>
<li>改造根据id批量查询用户的接口，查询用户的同时，查询出用户对应的所有地址</li>
<li>实现根据用户id查询收货地址功能，需要验证用户状态，冻结用户抛出异常（练习）</li>
</ol>
<p>需求1：改造根据id查询用户的接口，查询用户的同时，查询出用户对应的所有地址</p>
<ol>
<li><p>添加AddressVO类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 虎哥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-07-01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;收货地址VO&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressVO</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;省&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;市&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;县/区&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String town;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;手机&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String mobile;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;详细地址&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;联系人&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String contact;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;是否是默认 1默认 0否&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isDefault;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;备注&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String notes;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>给UserVO中添加成员变量：用户的收货地址集合</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;用户VO实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserVO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;详细信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;使用状态（1正常 2冻结）&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;账户余额&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户的收货地址&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;AddressVO&gt; address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改UserController中的queryUserById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据ID查询用户接口&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> UserVO <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id&quot;)</span> <span class="meta">@PathVariable</span> Long id)</span>&#123; <span class="comment">//PathVariable接收浏览器页面请求的id</span></span><br><span class="line">    <span class="keyword">return</span> userService.queryUserAndAddressById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在IUserService中声明queryUserAndAddressById方法，UserServiceImpl中实现queryUserAndAddressById方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.toolkit.Db;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.po.Address;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.AddressVO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserVO <span class="title function_">queryUserAndAddressById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//1. 查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id);</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span> || user.getStatus() == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户状态异常！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 查询地址</span></span><br><span class="line">        List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class).eq(Address::getUserId, id).list();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 封装VO</span></span><br><span class="line">        <span class="comment">//3.1 转User的PO为VO</span></span><br><span class="line">        <span class="type">UserVO</span> <span class="variable">userVO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserVO.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.2 转地址VO</span></span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(addresses))&#123;</span><br><span class="line">            List&lt;AddressVO&gt; addressVOList = BeanUtil.copyToList(addresses, AddressVO.class);</span><br><span class="line">            userVO.setAddress(addressVOList);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userVO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在测试接口中测试对应的接口是否正确</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220000823092.png" alt="image-20240220000823092"></p>
</li>
</ol>
<p>需求2：改造根据id批量查询用户的接口，查询用户的同时，查询出用户对应的所有地址</p>
<ol>
<li><p>修改UserController中的queryUserById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据ID批量查询用户接口&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@ApiParam(&quot;用户id集合&quot;)</span> <span class="meta">@RequestParam(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span>&#123; <span class="comment">//PathVariable接收浏览器页面请求的id</span></span><br><span class="line">    <span class="keyword">return</span> userService.queryUsersAndAddressesById(ids);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在IUserService中声明queryUsersAndAddressesById方法，UserServiceImpl中实现queryUsersAndAddressesById方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.toolkit.Db;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.po.Address;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.AddressVO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserVO&gt; <span class="title function_">queryUsersAndAddressesById</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">        <span class="comment">//1. 查询用户</span></span><br><span class="line">        List&lt;User&gt; users = listByIds(ids);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(users))&#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.查询地址</span></span><br><span class="line">        <span class="comment">//2.1 查询用户id集合</span></span><br><span class="line">        List&lt;Long&gt; userIds = users.stream().map(User::getId).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//2.2 根据用户id查询地址</span></span><br><span class="line">        List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class).in(Address::getUserId, userIds).list();</span><br><span class="line">        <span class="comment">//2.3 转换地址VO</span></span><br><span class="line">        List&lt;AddressVO&gt; addressVOList = BeanUtil.copyToList(addresses, AddressVO.class);</span><br><span class="line">        <span class="comment">//2.4 地址集合分组处理，相同用户放到一个集合中</span></span><br><span class="line">        Map&lt;Long, List&lt;AddressVO&gt;&gt; addressMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isNotEmpty(addressVOList))&#123;</span><br><span class="line">            addressMap = addressVOList.stream().collect(Collectors.groupingBy(AddressVO::getUserId));<span class="comment">//用用户id分组</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 转换VO返回</span></span><br><span class="line">        List&lt;UserVO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(users.size());</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="comment">//3.1转换User的PO为VO</span></span><br><span class="line">            <span class="type">UserVO</span> <span class="variable">vo</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserVO.class);</span><br><span class="line">            list.add(vo);</span><br><span class="line">            <span class="comment">//3.2转换地址VO</span></span><br><span class="line">            vo.setAddress(addressMap.get(user.getId()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        // 1. 查询用户列表</span></span><br><span class="line"><span class="comment">//        List&lt;User&gt; users = lambdaQuery().in(User::getId, ids).list();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        // 2. 准备一个空的UserVO列表用于返回结果</span></span><br><span class="line"><span class="comment">//        List&lt;UserVO&gt; userVOList = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        // 3. 遍历用户列表，为每个用户查询地址并封装成UserVO</span></span><br><span class="line"><span class="comment">//        for (User user : users) &#123;</span></span><br><span class="line"><span class="comment">//            // 跳过状态为2的用户</span></span><br><span class="line"><span class="comment">//            if (user.getStatus() == 2) &#123;</span></span><br><span class="line"><span class="comment">//                continue;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            // 3.1 将User转换为UserVO</span></span><br><span class="line"><span class="comment">//            UserVO userVO = BeanUtil.copyProperties(user, UserVO.class);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            // 3.2 查询当前用户的地址列表</span></span><br><span class="line"><span class="comment">//            List&lt;Address&gt; addresses = Db.lambdaQuery(Address.class).eq(Address::getUserId, user.getId()).list();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            // 3.3 将地址列表转换为AddressVO列表</span></span><br><span class="line"><span class="comment">//            List&lt;AddressVO&gt; addressVOList = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//            for (Address address : addresses) &#123;</span></span><br><span class="line"><span class="comment">//                AddressVO addressVO = BeanUtil.copyProperties(address, AddressVO.class);</span></span><br><span class="line"><span class="comment">//                addressVOList.add(addressVO);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            // 3.4 设置用户VO的地址信息</span></span><br><span class="line"><span class="comment">//            userVO.setAddress(addressVOList);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//            // 3.5 将UserVO添加到结果列表中</span></span><br><span class="line"><span class="comment">//            userVOList.add(userVO);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        return userVOList;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>在测试接口中测试对应的接口是否正确<img src="/2024/02/18/mybatisplus-day01/image-20240220002059865.png" alt="image-20240220002059865"></p>
</li>
</ol>
<h2 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h2><p>举例：淘宝购物后会形成订单， 在订单列表中有删除订单功能，在删除数据时，这个订单在后台的数据中并未真正被删除。</p>
<p><strong>逻辑删除</strong>就是基于代码逻辑模拟删除效果，但并不会真正删除数据。思路如下：</p>
<ul>
<li>在表中添加一个字段标记数据是否被删除</li>
<li>当删除数据时把标记置为1</li>
<li>查询时只查询标记为0的数据</li>
</ul>
<p>例如逻辑删除字段为deleted：</p>
<ul>
<li><p>删除操作：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220105031798.png" alt="image-20240220105031798"></p>
</li>
<li><p>查询操作</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220105156527.png" alt="image-20240220105156527"></p>
</li>
</ul>
<p>目前的MP它执行的操作语句不会额外在条件查询处加上这个判断，如果用逻辑删除原先的MP都不能用了。</p>
<p>Mybatis提供了逻辑删除功能，无需改变方法调用的方式，而是在底层帮我们自动修改CRUD的语句。我们要做的就是在application.yaml文件中配置逻辑删除的字段名称和值即可。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220105839937.png" alt="image-20240220105839937"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220105829649.png" alt="image-20240220105829649"></p>
<p>注意：</p>
<p>逻辑删除本身也有自己的问题，比如：</p>
<ul>
<li>会导致数据库表垃圾数据越来越多，影响查询效率</li>
<li>SQL中全都需要对逻辑删除字段做判断，影响查询效率</li>
</ul>
<p>因此，我不太推荐采用逻辑删除功能，如果数据不能删除，可以采用把数据迁移到其他表的方法。</p>
<h2 id="枚举处理器"><a href="#枚举处理器" class="headerlink" title="枚举处理器"></a>枚举处理器</h2><p>User类中有一个用户状态字段：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220110745823.png" alt="image-20240220110745823"></p>
<p>当状态数量过多时，对应的数字和状态越多，对编程的要求就更复杂，容易出错。</p>
<p>既然状态是有限数量的，可以用枚举来表示。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220111021894.png" alt="image-20240220111021894"></p>
<p>虽然用了枚举类型，但是我们的status状态还是Integer类型，这导致我们在做状态查询时用的还是数字。解决办法，使用UserStatus枚举类型的数据来表示状态。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220111232868.png" alt="image-20240220111232868"></p>
<p>这样操作虽然业务上方便了，但是我们后台的数据库表当中status字段的类型仍然是INT，它接受的仍然是数字。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220111540493.png" alt="image-20240220111540493"></p>
<p>Mybatis帮助我们实现了TypeHandler类，常见的POJO中实体类成员变量的类型它都有对应的处理器，因此它能自动实现Java数据类型与数据库类型的转换。其中就包括枚举类型处理器EnumOrdinalTypeHandler，然而，这个处理器对枚举类型的数据处理效果不是很好。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220111709228.png" alt="image-20240220111709228"></p>
<p>MP在此基础上做了进一步拓展，其中新增了MyBatisEnumTypeHandler处理器等等</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220111857384.png" alt="image-20240220111857384"></p>
<p>使用MyBatisEnumTypeHandler处理器可以将实体类中的枚举类型UserStatus转换为数据库表中的数字类型INT。具体实现操作如下：</p>
<ol>
<li><p>创建并标记枚举类型，在枚举类中对应的数据库字段的值上添加注释@EnumValue</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220113205152.png" alt="image-20240220113205152"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220112222477.png" alt="image-20240220112222477"></p>
</li>
<li><p>让枚举处理器生效，在application.yml中配置全局枚举处理器：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220112340573.png" alt="image-20240220112340573"></p>
</li>
<li><p>修改User和UserVo类成员变量status的类型由Integer为UserStatus。</p>
</li>
<li><p>加上@JsonValue注解，确保返回的是正常或冻结，而不是NORMAL或FROZEN；</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220113640238.png" alt="image-20240220113640238"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220113727515.png" alt="image-20240220113727515"></p>
</li>
</ol>
<p><strong>总结</strong></p>
<p>如何实现PO类中的枚举类型变量与数据库字段的转换？</p>
<ol>
<li><p>给枚举中的与数据库对应value值添加@EnumValue注解</p>
</li>
<li><p>在配置文件中配置的枚举处理器，实现类型转换</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220113838932.png" alt="image-20240220113838932"></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220113858908.png" alt="image-20240220113858908"></p>
</li>
</ol>
<h2 id="JSON处理器"><a href="#JSON处理器" class="headerlink" title="JSON处理器"></a>JSON处理器</h2><p>MP还额外提供了AbstarctJsonTypeHandler数据处理器，它用来解决数据库中的json数据类型与Java类型之间的转化。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220113944606.png" alt="image-20240220113944606"></p>
<p>数据库user表中有一个json类型的字段：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220114120948.png" alt="image-20240220114120948"></p>
<p>在Java中没有对应的json数据类型，默认使用的是String，mybatis会自动实现json和string的处理。这会导致一个问题，如果我们需要获取string中的键值对呢？一个比较好的处理办法是创建该JSON数据对应的实体类，如下所示：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220114651876.png" alt="image-20240220114651876"></p>
<p>成员变量info由string转换为自定义的UserInfo类。这样做可以实现info数据内部查询，但随着而来的是Mybatis并未实现UserInfo类和json格式的数据转换。这时候就要用到<font color="red">MP提供的类型处理器</font>。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220115012276.png" alt="image-20240220115012276"></p>
<p>如上所示，实体类User嵌套了实体类UserInfo。并且在其上方加入了@TableField字段，指定了typeHandler，确定了处理该字段的类型处理器。<font color="red">然而这种实体类的嵌套要求定义复杂的resultmap，如果不想要的话，就在Tablename加上属性autoResultMap &#x3D; false</font></p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220115508545.png" alt="image-20240220115508545"></p>
<p>实操</p>
<ol>
<li><p>创建UserInfo实体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.po;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor(staticName = &quot;of&quot;)</span>  <span class="comment">//加了staticName，可以通过静态方法UserInfo.of()创建对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String Intro;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改User成员变量对应信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.example.enums.UserStatus;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;tb_user&quot;, autoResultMap = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">//用户id</span></span><br><span class="line">    <span class="meta">@TableId(type= IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户名</span></span><br><span class="line">    <span class="meta">@TableField(&quot;`username`&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//密码</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//注册手机号</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="comment">//详细信息</span></span><br><span class="line">    <span class="meta">@TableField(typeHandler = JacksonTypeHandler.class)</span></span><br><span class="line">    <span class="keyword">private</span> UserInfo info;</span><br><span class="line">    <span class="comment">//使用状态（1正常2冻结）</span></span><br><span class="line">    <span class="keyword">private</span> UserStatus status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="插件功能"><a href="#插件功能" class="headerlink" title="插件功能"></a>插件功能</h1><p>MybatisPlus提供的内置拦截器有下面这些：</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>拦截器</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>TenantLineInnerInterceptor</td>
<td>多租户插件</td>
</tr>
<tr>
<td>2</td>
<td>DynamicTableNameInnerInterceptor</td>
<td>动态表名插件</td>
</tr>
<tr>
<td>3</td>
<td>PaginationInnerInterceptor</td>
<td>分页插件</td>
</tr>
<tr>
<td>4</td>
<td>OptimisticLockerInnerInterceptor</td>
<td>乐观锁插件</td>
</tr>
<tr>
<td>5</td>
<td>IllegalSQLInnerInterceptor</td>
<td>SQL性能规范插件，检测并拦截垃圾SQL</td>
</tr>
<tr>
<td>6</td>
<td>BlockAttackInnerInterceptor</td>
<td>防止全表更新和删除的插件</td>
</tr>
</tbody></table>
<h2 id="分页插件基本用法"><a href="#分页插件基本用法" class="headerlink" title="分页插件基本用法"></a>分页插件基本用法</h2><p>首先，要在配置类中注册MybatisPlus的核心插件，同时添加分页插件：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//声明方法，通过返回第三方类的对象实现IOC容器Bean对象的注入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1. 初始化核心插件</span></span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">//2. 添加分页插件</span></span><br><span class="line">        <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL);</span><br><span class="line">        paginationInnerInterceptor.setMaxLimit(<span class="number">1000L</span>); <span class="comment">//设置分页上限</span></span><br><span class="line">        interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着，就可以使用分页的API了（IService，Db静态工具，LambdaQuery都有类似的分页工具）：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220132445037.png" alt="image-20240220132445037"></p>
<p> 它有个泛型E，E继承自IPage接口及其子类（Page和PageDTO），我们用的比较多的是Page对象。</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220133020397.png" alt="image-20240220133020397"></p>
<p>接着，就可以使用分页的API了：</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220133039514.png" alt="image-20240220133039514"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IUserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testPageQuery</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1.查询</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span>, pageSize=  <span class="number">5</span>;</span><br><span class="line">        <span class="comment">//1.1 分页参数</span></span><br><span class="line">        Page&lt;User&gt; page = Page.of(pageNo,pageSize);</span><br><span class="line">        <span class="comment">//1.2排序参数，通过OrderItem来指定</span></span><br><span class="line">        page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;balance&quot;</span>,<span class="literal">true</span>));</span><br><span class="line">        <span class="comment">//1.3分页查询</span></span><br><span class="line">        Page&lt;User&gt; p = userService.page(page);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.总条数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;total = &quot;</span> + p.getTotal());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 总页数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;pages = &quot;</span> + p.getPages());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 分页数据</span></span><br><span class="line">        List&lt;User&gt; records = p.getRecords();</span><br><span class="line">        records.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="通用分页实体"><a href="#通用分页实体" class="headerlink" title="通用分页实体"></a>通用分页实体</h2><p>案例：简单分页查询案例</p>
<p>需求：遵循下面的接口规范，编写一个UserController接口，实现User的分页查询</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220134455782.png" alt="image-20240220134455782"></p>
<p>返回值</p>
<p><img src="/2024/02/18/mybatisplus-day01/image-20240220134554535.png" alt="image-20240220134554535"></p>
<p>实现操作</p>
<ol>
<li><p>创建PageQuery类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.query;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageQuery</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;页码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNo;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;页数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;排序字段&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sortyBy;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;是否升序&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isAsc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>让UserQuery继承PageQuery</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;用户查询条件实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> <span class="keyword">extends</span> <span class="title class_">PageQuery</span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名关键字&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer name;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户状态：1-正常，2-冻结&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;余额最小值&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer minBalance;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;余额最大值&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxBalance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在dto包下创建返回给前端的数据类型泛型类PageDTO&lt;T&gt;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.dto;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;分页结果&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageDTO</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;总条数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer total;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;总页数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer pages;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;集合&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.toolkit.Db;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.dto.PageDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.po.Address;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.query.UserQuery;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.AddressVO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.enums.UserStatus;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageDTO&lt;UserVO&gt; <span class="title function_">queryUsersPage</span><span class="params">(UserQuery query)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> query.getName();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> query.getStatus();</span><br><span class="line">        <span class="comment">//1.构建查询条件</span></span><br><span class="line">        <span class="comment">//1.1 分页条件</span></span><br><span class="line">        Page&lt;User&gt; page = Page.of(query.getPageNo(),query.getPageSize());</span><br><span class="line">        <span class="comment">//1.2 排序条件</span></span><br><span class="line">        <span class="keyword">if</span>(query.getSortyBy() != <span class="literal">null</span>)&#123;</span><br><span class="line">            page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(query.getSortyBy(),query.getIsAsc()));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//为空，默认按照更新时间降序排序</span></span><br><span class="line">            page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;update_time&quot;</span>,<span class="literal">false</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.分页查询</span></span><br><span class="line">        Page&lt;User&gt; p = lambdaQuery().like(name != <span class="literal">null</span>, User::getUsername, name)</span><br><span class="line">            .eq(status != <span class="literal">null</span>, User::getStatus, status)</span><br><span class="line">            .page(page);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.封装VO结果</span></span><br><span class="line">        PageDTO&lt;UserVO&gt; dto = <span class="keyword">new</span> <span class="title class_">PageDTO</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//3.1 总条数</span></span><br><span class="line">        dto.setTotal(p.getTotal());</span><br><span class="line">        <span class="comment">//3.2 总页数</span></span><br><span class="line">        dto.setPages(p.getPages());</span><br><span class="line">        <span class="comment">//3.3 当前页数据</span></span><br><span class="line">        List&lt;User&gt; records = p.getRecords();</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(records))&#123;</span><br><span class="line">            dto.setList((Collections.emptyList()));</span><br><span class="line">            <span class="keyword">return</span> dto;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.4 拷贝user的VO</span></span><br><span class="line">        List&lt;UserVO&gt; userVOS = BeanUtil.copyToList(p.getRecords(), UserVO.class);</span><br><span class="line">        dto.setList(userVOS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.返回</span></span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="通用分页实体与MP转换"><a href="#通用分页实体与MP转换" class="headerlink" title="通用分页实体与MP转换"></a>通用分页实体与MP转换</h2><p>案例：通用分页实体</p>
<p>需求：</p>
<ul>
<li><p>在PageQuery中定义方法，将PageQuery对象转化为MyBatisPlus中的Page对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.query;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;分页查询实体&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageQuery</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;页码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">pageNo</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;页数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;排序字段&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sortyBy;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;是否升序&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">isAsc</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPage</span><span class="params">(OrderItem... items)</span> &#123;</span><br><span class="line">        <span class="comment">//1.构建查询条件</span></span><br><span class="line">        <span class="comment">//1.1 分页条件</span></span><br><span class="line">        Page&lt;T&gt; page = Page.of(pageNo, pageSize);</span><br><span class="line">        <span class="comment">//1.2 排序条件</span></span><br><span class="line">        <span class="keyword">if</span> (sortyBy != <span class="literal">null</span>) &#123;</span><br><span class="line">            page.addOrder(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(sortyBy, isAsc));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (items != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//为空，默认按照更新时间降序排序</span></span><br><span class="line">            page.addOrder(items);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPage</span><span class="params">(String defaultSortBy, Boolean defaultAsc)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toMpPage(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(defaultSortBy, defaultAsc));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPageDefaultSortByCreateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toMpPage(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;create_time&quot;</span>, <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; Page&lt;T&gt; <span class="title function_">toMpPageDefaultSortByUpdateTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> toMpPage(<span class="keyword">new</span> <span class="title class_">OrderItem</span>(<span class="string">&quot;update_time&quot;</span>, <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在PageDTO中定义方法，将MyBatisPlus中的Page结果转化为PageDTO的结果</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.domain.dto;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;分页结果&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageDTO</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;总条数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;总页数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long pages;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;集合&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;PO, VO&gt;  PageDTO&lt;VO&gt; <span class="title function_">of</span><span class="params">(Page&lt;PO&gt; p, Class&lt;VO&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="comment">//3.封装VO结果</span></span><br><span class="line">        PageDTO&lt;VO&gt; dto = <span class="keyword">new</span> <span class="title class_">PageDTO</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//3.1 总条数</span></span><br><span class="line">        dto.setTotal(p.getTotal());</span><br><span class="line">        <span class="comment">//3.2 总页数</span></span><br><span class="line">        dto.setPages(p.getPages());</span><br><span class="line">        <span class="comment">//3.3 当前页数据</span></span><br><span class="line">        List&lt;PO&gt; records = p.getRecords();</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(records))&#123;</span><br><span class="line">            dto.setList((Collections.emptyList()));</span><br><span class="line">            <span class="keyword">return</span> dto;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.4 拷贝user的VO</span></span><br><span class="line">        List&lt;VO&gt; userVOS = BeanUtil.copyToList(records, clazz);</span><br><span class="line">        dto.setList(userVOS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.返回</span></span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新改写根据条件分页查询结果的测试方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.toolkit.Db;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.dto.PageDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.po.Address;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.query.PageQuery;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.query.UserQuery;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.AddressVO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.enums.UserStatus;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageDTO&lt;UserVO&gt; <span class="title function_">queryUsersPage</span><span class="params">(UserQuery query)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> query.getName();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> query.getStatus();</span><br><span class="line">        Page&lt;User&gt; page = query.toMpPageDefaultSortByUpdateTime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.分页查询</span></span><br><span class="line">        Page&lt;User&gt; p = lambdaQuery().like(name != <span class="literal">null</span>, User::getUsername, name)</span><br><span class="line">            .eq(status != <span class="literal">null</span>, User::getStatus, status)</span><br><span class="line">            .page(page);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> PageDTO.of(p, UserVO.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>缺点：<code>BeanUtil.copyToList(records, clazz);</code>要求PO和VO类型的字段名一致。如果字段名不一致，无法拷贝，就必须自己完成PO到VO的转化。解决办法，传递转换方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//pageDTO.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.domain.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collector;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;分页结果&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageDTO</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;总条数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long total;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;总页数&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long pages;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;集合&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;PO, VO&gt;  PageDTO&lt;VO&gt; <span class="title function_">of</span><span class="params">(Page&lt;PO&gt; p, Function&lt;PO,VO&gt; convertor)</span>&#123;</span><br><span class="line">        <span class="comment">//3.封装VO结果</span></span><br><span class="line">        PageDTO&lt;VO&gt; dto = <span class="keyword">new</span> <span class="title class_">PageDTO</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//3.1 总条数</span></span><br><span class="line">        dto.setTotal(p.getTotal());</span><br><span class="line">        <span class="comment">//3.2 总页数</span></span><br><span class="line">        dto.setPages(p.getPages());</span><br><span class="line">        <span class="comment">//3.3 当前页数据</span></span><br><span class="line">        List&lt;PO&gt; records = p.getRecords();</span><br><span class="line">        <span class="keyword">if</span>(CollUtil.isEmpty(records))&#123;</span><br><span class="line">            dto.setList((Collections.emptyList()));</span><br><span class="line">            <span class="keyword">return</span> dto;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.4 拷贝user的VO</span></span><br><span class="line">        dto.setList(records.stream().map(convertor).collect(Collectors.toList()));</span><br><span class="line"><span class="comment">//        List&lt;VO&gt; userVOS = BeanUtil.copyToList(records, clazz);</span></span><br><span class="line"><span class="comment">//        dto.setList(userVOS);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.返回</span></span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// UserServiceImpl.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.bean.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.collection.CollUtil;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.OrderItem;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.toolkit.Db;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.dto.PageDTO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.po.Address;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.query.PageQuery;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.query.UserQuery;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.AddressVO;</span><br><span class="line"><span class="keyword">import</span> com.example.domain.vo.UserVO;</span><br><span class="line"><span class="keyword">import</span> com.example.enums.UserStatus;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageDTO&lt;UserVO&gt; <span class="title function_">queryUsersPage</span><span class="params">(UserQuery query)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> query.getName();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">status</span> <span class="operator">=</span> query.getStatus();</span><br><span class="line">        Page&lt;User&gt; page = query.toMpPageDefaultSortByUpdateTime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.分页查询</span></span><br><span class="line">        Page&lt;User&gt; p = lambdaQuery().</span><br><span class="line">            like(name != <span class="literal">null</span>, User::getUsername, name)</span><br><span class="line">            .eq(status != <span class="literal">null</span>, User::getStatus, status)</span><br><span class="line">            .page(page);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> PageDTO.of(p, user -&gt; &#123;</span><br><span class="line"><span class="comment">//            BeanUtil.copyProperties(user, UserVO.class)</span></span><br><span class="line">            <span class="type">UserVO</span> <span class="variable">vo</span> <span class="operator">=</span> BeanUtil.copyProperties(user,UserVO.class);</span><br><span class="line">            vo.setUsername(vo.getUsername().substring(<span class="number">0</span>,vo.getUsername().length() - <span class="number">2</span>) + <span class="string">&quot;**&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> vo;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>mybatisplus</category>
      </categories>
  </entry>
  <entry>
    <title>javaweb-day09-maven高级</title>
    <url>/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/</url>
    <content><![CDATA[<h1 id="分模块设计与开发"><a href="#分模块设计与开发" class="headerlink" title="分模块设计与开发"></a>分模块设计与开发</h1><ul>
<li><p>为什么？</p>
<ul>
<li>（一个电商项目可能包含多个业务功能，商品、搜索、购物车、订单等等模块，所有的代码都在一个java项目中，这个项目的管理和维护会很困难）</li>
<li>（在项目中定义了通用的工具类和组件，公司其他项目组也想使用这些工具类和组件，这种情况也不太方便，代码难以复用）</li>
</ul>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216183352534.png" alt="image-20240216183352534"></p>
</li>
<li><p>分模块设计：将项目按照功能拆分为若干个子模块，方便项目的管理维护、拓展，也方便模块间的相互调用，资源共享。（商品、搜索、购物车、订单、实体类|通用组件模块等）</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216183456409.png" alt="image-20240216183456409"></p>
</li>
<li><p>实践</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216213219458.png" alt="image-20240216213219458"></p>
</li>
<li><p>步骤</p>
<ul>
<li><p>创建maven模块 tlias-pojo，存放实体类。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216214402332.png" alt="image-20240216214402332"></p>
<p>给tlias-pojo的pom.xml文件加上对应的依赖，确保其中的pojo类方法能正常运行。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216214515180.png" alt="image-20240216214515180"></p>
</li>
<li><p>创建maven模块tlias-utils，存放相关工具类。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216214900547.png" alt="image-20240216214900547"></p>
</li>
<li><p>在主程序中引入这两个模块</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216215548913.png" alt="image-20240216215548913"></p>
<p><font color="red">注意事项：分模块开发需要先针对模块功能进行设计，再进行编码。不会先将工程开发完毕，然后进行拆分。</font></p>
</li>
</ul>
</li>
</ul>
<h1 id="继承与聚合"><a href="#继承与聚合" class="headerlink" title="继承与聚合"></a>继承与聚合</h1><h2 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a>继承关系</h2><p><strong>问题</strong></p>
<p>不同模块的配置引入了多个相同依赖。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216220009702.png" alt="image-20240216220009702"></p>
<p><strong>继承</strong></p>
<ul>
<li>概念：继承描述的是两个工程间的关系，与Java中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承。（将各个子工程中的公共依赖放到父工程依赖中）。</li>
<li>作用：简化依赖配置，统一管理依赖。</li>
<li>实现：&lt;parent&gt; … &lt;&#x2F;parent&gt;</li>
</ul>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216220347887.png" alt="image-20240216220347887"></p>
<p><strong>步骤</strong></p>
<ol>
<li><p>创建maven模块tlias-parent，该工程为父工程，设置打包方式pom（默认jar）。</p>
<ul>
<li>jar：普通模块打包，springboot项目基本都是jar包（内嵌tomcat运行）</li>
<li>war：普通web程序打包，需要部署在外部的tomcat服务器中运行</li>
<li>pom：父工程或聚合工程，该模块不写代码，仅进行依赖管理</li>
</ul>
<p>注意：在maven当中，一个工程只能继承一个父工程。我们原始的tlias-web-management已经有父工程spring-boot-starter-parent。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216221111872.png" alt="image-20240216221111872"></p>
<p>解决办法：让tlias-parent继承spring-boot-starter-parent，再让tlias-web-management继承tlias-parent。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216221158176.png" alt="image-20240216221158176"></p>
<p>设置tlias-parent的pom.xml内容，设置了parent父工程，packaging打包方式。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216221232706.png" alt="image-20240216221232706"></p>
</li>
<li><p>在子工程的pom.xml文件中，配置继承关系。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216223213319.png" alt="image-20240216223213319"></p>
<ul>
<li>在子工程中，配置了继承关系之后，坐标中的groupId是可以省略的，因为会自动继承父工程的。</li>
<li>relativePath指定父工程的pom文件的相对位置（如果不指定，将从本地仓库&#x2F;远程仓库中查找该工程）。</li>
</ul>
</li>
<li><p>在父工程中配置各个工程共有的依赖（子工程会自动继承父工程的依赖）。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216223346649.png" alt="image-20240216223346649"></p>
<ul>
<li><font color="red">若父子工程都配置了同一个依赖的不同版本，以子工程的为准。</font></li>
</ul>
</li>
</ol>
<p><strong>实操</strong></p>
<ol>
<li>创建tlias-parent模块作为父工程。</li>
</ol>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216221627518.png" alt="image-20240216221627518"></p>
<ol start="2">
<li><p>设置tlias-parent模块的打包方式和父工程，删除无用的src目录（仅做依赖管理）</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216221919180.png" alt="image-20240216221919180"></p>
</li>
<li><p>设置子工程的pom.xml</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216222504798.png" alt="image-20240216222504798"></p>
</li>
<li><p>在父工程中配置子工程中相同的配置</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216222918026.png" alt="image-20240216222918026"></p>
</li>
</ol>
<p><strong>真实的项目模块结构</strong>（有图所示）</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216223542356.png" alt="image-20240216223542356"></p>
<h2 id="版本锁定"><a href="#版本锁定" class="headerlink" title="版本锁定"></a>版本锁定</h2><p>分模块之后，子工程可以继承父工程的依赖。</p>
<p>问题：存在多个（非全部）子工程使用同一个依赖。这个依赖无法直接添加到父工程中。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216223913990.png" alt="image-20240216223913990"></p>
<p>解决办法：</p>
<p>在maven中，可以在父工程的pom文件中通过&lt;dependencyManagement&gt;来统一管理依赖版本。（仅仅代表我们要统一管理这个依赖的版本，但是不将其添加至父工程的依赖中，实际上配置时还是在子工程中配置依赖，但是不用再在子工程中指定依赖版本）</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216224152871.png" alt="image-20240216224152871"></p>
<p>注意事项：</p>
<ul>
<li>子工程引入依赖时，无需指定&lt;version&gt;版本号，父工程统一管理。变更依赖版本，只需在父工程中统一变更。</li>
</ul>
<p><strong>自定义属性&#x2F;引用属性</strong></p>
<p>在yml文件的properties属性中设置依赖版本</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216225128520.png" alt="image-20240216225128520"></p>
<ol>
<li>&lt;dependencyManagement&gt;与&lt;dependencies&gt;的区别是什么？</li>
</ol>
<ul>
<li>&lt;dependencies&gt;是直接依赖，在父工程配置了依赖，子工程会直接继承下来。</li>
<li>&lt;dependencyManagement&gt;是统一管理依赖版本，不会直接依赖，还需要在子工程中引入所需依赖（无需指定版本）</li>
</ul>
<h2 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h2><p>问题：要将tlias-web-management打包，得先将tlias-parent，tlias-pojo，tlias-utils执行install，然后才能打包tlias-web-management。</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216231527264.png" alt="image-20240216231527264"></p>
<p>maven的聚合操作就是来解决这个问题：一键编译、打包、安装。</p>
<ul>
<li><p>聚合</p>
<p>将多个模块组织成一个整体，同时进行项目的构建。</p>
</li>
<li><p>聚合工程</p>
<p>一个不具有业务功能的“空”工程（有且仅有一个pom文件）（目前项目中就有，是tlias-parent，因此tlias-parent既是父工程，也是聚合工程）</p>
</li>
<li><p>作用</p>
<p>快速构建项目（无需根据依赖关系手动构建，直接在聚合工程上构建即可）</p>
</li>
</ul>
<p>maven可以通过在pom.xml中设置&lt;modules&gt;，从而设置当前聚合工程所包含的子模块名称</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216231953596.png" alt="image-20240216231953596"></p>
<p>注意事项：</p>
<ul>
<li>聚合工程中所包含的模块，在构建时，会根据模块间的依赖关系设置构建顺序，与聚合工程中模块的配置书写位置无关。</li>
</ul>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240216232244285.png" alt="image-20240216232244285"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>作用<ul>
<li>聚合用于快速构建项目</li>
<li>继承用于简化依赖配置、统一管理依赖</li>
</ul>
</li>
<li>相同点<ul>
<li>聚合与继承的pom.xml文件打包方式均为pom，可以将两种关系制作到同一个pom文件中</li>
<li>聚合与继承均属于设计型模块， 并无实际的模块内容</li>
</ul>
</li>
<li>不同点<ul>
<li>聚合是在聚合工程中配置关系，聚合可以感知到参与聚合的模块有哪些</li>
<li>继承是在子模块中配置关系，父模块无法感知哪些子模块继承了自己</li>
</ul>
</li>
</ul>
<h1 id="私服"><a href="#私服" class="headerlink" title="私服"></a>私服</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217011547756.png" alt="image-20240217011547756"></p>
<p>问题：怎么将A中的jar包导入至B的项目中？</p>
<p>解决办法：搭建私服。私服从中央仓库下载第三方依赖，确保A和B能使用对方的依赖和中央仓库的依赖。</p>
<ul>
<li><p>私服是一种特殊的远程仓库，它是架设在局域网内的仓库服务，用来代理位于外部的中央仓库，用于解决团队内部的资源共享与资源同步问题。</p>
</li>
<li><p>依赖查找顺序：</p>
<ul>
<li>本地仓库</li>
<li>私服</li>
<li>中央仓库</li>
</ul>
</li>
<li><p>注意事项：私服在企业项目开发中，一个项目&#x2F;公司，只需要一台即可（<font color="red">无需我们搭建，会使用即可</font>）</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217011926163.png" alt="image-20240217011926163"></p>
</li>
</ul>
<h2 id="资源上传与下载"><a href="#资源上传与下载" class="headerlink" title="资源上传与下载"></a>资源上传与下载</h2><p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217012323930.png" alt="image-20240217012323930"></p>
<p><strong>私服的仓库</strong></p>
<ul>
<li>RELEASE(发行版本)：功能趋于稳定，当前更新停止，可以用于发行的版本，存储在私服的RELEASE仓库中。</li>
<li>SNAPSHOT（快照版本）：功能不稳定、尚处于开发中的版本，即快照版本，存储在私服的SNAPSHOT仓库中。</li>
</ul>
<ol>
<li><p>配置访问私服的用户名&#x2F;密码（settings.xml中的servers中配置）</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217013612624.png" alt="image-20240217013612624"></p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217013535822.png" alt="image-20240217013535822"></p>
</li>
<li><p>IDEA的maven工程的pom文件中配置上传（发布）地址</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217013625786.png" alt="image-20240217013625786"></p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217013643914.png" alt="image-20240217013643914"></p>
</li>
<li><p>设置私服依赖下载的仓库组地址（仓库组挂载了所有仓库，settings.xml中的mirrors、profiles中配置）</p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217013820947.png" alt="image-20240217013820947"></p>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217013850809.png" alt="image-20240217013850809"></p>
</li>
</ol>
<h2 id="私服配置说明"><a href="#私服配置说明" class="headerlink" title="私服配置说明"></a>私服配置说明</h2><p>访问私服：<a href="http://192.168.150.101:8081/">http://192.168.150.101:8081</a></p>
<p>访问密码：admin&#x2F;admin</p>
<p>使用私服，需要在maven的settings.xml配置文件中，做如下配置：</p>
<ol>
<li><p>需要在 <strong>servers</strong> 标签中，配置访问私服的个人凭证(访问的用户名和密码)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>在 <strong>mirrors</strong> 中只配置我们自己私服的连接地址(如果之前配置过阿里云，需要直接替换掉)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.150.101:8081/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>需要在 <strong>profiles</strong> 中，增加如下配置，来指定snapshot快照版本的依赖，依然允许使用</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>allow-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.150.101:8081/repository/maven-public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>如果需要上传自己的项目到私服上，需要在项目的pom.xml文件中，增加如下配置，来配置项目发布的地址(也就是私服的地址)</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- release版本的发布地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.150.101:8081/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- snapshot版本的发布地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>maven-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://192.168.150.101:8081/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>发布项目，直接运行 deploy 生命周期即可 (发布时，建议跳过单元测试)</p>
</li>
</ol>
<p>​		</p>
<h2 id="启动本地私服"><a href="#启动本地私服" class="headerlink" title="启动本地私服"></a>启动本地私服</h2><ol>
<li><p>解压： apache-maven-nexus.zip</p>
</li>
<li><p>进入目录： apache-maven-nexus\nexus-3.39.0-01\bin</p>
</li>
<li><p>启动服务：双击 start.bat </p>
</li>
<li><p>访问服务：localhost:8081</p>
</li>
<li><p>私服配置说明：将上述配置私服信息的 192.168.150.101 改为 localhost</p>
</li>
</ol>
<h1 id="Web开发完结"><a href="#Web开发完结" class="headerlink" title="Web开发完结"></a>Web开发完结</h1><p>接下来的学习路线</p>
<ol>
<li>MyBatis-Plus</li>
<li>瑞吉外卖项目</li>
<li>微服务技术栈</li>
<li>学成在线项目</li>
</ol>
<p><img src="/2024/02/16/javaweb-day09-maven%E9%AB%98%E7%BA%A7/image-20240217015500978.png" alt="image-20240217015500978"></p>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>javaweb-day08-springboot原理篇</title>
    <url>/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/</url>
    <content><![CDATA[<h1 id="配置优先级"><a href="#配置优先级" class="headerlink" title="配置优先级"></a>配置优先级</h1><ul>
<li><p>springboot中支持三种格式的配置文件：</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215195245829.png" alt="image-20240215195245829"></p>
<p>properties的优先级最高</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215195550412.png" alt="image-20240215195550412"></p>
<p>yml的优先级次之</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215195629992.png" alt="image-20240215195629992"></p>
<p>yaml的优先级最后</p>
</li>
<li><p>注意事项：虽然springboot支持多种格式配置文件，但是在项目开发时，推荐统一使用一种格式的配置（yml是主流）</p>
</li>
<li><p>springboot除了支持配置文件属性配置，还支持<font color="red">Java系统属性</font>和<font color="red">命令行参数</font>的方法进行属性配置。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215195946438.png" alt="image-20240215195946438"></p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215200530374.png" alt="image-20240215200530374"></p>
<p><font color="red">命令行参数（Program argument）的优先级要高于Java系统属性（VM option）设置。</font></p>
</li>
</ul>
<p>目前的设置是在idea中，假如我们使用的不是idea，或者我们的项目已经打包上线了，我们又如何设置java系统属性和命令行参数呢？接下来运行项目打包后运行时如何指定java系统属性和命令行参数。</p>
<ol>
<li><p>执行maven打包指令package</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215201417286.png" alt="image-20240215201417286"></p>
</li>
<li><p>执行java指令，运行jar包</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java -Dserver.port=<span class="number">9000</span> -jar tlias-web-management-<span class="number">0.0</span><span class="number">.1</span>-SNAPSHOT.jar --server.port=<span class="number">10010</span></span><br></pre></td></tr></table></figure>

<p>注意事项：springboot项目进行打包时，需要引入插件spring-boot-maven-plugin（基于官网骨架创建项目，会自动添加该插件）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215201808877.png" alt="image-20240215201808877"></p>
</li>
</ol>
<p>配置优先级（从高到低）</p>
<ul>
<li>java系统属性（-Dxxx&#x3D;xxx）</li>
<li>命令行参数（–xxx&#x3D;xxx）</li>
<li>application.properties</li>
<li>application.yml</li>
<li>application.yaml（忽略）</li>
</ul>
<h1 id="Bean管理"><a href="#Bean管理" class="headerlink" title="Bean管理"></a>Bean管理</h1><h2 id="获取bean"><a href="#获取bean" class="headerlink" title="获取bean"></a>获取bean</h2><ul>
<li><p>默认情况下，Spring项目启动时，会把bean都创建好放在IOC容器中，如果想要主动获取这些bean，可以通过如下方式：</p>
<ul>
<li>根据name获取bean：<code>Object getBean(String name)</code></li>
<li>根据类型获取bean：<code>&lt;T&gt; T getBean(Class&lt;T&gt; requiredType)</code></li>
<li>根据name获取bean（带类型转换）：<code>&lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType)</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TliasWebManagementApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext; <span class="comment">//IOC容器对象</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//根据bean的名称获取</span></span><br><span class="line">        <span class="type">DeptController</span> <span class="variable">bean1</span> <span class="operator">=</span> (DeptController) applicationContext.getBean(<span class="string">&quot;deptController&quot;</span>);</span><br><span class="line">		System.out.println(bean1);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//根据bean的类型获取</span></span><br><span class="line">		<span class="type">DeptController</span> <span class="variable">bean2</span> <span class="operator">=</span> applicationContext.getBean(DeptController.class);</span><br><span class="line">		System.out.println(bean2);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//根据bean的名称及类型获取</span></span><br><span class="line">		<span class="type">DeptController</span> <span class="variable">bean3</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;deptController&quot;</span>, DeptController.class);</span><br><span class="line">		System.out.println(bean3);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意事项：上述所说的[Spring项目启动时，会把其中的bean都创建好]还会收到作用域及延迟初始化影响，这里主要针对默认的单例非延迟加载的bean而言。</p>
</li>
</ul>
<h2 id="bean作用域"><a href="#bean作用域" class="headerlink" title="bean作用域"></a>bean作用域</h2><ul>
<li><p>Spring支持五种作用域，后三种在web环境才会生效</p>
<table>
<thead>
<tr>
<th>作用域</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><font color="red">singleton</font></td>
<td><font color="red">容器内声明的bean只有一个实例（单例）（默认）</font></td>
</tr>
<tr>
<td><font color="red">prototype</font></td>
<td><font color="red">每次使用该bean时都会创建新的实例（非单例）</font></td>
</tr>
<tr>
<td>request</td>
<td>每个请求范围内都会创建新的实例（web环境中，了解）</td>
</tr>
<tr>
<td>session</td>
<td>每个会话范围内都会创建新的实例（web环境中，了解）</td>
</tr>
<tr>
<td>application</td>
<td>每个应用范围内都会创建新的实例（web环境中，了解）</td>
</tr>
</tbody></table>
</li>
<li><p>可以通过@Scope注解来进行配置作用域：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/depts&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意事项</p>
<ul>
<li>默认singleton的bean，在容器启动时被创建，可以通过@Lazy注解来延迟初始化（延迟到第一次使用时）。</li>
<li>prototype的bean，每一次使用该bean的时候都会创建一个新的实例。</li>
<li>实际开发当中，绝大部分的Bean都是单例的，也就是说绝大部分Bean不需要配置scope属性。</li>
</ul>
</li>
</ul>
<h2 id="第三方bean"><a href="#第三方bean" class="headerlink" title="第三方bean"></a>第三方bean</h2><p>原生Bean</p>
<ul>
<li>@Controller</li>
<li>@Service</li>
<li>@Repository（@Mapper）</li>
<li>@Component</li>
</ul>
<p>现在有以下情况，需要初始化某些第三方jar包中的某些类对象，而这些第三方jar包的原码默认是read-only的，不能在其类上加注解@Component。</p>
<ul>
<li><p>如果要管理的bean对象来自于第三方（不是自定义的），是无法用@Component及衍生注解声明bean的，就需要用到@Bean注解。</p>
</li>
<li><p>若要管理的第三方bean对象，建议对这些bean进行集中分类配置，可以通过@Configuration注解声明一个配置类。</p>
</li>
<li><p>将当前方法的返回值对象交给IOC容器管理，称为IOC容器的bean，通过@Bean注解的&#x2F;name&#x2F;value属性指定bean名称，如果为指定，默认方法名即为该第三方bean对象。（完成了控制反转）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215223531608.png" alt="image-20240215223531608"></p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215224343513.png" alt="image-20240215224343513"></p>
</li>
<li><p>完成了依赖注入</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215225225131.png" alt="image-20240215225225131"></p>
</li>
<li><p>如果第三方bean需要依赖其他bean对象，直接再bean定义方法中设置形参即可，容器会根据类型自动装配。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215225407697.png" alt="image-20240215225407697"></p>
</li>
</ul>
<h1 id="SpringBoot原理"><a href="#SpringBoot原理" class="headerlink" title="SpringBoot原理"></a>SpringBoot原理</h1><p>Spring全家桶都基于Spring Framework，这个框架比较繁琐（配置pom.xml复杂），基于此，在Spring Framework4.0之后，推出了Spring Boot框架（简化Spring Framework的开发）。</p>
<p>Spring Boot提供了起步依赖和自动配置。</p>
<ul>
<li>起步依赖：大大简化pom.xml中依赖配置，解决spring framework中依赖配置繁琐的问题。</li>
<li>自动配置：简化spring framework使用时bean的声明和配置。</li>
</ul>
<h2 id="起步依赖"><a href="#起步依赖" class="headerlink" title="起步依赖"></a>起步依赖</h2><p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215230254400.png" alt="image-20240215230254400"></p>
<p>spring框加进行web程序开发要引入上述每个依赖，而springboot只需要引入一个依赖，<font color="red">收益于maven的依赖传递（如果a依赖了b，b依赖了c，那么在引入a之后，b和c这两个依赖也都会引入）</font>。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215230457232.png" alt="image-20240215230457232"></p>
<h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><ul>
<li><p>SpringBoot的自动配置就是当spring容器启动后，一些配置类、bean对象就会自动存入到IOC容器中，不需要我们手动去声明，从而简化了开发，省去了繁琐的配置操作。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215231251757.png" alt="image-20240215231251757"></p>
</li>
</ul>
<h3 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h3><p>springboot当中，我们引入对应的依赖，是如何将依赖中jar包当中所提供的这些bean以及配置类直接加载到当前项目的spring ioc容器当中，然后我们就可以直接使用了。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215231450566.png" alt="image-20240215231450566"></p>
<ul>
<li><p>方案一：@ComponentScan组件扫描</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215232814762.png" alt="image-20240215232814762"></p>
</li>
<li><p>方案二：@Import导入。使用@Import导入的类会被Spring加载到IOC容器中，导入形式主要有以下几种：</p>
<ul>
<li><p>导入普通类</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215233345565.png" alt="image-20240215233345565"></p>
</li>
<li><p>导入配置类（@Configuration，这个类中所有的加了@Bean方法返回的对象都会加载到IOC容器中）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215233510157.png" alt="image-20240215233510157"></p>
</li>
<li><p>导入ImportSelector接口实现类(<font color="red">selectImports方法，极其重要，决定哪些类可以作为Bean对象导入到IOC容器中</font>)</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215234724430.png" alt="image-20240215234724430"></p>
</li>
<li><p>@EnableXxxx注解，封装@Import注解，让第三方库作者来设置要实现哪些bean对象（推荐，方便，优雅）</p>
<p>为启动程序加上@EnableXxxx注解，再创建Enablexxx接口，在该接口加上注解@Import(Xxxx.class)，指定的这个Xxxx.class实现ImportSelector接口的selectImports方法，该方法返回了具体哪些类会注入到ioc容器中。这样第三方作者可以快速方便的自动决定哪些类要加入到IOC容器中。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215235112424.png" alt="image-20240215235112424"></p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240215235235351.png" alt="image-20240215235235351"></p>
</li>
</ul>
</li>
</ul>
<h3 id="源码跟踪"><a href="#源码跟踪" class="headerlink" title="源码跟踪"></a>源码跟踪</h3><p>重点&#x2F;关键：@SpringBootApplication(SpringBoot中最为重要的注解)</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216002845192.png" alt="image-20240216002845192"></p>
<p>技巧：抓关键点，找关键流程</p>
<ol>
<li><p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216003918693.png" alt="image-20240216003918693"></p>
</li>
<li><p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216004027562.png" alt="image-20240216004027562"></p>
</li>
<li><p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216004154608.png" alt="image-20240216004154608"></p>
</li>
<li><p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216004548571.png" alt="image-20240216004548571"></p>
</li>
<li><p>找到了对应的selectImports方法，该方法会返回要封装到IOC容器的bean对象的全类名的数组。现在要查明数组的具体内容是什么，先进入getAutoConfigurationEntry找到具体的实现细节。<img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216004713347.png" alt="image-20240216004713347"></p>
</li>
<li><p>Entry里面返回了哪些信息，在这里可以看到，直接return了一个entry对象，new  entry对象时里面传递了两个参数，分别是configurations，exclusions，通过图5可以知道最终调用的是configurations。我们要去看一下这个configurations如何获取的，是通过调用getCandidateConfigurations方法。<img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216005719506.png" alt="image-20240216005719506"></p>
</li>
<li><p>getCandidateConfigurations的代码如下所示，通过调用loadFactoryNames获得configurations，它的具体实现细节暂时可跳过，重点注意下面的断言，如果configurations是空的，就会提示信息，信息描述是说当没有自动配置的类被发现时就会报错，这里有两个文件，首先，第一个文件是META-INF下的spring.factory文件，另一个是META-INF&#x2F;spring&#x2F;org.springframework.boot.autoconfigure.AutoConfiguration.imports，那也就是说，springboot在启动时会自动加载这两个文件中配置的信息，并将其封装到list集合，最终将list集合的内容封装到string类型的数组中，这些数据最终加载到IOC容器的Bean或者配置类。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216010055187.png" alt="image-20240216010055187"></p>
</li>
<li><p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216010605951.png" alt="image-20240216010605951"></p>
</li>
<li><p>可以看到，这两个文件下的内容都是各个类的全类名<img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216010704636.png" alt="image-20240216010704636"></p>
</li>
</ol>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216010819685.png" alt="image-20240216010819685"></p>
<p>@SpringBootApplication</p>
<ul>
<li>该注解表示在SpringBoot工程引导类上，是springboot最最最重要的注解，该注解由三个部分组成。<ul>
<li>@SpringBootConfiguration：该注解与@Configuration注解作用相同，用来声明当前也是一个配置类。</li>
<li>@ComponentScan：组件扫描，默认扫描当前引导类所在包及其子包。</li>
<li>@EnableAutoConfiguration：SpringBoot实现自动化配置的核心注解。</li>
</ul>
</li>
</ul>
<p>并不是所有的@Bean都会注册为bean对象，@ConditionalOnMissingBean就是用来决定哪些加了@Bean的方法返回的对象可以成为bean对象。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216011245608.png" alt="image-20240216011245608"></p>
<p>@Conditional</p>
<ul>
<li>作用：按照一定的条件进行判断，在满足给定条件后才会注册对应的bean对象到Spring IOC容器中。</li>
<li>位置：方法、类。</li>
<li>@Conditional本身是一个父注解， 派生出大量的子注解；<ul>
<li>@ConditionalOnClass：判断环境中是否有对应的字节码文件，才注册bean到IOC容器。</li>
<li>@ConditionalOnMissingBean：判断环境中没有对应的bean（类型或名称），才注册bean到IOC容器。</li>
<li>@ConditionalOnProperty：判断配置文件中有对应属性和值，才注册bean到IOC容器。</li>
</ul>
</li>
</ul>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216011800342.png" alt="image-20240216011800342"></p>
<ol>
<li>不加@ConditionalOnClass注解的结果</li>
</ol>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216135152532.png" alt="image-20240216135152532"></p>
<ol start="2">
<li><p>加了@ConditionalOnMissingBean注解（如果用户没有定义对应的第三方类名或方法，才会将其注入到Bean对象中）</p>
</li>
<li><p>加了@ConditionalOnClass注解（<font color="red">当pom.xml文件中引入当前name指定的全类对应的依赖时，才会将对象加入到bean对象中</font>）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216135356633.png" alt="image-20240216135356633"></p>
</li>
<li><p>加了@ConditionalOnProperty注解（判断配置文件是否存在对应的属性和属性值，如果存在，才会将这个bean注册到ioc容器中）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216142834334.png" alt="image-20240216142834334"></p>
</li>
</ol>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216142936518.png" alt="image-20240216142936518"></p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216143403666.png" alt="image-20240216143403666"></p>
<h3 id="案例（自定义starter）"><a href="#案例（自定义starter）" class="headerlink" title="案例（自定义starter）"></a>案例（自定义starter）</h3><p><strong>场景</strong></p>
<ul>
<li>在实际开发中，经常会定义一些公共组件，提供给各个项目团队使用。而在SpringBoot的项目中，一般会将这些公共组件封装为SpringBoot的starter。</li>
</ul>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216144308670.png" alt="image-20240216144308670"></p>
<p><strong>需求</strong></p>
<ul>
<li>需求：自定义aliyun-oss-spring-boot-starter，完成阿里云OSS操作工具类AliyunOSSUtils的自动配置。</li>
<li>目标：引入起步依赖之后，要想使用阿里云OSS，注入AliyunOSSUtils直接使用即可。</li>
</ul>
<p>原始的使用阿里云OSS的步骤</p>
<ol>
<li>需要在pom.xml文件中引入阿里云OSS的一堆依赖</li>
<li>参照官方提供的SDK改造工具类，将官方的SDK demo示例改造成工具类，然后在yml中配置aliyunOSS需要的配置参数，然后在通过AliyunOSS的实体类来加载yml配置文件当中的配置项，最后才可以在AliyunOSSUtils中获取这些参数，最后再将这个类交给SpringIOC容器管理，称为IOC容器当中的Bean对象。</li>
</ol>
<p>步骤</p>
<ol>
<li>创建aliyun-oss-spring-boot-starter模块</li>
<li>创建aliyun-oss-spring-boot-autoconfigure模块，在starter中引入该模块</li>
<li>在aliyun-oss-spring-boot-autoconfigure模块中定义自动配置功能， 并定义自动配置文件 META-INF&#x2F;spring&#x2F;xxxx.imports</li>
</ol>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216145204597.png" alt="image-20240216145204597"></p>
<p><strong>创建aliyun-oss-spring-boot-starter模块</strong></p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216145946840.png" alt="image-20240216145946840"></p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216150000745.png" alt="image-20240216150000745"></p>
<p>修改pom.xml文件，可以删除下述三个红框位置的内容。<img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216150040587.png" alt="image-20240216150040587"></p>
<p>删除所有文件至留下以下两项（如果创建的maven项目没有imi文件，解决办法：<a href="https://blog.csdn.net/helloearth121/article/details/118168244">IDEA使用Maven生成普通项目没有生成iml文件解决方法_创建java不自动创建iml-CSDN博客</a>）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216150441995.png" alt="image-20240216150441995"></p>
<p><strong>创建aliyun-oss-spring-boot-autoconfigure模块</strong></p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216150711921.png" alt="image-20240216150711921"></p>
<p>精简至如下结果</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216151112174.png" alt="image-20240216151112174"></p>
<ol>
<li><p>将autoconfigure依赖导入starter的pom.xml</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216151300776.png" alt="image-20240216151300776"></p>
</li>
<li><p>在autoconfigure模块中配置好AliyunOSSUtils（在autoconfigure模块的pom.xml中引入阿里云OSS依赖）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216151802968.png" alt="image-20240216151802968"></p>
</li>
<li><p>将对应AliOSSProperties类和AliOSSUtils类复制到autoconfigure模块的com.aliyun.oss包下。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216152055856.png" alt="image-20240216152055856"></p>
</li>
<li><p>补全这两个类需要的依赖和代码（getter和setter方法）</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216152347046.png" alt="image-20240216152347046"></p>
</li>
<li><p>由于这两个方法中加了@Component，但是它们都不是项目启动时加入的Bean对象，因此要将注解删除。为了实现依赖注入，要为我们自定义的第三方项目创建配置类，声明AliyunOSSUtils这个Bean.因此这一步的操作是声明配置类。</p>
<p>先创建AliOSSAutoConfiguration类，加@Configuration使其成为配置类，加@Bean方法，返回值AliOSSUtils类，方法名为aliOSSUtils，使得返回的与方法名同名的AliOSSUtils类型的对象注册为Bean对象。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216152851187.png" alt="image-20240216152851187"></p>
</li>
<li><p>通过@EnableConfigurationProperties将AliOSSProperties导入到IOC容器中，使其称为Bean对象，同时将其作为aliOSSUtils的参数输入（默认将IOC容器的Bean对象传入），给AliOSSUtils类添加AliOSSProperties的对象属性，重构对应的AliOSSUtils的构造函数，确保其属性能接收到参数传入的Bean对象。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216154218655.png" alt="image-20240216154218655"></p>
</li>
<li><p>配置对应的配置文件META-INF&#x2F;spring&#x2F;xxxx.imports（在resource目录下创建META-INF.spring目录，在该目录下创建org.springframework.boot.autoconfigure.AutoConfiguration.imports文件，并将配置类的全类名com.aliyun.oss.AliOSSAutoConfiguration写入其中。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216155040246.png" alt="image-20240216155040246"></p>
</li>
<li><p>至此，完成！</p>
</li>
</ol>
<p><strong>小结</strong></p>
<p>我们主要定义了starter和autoconfigure两个模块，starter模块主要进行依赖管理，autoconfigure模块实现自动配置。</p>
<p>我们需要定义一个自动配置类，将需要自动配置的Bean都定义在这个自动配置类当中，接着在org.springframework.boot.autoconfigure.AutoConfiguration.imports下导入启动类。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216160946664.png" alt="image-20240216160946664"></p>
<h1 id="Web后端开发总结"><a href="#Web后端开发总结" class="headerlink" title="Web后端开发总结"></a>Web后端开发总结</h1><p>Web后端开发基于三层架构开发</p>
<ul>
<li>Controller控制器层，负责接受请求，响应数据</li>
<li>Service业务层，负责业务逻辑处理</li>
<li>Dao数据访问层&#x2F;持久层，负责处理数据访问操作，完成数据库增删改查</li>
</ul>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216161332789.png" alt="image-20240216161332789"></p>
<p>如果我们在执行具体业务之前要进行通用的业务处理，比如要进行登录校验，要进行统一的字符编码。此时可以借助于JavaWeb三大组件之一的过滤器Filter或Spring当中提供的拦截器Interceptor实现。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216161633213.png" alt="image-20240216161633213"></p>
<p>为了实现三层架构层与层之间的解耦，我们学习了spring框架的第一大核心IOC控制反转和DI依赖注入。</p>
<p>IOC控制反转：将对象创建的控制权由应用程序自身交给外部容器，并将对象声明为IOC容器的Bean对象。</p>
<p>DI依赖注入：容器为程序提供运行时需要的资源。</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216161940142.png" alt="image-20240216161940142"></p>
<ul>
<li><p>AOP面向切面编程</p>
</li>
<li><p>事务管理</p>
</li>
<li><p>全局异常处理</p>
</li>
<li><p>传统会话技术：Cookie、Session</p>
</li>
<li><p>新的会话跟踪解决方案：JWT</p>
</li>
<li><p>阿里云OSS对象存储服务</p>
</li>
<li><p>MyBatis持久层框架操作数据库</p>
</li>
</ul>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216162200217.png" alt="image-20240216162200217"></p>
<p>各个技术分属细节</p>
<p><img src="/2024/02/15/javaweb-day08-springboot%E5%8E%9F%E7%90%86%E7%AF%87/image-20240216162502383.png" alt="image-20240216162502383"></p>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>javaweb-day07-事务管理 &amp; AOP</title>
    <url>/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/</url>
    <content><![CDATA[<h1 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h1><h2 id="事务回顾"><a href="#事务回顾" class="headerlink" title="事务回顾"></a>事务回顾</h2><ul>
<li><p>概念</p>
<p>事务是一组操作的集合，它是一个不可分割的工作单位，这些操作要么同时成功，要么同时失败。</p>
</li>
<li><p>操作</p>
<ul>
<li>开启事务（一组操作开始前，开启事务）：start transaction &#x2F; begin；</li>
<li>提交事务（这组操作全部成功后，提交事务）：commit；</li>
<li>回滚事务（中间任何一个操作出现异常，回滚事务）：rollback；</li>
</ul>
</li>
</ul>
<h2 id="Spring事务管理"><a href="#Spring事务管理" class="headerlink" title="Spring事务管理"></a>Spring事务管理</h2><p>案例需求：解散部门，删除部门，同时删除该部门下的员工。</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214122907385.png" alt="image-20240214122907385"></p>
<p>问题（数据库操作中间报错，导致后续数据库操作未正常执行）</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214122932665.png" alt="image-20240214122932665"></p>
<p>解决办法Spring事务管理</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214123058600.png" alt="image-20240214123058600"></p>
<ul>
<li><p>注解：@Transactional</p>
</li>
<li><p>位置：业务（service）层的方法上、类上、接口上</p>
<p>（作用在方法上，表示当前方法交由spring事务管理；作用在类上，表示当前类的所有方法交由spring事务管理；作用在接口上，表示这个接口下所有实现类的所有实现方法都交由spring事务管理）</p>
</li>
<li><p>作用：将当前方法交给spring进行事务管理，方法执行前，开启事务；成功执行完毕，提交事务；出现异常，回滚事务</p>
</li>
<li><p>常见用法：在执行多次数据访问操作的业务方法上加上Transactional注解。</p>
</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214124025970.png" alt="image-20240214124025970"></p>
<p><strong>开启事务日志</strong></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 开启事务管理日志</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">org.springframework.jdbc.support.JdbcTransactionManager :</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h2 id="事务进阶"><a href="#事务进阶" class="headerlink" title="事务进阶"></a>事务进阶</h2><h3 id="rollbackFor"><a href="#rollbackFor" class="headerlink" title="rollbackFor"></a>rollbackFor</h3><ul>
<li><p>默认情况下，只有出现RuntimeException才回滚异常。rollbackFor属性用于控制出现何种异常类型，回滚事务。</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214125021300.png" alt="image-20240214125021300"></p>
<p>增加代码</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214124800658.png" alt="image-20240214124800658"></p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214125224998.png" alt="image-20240214125224998"></p>
</li>
</ul>
<h3 id="propagation"><a href="#propagation" class="headerlink" title="propagation"></a>propagation</h3><ul>
<li><p>事务传播行为：指的是当一个事务方法被另一个事务方法调用时，这个事务方法应该如何进行事务控制。</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214125400853.png" alt="image-20240214125400853"></p>
<table>
<thead>
<tr>
<th>属性值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><font color="red">REQUIRED</font></td>
<td><font color="red">【默认值】需要事务，有则加入，无则创建新事务</font></td>
</tr>
<tr>
<td><font color="red">REQUIRES_NEW</font></td>
<td><font color="red">需要新事务，无论有无，总是创建新事务</font></td>
</tr>
<tr>
<td>SUPPORTS</td>
<td>支持事务，有则加入，无则在无事务状态中运行</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>不支持事务，在无事务状态下运行，如果当前存在已有事务，则挂起当前事务</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>必须有事务，否则抛异常</td>
</tr>
<tr>
<td>NEVER</td>
<td>必须没事务，否则抛异常</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
</li>
</ul>
<p>案例：解散部门时，记录操作日志</p>
<p>需求：解散部门时，无论是成功还是失败，都要记录操作日志。</p>
<p>步骤：</p>
<ol>
<li>解散部门：删除部门、删除部门下的员工</li>
<li>记录日志到数据库表中</li>
</ol>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214132730521.png" alt="image-20240214132730521"></p>
<ul>
<li>REQUIRED：大部分情况下都是用该传播行为即可。</li>
<li>REQUIRES_NEW：当我们不希望事务之间相互影响时，可以使用该传播行为。例如：下订单前需要记录日志，不论订单保存成功与否，都需要保证日志记录能够记录成功。</li>
</ul>
<h1 id="AOP基础"><a href="#AOP基础" class="headerlink" title="AOP基础"></a>AOP基础</h1><h2 id="AOP概述"><a href="#AOP概述" class="headerlink" title="AOP概述"></a>AOP概述</h2><ul>
<li><p>AOP：Aspect Oriented Programming（面向切面编程、面向方面编程），其实就是面向特定方法编程。</p>
</li>
<li><p>场景</p>
<ul>
<li><p>案例部分功能运行较慢，定位执行耗时较长的业务方法，此时需要统计每个业务方法的执行耗时</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214135211983.png" alt="image-20240214135211983"></p>
</li>
<li><p>实现：</p>
<ul>
<li>动态代理是面向切面编程最主流的实现。而SpringAOP是Spring框架的高级技术，旨在管理bean对象的过程中，主要通过底层的动态代理机制，对特定的方法进行编程。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="AOP快速入门"><a href="#AOP快速入门" class="headerlink" title="AOP快速入门"></a>AOP快速入门</h2><p>案例：Spring AOP快速入门：统计各个业务层方法执行耗时</p>
<ul>
<li><p>导入依赖：在pom.xml中导入AOP的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写AOP程序：针对于特定方法根据业务需要进行编程</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//当前类是AOP类</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.example.service.*.*(..))&quot;)</span>  <span class="comment">//运行service包下所有类或接口的所有方法，切入点表达式</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordTime</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//1. 记录开始时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用原始方法运行</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 记录结束时间，计算方法执行耗时</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        log.info(joinPoint.getSignature() + <span class="string">&quot;方法执行耗时：&#123;&#125;ms&quot;</span>,end-begin);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214144033685.png" alt="image-20240214144033685"></p>
<h2 id="AOP核心概念"><a href="#AOP核心概念" class="headerlink" title="AOP核心概念"></a>AOP核心概念</h2><ul>
<li><p>连接点：JoinPoint，可以被AOP控制的方法（暗含方法执行时的相关信息）</p>
</li>
<li><p>通知：Advice，指那些重复的逻辑，也就是共性功能（最终体现为一个方法）</p>
</li>
<li><p>切入点：PointCut，匹配连接点的条件，通知仅会在切入点方法执行时被应用</p>
</li>
<li><p>切面：Aspect，描述通知与切入点的对应关系（通知+切入点）</p>
</li>
<li><p>目标对象：Target，通知所应用的对象</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214144744583.png" alt="image-20240214144744583"></p>
</li>
<li><p>AOP执行流程</p>
<p>程序运行时，会自动为目标对象生成对应的代理对象，在代理对象中，就会对目标对象中的原始方法进行功能增强。增强逻辑取决于Aspect定义的增强功能。AOP本质还是基于动态代理。如下所示：</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214145040852.png" alt="image-20240214145040852"></p>
</li>
</ul>
<h1 id="AOP进阶"><a href="#AOP进阶" class="headerlink" title="AOP进阶"></a>AOP进阶</h1><h2 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h2><ol>
<li>@Around：环绕通知，此注解标注的通知方法在目标方法前、后都被执行</li>
<li>@Before：前置通知，此注解标注的通知方法在目标方法前被执行</li>
<li>@After：后置通知，此注解标注的通知方法在目标方法后被执行，无论是否有异常都会执行</li>
<li>@AfterReturning：返回后通知，此注解标注的通知方法在目标方法后被执行，有异常不会执行</li>
<li>@AfterThrowing：异常后通知，此注解标注的通知方法发生异常后执行</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.example.service.impl.DeptServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;before ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.example.service.impl.DeptServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        log.info(<span class="string">&quot;around before ...&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line">        log.info(<span class="string">&quot;around after ...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.example.service.impl.DeptServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;after ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;execution(* com.example.service.impl.DeptServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterReturning ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* com.example.service.impl.DeptServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;afterThrowing ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行顺序如下所示：</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214151512139.png" alt="image-20240214151512139"></p>
<p>注意事项：</p>
<ul>
<li>@Around环绕通知需要自己调用proceedingJoinPoint.proceed()来让原始方法执行，其他通知不需要考虑目标方法执行</li>
<li>@Around环绕通知方法的返回值，必须指定为Object，来接收原始方法的返回值。</li>
</ul>
<p>@PointCut</p>
<ul>
<li><p>该注解的作用时将公共的切点表达式抽取出来，需要用到时引用该切点表达式即可。</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214152457184.png" alt="image-20240214152457184"></p>
</li>
</ul>
<p><strong>小结</strong></p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214152524439.png" alt="image-20240214152524439"></p>
<h2 id="通知顺序"><a href="#通知顺序" class="headerlink" title="通知顺序"></a>通知顺序</h2><p>当有多个切面的切入点都匹配到了目标方法，目标方法运行时，多个通知方法都会被执行。</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214152933743.png" alt="image-20240214152933743"></p>
<p>执行顺序</p>
<ol>
<li><p>不同切面类中，默认按照切面类的类名字母排序</p>
<ul>
<li>目标方法前的通知方法：字母排名靠前的先执行</li>
<li>目标方法后的通知方法：字母排名靠前的后执行</li>
</ul>
</li>
<li><p>用@Order(数字)加载切面类上来控制顺序</p>
<ul>
<li>目标方法前的通知方法：数字小的先执行</li>
<li>目标方法后的通知方法：数字小的后执行</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214153232022.png" alt="image-20240214153232022"></p>
</li>
</ol>
<h2 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h2><ul>
<li>切入点表达式：描述切入点方法的一种表达式</li>
<li>作用：主要用来决定项目中的哪些方法需要加入通知</li>
<li>常见形式：<ul>
<li>execution(…)：根据方法的签名来匹配</li>
<li>@annotation(…)：根据注解匹配</li>
</ul>
</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214153640323.png" alt="image-20240214153640323"></p>
<h3 id="切入点表达式-execution"><a href="#切入点表达式-execution" class="headerlink" title="切入点表达式 - execution"></a>切入点表达式 - execution</h3><p>execution主要根据方法的返回值、包名、类名、方法名、方法参数等信息来匹配，语法为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">execution(访问修饰符? 返回值 包名.类名.?方法名(方法参数) <span class="keyword">throws</span> 异常?)</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214153831045.png" alt="image-20240214153831045"></p>
<ul>
<li><p>其中带？的表示可以省略的部分</p>
<ul>
<li>访问修饰符：可省略（比如：public、protected）</li>
<li>包名.类名：可省略</li>
<li>throws 异常：可省略（注意是方法上声明抛出的异常，不是实际抛出的异常）</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214153959965.png" alt="image-20240214153959965"></p>
</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214155556329.png" alt="image-20240214155556329"></p>
<ul>
<li><p>可以使用通配符描述切入店</p>
<ul>
<li><p>*：单个独立的任意符号，可以通配任意返回值、包名、类名、方法名、任意类型的一个参数，也可以通配包、类、方法名的一部分</p>
<p>如下所示：匹配任意返回类型，任意二级包名，任意类&#x2F;接口，update后续任意部分的任意单个参数</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214155710577.png" alt="image-20240214155710577"></p>
</li>
<li><p>.. : 多个连续的任意符号，可以通配任意层级的包，或任意类型、任意个数的参数</p>
<p>如下所示：匹配任意返回类型，任意层级的包，任意方法名，任意数量的参数</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214155744813.png" alt="image-20240214155744813"></p>
</li>
</ul>
</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214160336308.png" alt="image-20240214160336308"></p>
<p>匹配：com包下任意一级子包的service包的impl包的以ServiceImpl结尾的类的以delete开头且含有一个参数的方法。</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214161042187.png" alt="image-20240214161042187"></p>
<p><font color="red">匹配多个不同名不同参数的方法。</font></p>
<p>书写规范</p>
<ul>
<li>所有业务方法名在命名时应该尽量规范蛮方便切入点表达式快速匹配。如：查询类方法都是find开头，更新类方法都以update开头。</li>
<li>描述切入点方法时通常基于接口描述，而不是直接描述实现类，增强拓展性。</li>
<li>在满足业务需要的前提下，尽量缩小切入点的匹配范围。如：包名匹配尽量不要使用..,使用*匹配单个包。</li>
</ul>
<h3 id="切入点表达式-anotation"><a href="#切入点表达式-anotation" class="headerlink" title="切入点表达式 - @anotation"></a>切入点表达式 - @anotation</h3><ul>
<li><p>@annotation切入点表达式，用于匹配标识有特定注解的方法</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214164136474.png" alt="image-20240214164136474"></p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214164149820.png" alt="image-20240214164149820"></p>
</li>
</ul>
<h2 id="连接点"><a href="#连接点" class="headerlink" title="连接点"></a>连接点</h2><ul>
<li><p>在Spring中用JoinPoint抽象了连接点，用它可以获得方法执行时的相关信息，如目标类名，方法名，方法参数等。</p>
<ul>
<li>对于@Around 通知，获取连接点信息只能使用ProceedingJoinPoint</li>
<li>对于其他四种通知，获取连接点信息只能使用JointPoint，它是ProceedingJoinPoint的父类型</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214170831453.png" alt="image-20240214170831453"></p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214170900363.png" alt="image-20240214170900363"></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//@Order(3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect7</span> &#123; </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.service.DeptService.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect8 ... before ...&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        log.info(<span class="string">&quot;MyAspect8 around before ...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 获取目标对象的类名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> proceedingJoinPoint.getTarget().getClass().getName();</span><br><span class="line">        log.info(<span class="string">&quot;目标对象的类名：&#123;&#125;&quot;</span>,className);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取目标方法的方法名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> proceedingJoinPoint.getSignature().getName();</span><br><span class="line">        log.info(<span class="string">&quot;目标方法的方法名:&#123;&#125;&quot;</span>,methodName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 获取目标方法运行时传入的参数</span></span><br><span class="line">        Object[] args = proceedingJoinPoint.getArgs();</span><br><span class="line">        log.info(<span class="string">&quot;目标方法运行时传入的参数：&#123;&#125;&quot;</span>, Arrays.toString(args));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 获取目标方法执行</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 获取目标方法运行的返回值</span></span><br><span class="line">        log.info(<span class="string">&quot;目标方法运行的返回值：&#123;&#125;&quot;</span>,result);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="AOP案例"><a href="#AOP案例" class="headerlink" title="AOP案例"></a>AOP案例</h1><p>案例：将案例中增删改查相关接口的操作日志记录到数据库表中</p>
<p>操作日志</p>
<p>日志信息包含：操作人、操作时间、执行方法的全类名、执行方法名、方法运行时参数、返回值、方法执行时长</p>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214172708047.png" alt="image-20240214172708047"></p>
<p>思路分析</p>
<ul>
<li>需要对所有业务类中的增删改查方法添加统一功能，使用AOP技术最为方便。</li>
</ul>
<p><img src="/2024/02/14/javaweb-day07-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86-AOP/image-20240214173033257.png" alt="image-20240214173033257"></p>
<p>步骤</p>
<ul>
<li><p>准备：</p>
<ul>
<li><p>在案例工程中引入AOP的起步依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入资料中准备好的数据库表结构，并引入对应的实体类</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> operate_log</span><br><span class="line">(</span><br><span class="line">    id            <span class="type">int</span> unsigned auto_increment comment <span class="string">&#x27;ID&#x27;</span></span><br><span class="line">        <span class="keyword">primary</span> key,</span><br><span class="line">    operate_user  <span class="type">int</span> unsigned  <span class="keyword">null</span> comment <span class="string">&#x27;操作人ID&#x27;</span>,</span><br><span class="line">    operate_time  datetime      <span class="keyword">null</span> comment <span class="string">&#x27;操作时间&#x27;</span>,</span><br><span class="line">    class_name    <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;操作的类名&#x27;</span>,</span><br><span class="line">    method_name   <span class="type">varchar</span>(<span class="number">100</span>)  <span class="keyword">null</span> comment <span class="string">&#x27;操作的方法名&#x27;</span>,</span><br><span class="line">    method_params <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">null</span> comment <span class="string">&#x27;方法参数&#x27;</span>,</span><br><span class="line">    return_value  <span class="type">varchar</span>(<span class="number">2000</span>) <span class="keyword">null</span> comment <span class="string">&#x27;返回值&#x27;</span>,</span><br><span class="line">    cost_time     <span class="type">bigint</span>        <span class="keyword">null</span> comment <span class="string">&#x27;方法执行耗时, 单位:ms&#x27;</span></span><br><span class="line">)</span><br><span class="line">    comment <span class="string">&#x27;操作日志表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OperateLog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id; <span class="comment">//ID</span></span><br><span class="line">    <span class="keyword">private</span> Integer operateUser; <span class="comment">//操作人ID</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime operateTime; <span class="comment">//操作时间</span></span><br><span class="line">    <span class="keyword">private</span> String className; <span class="comment">//操作类名</span></span><br><span class="line">    <span class="keyword">private</span> String methodName; <span class="comment">//操作方法名</span></span><br><span class="line">    <span class="keyword">private</span> String methodParams; <span class="comment">//操作方法参数</span></span><br><span class="line">    <span class="keyword">private</span> String returnValue; <span class="comment">//操作方法返回值</span></span><br><span class="line">    <span class="keyword">private</span> Long costTime; <span class="comment">//操作耗时</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>编码：</p>
<ul>
<li><p>自定义注解@Log</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.anno;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Log &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义切面类，完成记录操作日志的逻辑</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.example.mapper.OperateLogMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.OperateLog;</span><br><span class="line"><span class="keyword">import</span> com.example.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OperateLogMapper operateLogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest httpServletRequest;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(com.example.anno.Log)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordLog</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作人员ID - 当前登录员工ID</span></span><br><span class="line">        <span class="comment">//获取请求头中的JWT令牌，解析令牌</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> httpServletRequest.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtils.parseJWT(jwt);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">operatorUser</span> <span class="operator">=</span> (Integer) claims.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作时间</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">operateTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作类名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> proceedingJoinPoint.getTarget().getClass().getName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作方法名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> proceedingJoinPoint.getSignature().getName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作方法参数</span></span><br><span class="line">        Object[] args = proceedingJoinPoint.getArgs();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodParams</span> <span class="operator">=</span> Arrays.toString(args);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作耗时</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用原始目标方法运行</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//操作方法返回值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">returnValue</span> <span class="operator">=</span> JSONObject.toJSONString(result);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">costTime</span> <span class="operator">=</span> end - begin;</span><br><span class="line"></span><br><span class="line">        <span class="type">OperateLog</span> <span class="variable">operateLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OperateLog</span>(<span class="literal">null</span>, operatorUser, operateTime, className, methodName, methodParams, returnValue, costTime);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//记录操作日志</span></span><br><span class="line">        operateLogMapper.insert(operateLog);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;AOP记录操作日志：&#123;&#125;&quot;</span>, operateLog);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>定义operateLogMapper接口，创建对应的插入操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.DeptLog;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptLogMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Insert(&quot;insert into dept_log(create_time,description) values(#&#123;createTime&#125;,#&#123;description&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(DeptLog deptLog)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>获取当前登录用户</p>
<ul>
<li>获取request对象，从请求头中获取到jwt令牌，解析令牌获取出当前用户的id。</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>javeweb-day06-登录认证</title>
    <url>/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<h1 id="基础登录功能"><a href="#基础登录功能" class="headerlink" title="基础登录功能"></a>基础登录功能</h1><p>判断用户输入的用户名和密码是否正确</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213121002402.png" alt="image-20240213121002402"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213121908243.png" alt="image-20240213121908243"></p>
<h1 id="登录校验（重点）"><a href="#登录校验（重点）" class="headerlink" title="登录校验（重点）"></a>登录校验（重点）</h1><p><strong>联调测试</strong></p>
<p><strong>问题</strong></p>
<ul>
<li>在未登录的情况下，我们也可以直接访问部门管理、员工管理等功能。</li>
</ul>
<p><strong>理想实现操作</strong></p>
<ul>
<li>在服务器接收到浏览器发送过来的请求之后，要先校验用户是否登录，如果用户已经登录了，直接执行业务操作即可。</li>
<li>如果用户并没有登录，此时不允许执行相关操作，直接给前端响应一个错误的结果，最终跳转到登录页面，要求登录成功之后再来访问相应的数据。</li>
</ul>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213122931243.png" alt="image-20240213122931243"></p>
<p>HTTP请求是无状态的，即上一次业务操作与下一次业务操作是相互分隔的。所以服务器无法判断用户是否登录。</p>
<p>解决办法：在服务器端存储登录标记，一旦员工登录成功，就存储相应的登录标记。根据用户是否登录执行不同的操作。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213123143360.png" alt="image-20240213123143360"></p>
<p>每次操作都要判断用户是否登录，会导致后端的代码量上升，因此，我们产生了统一拦截的技术。通过统一拦截，我们可以拦截浏览器发送的所有请求，拦截到之后，就可以对请求进行校验，校验员工是否登录。如果拦截到请求后，没有获取到对应的登录标记，或者登录标记是有问题的，则直接给前端响应错误信息，前端会自动跳转到登录页面。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213123345266.png" alt="image-20240213123345266"></p>
<p><strong>登陆标记</strong></p>
<ul>
<li>用户登录成功之后，每一次请求后，都可以获取到该标记。（会话技术）</li>
</ul>
<p><strong>统一拦截</strong></p>
<ul>
<li>过滤器Filter（servlet技术）</li>
<li>拦截器Interceptor（spring技术）</li>
</ul>
<h2 id="会话技术"><a href="#会话技术" class="headerlink" title="会话技术"></a>会话技术</h2><ul>
<li><p>会话：用户打开浏览器，访问web浏览器的资源，会话建立，直到有任何一方断开连接，会话结束。在一次会话中可以包含多次请求和响应。</p>
</li>
<li><p>会话跟踪：一种维护浏览器状态的方法，服务器需要识别多次请求是否来自于同一浏览器，以便在同一次会话的多次请求间共享数据。</p>
</li>
<li><p>会话跟踪方案：</p>
<ul>
<li>客户端会话跟踪技术：Cookie（浏览器）</li>
<li>服务端会话跟踪技术：Session（服务器）</li>
<li>令牌技术</li>
</ul>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213123837098.png" alt="image-20240213123837098"></p>
</li>
</ul>
<p><strong>会话跟踪方案对比</strong></p>
<p> 服务器通过响应头直接设置Set-cookie:name&#x3D;value，响应头返回给浏览器，浏览器会自动解析这个响应头，然后拿到响应头对应的cookie，将其存储在浏览器本地，在后续的每一次请求，浏览器都会将存储的cookie值通过请求头携带到服务端，在Tomcat中，提供了cookie操作的api，可以很方便的设置。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213130050761.png" alt="image-20240213130050761"></p>
<p><strong>SessionController类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置Cookie（服务器给浏览器设置响应数据）</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/c1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">cookie1</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">        response.addCookie(<span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;login_username&quot;</span>,<span class="string">&quot;itheima&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/c2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">cookie2</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName().equals(<span class="string">&quot;login_username&quot;</span>))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;login_username:&quot;</span> + cookie.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：HTTP协议中支持的技术</p>
<p>缺点：</p>
<ul>
<li>移动端APP无法使用Cookie</li>
<li>不安全，用户可以自己禁用Cookie</li>
<li>Cookie不能跨域</li>
</ul>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213131523089.png" alt="image-20240213131523089"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213131651459.png" alt="image-20240213131651459"></p>
<p>优点：存储在服务端，安全</p>
<p>缺点：</p>
<ul>
<li><p>现在开发的服务器一般都部署在集群上，同一个项目部署多份，用户访问负载均衡的服务器，它负责将请求均匀的发送给后端的服务器。如果使用session，出现单点故障就寄了。</p>
</li>
<li><p>Cookie当中的缺点。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213132732677.png" alt="image-20240213132732677"></p>
</li>
</ul>
<p><strong>SessionController类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.Cookie;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/s1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">session1</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;HttpSession-s1:&#123;&#125;&quot;</span>,session.hashCode());</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;loginUser&quot;</span>,<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/s2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">session2</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        log.info(<span class="string">&quot;HttpSession-s2:&#123;&#125;&quot;</span>,session.hashCode());</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">loginUser</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;loginUser&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;logUser:&#123;&#125;&quot;</span>,loginUser);</span><br><span class="line">        <span class="keyword">return</span> Result.success(loginUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="JWT令牌（主流）"><a href="#JWT令牌（主流）" class="headerlink" title="JWT令牌（主流）"></a>JWT令牌（主流）</h2><p>令牌就是用户身份的标识，本质就是一个字符串，通过令牌技术跟踪会话，浏览器发送请求，在请求登录接口的时候，如果登录成功，就生成一个令牌，令牌就是用户的合法身份凭证，在响应数据的时候，就可以把这个令牌响应给前端，接下来前端程序接收到这个令牌之后，就需要将这个令牌存储起来，令牌可以存储在cookie或者其他存储空间，后续的每一次请求，都需要将令牌携带到服务端，服务端需要校验令牌有效性，如果令牌有效，则说明用户已经执行了登录操作，如果令牌是无效的，则用户之前并未执行登录操作。</p>
<p>如果想要在多次会话之间共享数据，可以将数据存储在令牌当中。</p>
<p>优点：</p>
<ul>
<li>支持PC，移动端</li>
<li>解决集群环境下的认证问题</li>
<li>减轻服务器端存储压力</li>
</ul>
<p>缺点：需要自己编程实现</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213133400789.png" alt="image-20240213133400789"></p>
<ul>
<li><p>全称：JSON Web Token（<a href="https://jwt.io/%EF%BC%89">https://jwt.io/）</a></p>
</li>
<li><p>定义了一种简洁的、自包含的格式，用于在通信双方以json数据格式安全的传输信息。由于数字签名的存在，这些信息是可靠的。</p>
</li>
<li><p>组成：</p>
<ul>
<li><p>第一部分：Header（头）：记录令牌类型、签名算法等。例如：{“alg”:”HS256”,”type”:”JWT”}</p>
<p>在生成JWT的时候，要先进行Base64编码（是一种基于64个可打印字符（A-Z a-Z 0-9 + &#x2F;）来表示二进制数据的编码方式。</p>
</li>
<li><p>第二部分：Payload（有效载荷），携带了一些自定义信息、默认信息等。例如:{“id”:”1”,”username”:”Tom”}，也进行了Base64编码。</p>
</li>
<li><p>第三部分：Signature（签名），防止Token被篡改、确保安全性。将header，payload，并加入指定密钥，通过指定签名算法计算而来。</p>
</li>
</ul>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213134135704.png" alt="image-20240213134135704"></p>
</li>
<li><p>场景：登录认证。</p>
<ul>
<li><p>登录成功后，生成令牌。</p>
</li>
<li><p>后续每个请求，都要携带JWT令牌，系统在每次请求处理之前，先校验令牌，通过后，再处理</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213134329360.png" alt="image-20240213134329360"></p>
</li>
</ul>
</li>
</ul>
<p><strong>JWT-生成</strong></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213134519464.png" alt="image-20240213134519464"></p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>test单元测试（生成JWT令牌）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenJwt</span><span class="params">()</span>&#123;</span><br><span class="line">    Map&lt;String,Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    claims.put(<span class="string">&quot;id&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    claims.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;tom&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">        .signWith(SignatureAlgorithm.HS256, <span class="string">&quot;itheima&quot;</span>) <span class="comment">//签名算法，其中itheima是密钥，用于第三部分加密</span></span><br><span class="line">        .setClaims(claims)  <span class="comment">//自定义内容（载荷）</span></span><br><span class="line">        .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis()) <span class="comment">// 设置JWT令牌的有效期为1h</span></span><br><span class="line">        .compact();</span><br><span class="line"></span><br><span class="line">    System.out.println(jwt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（解析JWT令牌）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParseJwt</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parser().setSigningKey(<span class="string">&quot;itheima&quot;</span>).parseClaimsJws(<span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoidG9tIiwiaWQiOjEsImV4cCI6MTcwNzgwNDA5Mn0.KCv1P2sm4hAMjEfW1OSDhk9iitL-oBlCvotb2OLWavo&quot;</span>).getBody();</span><br><span class="line"></span><br><span class="line">	System.out.println(claims);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思路</p>
<ul>
<li>令牌生成：登录成功后，生成JWT令牌，并返回给前端。</li>
<li>令牌校验：在请求到达服务端后，对令牌进行统一拦截，校验。</li>
</ul>
<p><strong>登录-生成令牌</strong></p>
<p>步骤</p>
<ul>
<li>引入JWT令牌操作工具类。</li>
<li>登录完成后，调用工具类生成JWT令牌，并返回。</li>
</ul>
<p><strong>JwtUtils.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">signKey</span> <span class="operator">=</span> <span class="string">&quot;itheima&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Long</span> <span class="variable">expire</span> <span class="operator">=</span> <span class="number">43200000L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成JWT令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> claims JWT第二部分负载 payload 中存储的内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateJwt</span><span class="params">(Map&lt;String, Object&gt; claims)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.builder()</span><br><span class="line">                .addClaims(claims)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, signKey)</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + expire))</span><br><span class="line">                .compact();</span><br><span class="line">        <span class="keyword">return</span> jwt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析JWT令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jwt JWT令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JWT第二部分负载 payload 中存储的内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title function_">parseJWT</span><span class="params">(String jwt)</span>&#123;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parser()</span><br><span class="line">                .setSigningKey(signKey)</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213142444360.png" alt="image-20240213142444360"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213142542418.png" alt="image-20240213142542418"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213142641695.png" alt="image-20240213142641695"></p>
<h2 id="过滤器Filter"><a href="#过滤器Filter" class="headerlink" title="过滤器Filter"></a>过滤器Filter</h2><ul>
<li><p>概念：Filter过滤器，是JavaWeb三大组件（Servlet、Filter、Linstener）之一。</p>
</li>
<li><p>过滤器可以把对资源的请求拦截下来，从而实现一些比较特殊的功能。</p>
</li>
<li><p>过滤器一般完成一些通用的操作，比如：登录校验、统一编码处理、敏感字符处理等。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213143033277.png" alt="image-20240213143033277"></p>
</li>
</ul>
<h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><ol>
<li><p>定义Filter：定义一个类，实现Filter接口，并重写其所有方法。</p>
</li>
<li><p>配置Filter：Filter类上加@WebFilter注解，配置拦截资源的路径。引导类上加@ServletComponentScan开启Servlet组件支持。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213143454407.png" alt="image-20240213143454407"></p>
</li>
</ol>
<h3 id="详解-执行流程、拦截路径、过滤器链"><a href="#详解-执行流程、拦截路径、过滤器链" class="headerlink" title="详解(执行流程、拦截路径、过滤器链)"></a>详解(执行流程、拦截路径、过滤器链)</h3><p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213153026983.png" alt="image-20240213153026983"></p>
<p>先执行放行前逻辑——放行——执行服务器代码——执行放行后逻辑。</p>
<p>疑问</p>
<ul>
<li>放行后会访问对应资源，资源访问完成后，还会回到Filter中吗？会</li>
<li>如果回到Filter中，是重新执行还是执行放行之后的逻辑呢？执行放行后逻辑</li>
</ul>
<p><strong>Filter拦截路径</strong></p>
<ul>
<li><p>Filter可以根据需求，配置不同的拦截资源路径</p>
<table>
<thead>
<tr>
<th>拦截路径</th>
<th>urlPatterns值</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>拦截具体路径</td>
<td>&#x2F;login</td>
<td>只有访问&#x2F;login路径时，才会被拦截</td>
</tr>
<tr>
<td>目录拦截</td>
<td>&#x2F;emps&#x2F;*</td>
<td>访问&#x2F;emps下的所有资源，都会被拦截</td>
</tr>
<tr>
<td>拦截所有</td>
<td>&#x2F;*</td>
<td>访问所有资源，都会被拦截</td>
</tr>
</tbody></table>
</li>
</ul>
<p><strong>过滤器链</strong></p>
<ul>
<li><p>介绍：一个web应用中，可以配置多个过滤器，这多个过滤器就形成了一个过滤器链。</p>
</li>
<li><p>顺序：注解配置的filter，优先级默认是按照过滤器类名（字符串）的自然排序。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213154743954.png" alt="image-20240213154743954"></p>
</li>
</ul>
<p><strong>小结</strong></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213154815641.png" alt="image-20240213154815641"></p>
<h3 id="登录校验-Filter"><a href="#登录校验-Filter" class="headerlink" title="登录校验-Filter"></a>登录校验-Filter</h3><p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213154957750.png" alt="image-20240213154957750"></p>
<p>思考</p>
<ul>
<li>所有的请求，拦截到了之后，都需要校验令牌吗？有一个例外，登录请求</li>
<li>拦截到请求后，什么情况下才可以放行，执行业务操作？有令牌，且令牌校验通过（合法）；否则都返回未登录错误结果</li>
</ul>
<p>步骤</p>
<ul>
<li>获取请求url。</li>
<li>判断请求url中是否包含login，如果包含，说明是登录操作，放行。</li>
<li>获取请求头中的令牌（token）。</li>
<li>判断令牌是否存在，如果不存在，返回错误结果（未登录）。</li>
<li>解析token，如果解析失败，返回错误结果（未登录）。</li>
<li>放行。</li>
</ul>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213155513342.png" alt="image-20240213155513342"></p>
<p><strong>LoginCheckFilter类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.util.StringUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> netscape.javascript.JSObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns =  &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="comment">//1. 获取请求url。</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">resp</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 判断请求url中是否包含login，如果包含，说明是登录操作，放行。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURI().toString();</span><br><span class="line">        log.info(<span class="string">&quot;请求的url：&#123;&#125;&quot;</span>,url);</span><br><span class="line">        <span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;登录操作，放行....&quot;</span>);</span><br><span class="line">            filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 获取请求头中的令牌（token）。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> req.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 判断令牌是否存在，如果不存在，返回错误结果（未登录）。</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;请求头token为空，返回未登录的信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="comment">//手动转换 对象 --阿里巴巴fastjson</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notlogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            resp.getWriter().write(notlogin);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 解析token，如果解析失败，返回错误结果（未登录）。</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JwtUtils.parseJWT(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; <span class="comment">//jwt解析失败</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            log.info(<span class="string">&quot;解析令牌失败。返回未登录错误信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">notlogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            resp.getWriter().write(notlogin);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. 放行。</span></span><br><span class="line">        log.info(<span class="string">&quot;令牌合法，放行&quot;</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="拦截器Interceptor"><a href="#拦截器Interceptor" class="headerlink" title="拦截器Interceptor"></a>拦截器Interceptor</h2><h3 id="简介-快速入门"><a href="#简介-快速入门" class="headerlink" title="简介 &amp; 快速入门"></a>简介 &amp; 快速入门</h3><ul>
<li>概念：是一种动态拦截方法调用的机制，类似于过滤器。Spring框架中提供的，用来动态拦截控制器方法的执行。</li>
<li>作用：拦截请求，在请求的方法调用前后，根据业务需要执行预先设定的代码。</li>
</ul>
<ol>
<li><p>定义拦截器，实现HandlerInterceptor接口，并重写其中所有方法。</p>
</li>
<li><p>注册拦截器。</p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213194352886.png" alt="image-20240213194352886"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213194419268.png" alt="image-20240213194419268"></p>
<p><strong>LoginCheckInterceptor.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//目标资源方法运行前运行，返回true；放行，返回false，不放行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//目标资源方法运行后运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 视图渲染完毕后运行，最后运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion...&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>WebConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.interceptor.LoginCheckInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginCheckInterceptor loginCheckInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(loginCheckInterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>拦截器可以根据需求，配置不同的拦截路径：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.interceptor.LoginCheckInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoginCheckInterceptor loginCheckInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;       registry.addInterceptor(loginCheckInterceptor).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>拦截路径</th>
<th>含义</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;*</td>
<td>一级路径</td>
<td>能匹配&#x2F;depts,&#x2F;emps,&#x2F;login，不能匹配&#x2F;depts&#x2F;1</td>
</tr>
<tr>
<td>&#x2F;**</td>
<td>任意级路径</td>
<td>能匹配&#x2F;depts,&#x2F;depts&#x2F;1,&#x2F;depts&#x2F;1&#x2F;2</td>
</tr>
<tr>
<td>&#x2F;depts&#x2F;*</td>
<td>&#x2F;depts下的一级路径</td>
<td>能匹配&#x2F;depts&#x2F;1，不能匹配&#x2F;depts&#x2F;1&#x2F;2，&#x2F;depts</td>
</tr>
<tr>
<td>&#x2F;depts&#x2F;**</td>
<td>&#x2F;depts下的任意级路径</td>
<td>能匹配&#x2F;depts,&#x2F;depts&#x2F;1,depts&#x2F;1&#x2F;2;不能匹配&#x2F;emps</td>
</tr>
</tbody></table>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213202921519.png" alt="image-20240213202921519"></p>
</li>
</ul>
<p><strong>Filter与Interceptor</strong></p>
<ul>
<li>接口规范不同：过滤器需要实现Filter接口，而拦截器需要实现HandlerInterceptor接口。</li>
<li>拦截范围不同：过滤器Filter会拦截所有资源，而Interceptor只会拦截Spring环境中的资源。</li>
</ul>
<h3 id="登录校验-Interceptor"><a href="#登录校验-Interceptor" class="headerlink" title="登录校验 - Interceptor"></a>登录校验 - Interceptor</h3><p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213203640091.png" alt="image-20240213203640091"></p>
<p><strong>LoginCheckInterceptor类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.utils.JwtUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//目标资源方法运行前运行，返回true；放行，返回false，不放行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 获取请求url。</span></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">resp</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 判断请求url中是否包含login，如果包含，说明是登录操作，放行。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURI().toString();</span><br><span class="line">        log.info(<span class="string">&quot;请求的url：&#123;&#125;&quot;</span>,url);</span><br><span class="line">        <span class="keyword">if</span>(url.contains(<span class="string">&quot;login&quot;</span>))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;登录操作，放行....&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 获取请求头中的令牌（token）。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> req.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 判断令牌是否存在，如果不存在，返回错误结果（未登录）。</span></span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasLength(jwt))&#123;</span><br><span class="line">            log.info(<span class="string">&quot;请求头token为空，返回未登录的信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="comment">//手动转换 对象 --阿里巴巴fastjson</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notlogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            resp.getWriter().write(notlogin);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 解析token，如果解析失败，返回错误结果（未登录）。</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JwtUtils.parseJWT(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; <span class="comment">//jwt解析失败</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            log.info(<span class="string">&quot;解析令牌失败。返回未登录错误信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">notlogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            resp.getWriter().write(notlogin);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. 放行。</span></span><br><span class="line">        log.info(<span class="string">&quot;令牌合法，放行&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">//目标资源方法运行后运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 视图渲染完毕后运行，最后运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213205958788.png" alt="image-20240213205958788"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240213210058206.png" alt="image-20240213210058206"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240214120014045.png" alt="image-20240214120014045"></p>
<p><img src="/2024/02/12/javeweb-day06-%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/image-20240214120254171.png" alt="image-20240214120254171"></p>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>javaweb-day05-springboot案例</title>
    <url>/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/</url>
    <content><![CDATA[<h1 id="SpringBootWeb案例"><a href="#SpringBootWeb案例" class="headerlink" title="SpringBootWeb案例"></a>SpringBootWeb案例</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209151042104.png" alt="image-20240209151042104"></p>
<p>环境搭建</p>
<ul>
<li><p>准备数据库表（dept，emp）</p>
</li>
<li><p>创建springboot工程，引入对应的起步依赖（web、mybatis、mysql驱动、lombok）</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209152041678.png" alt="image-20240209152041678"></p>
</li>
<li><p>在application.properties中配置数据库信息，引入mybatis的配置信息，准备对应的实体类</p>
</li>
<li><p>准备三层架构的基础代码（controller、service（接口，实现类）、mapper（dao层））</p>
</li>
</ul>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209151547313.png" alt="image-20240209151547313"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209152929582.png" alt="image-20240209152929582"></p>
<p>数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 部门管理</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    create_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    update_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept (id, name, create_time, update_time) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;学工部&#x27;</span>,now(),now()),(<span class="number">2</span>,<span class="string">&#x27;教研部&#x27;</span>,now(),now()),(<span class="number">3</span>,<span class="string">&#x27;咨询部&#x27;</span>,now(),now()), (<span class="number">4</span>,<span class="string">&#x27;就业部&#x27;</span>,now(),now()),(<span class="number">5</span>,<span class="string">&#x27;人事部&#x27;</span>,now(),now());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工管理(带约束)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp (</span><br><span class="line">  id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">  username <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">  password <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">default</span> <span class="string">&#x27;123456&#x27;</span> comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  gender tinyint unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;性别, 说明: 1 男, 2 女&#x27;</span>,</span><br><span class="line">  image <span class="type">varchar</span>(<span class="number">300</span>) comment <span class="string">&#x27;图像&#x27;</span>,</span><br><span class="line">  job tinyint unsigned comment <span class="string">&#x27;职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师&#x27;</span>,</span><br><span class="line">  entrydate <span class="type">date</span> comment <span class="string">&#x27;入职时间&#x27;</span>,</span><br><span class="line">  dept_id <span class="type">int</span> unsigned comment <span class="string">&#x27;部门ID&#x27;</span>,</span><br><span class="line">  create_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  update_time datetime <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp</span><br><span class="line">	(id, username, password, name, gender, image, job, entrydate,dept_id, create_time, update_time) <span class="keyword">VALUES</span></span><br><span class="line">	(<span class="number">1</span>,<span class="string">&#x27;jinyong&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;金庸&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;2000-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">2</span>,<span class="string">&#x27;zhangwuji&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;张无忌&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2015-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">3</span>,<span class="string">&#x27;yangxiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;杨逍&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;3.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2008-05-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">4</span>,<span class="string">&#x27;weiyixiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;韦一笑&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;4.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2007-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">5</span>,<span class="string">&#x27;changyuchun&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;常遇春&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;5.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2012-12-05&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">6</span>,<span class="string">&#x27;xiaozhao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;小昭&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;6.jpg&#x27;</span>,<span class="number">3</span>,<span class="string">&#x27;2013-09-05&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">7</span>,<span class="string">&#x27;jixiaofu&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;纪晓芙&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;7.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2005-08-01&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">8</span>,<span class="string">&#x27;zhouzhiruo&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;周芷若&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;8.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2014-11-09&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">9</span>,<span class="string">&#x27;dingminjun&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;丁敏君&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;9.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2011-03-11&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">10</span>,<span class="string">&#x27;zhaomin&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;赵敏&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;10.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2013-09-05&#x27;</span>,<span class="number">1</span>,now(),now()),</span><br><span class="line">	(<span class="number">11</span>,<span class="string">&#x27;luzhangke&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;鹿杖客&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;11.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2007-02-01&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">	(<span class="number">12</span>,<span class="string">&#x27;hebiweng&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;鹤笔翁&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;12.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2008-08-18&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">	(<span class="number">13</span>,<span class="string">&#x27;fangdongbai&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;方东白&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;13.jpg&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2012-11-01&#x27;</span>,<span class="number">3</span>,now(),now()),</span><br><span class="line">	(<span class="number">14</span>,<span class="string">&#x27;zhangsanfeng&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;张三丰&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;14.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2002-08-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">15</span>,<span class="string">&#x27;yulianzhou&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;俞莲舟&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;15.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2011-05-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">16</span>,<span class="string">&#x27;songyuanqiao&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;宋远桥&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;16.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2007-01-01&#x27;</span>,<span class="number">2</span>,now(),now()),</span><br><span class="line">	(<span class="number">17</span>,<span class="string">&#x27;chenyouliang&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;陈友谅&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;17.jpg&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;2015-03-21&#x27;</span>,<span class="keyword">NULL</span>,now(),now());</span><br></pre></td></tr></table></figure>

<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/tlias</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置mybatis的日志，指定其输出到控制台</span></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 开启mybatis的驼峰命名自动映射开关</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>



<h2 id="开发规范"><a href="#开发规范" class="headerlink" title="开发规范"></a>开发规范</h2><p>案例基于当前最主流的前后端分离模式进行开发。</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209154811663.png" alt="image-20240209154811663"></p>
<ul>
<li><p>REST（REpresentational State Transfer），表述性状态转换，它是一种软件架构风格</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209155135828.png" alt="image-20240209155135828"></p>
<p>注意事项</p>
<ul>
<li>REST是风格，是约定方式，约定不是规定，可以打破。</li>
<li>描述模块的功能通常使用复数，也就是加s的格式来描述，表示此类资源，而非单个资源。如：users、emps、books…</li>
</ul>
</li>
<li><p>所有的增删改查接口都要返回统一的响应结果Result（code，msg，data）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;<span class="comment">//响应码，1 代表成功; 0 代表失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg;  <span class="comment">//响应信息 描述字符串</span></span><br><span class="line">    <span class="keyword">private</span> Object data; <span class="comment">//返回的数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//增删改 成功响应</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">1</span>,<span class="string">&quot;success&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询 成功响应</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">success</span><span class="params">(Object data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">1</span>,<span class="string">&quot;success&quot;</span>,data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//失败响应</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result <span class="title function_">error</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="number">0</span>,msg,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209155326662.png" alt="image-20240209155326662"></p>
</li>
</ul>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209155531746.png" alt="image-20240209155531746"></p>
<h1 id="部门管理"><a href="#部门管理" class="headerlink" title="部门管理"></a>部门管理</h1><h2 id="查询部门"><a href="#查询部门" class="headerlink" title="查询部门"></a>查询部门</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209160429415.png" alt="image-20240209160429415"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209160528223.png" alt="image-20240209160528223"></p>
<ol>
<li><p>编写DeptController类中代码</p>
<ol>
<li>@RestController，让DeptController返回restful形式的统一响应结果</li>
<li>@Slf4j，自动为注释的类创建log对象</li>
<li>@GetMapping，设置该请求仅回复get响应</li>
<li>设置deptService（<font color="red">service层接口对象</font>），方便控制反转</li>
<li>设置相应的返回方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// DeptController</span></span><br><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部门管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">//该注释会为相应类生成对应的log对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;</span><br><span class="line">    <span class="comment">//private static Logger log = LoggerFactory.getLogger(DeptController.class);</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"><span class="comment">//    @RequestMapping(value = &quot;/depts&quot;,method = RequestMethod.GET)  //RequestMapping映射页面请求和处理方法</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/depts&quot;)</span>  <span class="comment">//RequestMapping映射页面请求和处理方法</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;  <span class="comment">//Controller层查询结果，返回的是Result对象</span></span><br><span class="line">        log.info(<span class="string">&quot;查询全部部门数据&quot;</span>);</span><br><span class="line">        List&lt;Dept&gt; deptList =  deptService.list();</span><br><span class="line">        <span class="keyword">return</span> Result.success(deptList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写services代码查询数据</p>
<ol>
<li>设置service层接口及其实现类对象（实现类对象要加@Service，方便依赖注入）</li>
<li>设置deptMapper(<font color="red">dao层接口对象</font>)，方便控制反转</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//DeptService.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptService</span> &#123;</span><br><span class="line">    List&lt;Dept&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//DeptServiceImpl.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.DeptMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> com.example.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deptMapper.list();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写dao层代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from dept&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Dept&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h2><p><font color="red">前端接口通过nginx服务器与后端的tomcat服务器实现端口映射。</font></p>
<p>概念：将前端工程和后端工程都启动起来，然后访问前端工程，通过前端工程访问服务器程序，进而调试结果。</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209165501994-17074689029111.png" alt="image-20240209165501994"></p>
<h2 id="删除部门"><a href="#删除部门" class="headerlink" title="删除部门"></a>删除部门</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209170144724.png" alt="image-20240209170144724"></p>
<p>使用@PathVariable获取id参数值</p>
<p><strong>controller层</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部门管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">//该注释会为相应类生成对应的log对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;</span><br><span class="line">    <span class="comment">//private static Logger log = LoggerFactory.getLogger(DeptController.class);</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 删除部门</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@DeleteMapping(value = &quot;/depts/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;根据id删除指定部门:&#123;&#125;&quot;</span>,id);</span><br><span class="line">        deptService.delete(id);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptService</span> &#123;</span><br><span class="line">    List&lt;Dept&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Delete(&quot;delete from dept where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="新增部门"><a href="#新增部门" class="headerlink" title="新增部门"></a>新增部门</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209175909231.png" alt="image-20240209175909231"></p>
<p><strong>controller层</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部门管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">//该注释会为相应类生成对应的log对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;</span><br><span class="line">    <span class="comment">//private static Logger log = LoggerFactory.getLogger(DeptController.class);</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/depts&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> Dept dept)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;新增部门：&#123;&#125;&quot;</span>,dept);</span><br><span class="line"></span><br><span class="line">        deptService.add(dept);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.DeptMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> com.example.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Dept dept)</span> &#123;</span><br><span class="line">        dept.setCreateTime(LocalDateTime.now());</span><br><span class="line">        dept.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        deptMapper.insert(dept);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Insert(&quot;insert into dept(name,create_time, update_time) values(#&#123;name&#125;,#&#123;createTime&#125;,#&#123;updateTime&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Dept dept)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>使用@RequestMapping简化Controller类中方法的编写过程</strong></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209181608222.png" alt="image-20240209181608222"></p>
<ul>
<li>一个完整的请求路径，应该是类上的@RequestMapping的value属性+方法上的@RequestMapping的value属性。</li>
</ul>
<h2 id="修改部门"><a href="#修改部门" class="headerlink" title="修改部门"></a>修改部门</h2><p><strong>controller层</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 部门管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">//该注释会为相应类生成对应的log对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptController</span> &#123;</span><br><span class="line">    <span class="comment">//private static Logger log = LoggerFactory.getLogger(DeptController.class);</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptService deptService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/depts&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Dept dept)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;更新部门:&#123;&#125;&quot;</span>,dept);</span><br><span class="line"></span><br><span class="line">        deptService.update(dept);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>service层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.DeptMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> com.example.service.DeptService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeptServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DeptService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DeptMapper deptMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Dept dept)</span> &#123;</span><br><span class="line">        dept.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        dept.setCreateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        deptMapper.update(dept);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>mapper层代码</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Dept;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update dept set name = #&#123;name&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Dept dept)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="员工管理"><a href="#员工管理" class="headerlink" title="员工管理"></a>员工管理</h1><h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240209185704327.png" alt="image-20240209185704327"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240210002309264.png" alt="image-20240210002309264"></p>
<p><strong>定义实体类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// PageBean</span></span><br><span class="line"><span class="keyword">package</span> com.example.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageBean</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long total; <span class="comment">// 总记录数</span></span><br><span class="line">    <span class="keyword">private</span> List rows; <span class="comment">//数据列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>EmpController类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.PageBean;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Result;</span><br><span class="line"><span class="keyword">import</span> com.example.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工管理Controller</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpService empService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/emps&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">page</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer page, <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> Integer pageSize)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;分页查询，参数：&#123;&#125;,&#123;&#125;&quot;</span>,page,pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span>  empService.page(page,pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Result.success(pageBean);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>EmpService类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.EmpMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.PageBean;</span><br><span class="line"><span class="keyword">import</span> com.example.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageBean <span class="title function_">page</span><span class="params">(Integer page, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">num</span> <span class="operator">=</span> empMapper.count();</span><br><span class="line">        List&lt;Emp&gt; emp = empMapper.page((page - <span class="number">1</span>) * pageSize, pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageBean</span>(num, emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>EmpMapper类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select count(*) from emp&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">count</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from emp limit #&#123;start&#125;,#&#123;pageSize&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">page</span><span class="params">(Integer start, Integer pageSize)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240210003718951.png" alt="image-20240210003718951"></p>
<h2 id="分页插件PageHelper"><a href="#分页插件PageHelper" class="headerlink" title="分页插件PageHelper"></a>分页插件PageHelper</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240210005329151.png" alt="image-20240210005329151"></p>
<p>引入pageHelper依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- PageHelper分页插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240210005505728.png" alt="image-20240210005505728"></p>
<p><strong>EmpServiceImpl类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.EmpMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.PageBean;</span><br><span class="line"><span class="keyword">import</span> com.example.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.Page;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.PageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public PageBean page(Integer page, Integer pageSize) &#123;</span></span><br><span class="line"><span class="comment">//        Long num = empMapper.count();</span></span><br><span class="line"><span class="comment">//        List&lt;Emp&gt; emp = empMapper.page((page - 1) * pageSize, pageSize);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        return new PageBean(num, emp);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageBean <span class="title function_">page</span><span class="params">(Integer page, Integer pageSize)</span>&#123;</span><br><span class="line">        <span class="comment">// 1. 设置分页参数</span></span><br><span class="line">        PageHelper.startPage(page,pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 执行查询</span></span><br><span class="line">        List&lt;Emp&gt; empList = empMapper.list();</span><br><span class="line">        Page&lt;Emp&gt; p = (Page&lt;Emp&gt;) empList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 封装PageBean对象</span></span><br><span class="line">        <span class="type">PageBean</span> <span class="variable">pageBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageBean</span>(p.getTotal(),p.getResult());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>EmpMapper类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Select(&quot;select count(*) from emp&quot;)</span></span><br><span class="line"><span class="comment">//    public Long count();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    @Select(&quot;select * from emp limit #&#123;start&#125;,#&#123;pageSize&#125;&quot;)</span></span><br><span class="line"><span class="comment">//    public List&lt;Emp&gt; page(Integer start, Integer pageSize);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 员工信息查询</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from emp&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="red">注意，这里可能会出现版本适配问题，即springboot和对应的PageHelper插件版本不同，导致最终程序无法正确运行。</font></p>
<p><strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">		 <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tlias-web-management<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>tlias-web-management<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--web起步依赖--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--mybatis起步依赖--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--springboot单元测试--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--PageHelper分页插件--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="分页条件查询"><a href="#分页条件查询" class="headerlink" title="分页条件查询"></a>分页条件查询</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212122859658.png" alt="image-20240212122859658"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212124618865.png" alt="image-20240212124618865"></p>
<h2 id="删除员工"><a href="#删除员工" class="headerlink" title="删除员工"></a>删除员工</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212132059565.png" alt="image-20240212132059565"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212132905480.png" alt="image-20240212132905480"></p>
<h2 id="新增员工"><a href="#新增员工" class="headerlink" title="新增员工"></a>新增员工</h2><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212145401473.png" alt="image-20240212145401473"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212145955119.png" alt="image-20240212145955119"></p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul>
<li>文件上传，是指将本地图片、视频、音频等文件上传到服务器，供其他用户浏览或下载的过程。</li>
<li>文件上传在项目中应用非常广泛，我们经常发微博、发微信朋友圈都用到了文件上传功能。</li>
</ul>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212152007551.png" alt="image-20240212152007551"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212153024176.png" alt="image-20240212153024176"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212153040779.png" alt="image-20240212153040779"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212155104185.png" alt="image-20240212155104185"></p>
<h3 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h3><p>在服务器端，接收到上传上来的文件之后，将文件存储在本地服务器磁盘中。</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212160650537.png" alt="image-20240212160650537"></p>
<p>在Springboot中，文件上传，默认单个文件允许最大大小为1M。如果需要上传大文件，可以在application.properties中进行如下配置：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置单个文件最大上传大小</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.max-file-size</span>=<span class="string">10MB</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置单个请求最大上传大小（一次请求可以上传多个文件）</span></span><br><span class="line"><span class="attr">spring.servlet.multipart.max-request-size</span>=<span class="string">100MB</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212163506732.png" alt="image-20240212163506732"></p>
<p>multipartfile的常用功能</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212163755305.png" alt="image-20240212163755305"></p>
<h3 id="阿里云OSS"><a href="#阿里云OSS" class="headerlink" title="阿里云OSS"></a>阿里云OSS</h3><p>阿里云对象存储OSS（Object Storage Service），是一款海量、安全、低成本、高可靠的云存储服务。使用OSS，您可以通过网络随时存储和调用包括文本、图片、音频和视频在内的各种文件。</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212164038792.png" alt="image-20240212164038792"></p>
<p>第三方服务-通用思路</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212164215124.png" alt="image-20240212164215124"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212164305194.png" alt="image-20240212164305194"></p>
<p>Bucket：存储空间是用户用于存储对象（Object，就是文件）的容器，所有的对象都必须隶属于某个存储空间。</p>
<p>SDK：Software Development Kit的缩写，软件开发工具包，包括辅助软件开发的依赖（jar包）,代码示例等，都可以叫做SDK。</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212175938569.png" alt="image-20240212175938569"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212180022852.png" alt="image-20240212180022852"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212180106893.png" alt="image-20240212180106893"></p>
<p><a href="https://blog.csdn.net/qq_59621600/article/details/134859770">03_阿里云_配置OSS环境变量_从环境变量中获取访问凭证。运行本代码示例之前,请确保已设置环境变量oss_access_-CSDN博客</a></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212180508466.png" alt="image-20240212180508466"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212181243549.png" alt="image-20240212181243549"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212182131820.png" alt="image-20240212182131820"></p>
<h2 id="修改员工"><a href="#修改员工" class="headerlink" title="修改员工"></a>修改员工</h2><h3 id="查询回显"><a href="#查询回显" class="headerlink" title="查询回显"></a>查询回显</h3><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212182543275.png" alt="image-20240212182543275"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212183024576.png" alt="image-20240212183024576"></p>
<h3 id="修改员工-1"><a href="#修改员工-1" class="headerlink" title="修改员工"></a>修改员工</h3><p> <img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212183219286.png" alt="image-20240212183219286"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212183659370.png" alt="image-20240212183659370"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212184349123.png" alt="image-20240212184349123"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212184809216.png" alt="image-20240212184809216"></p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h3 id="参数配置化"><a href="#参数配置化" class="headerlink" title="参数配置化"></a>参数配置化</h3><p>每次涉及到第三方参数，都要重新编写java代码，是比较繁琐的。且第三方参数在各个文件中，要修改的地方太多，</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212185212846.png" alt="image-20240212185212846"></p>
<p>pom.xml文件是maven环境的配置文件，application.properties是springboot的配置文件。将第三方参数配置到application.properties中。</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212185659858.png" alt="image-20240212185659858"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212185831938.png" alt="image-20240212185831938"></p>
<h3 id="yml配置文件"><a href="#yml配置文件" class="headerlink" title="yml配置文件"></a>yml配置文件</h3><ul>
<li><p>springboot提供了多种属性配置方式</p>
<ul>
<li><p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br><span class="line"><span class="attr">server.address</span>=<span class="string">127.0.0.1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="string">port:8080</span></span><br><span class="line">	<span class="string">address:127.0.0.1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>application.yaml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="string">port:8080</span></span><br><span class="line">	<span class="string">address:127.0.0.1</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>常见配置文件格式对比</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212190404086.png" alt="image-20240212190404086"></p>
</li>
<li><p>Yml基本语法</p>
<ul>
<li>大小写敏感</li>
<li>数值前必须有空格，作为分隔符</li>
<li>使用缩进表示层级关系，缩进式，不允许使用Tab键，只能使用空格（idea会自动将Tab转化为空格）</li>
<li>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li>
<li>#表示注释，从这个字符一直到行尾，都会被解析器忽略</li>
</ul>
</li>
</ul>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212190610849.png" alt="image-20240212190610849"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212190644684.png" alt="image-20240212190644684"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212191542372.png" alt="image-20240212191542372"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212191559992.png" alt="image-20240212191559992"></p>
<h3 id="ConfigurationProperties"><a href="#ConfigurationProperties" class="headerlink" title="@ConfigurationProperties"></a>@ConfigurationProperties</h3><p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212191836626.png" alt="image-20240212191836626"></p>
<p>问题：待注入的属性值过多。</p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212192057758.png" alt="image-20240212192057758"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212193223494.png" alt="image-20240212193223494"></p>
<p><img src="/2024/02/09/javaweb-day05-springboot%E6%A1%88%E4%BE%8B/image-20240212193244630.png" alt="image-20240212193244630"></p>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>javaweb-day04-mybatis</title>
    <url>/2024/02/08/javaweb-day04-mybatis/</url>
    <content><![CDATA[<h1 id="MyBatis概述"><a href="#MyBatis概述" class="headerlink" title="MyBatis概述"></a>MyBatis概述</h1><p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208175300104.png" alt="image-20240208175300104"></p>
<p>在项目中通过Java程序操作数据库，其中最主流的技术则是MyBatis。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208175438494.png" alt="image-20240208175438494"></p>
<ul>
<li><font color="red">MyBatis是一款优秀的持久层框架，用于简化JDBC的开发。</font></li>
<li>MyBatis原本是Apache的一个开源项目iBatis，2010年这个项目由apache迁移到了google code，并且改名为MyBatis。2013年11月迁移到Github。</li>
<li>官网：<a href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></li>
</ul>
<h1 id="MyBatis入门"><a href="#MyBatis入门" class="headerlink" title="MyBatis入门"></a>MyBatis入门</h1><p>案例：使用MyBatis查询所有用户数据</p>
<ol>
<li>准备工作（创建springboot工程，数据库表user，实体类User）</li>
<li>引入Mybatis的相关依赖，配置Mybatis（数据库连接信息）</li>
<li>编写SQL语句（注解&#x2F;XML）</li>
</ol>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208180807585.png" alt="image-20240208180807585"></p>
<ol>
<li><p>配置springboot工程的相关依赖包。</p>
</li>
<li><p>在application.properties中设置数据库连接信息。</p>
</li>
<li><p>设置注解@Mapper，为接口UserMapper定义方法list()，再加上注解@Select，指定当前方法是查询操作，在注解中指定要执行的sql语句。最终在执行sql语句，只需要调用UserMapper中的list方法即可，此时框架就会自动执行sql语句，并将sql语句的执行结果返回到方法的返回值中。</p>
</li>
<li><p>在Mybatis的设计中，只需要设计接口，不需要定义实现类，程序运行时，框架底层会自动生成该实现类对象。</p>
</li>
</ol>
<p><strong>准备工作</strong></p>
<ol>
<li><p>配置springboot工程及相关依赖包。<img src="/2024/02/08/javaweb-day04-mybatis/image-20240208181512518.png" alt="image-20240208181512518"></p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208181638813.png" alt="image-20240208181638813"></p>
</li>
<li><p>数据库表user的建立</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">    id <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age tinyint unsigned comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    gender tinyint unsigned comment <span class="string">&#x27;性别, 1:男, 2:女&#x27;</span>,</span><br><span class="line">    phone <span class="type">varchar</span>(<span class="number">11</span>) comment <span class="string">&#x27;手机号&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;用户表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;白眉鹰王&#x27;</span>,<span class="number">55</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;金毛狮王&#x27;</span>,<span class="number">45</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000001&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;青翼蝠王&#x27;</span>,<span class="number">38</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000002&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;紫衫龙王&#x27;</span>,<span class="number">42</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;18800000003&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;光明左使&#x27;</span>,<span class="number">37</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000004&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(id, name, age, gender, phone) <span class="keyword">VALUES</span> (<span class="keyword">null</span>,<span class="string">&#x27;光明右使&#x27;</span>,<span class="number">48</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;18800000005&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建实体类User</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208182232317.png" alt="image-20240208182232317"></p>
<p>在pojo目录下创建实体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.pojp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Short age;</span><br><span class="line">    <span class="keyword">private</span> Short gender;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(Integer id, String name, Short age, Short gender, String phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">        <span class="built_in">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">            <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">            <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">            <span class="string">&quot;, gender=&quot;</span> + gender +</span><br><span class="line">            <span class="string">&quot;, phone=&#x27;&quot;</span> + phone + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Short <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Short age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Short <span class="title function_">getGender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(Short gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPhone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPhone</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在resoures目录下配置数据库的连接信息</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"># 配置mybatis的日志信息，指定输出至控制台</span></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写SQL语句（注解&#x2F;XML）</p>
<p>在mapper目录下创建UserMapper</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojp.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span> <span class="comment">//在运行时，会自动生成该接口的实现类对象（代理对象），并且将该对象交给IOC容器管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">//查询全部的用户信息</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在test目录的测试类中测试编写好的代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojp.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span> <span class="comment">//springboot整合单元测试的注解</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisQuickstartApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span>  UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testListUser</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userMapper.list();</span><br><span class="line">        userList.stream().forEach(user-&gt;&#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="red">由于加了SpringBootTest的注解，运行时，程序会自动加载整个springboot的环境，并且创建springboot的ioc容器，ioc容器创建之后，由于加了@Autowired，实现了依赖注入，因而userMapper自动从ioc容器中获取相应的bean对象，接下来就可以调用这个bean对象当中的list方法，进而实现sql语句的查询。</font></p>
</li>
</ol>
<h1 id="配置SQL提示"><a href="#配置SQL提示" class="headerlink" title="配置SQL提示"></a>配置SQL提示</h1><p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208184500656.png" alt="image-20240208184500656"></p>
<p>存在报错信息</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208184604448.png" alt="image-20240208184604448"></p>
<p>好处：编写的sql语句如果有问题，可以在编码阶段就发现问题，而不是运行时才能显示问题。</p>
<h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><ul>
<li><p>JDBC（Java DataBase Connectivity），就是Java语言操作关系型数据库的一套API。</p>
<p>JDBC仅仅实现了接口，没有实现具体的实现机制。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208185018446.png" alt="image-20240208185018446"></p>
</li>
<li><p>JDBC vs MyBatis</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208185543665.png" alt="image-20240208185543665"></p>
<p>MyBatis单独提炼出连接数据库的配置，同时节省了数据查询结果的封装过程，此外，采用数据库连接池技术存储连接过程中创建的connection对象，节省了频繁开销带来的性能损失。</p>
</li>
<li><p>MyBatis的实现关注重点</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208185621056.png" alt="image-20240208185621056"></p>
</li>
</ul>
<h1 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h1><ul>
<li><p>数据库连接池是一个容器，负责分配、管理数据库连接（Connection）</p>
</li>
<li><p>它允许应用程序重复使用一个现有的数据库对象，而不是重新建立一个</p>
</li>
<li><p>释放空间时间超过最大空闲时间的链接，来避免因为没有释放连接引起的数据库连接遗漏（如果用户获取数据库对象后在一定时间未对数据库进行操作，超出时间后，连接池会收回该对象）</p>
</li>
</ul>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208190243297.png" alt="image-20240208190243297"></p>
<p>优势</p>
<ul>
<li>资源重用</li>
<li>提升系统响应速度</li>
<li>避免数据库连接泄露</li>
</ul>
<p>标准接口：DataSource</p>
<ul>
<li><p>官方（sun）提供的数据库连接池接口，由第三方组织实现此接口。</p>
</li>
<li><p>功能：获取链接 <code>Connection getConnection() throws SQLException;</code></p>
</li>
<li><p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208190417420.png" alt="image-20240208190417420"></p>
</li>
<li><p>Druid和HiKari的连接池都不错</p>
<ul>
<li>Druid连接池是阿里巴巴开源的数据库连接池项目</li>
<li>功能强大，性能优秀，是Java语言最好的数据库连接池之一</li>
</ul>
</li>
<li><p>切换Druid数据库连接池</p>
<p>官方地址：<a href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 指定数据源类型为Druid</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="lombok"><a href="#lombok" class="headerlink" title="lombok"></a>lombok</h1><p>问题：原有的类过于臃肿，每个属性都要创建对应的get，set方法。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208193220097.png" alt="image-20240208193220097"></p>
<ul>
<li><p>Lombok是一个实用的Java类库，能通过注解的形式自动生成构造器、getter&#x2F;setter、equals、hashcode、toString等方法，并可以自动化生成日志变量，简化java开发，提高效率。</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>@Getter&#x2F;@Setter</td>
<td>为所有的属性提供get&#x2F;set方法</td>
</tr>
<tr>
<td>@ToString</td>
<td>会为类自动生成易阅读的toString方法</td>
</tr>
<tr>
<td>@EqualsAndHashCode</td>
<td>根据类所拥有的非静态字段自动重写equals方法和hashCode方法</td>
</tr>
<tr>
<td>@Data</td>
<td>提供更综合的生成代码功能（@Getter+@Setter+@ToString+@EqualsAndHashCode）</td>
</tr>
<tr>
<td>@NoArgsConstructor</td>
<td>为实体类生成无参的构造器方法</td>
</tr>
<tr>
<td>@AllArgsConstructor</td>
<td>为实体类生成除了static修饰的字段之外带有各参数的构造器方法</td>
</tr>
</tbody></table>
</li>
<li><p>引入lambok的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>实例代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.pojp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Short age;</span><br><span class="line">    <span class="keyword">private</span> Short gender;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ul>
<li><p>lombok在编译时，自动生成对应的java代码，我们使用lombok时，还需要安装一个lombok的插件（idea自带）。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208194835391.png" alt="image-20240208194835391"></p>
</li>
</ul>
</li>
</ul>
<h1 id="Mybatis基础操作"><a href="#Mybatis基础操作" class="headerlink" title="Mybatis基础操作"></a>Mybatis基础操作</h1><p>准备工作</p>
<ul>
<li><p>准备数据库表emp</p>
</li>
<li><p>创建一个新的springboot工程，选择引入对应的起步依赖（mybatis、mysql、lombok）</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208212225283.png" alt="image-20240208212225283"></p>
</li>
<li><p>application.properties中引入数据库连接信息</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 切换为Druid</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建对应的实体类Emp（实体类属性采用驼峰命名法）</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208212425880.png" alt="image-20240208212425880"></p>
</li>
<li><p>准备Mapper接口EmpMapper</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208212434113.png" alt="image-20240208212434113"></p>
</li>
</ul>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208214036989.png" alt="image-20240208214036989"></p>
<p>删除时点击删除按钮，最终会向后台发送该数据对应的主键id，交给后端处理。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpMapper</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="comment">//根据ID删除数据（该函数是有返回值的，返回的是删除操作影响的记录数）</span></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from emp where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SpringbootMybatisCrudApplicationTests</span></span><br><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.EmpMapper;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">        empMapper.delete(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<p>如果mapper接口方法形参只有一个普通类型的参数，#{…}里面的属性名可以随便写，如：#{id}，#{value}。</p>
<p><strong>日志输出</strong></p>
<ul>
<li><p>可以在application.properties中，打开mybatis的日志，并指定输出到控制台。</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置mybatis的日志信息，指定输出至控制台</span></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<p>再次运行之后得到预编译SQL操作信息（在运行前，后将Parameter写入Preparing中的参数）</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208215940314.png" alt="image-20240208215940314"></p>
<p>使用#{id}，代表占位符，最终执行时，？会用参数占位符的实际内容16代替，发送到数据库执行语句。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208220029626.png" alt="image-20240208220029626"></p>
</li>
</ul>
<p><strong>MySQL语句的执行过程 | 预编译SQL</strong></p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208220327688.png" alt="image-20240208220327688"></p>
<p>普通的java语句-&gt;sql语法解析检查-&gt;优化SQL-&gt;编译sql-&gt;执行sql</p>
<p>其中，预编译会将“sql语法解析检查-&gt;优化SQL-&gt;编译sql”这几步<strong>缓存</strong>起来，后续如果有大量的SQL语句，则从<strong>缓存</strong>中找是否有对应的预编译好的指令，如果有，就省略这三步操作，直接去执行SQL语句，否则，需要再次执行操作。</p>
<p>例如，如果我们要执行以下三条语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>则这三条语句都要进行语法检查，优化，编译。</p>
<p>如果我们实际执行的是</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id <span class="operator">=</span> ?;</span><br></pre></td></tr></table></figure>

<p>则对应的后两条删除语句可以直接将参数带入，直接执行SQL语句。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208220901168.png" alt="image-20240208220901168"></p>
<p><strong>防止SQL注入的具体例子：</strong></p>
<ul>
<li><p><strong>SQL注入</strong>是通过操作输入的数据来修改实现定义好的SQL语句，以达到执行代码对服务器进行<strong>攻击</strong>的方法。</p>
</li>
<li><p>例如 用户输入的是’waterdance’，password输入的是 ‘ or  ‘1’ &#x3D; ‘1</p>
</li>
<li><p>参数占位符类别</p>
<table>
<thead>
<tr>
<th>#{…}</th>
<th>${…}</th>
</tr>
</thead>
<tbody><tr>
<td>执行SQL语句时，会将#{…}替换为？，生成预编译的SQL，会自动设置参数值</td>
<td>拼接SQL。直接将 参数拼接在SQL语句中，存在SQL注入问题。</td>
</tr>
<tr>
<td>使用时机：参数传递，都使用#{}</td>
<td>使用时机：如果对表名、列表进行动态设置时使用。</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpMapper</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Insert(&quot;insert into emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time)&quot; +</span></span><br><span class="line"><span class="meta">        &quot;values (#&#123;username&#125;, #&#123;name&#125;, #&#123;gender&#125;, #&#123;image&#125;, #&#123;job&#125;, #&#123;entrydate&#125;, #&#123;deptId&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;)&quot;)</span>  # 属性名要求按照类设计的属性名来编写</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insert</span><span class="params">(Emp emp)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SpringbootMybatisCrudApplicationTests</span></span><br><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.EmpMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.LocalDateTime.now;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.LocalDateTime.of;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        emp.setUsername(<span class="string">&quot;Jerry&quot;</span>);</span><br><span class="line">        emp.setName(<span class="string">&quot;杰瑞&quot;</span>);</span><br><span class="line">        emp.setImage(<span class="string">&quot;1.jpg&quot;</span>);</span><br><span class="line">        emp.setGender((<span class="type">short</span>)<span class="number">1</span>);</span><br><span class="line">        emp.setJob((<span class="type">short</span>)<span class="number">1</span>);</span><br><span class="line">        emp.setEntrydate(LocalDate.of(<span class="number">2000</span>,<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">        emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">        emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        emp.setDeptId(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">insertNum</span> <span class="operator">=</span> empMapper.insert(emp);</span><br><span class="line">        System.out.println(insertNum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208223618549.png" alt="image-20240208223618549"></p>
<p><strong>新增（主键返回）</strong></p>
<ul>
<li><p>描述：在数据添加成功后，需要获取插入数据库数据的主键。</p>
<p>如：添加套餐数据时，还需要维护套餐菜品关系表数据。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208223935524.png" alt="image-20240208223935524"></p>
<ul>
<li><p>实现</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208224223342.png" alt="image-20240208224223342"></p>
</li>
</ul>
</li>
</ul>
<p><strong>小结</strong></p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208224506667.png" alt="image-20240208224506667"></p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpMapper</span></span><br><span class="line"><span class="keyword">package</span> com.example.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Update(&quot;update emp set username = #&#123;username&#125;, name = #&#123;name&#125;, gender = #&#123;gender&#125;, image = #&#123;image&#125; ,&quot; +</span></span><br><span class="line"><span class="meta">           &quot; job = #&#123;job&#125;, entrydate = #&#123;entrydate&#125;, dept_id = #&#123;deptId&#125;, update_time = #&#123;updateTime&#125; where id = #&#123;id&#125; &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Emp emp)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SpringbootMybatisCrudApplicationTests</span></span><br><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.mapper.EmpMapper;</span><br><span class="line"><span class="keyword">import</span> com.example.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.LocalDateTime.now;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.LocalDateTime.of;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        emp.setId(<span class="number">18</span>);</span><br><span class="line">        emp.setUsername(<span class="string">&quot;Jerrysdasdasdasdas2&quot;</span>);</span><br><span class="line">        emp.setName(<span class="string">&quot;汤姆adasdas&quot;</span>);</span><br><span class="line">        emp.setImage(<span class="string">&quot;1sadasd.jpg&quot;</span>);</span><br><span class="line">        emp.setGender((<span class="type">short</span>) <span class="number">1</span>);</span><br><span class="line">        emp.setJob((<span class="type">short</span>) <span class="number">1</span>);</span><br><span class="line">        emp.setEntrydate(LocalDate.of(<span class="number">2000</span>, <span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">        emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        emp.setDeptId(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        empMapper.update(emp);</span><br><span class="line">        System.out.println(emp.getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpMapper</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from emp where id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SpringbootMybatisCrudApplicationTests</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> empMapper.getById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208230825297.png" alt="image-20240208230825297"></p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208230900933.png" alt="image-20240208230900933"></p>
<p><font color="red">其中deptId，createTime，updateTime字段值均为null，未正确封装数据内容。</font></p>
<p><font color="red">原因：</font></p>
<ul>
<li><p><font color="red">实体类属性名和数据库查询返回的字段名一致，mybatis会自动封装。</font></p>
</li>
<li><p><font color="red">如果实体类属性名和数据库表查询返回的字段名不一样，不能自动封装。</font></p>
</li>
</ul>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208231100003.png" alt="image-20240208231100003"></p>
<ul>
<li><p>为了解决实体类与数据库表命名不一致的问题，我们有以下方案。</p>
<ul>
<li><p>方案一：给字段起别名，让别名与实体类属性一致（修改empmapper类中的select方法）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据ID查询员工</span></span><br><span class="line">   <span class="meta">@Select(&quot;select id, username, password, name, gender, image, job,  entrydate, &quot; +</span></span><br><span class="line"><span class="meta">       &quot; dept_id deptId, create_time createTime, update_time updateTime from emp where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Emp <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方案二：通过MyBatis,@Result注释手动映射封装</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;dept_id&quot;,property = &quot;deptId&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;update_time&quot;,property = &quot;updateTime&quot;),</span></span><br><span class="line"><span class="meta">        @Result(column = &quot;create_time&quot;,property = &quot;createTime&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from emp where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Emp <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>（推荐使用）方案三</strong>：开启mybatis的驼峰命名自动映射开关（将a_column这样的数据表字段自动映射到实体类的属性aColumn中,要严格遵循数据表字段是下划线分割，类中的属性名是驼峰命名）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/mybatis</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br><span class="line"># 配置mybatis的日志，指定其输出到控制台</span><br><span class="line">mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl</span><br><span class="line"></span><br><span class="line"># 开启mybatis的驼峰命名自动映射开关</span><br><span class="line">mybatis.configuration.map-underscore-to-camel-case=true</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208231533437.png" alt="image-20240208231533437"></p>
</li>
</ul>
</li>
</ul>
<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><ul>
<li><p>在empMapper类中编写接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//EmpMapper</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from emp where name like &#x27;%$&#123;name&#125;%&#x27; and gender = #&#123;gender&#125; and &quot; +</span></span><br><span class="line"><span class="meta">        &quot;entrydate between #&#123;begin&#125; and #&#123;end&#125; order by update_time desc ;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">(String name, Short gender, LocalDate begin, LocalDate end)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在test类中测试接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SpringbootMybatisCrudApplicationTests</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Emp&gt; empList = empMapper.list(<span class="string">&quot;张&quot;</span>, (<span class="type">short</span>) <span class="number">1</span>, LocalDate.of(<span class="number">2010</span>, <span class="number">1</span>, <span class="number">1</span>), LocalDate.of(<span class="number">2020</span>, <span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">    System.out.println(empList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208233621106.png" alt="image-20240208233621106"></p>
<p>因为name使用的是${}而不是#{}，可能存在SQL注入问题。解决办法：empMapper类中编写的接口使用mysql的concat函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//条件查询员工</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from emp where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;) and gender = #&#123;gender&#125; and &quot; +</span></span><br><span class="line"><span class="meta">        &quot;entrydate between #&#123;begin&#125; and #&#123;end&#125; order by update_time desc ;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">(String name, Short gender, LocalDate begin, LocalDate end)</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208233536664.png" alt="image-20240208233536664"></p>
</li>
</ul>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208233800310.png" alt="image-20240208233800310"></p>
<p>springboot的1.x版本和2.x版本的参数设置有一点区别，区别如下所示：</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240208234015102.png" alt="image-20240208234015102"></p>
<h1 id="XML映射文件"><a href="#XML映射文件" class="headerlink" title="XML映射文件"></a>XML映射文件</h1><p>之前的方式是通过注解的方式配置sql语句，这是通过xml来配置sql语句。</p>
<ul>
<li><strong>实际开发时，选择注解来映射简单语句，如果需要实现复杂的SQL功能，还是要通过xml来完成。</strong></li>
</ul>
<h2 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h2><ul>
<li><p>XML映射文件的名称与Mapper接口名称一致，并且将XML映射文件和Mapper接口放置在<strong>相同包</strong>下(同包同名)。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209120818270.png" alt="image-20240209120818270"></p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209122155859.png" alt="image-20240209122155859"></p>
</li>
<li><p>XML映射文件的namespace属性与Mapper接口<strong>全限定名</strong>一致。resultType属性要填写的单条记录要封装的类型的<strong>全限定名</strong>。（下图中EmpMapper与namespace中的内容一致）</p>
</li>
<li><p>XML映射文件中sql语句的id与Mapper接口中的方法名一致，并保持返回类型一致。（下图中方法名list与id的内容一致，resultType是单条记录封装的类型的全类名）</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209120946411.png" alt="image-20240209120946411"></p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209122759826.png" alt="image-20240209122759826"></p>
</li>
<li><p>例子：</p>
</li>
</ul>
<p>在resources目录下创建与EmpMapper想通包的文件EmpMapper.xml，其中的配置如下所示</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select * from emp where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;) and gender = #&#123;gender&#125; and  + entrydate between #&#123;begin&#125; and #&#123;end&#125; order by update_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我们按照这三点规范定义了XML映射文件，当我们在调用EmpMapper的list方法时，MyBatis就会自动查找namespace属性值与这个接口全类名的相同的XML映射文件，并在XML映射文件中找到id属性值与方法名相同的这条sql语句，最终运行sql语句，从而完成数据库的操作。</p>
<ul>
<li>安装mybatisX插件，mapper类会和对应的xml建立连接。</li>
</ul>
<h1 id="MyBatis动态SQL"><a href="#MyBatis动态SQL" class="headerlink" title="MyBatis动态SQL"></a>MyBatis动态SQL</h1><p><strong>动态SQL</strong></p>
<p>随着用户的输入或外部条件的变化而变化的SQL语句，我们称为动态SQL。</p>
<p> <img src="/2024/02/08/javaweb-day04-mybatis/image-20240209132846618.png" alt="image-20240209132846618"></p>
<p>如上图所示，我们设定死了要求输入三个参数来进行数据库查询。其实功能要泛化，实现单个或者任意两个参数也能实现相应的查询结果。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209133959066.png" alt="image-20240209133959066"></p>
<h2 id="if-where-set"><a href="#if-where-set" class="headerlink" title="if | where | set"></a>if | where | set</h2><ul>
<li><p>&lt;if&gt;：用于判断条件是否成立。使用test属性进行条件判断，如果条件为true，则拼接SQL。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- EmpMapper.xml --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from emp</span><br><span class="line">        where</span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> =<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name like concat(&quot;%&quot;,#&#123;name&#125;,&quot;%&quot;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">                and gender = #&#123;gender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span></span><br><span class="line">                and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        order by update_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>有bug，当name属性的值为null时，会报错。改进措施，加上&lt;where&gt;标签</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- EmpMapper.xml --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select *</span><br><span class="line">        from emp</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> =<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name like concat(&quot;%&quot;,#&#123;name&#125;,&quot;%&quot;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">                and gender = #&#123;gender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span></span><br><span class="line">                and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by update_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>&lt;where&gt;：根据where中的子标签判断条件是否成立。如果所有条件都不成立，就不会生产where子句，否则会生成where子句，而且会自动去除子句的开头的AND或者OR。</p>
<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209135153909.png" alt="image-20240209135153909"></p>
</li>
<li><p>&lt;set&gt;：动态在行首插入set关键字，并会删除掉额外的逗号。（用在update语句中）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- EmpMapper.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update2&quot;</span>&gt;</span></span><br><span class="line">        update emp</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;username != null&quot;</span>&gt;</span> username = #&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;name != null&quot;</span>&gt;</span> name        = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;gender != null&quot;</span>&gt;</span> gender      = #&#123;gender&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;image != null&quot;</span>&gt;</span> image       = #&#123;image&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;job != null&quot;</span>&gt;</span>job         = #&#123;job&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;entrydate != null&quot;</span>&gt;</span>entrydate   = #&#123;entrydate&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;deptId != null&quot;</span>&gt;</span>dept_id     = #&#123;deptId&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span> = <span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #&#123;updateTime&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209142712475.png" alt="image-20240209142712475"></p>
</li>
</ul>
<h2 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h2><p><strong>sql语句</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp <span class="keyword">where</span> id <span class="keyword">in</span>(<span class="number">20</span>,<span class="number">22</span>,<span class="number">23</span>);</span><br></pre></td></tr></table></figure>

<p><strong>接口方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteByIds</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Integer&gt;  ids = Arrays.asList(<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>);</span><br><span class="line">    empMapper.deleteByIds(ids);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>XML映射文件</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 批量删除标签 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        collection : 遍历的集合</span></span><br><span class="line"><span class="comment">        item:遍历出来的元素</span></span><br><span class="line"><span class="comment">        seperator:分隔符</span></span><br><span class="line"><span class="comment">        open:遍历开始拼接的SQL片段</span></span><br><span class="line"><span class="comment">        close:遍历结束拼接的SQL片段</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">        delete from emp where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209144453692.png" alt="image-20240209144453692"></p>
<h2 id="sql-include"><a href="#sql-include" class="headerlink" title="sql | include"></a>sql | include</h2><p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209144709292.png" alt="image-20240209144709292"></p>
<p>问题：</p>
<ul>
<li><p>在映射配置文件中select部分存在大量重复字段，如果修改了数据表中的字段名，映射配置文件xml中要修改部分太多，代码复用性较差。java定义一个方法，将重复部分的代码封装到方法中，哪里需要就调用这个方法即可。</p>
</li>
<li><p>实现机制，用sql标签抽取重复片段，给sql分配唯一标识（定义id属性），include标签引入sql片段，用refid指定引用片段。</p>
<ul>
<li>sql：定义可重用的SQL片段。</li>
<li>include:通过属性refid，指定包含的sql片段。</li>
</ul>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/02/08/javaweb-day04-mybatis/image-20240209145633455.png" alt="image-20240209145633455"></p>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>javaweb-day03-mysql</title>
    <url>/2024/02/06/javaweb-day03-mysql/</url>
    <content><![CDATA[<p>什么是数据库？</p>
<ul>
<li><p>数据库：DataBase（DB），是存储和管理数据的仓库。</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206125606781.png" alt="image-20240206125606781"></p>
</li>
<li><p>数据库管理系统：DataBase Management System(DBMS)，操纵和管理数据库的大型软件。</p>
</li>
<li><p>SQL：Structured Query Language，操作关系型数据库的编程语言，定义了一套操作关系型数据库统一标准。</p>
</li>
</ul>
<p>数据库产品</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206130010075.png" alt="image-20240206130010075"></p>
<h1 id="MySQL概述"><a href="#MySQL概述" class="headerlink" title="MySQL概述"></a>MySQL概述</h1><h2 id="安装、配置"><a href="#安装、配置" class="headerlink" title="安装、配置"></a>安装、配置</h2><h2 id="一、下载"><a href="#一、下载" class="headerlink" title="一、下载"></a>一、下载</h2><p>点开下面的链接：<a href="https://dev.mysql.com/downloads/mysql/">https://dev.mysql.com/downloads/mysql/</a></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20221020012302873.png" alt="image-20221020012302873"> </p>
<p>点击Download 就可以下载对应的安装包了, 安装包如下: <img src="/2024/02/06/javaweb-day03-mysql/image-20221020012428839.png" alt="image-20221020012428839">  </p>
<h2 id="二、解压"><a href="#二、解压" class="headerlink" title="二、解压"></a>二、解压</h2><p>下载完成后我们得到的是一个压缩包，将其解压，我们就可以得到MySQL 8.0.31 的软件本体了(就是一个文件夹)，我们可以把它放在你想安装的位置 。</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20221020013011737.png" alt="image-20221020013011737"> </p>
<h2 id="三、配置"><a href="#三、配置" class="headerlink" title="三、配置"></a>三、配置</h2><h3 id="1-添加环境变量"><a href="#1-添加环境变量" class="headerlink" title="1. 添加环境变量"></a>1. 添加环境变量</h3><blockquote>
<p>环境变量里面有很多选项，这里我们只用到<code>Path</code>这个参数。为什么在初始化的开始要添加环境变量呢？</p>
<p>在黑框(即CMD)中输入一个可执行程序的名字，Windows会先在环境变量中的<code>Path</code>所指的路径中寻找一遍，如果找到了就直接执行，没找到就在当前工作目录找，如果还没找到，就报错。我们添加环境变量的目的就是能够在任意一个黑框直接调用MySQL中的相关程序而不用总是修改工作目录，大大简化了操作。</p>
</blockquote>
<p>右键<code>此电脑</code>→<code>属性</code>，点击<code>高级系统设置</code></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/1556823-20181220220242472-524708778.png" alt="img"> </p>
<p>点击<code>环境变量</code></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/1556823-20181220220359609-736422950.png" alt="img"> </p>
<p>在<code>系统变量</code>中新建MYSQL_HOME</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20221020013128323.png" alt="image-20221020013128323">  </p>
<p>在<code>系统变量</code>中找到并<strong>双击</strong><code>Path</code></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/1556823-20181220220551145-1198958872.png" alt="img"> </p>
<p>点击<code>新建</code></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20201109135248104.png" alt="image-20201109135248104"> </p>
<p>最后点击确定。</p>
<p><strong>如何验证是否添加成功？</strong></p>
<p>右键开始菜单(就是屏幕左下角)，选择<code>命令提示符(管理员)</code>，打开黑框，敲入<code>mysql</code>，回车。</p>
<img src="/2024/02/06/javaweb-day03-mysql/image-20221020013302450.png" alt="image-20221020013302450" style="zoom:67%;"> 

<p>如果提示<code>Can&#39;t connect to MySQL server on &#39;localhost&#39;</code>则证明添加成功；</p>
<img src="/2024/02/06/javaweb-day03-mysql/image-20221020013335596.png" alt="image-20221020013335596" style="zoom:80%;"> 

<p>如果提示<code>mysql不是内部或外部命令，也不是可运行的程序或批处理文件</code>则表示添加添加失败，请重新检查步骤并重试。</p>
<h3 id="2-初始化MySQL"><a href="#2-初始化MySQL" class="headerlink" title="2. 初始化MySQL"></a>2. 初始化MySQL</h3><p>&#x3D;&#x3D;以管理员身份，运行命令行窗口：&#x3D;&#x3D;</p>
<img src="/2024/02/06/javaweb-day03-mysql/image-20220518172922780.png" alt="image-20220518172922780" style="zoom: 80%;">

<p>在刚才的命令行中，输入如下的指令： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqld --initialize-insecure</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/06/javaweb-day03-mysql/image-20201109140955772.png" alt="image-20201109140955772"> </p>
<p>稍微等待一会，如果出现没有出现报错信息，则证明data目录初始化没有问题，此时再查看MySQL目录下已经有data目录生成。</p>
<p>tips：如果出现如下错误</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20201109135848054.png" alt="image-20201109135848054"> </p>
<p>是由于权限不足导致的，以管理员方式运行 cmd</p>
<img src="/2024/02/06/javaweb-day03-mysql/image-20220518172922780.png" alt="image-20220518172922780" style="zoom: 80%;"> 

<h3 id="3-注册MySQL服务"><a href="#3-注册MySQL服务" class="headerlink" title="3. 注册MySQL服务"></a>3. 注册MySQL服务</h3><p>命令行（注意必须以管理员身份启动）中，输入如下的指令，回车执行： </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqld -install</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/06/javaweb-day03-mysql/image-20201109141325810.png" alt="image-20201109141325810"> </p>
<p>现在你的计算机上已经安装好了MySQL服务了。</p>
<h3 id="4-启动MySQL服务"><a href="#4-启动MySQL服务" class="headerlink" title="4. 启动MySQL服务"></a>4. 启动MySQL服务</h3><p>在黑框里敲入<code>net start mysql</code>，回车。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">net start mysql  <span class="comment">// 启动mysql服务</span></span><br><span class="line">    </span><br><span class="line">net stop mysql  <span class="comment">// 停止mysql服务</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/06/javaweb-day03-mysql/image-20220518183747072.png" alt="image-20220518183747072"> </p>
<h3 id="5-修改默认账户密码"><a href="#5-修改默认账户密码" class="headerlink" title="5. 修改默认账户密码"></a>5. 修改默认账户密码</h3><p>在黑框里敲入<code>mysqladmin -u root password 1234</code>，这里的<code>1234</code>就是指默认管理员(即root账户)的密码，可以自行修改成你喜欢的。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqladmin -u root password 1234</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/06/javaweb-day03-mysql/1556823-20181221093251250-819416425.png" alt="img"> </p>
<h2 id="四、登录MySQL"><a href="#四、登录MySQL" class="headerlink" title="四、登录MySQL"></a>四、登录MySQL</h2><p>右键开始菜单，选择<code>命令提示符</code>，打开黑框。<br>在黑框中输入，<code>mysql -uroot -p1234</code>，回车，出现下图且左下角为<code>mysql&gt;</code>，则登录成功。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p1234</span><br></pre></td></tr></table></figure>

<img src="/2024/02/06/javaweb-day03-mysql/image-20221020013540957.png" alt="image-20221020013540957" style="zoom:80%;">   

<p><strong>到这里你就可以开始你的MySQL之旅了！</strong></p>
<p>退出mysql：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exit</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>登陆参数：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql -u用户名 -p密码 -h要连接的mysql服务器的ip地址(默认127.0.0.1) -P端口号(默认3306)</span><br></pre></td></tr></table></figure>

<h2 id="五、卸载MySQL"><a href="#五、卸载MySQL" class="headerlink" title="五、卸载MySQL"></a>五、卸载MySQL</h2><p>如果你想卸载MySQL，也很简单。</p>
<p>点击开始菜单，输入cmd，选择 “命令提示符”，选择右侧的 “以管理员身份运行”。</p>
<img src="/2024/02/06/javaweb-day03-mysql/image-20220611083741275.png" alt="image-20220611083741275" style="zoom:80%;"> 

<ol>
<li>敲入<code>net stop mysql</code>，回车。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">net stop mysql</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/06/javaweb-day03-mysql/1556823-20181220222924783-57600848.png" alt=" "> </p>
<ol start="2">
<li>再敲入<code>mysqld -remove mysql</code>，回车。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysqld -remove mysql</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/06/javaweb-day03-mysql/1556823-20181220223025128-587235464.png" alt="img"> </p>
<ol start="3">
<li>最后删除MySQL目录及相关的环境变量。</li>
</ol>
<p><strong>至此，MySQL卸载完成！</strong></p>
<h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><ul>
<li><p>关系型数据库（RDBMS）：建立在关系模型基础上，由多张相互连接的二维表组成的数据库。</p>
<p>特点：</p>
<ul>
<li>使用表存储数据，格式统一，便于维护</li>
<li>使用SQL语言操作，标准统一，使用方便，可以用复杂查询</li>
</ul>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206131607795.png" alt="image-20240206131607795"></p>
</li>
</ul>
<h2 id="SQL介绍"><a href="#SQL介绍" class="headerlink" title="SQL介绍"></a>SQL介绍</h2><ul>
<li><p>SQL：一门操作关系型数据库的编程语言，定义操作所有关系型数据库的统一标准。</p>
<table>
<thead>
<tr>
<th>SQL语句可以单行或者多行书写，以分号结尾。</th>
<th>show databases;</th>
</tr>
</thead>
<tbody><tr>
<td>SQL语句可以使用空格&#x2F;缩进来增强语句的可读性。</td>
<td>show  databases;</td>
</tr>
<tr>
<td>MySQL数据库的SQL语句不区分大小写。</td>
<td>SHOW DATABASES;</td>
</tr>
<tr>
<td>注释： 单行注释：– 注释内容 或 # 注释内容（MySQL特有）</td>
<td>–show databases;</td>
</tr>
<tr>
<td>多行注释：&#x2F;* 注释内容 *&#x2F;</td>
<td>&#x2F;* show database; *&#x2F;</td>
</tr>
</tbody></table>
</li>
<li><p>SQL语句通常被分为四大类：</p>
<table>
<thead>
<tr>
<th>分类</th>
<th>全称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>DDL</td>
<td>Data Definition Language</td>
<td>数据定义语言，用来定义数据库对象（数据库，表，字段）</td>
</tr>
<tr>
<td>DML</td>
<td>Data Manipulation Language</td>
<td>数据操作语言，用来对数据表中的数据进行增删改</td>
</tr>
<tr>
<td>DQL</td>
<td>Data Query Language</td>
<td>数据查询语言，用来查询数据库中表的记录</td>
</tr>
<tr>
<td>DCL</td>
<td>Data Control Language</td>
<td>数据控制语言，用来创建数据库用户，控制数据库的访问权限</td>
</tr>
</tbody></table>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206132230078.png" alt="image-20240206132230078"></p>
</li>
</ul>
<h1 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h1><h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><p>– 查询所有数据库<br>show databases;</p>
<p>– 创建数据库<br>create database if not exists db02;</p>
<p>–删除数据库</p>
<p>drop database if exists db02;</p>
<p>注意事项：</p>
<ul>
<li>上述语法中的databse，也可以替换成schema。如 create schema db01;</li>
</ul>
<h2 id="图形化工具"><a href="#图形化工具" class="headerlink" title="图形化工具"></a>图形化工具</h2><p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206135040052.png" alt="image-20240206135040052"></p>
<p>jetbrain已经将datagrip中的功能集成到了intellij idea中。</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206134857300.png" alt="image-20240206134857300"></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206135024009.png" alt="image-20240206135024009"></p>
<h2 id="数据表操作"><a href="#数据表操作" class="headerlink" title="数据表操作"></a>数据表操作</h2><ul>
<li><p>创建</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名&#123;</span><br><span class="line">	字段<span class="number">1</span> 字段类型 [约束] [comment 字段<span class="number">1</span>注释],</span><br><span class="line">	...</span><br><span class="line">    字段n 字段类型 [约束] [comment 字段n注释],	</span><br><span class="line">&#125;[comment 表注释];</span><br></pre></td></tr></table></figure>
</li>
<li><p>约束</p>
<ul>
<li>概念：约束是作用于表中字段上的规则，用于限制存储在表中的数据</li>
<li>目的：保证数据库中的数据正确性，有效性和完整性。</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>约束</th>
<th>描述</th>
<th>关键字</th>
</tr>
</thead>
<tbody><tr>
<td>非空约束</td>
<td>限制该字段值不能为null</td>
<td>not null</td>
</tr>
<tr>
<td>唯一约束</td>
<td>保证字段的所有数据都是唯一、不重复的</td>
<td>unique</td>
</tr>
<tr>
<td>主键约束</td>
<td>主键是一行数据的唯一标识、要求非空且唯一</td>
<td>primary key（auto_increment)</td>
</tr>
<tr>
<td>默认约束</td>
<td>保存数据时，如果未指定该字段值，这采用默认值</td>
<td>default</td>
</tr>
<tr>
<td>外键约束</td>
<td>让两张表的数据建立连接，保证数据的一致性和完整性</td>
<td>foreign key</td>
</tr>
</tbody></table>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206140150269.png" alt="image-20240206140150269"></p>
<h1 id="DDL（表操作）"><a href="#DDL（表操作）" class="headerlink" title="DDL（表操作）"></a>DDL（表操作）</h1><ul>
<li><p>数据类型</p>
<p>MySQL中的数据类型有很多，主要分为三类：数值类型、字符串类型、日期时间类型。</p>
<p>数值类型：</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206140956703.png" alt="image-20240206140956703"></p>
<p>字符串类型：</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206141713907.png" alt="image-20240206141713907"></p>
<p>日期时间类型：</p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20231102151145540.png" alt="image-20231102151145540"></p>
</li>
</ul>
<h2 id="图形化方式建表"><a href="#图形化方式建表" class="headerlink" title="图形化方式建表"></a>图形化方式建表</h2><p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206142527606.png" alt="image-20240206142527606"></p>
<hr>

<ul>
<li><p>查询</p>
<ul>
<li>查询当前数据库所有表：show tables;</li>
<li>查询表结构：desc 表名；</li>
<li>查询建表语句：show create table 表名；</li>
</ul>
</li>
</ul>
<hr>

<ul>
<li><p>修改</p>
<ul>
<li><p>添加字段：alter table 表名 add 字段名 类型（长度） [comment 注释] [约束];</p>
</li>
<li><p>修改字段类型：alter table 表名 modify 字段名 新数据类型（长度）;</p>
</li>
<li><p>修改字段名和字段类型：alter table 表名 change 旧字段名 新字段名 类型（长度） [comment 注释] [约束];</p>
</li>
<li><p>删除字段：alter table 表名 drop column 字段名;</p>
</li>
<li><p>修改表名：rename table 表名 to 新表名;</p>
</li>
<li><p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DDL：修改表结构</span></span><br><span class="line"><span class="comment">-- 修改：为表 tb_emp添加字段 qq varchar(11)</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp <span class="keyword">add</span> qq <span class="type">varchar</span>(<span class="number">11</span>) comment <span class="string">&#x27;QQ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改：修改表 tb_emp字段类型 qq varchar(13)</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp modify qq <span class="type">varchar</span>(<span class="number">11</span>) comment <span class="string">&#x27;QQ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改： 修改表 tb_emp 字段名 qq为 qq_num  varchar(13)</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp change qq qq_num <span class="type">varchar</span>(<span class="number">13</span>) comment <span class="string">&#x27;QQ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改：删除tb_emp的qq_num字段</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_emp <span class="keyword">drop</span> <span class="keyword">column</span>  qq_num;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改：将tb_emp表修改为 emp</span></span><br><span class="line">rename <span class="keyword">table</span> tb_emp <span class="keyword">to</span> emp;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>

<ul>
<li><p>删除</p>
<ul>
<li>删除表：drop table[if  exists] 表名;</li>
</ul>
</li>
</ul>
<h1 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h1><ul>
<li><p>插入数据（INSERT）</p>
<ul>
<li>指定字段添加数据： insert into 表名 （字段名1，字段名2）values(值1，值2);</li>
<li>全部字段添加数据： insert into 表名 values（值1，值2，。。。)</li>
<li>批量添加数据（指定字段）：insert into 表名（字段名 1，字段名2） values（值1，值2）（值1，值2）;</li>
<li>批量添加数据（全部字段）：insert into 表名 values（值1，值2，…)，（值1，值2，…);</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DML: 数据操作语言</span></span><br><span class="line"><span class="comment">-- DML：插入数据 - insert</span></span><br><span class="line"><span class="comment">-- 1. 为 emp 表的username, name, gender字段插入值</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp (username,name,gender,create_time,update_time) <span class="keyword">values</span> (<span class="string">&#x27;wuji&#x27;</span>,<span class="string">&#x27;张无忌&#x27;</span>,<span class="number">1</span>,now(),now());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 为emp表的所有字段插入值</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(id, username, password, name, gender, image, job, entrydate, create_time, update_time) <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;zhiruo&#x27;</span>,<span class="string">&#x27;123&#x27;</span>,<span class="string">&#x27;周芷若&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2010-01-01&#x27;</span>,now(),now());</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span> (<span class="keyword">null</span>, <span class="string">&#x27;zhiruo2&#x27;</span>,<span class="string">&#x27;123&#x27;</span>,<span class="string">&#x27;周芷若2&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2010-01-01&#x27;</span>,now(),now());</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 批量为emp表的username, name, gender字段插入值</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(username, name, image,  create_time, update_time) <span class="keyword">values</span> (<span class="string">&#x27;weifuwang&#x27;</span>,<span class="string">&#x27;韦一笑&#x27;</span>,<span class="number">1</span>,now(),now()),(<span class="string">&#x27;xieshiwang&#x27;</span>,<span class="string">&#x27;谢逊&#x27;</span>,<span class="number">1</span>,now(),now());</span><br></pre></td></tr></table></figure>



<p>注意事项：</p>
<ol>
<li><p>插入数据时，指定的字段顺序需要与值的顺序一一对应</p>
</li>
<li><p>字符串和日期型数据应该包含在引号中</p>
</li>
<li><p>插入的数据大小，应在字段的规定范围内</p>
</li>
</ol>
</li>
</ul>
<hr>

<ul>
<li><p>更新数据（UPDATE）</p>
<ul>
<li><p>修改数据： update 表名 set 字段1&#x3D;值1，字段2&#x3D;值2，… [where 条件]；</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- DML：更新数据 - update</span></span><br><span class="line"><span class="comment">-- 1. 将emp表的ID为1的员工，姓名name字段更新为‘张三’</span></span><br><span class="line"><span class="keyword">update</span> emp <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;张三&#x27;</span>,update_time<span class="operator">=</span>now() <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 将tb_emp表的所有员工的入职日期更改为‘2020-01-01’</span></span><br><span class="line"><span class="keyword">update</span> emp <span class="keyword">set</span> entrydate <span class="operator">=</span> <span class="string">&#x27;2010-01-01&#x27;</span>, update_time <span class="operator">=</span> now();</span><br></pre></td></tr></table></figure>

<hr></li>
</ul>
</li>
<li><p>删除数据（DELETE）</p>
<ul>
<li>删除数据： delete from 表名 where [条件];</li>
</ul>
<p>注意事项：</p>
<ol>
<li>DELETE语句的条件可以有，也可以没有，如果没有条件，则会删除整张表的所有数据。</li>
<li>DELETE语句不能删除某一个字段的值（如果要删除，可以使用UPDATE，该字段的值为NULL）.</li>
</ol>
</li>
</ul>
<hr>  

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206151657551.png" alt="image-20240206151657551"></p>
<h1 id="DQL-Data-query-language"><a href="#DQL-Data-query-language" class="headerlink" title="DQL(Data query language)"></a>DQL(Data query language)</h1><p>语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    字段列表</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    表名列表</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    条件列表</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    分组字段列表</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line">    分组后条件列表</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">    排序字段列表</span><br><span class="line">limit</span><br><span class="line">    分页参数</span><br></pre></td></tr></table></figure>

<ul>
<li>基本查询</li>
<li>条件查询（where）</li>
<li>分组查询（group by）</li>
<li>排序查询（order by）</li>
<li>分页查询（limit）</li>
</ul>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206200329379.png" alt="image-20240206200329379"></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240206201404182.png" alt="image-20240206201404182"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> name,entrydate <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> id, username, password, name, gender, image, job, entrydate, create_time, update_time <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- (不推荐，性能低)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询所有员工的name, entrydate, 起别名</span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">as</span> 姓名, entrydate <span class="keyword">as</span> 入职日期 <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询所有员工的name, entrydate, 起别名(别名有空格）</span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">as</span> <span class="string">&#x27;姓 名&#x27;</span>, entrydate <span class="keyword">as</span> 入职日期 <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 查询已有的员工关联了哪几种职位（不要重复）</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> job <span class="keyword">from</span> tb_emp;</span><br></pre></td></tr></table></figure>



<hr>

<ul>
<li><p>条件查询（where）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件列表;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>比较运算符</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&gt;&#x3D;</td>
<td>大于等于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&lt;&#x3D;</td>
<td>小于等于</td>
</tr>
<tr>
<td>&#x3D;</td>
<td>等于</td>
</tr>
<tr>
<td>&lt;&gt; 或 !&#x3D;</td>
<td>不等于</td>
</tr>
<tr>
<td>between … and …</td>
<td>在某个范围之内（含最小，最大值）</td>
</tr>
<tr>
<td>in(…)</td>
<td>在in之后的列表中的值，多选一</td>
</tr>
<tr>
<td>like 占位符</td>
<td>模糊匹配（_匹配单个字符，%匹配任意字符）</td>
</tr>
<tr>
<td>is null</td>
<td>是null</td>
</tr>
<tr>
<td>and 或 &amp;&amp;</td>
<td>并且（多个条件同时成立）</td>
</tr>
<tr>
<td>or 或 ||</td>
<td>或者（多个条件任意一个成立）</td>
</tr>
<tr>
<td>not 或 ||</td>
<td>非，不是</td>
</tr>
</tbody></table>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 查询姓名为金庸的员工</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;金庸&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 查询id小于等于5的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> id <span class="operator">&lt;=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询没有分配职位的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> job <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 查询有职位的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> job <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5. 查询密码不等于‘123456’的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> password <span class="operator">!=</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> password <span class="operator">&lt;&gt;</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 查询入职日在&#x27;2000-01-01&#x27;（包含）到&#x27;2020-01-01&#x27;(包含）之间的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="keyword">between</span> <span class="string">&#x27;2000-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2010-01-01&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&gt;=</span> <span class="string">&#x27;2000-01-01&#x27;</span> <span class="keyword">and</span> entrydate <span class="operator">&lt;=</span> <span class="string">&#x27;2010-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 7. 查询入职时间在&#x27;2000-01-01&#x27;（包含）到&#x27;2010-01-01&#x27;（包含）之间且性别为女的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="keyword">between</span> <span class="string">&#x27;2000-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2010-01-01&#x27;</span> <span class="keyword">and</span> gender <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 8. 查询职位是2（讲师），3（学工主管），4（教研主管）的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="number">2</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="number">3</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> job <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 9. 查询姓名为两个字的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;__&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 10. 查询姓‘张’的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;张%&#x27;</span>;</span><br></pre></td></tr></table></figure>



  <hr>

<ul>
<li><p>分组查询（group by）</p>
<p>聚合函数：将一列数据作为一个整体，进行纵向运算。</p>
<p>聚合查询语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 聚合函数（字段列表） <span class="keyword">from</span> 表名；</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>count</td>
<td>统计数量</td>
</tr>
<tr>
<td>max</td>
<td>最大值</td>
</tr>
<tr>
<td>min</td>
<td>最小值</td>
</tr>
<tr>
<td>avg</td>
<td>平均值</td>
</tr>
<tr>
<td>sum</td>
<td>求和</td>
</tr>
</tbody></table>
<p>示例说明：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1、统计该企业的员工数量 -- count</span></span><br><span class="line"><span class="comment">-- A. count(字段）</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(id) <span class="keyword">from</span> tb_emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(job) <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- B. count(常量)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">0</span>) <span class="keyword">from</span> tb_emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">from</span> tb_emp;</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="string">&#x27;a&#x27;</span>) <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- C. count(*)</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 统计该企业最早入职的员工 --min</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(entrydate) <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 统计该企业最晚入职的员工 --max</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(entrydate) <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 统计该企业员工ID的平均值 --avg</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(id) <span class="keyword">from</span> tb_emp;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项：</strong></p>
<ul>
<li>null值不参与所有聚合函数运算</li>
<li>统计数量可以使用：count(*) count(字段) count(常量)，推荐使用count(*)。</li>
</ul>
<hr>

<p>分组查询：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">group</span> <span class="keyword">by</span> 分组字段名 [<span class="keyword">having</span> 分组过滤条件];</span><br></pre></td></tr></table></figure>

<ul>
<li><p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 根据性别分组，统计男性和女性员工的数量 count(*)</span></span><br><span class="line"><span class="keyword">select</span> gender,<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_emp <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 先查询入职时间在 ’2015-01-01’(包含）以前的员工，并对结果根据职位分组，获取员工数量大于等于2的职位</span></span><br><span class="line"><span class="keyword">select</span> job, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&lt;=</span> <span class="string">&#x27;2015-01-01&#x27;</span> <span class="keyword">group</span> <span class="keyword">by</span> job <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>where和having的区别</p>
<ol>
<li>执行时机不同：where是分组之前进行过滤，不满足where条件，不参与分组；而having是分组之后对结果进行过滤。</li>
<li>判断条件不同：<font color="red">where不能对聚合函数判断，而having可以。</font></li>
</ol>
</li>
<li><p>注意事项</p>
<ul>
<li><font color="red">分组之后，查询的字段一般为聚合聚合函数和分组字段，查询其他字段无任何意义。</font></li>
<li>执行顺序：where &gt; 聚合函数 &gt; having。</li>
</ul>
</li>
</ul>
<hr>
</li>
<li><p>排序查询（order by）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">group</span> <span class="keyword">by</span> 分组字段名 [<span class="keyword">having</span> 分组过滤条件] <span class="keyword">order</span> <span class="keyword">by</span> 字段<span class="number">1</span> 排序方式<span class="number">1</span>, 字段<span class="number">2</span> 排序方式<span class="number">2</span>, ...;</span><br></pre></td></tr></table></figure>

<p>排序方式</p>
<ul>
<li>ASC：升序排序（默认）</li>
<li>DESC：降序排序</li>
</ul>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 根据入职时间，对员工进行升序排序 --asc</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">order</span> <span class="keyword">by</span> entrydate <span class="keyword">asc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 根据入职时间，对员工进行降序排序 --desc</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">order</span> <span class="keyword">by</span> entrydate <span class="keyword">desc</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. 根据入职时间，对员工进行升序排序，入职时间相同，再根据更新事件进行降序排序 --asc</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">order</span> <span class="keyword">by</span> entrydate, update_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<hr>
</li>
<li><p>分页查询（limit）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 limit 起始索引,查询记录数；</span><br></pre></td></tr></table></figure>

<p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1. 从起始索引0开始查询员工数据，每页展示5条数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp limit <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 查询第1页员工数据，每页展示5条数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp limit <span class="number">0</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询第2页员工数据，每页展示5条数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp limit <span class="number">5</span>, <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询第3页员工数据，每页展示5条数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp limit <span class="number">10</span>, <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<ol>
<li>起始索引从0开始，起始索引&#x3D;（查询页码 - 1）* 每页显示记录数。</li>
<li>分页查询是数据库的方言，不同数据库有不同的实现，MySQL是LIMIT。</li>
<li>如果查询的是第一页的数据，其实索引可以省略，可以简写为limit 10。</li>
</ol>
</li>
</ul>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 案例2-1：根据需求，完成员工性别信息的统计</span></span><br><span class="line"><span class="comment">-- 将1转化为男性员工，2转换为女性员工</span></span><br><span class="line"><span class="comment">-- if(条件表达式, true取值, false取值)</span></span><br><span class="line"><span class="keyword">select</span> if(gender<span class="operator">=</span> <span class="number">1</span>,<span class="string">&#x27;男性员工&#x27;</span>,<span class="string">&#x27;女性员工&#x27;</span>) 性别, <span class="built_in">count</span>(gender) 数量 <span class="keyword">from</span> tb_emp <span class="keyword">group</span> <span class="keyword">by</span> (gender);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 案例2-2：根据需求，完成员工职位信息的统计</span></span><br><span class="line"><span class="comment">-- case 表达式 when 值1 then 结果1 when 值2 then 结果2 ... else ... end</span></span><br><span class="line"><span class="keyword">select</span> (<span class="keyword">case</span> job <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span> <span class="string">&#x27;班主任&#x27;</span> <span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;讲师&#x27;</span> <span class="keyword">when</span> <span class="number">3</span> <span class="keyword">then</span> <span class="string">&#x27;学工主管&#x27;</span> <span class="keyword">when</span> <span class="number">4</span> <span class="keyword">then</span> <span class="string">&#x27;教研主管&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;未分配职位&#x27;</span> <span class="keyword">end</span>) 职位, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> tb_emp <span class="keyword">group</span> <span class="keyword">by</span> job;</span><br></pre></td></tr></table></figure>

<p>函数：</p>
<ul>
<li>if(表达式,tvalue,fvalue):当表达式为true时，取值tvalue；当表达式为false时，取值fvalue;</li>
<li>case expr when value1 then result1 [when value2 then result2 …][else result] end</li>
</ul>
<h1 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h1><ul>
<li>字段1 [as] 别名1，字段2 [as] 别名2，…</li>
</ul>
<h1 id="多表模式"><a href="#多表模式" class="headerlink" title="多表模式"></a>多表模式</h1><ul>
<li><p>一对多（多对一）</p>
<p>外键：给A中的某个字段加外键（B中某个字段），意味着A中该字段的值要在B中该字段范围内取值。</p>
<p>实现细节：在数据库表中多的一方，添加字段，来关联一方的主键。（使用外键约束建立表联系）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建表时的指定方式</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">    字段名 数据类型,</span><br><span class="line">    ...</span><br><span class="line">    [<span class="keyword">constraint</span>][外键名称] <span class="keyword">foreign</span> key(外键字段名) <span class="keyword">references</span> 主表（字段名）</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 建完表后的执行方式，添加外键</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> <span class="keyword">constraint</span> 外键名称 <span class="keyword">foreign</span> key(外键字段名) <span class="keyword">references</span> 主表（字段名）;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240207164619163.png" alt="image-20240207164619163"></p>
<p><strong>物理外键</strong></p>
<p>概念：使用foreign  key定义外键关联另外一张表</p>
<p>缺点：</p>
<ul>
<li>影响增、删、改的效率（需要检查外键关系）。</li>
<li>仅用于单节点数据库 ，不适用与分布式、集群场景。</li>
<li>容易引发数据库的死锁问题，消耗性能。</li>
</ul>
<p><strong>逻辑外键（推荐）</strong></p>
<p>概念：在业务逻辑中，解决外键关联。</p>
<p>通过逻辑外键，就可以很方便的解决上述问题。</p>
</li>
<li><p>一对一</p>
<p>案例：用户与身份证信息的关系</p>
<p>关系：一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他字段放在另一张表中，以提升操作效率</p>
</li>
</ul>
<p>​		实现：<font color="red">在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（UNIQUE）</font></p>
<ul>
<li><p>多对多</p>
<p>案例：学生与课程的关系</p>
<p>关系：一个学生可以选修多门课程，一门课程也可以供多个学生选择</p>
<p>实现：建立第三张中间表，中间表中至少包含两个外键，分别关联两方主键</p>
</li>
</ul>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240207174539789.png" alt="image-20240207174539789"></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240207175403377.png" alt="image-20240207175403377"></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240207181108591.png" alt="image-20240207181108591"></p>
<h1 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h1><ul>
<li><p>多表查询：指从多张表中查询数据。</p>
</li>
<li><p>笛卡尔积：笛卡尔乘积是指数学中，两个集合的所有组合情况。</p>
</li>
<li><p>分类</p>
<ul>
<li><p>内连接：相当于查询A、B交集部分数据</p>
<p>语法：</p>
<ul>
<li><p>隐式内连接：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span>，表<span class="number">2</span> <span class="keyword">where</span> 条件 ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实例</span></span><br><span class="line"><span class="comment">-- A. 查询员工的姓名，及所属的部门名称（隐式内连接实现）</span></span><br><span class="line"><span class="keyword">select</span> tb_dept.name,tb_emp.name <span class="keyword">from</span> tb_emp, tb_dept <span class="keyword">where</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 起别名</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp e, tb_dept d <span class="keyword">where</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>
</li>
<li><p>显式内连接：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> [<span class="keyword">inner</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 连接条件 ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 实例</span></span><br><span class="line"><span class="comment">-- B. 查询员工的姓名，及所属的部门名称（显式内连接实现）</span></span><br><span class="line"><span class="keyword">select</span> tb_emp.name,tb_dept.name <span class="keyword">from</span> tb_emp <span class="keyword">inner</span> <span class="keyword">join</span> tb_dept <span class="keyword">on</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>外连接：</p>
<ul>
<li><p>左外连接：查询左表所有数据（包括两张表交集部分的数据）(经常使用)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">left</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 连接条件 ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- A. 查询员工表所有员工的姓名，相对应的部门名称（左外连接）</span></span><br><span class="line"><span class="keyword">select</span> e.name, d.name <span class="keyword">from</span> tb_emp e <span class="keyword">left</span> <span class="keyword">join</span> tb_dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure>
</li>
<li><p>右外连接：查询右表所有数据（包括两张表交集部分的数据）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">right</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 连接条件 ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- B. 查询部门表所有部门的名称，和对应的员工名称（右外连接）</span></span><br><span class="line"><span class="keyword">select</span> e.name,d.name <span class="keyword">from</span> tb_emp e <span class="keyword">right</span> <span class="keyword">join</span> tb_dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>子查询</p>
<ul>
<li><p>SQL语句中嵌套select语句，称为嵌套查询，又称子查询。</p>
</li>
<li><p>形式：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t1 <span class="keyword">where</span> column1 <span class="operator">=</span> (<span class="keyword">select</span> column1 <span class="keyword">from</span> t2 ... );</span><br></pre></td></tr></table></figure>
</li>
<li><p>子查询外部的语句可以是 insert&#x2F;update&#x2F;delete&#x2F;select中的任何一个，最常见的是select。</p>
</li>
<li><p>分类</p>
<ul>
<li><p>标量子查询：子查询返回的结果为单个值</p>
<ul>
<li><p>子查询返回的结果是单个值（数字、字符串、日期等），最简单的形式</p>
</li>
<li><p>最常见的操作符： &#x3D;   &lt;&gt;   &gt;   &gt;&#x3D;   &lt;   &lt;&#x3D;</p>
<p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- A. 查询 “教研部”的所有员工信息</span></span><br><span class="line"><span class="comment">-- a. 查询教研部的ID - tb_dept（标量子查询）</span></span><br><span class="line"><span class="keyword">select</span>  id  <span class="keyword">from</span> tb_dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;教研部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b. 查询教研部ID下的员工信息 tb_emp</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span>  dept_id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span>  dept_id <span class="operator">=</span> (<span class="keyword">select</span>  id  <span class="keyword">from</span> tb_dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;教研部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- B. 查询在”方东白“入职之前的员工信息</span></span><br><span class="line"><span class="comment">-- a. 查询方东白的入职时间（单行单列值）</span></span><br><span class="line"><span class="keyword">select</span> entrydate <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;方东白&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b. 查询在“方东白”入职之后的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&gt;</span> <span class="string">&#x27;2012-11-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&gt;</span> (<span class="keyword">select</span> entrydate <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;方东白&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>列子查询：子查询返回的结果为一列</p>
<ul>
<li><p>子查询返回的结果是一列（可以是多行 ）</p>
</li>
<li><p>常用的操作符：in、not in等</p>
</li>
<li><p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 列子查询</span></span><br><span class="line"><span class="comment">-- A. 查询”教研部“和”咨询部“的所有员工信息</span></span><br><span class="line"><span class="comment">-- a. 查询教研部和咨询部的ID</span></span><br><span class="line"><span class="keyword">select</span> id  <span class="keyword">from</span> tb_dept <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;教研部&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;咨询部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- b. 根据部门ID，查询该部门下的员工信息 tb_emp</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> dept_id <span class="keyword">in</span> (<span class="number">2</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> dept_id <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> id  <span class="keyword">from</span> tb_dept <span class="keyword">where</span> name <span class="operator">=</span><span class="string">&#x27;教研部&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;咨询部&#x27;</span></span><br><span class="line">    );</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>行子查询：子查询返回的结果为一行</p>
<ul>
<li><p>子查询返回的结果是一行（可以是多列）</p>
</li>
<li><p>常用的操作符： &#x3D;、&lt;&gt;、innot in</p>
</li>
<li><p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- A. 查询与“韦一笑”的入职日期及值为都相同的员工信息；</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- a. 查询“韦一笑”的入职日期及职位</span></span><br><span class="line"><span class="keyword">select</span> entrydate,job <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;韦一笑&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b. 查询与其入职日期及职位都相同的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> (entrydate,job) <span class="operator">=</span> (<span class="keyword">select</span> entrydate,job <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;韦一笑&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>表子查询：子查询返回的结果为多行多列</p>
<ul>
<li><p>子查询返回的结果是多行多列，常作为临时表</p>
</li>
<li><p>常用的操作符：in</p>
</li>
<li><p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 表子查询</span></span><br><span class="line"><span class="comment">-- A. 查询入职日期是“2006-01-01”之后的员工信息，及其部门名称</span></span><br><span class="line"><span class="comment">-- a.查询入职日期是”2006-01-01“之后的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&gt;</span> <span class="string">&#x27;2006-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b.查询这部分员工信息及其部门名称 - tb_dept</span></span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>,d.name <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&gt;</span> <span class="string">&#x27;2006-01-01&#x27;</span>) e, tb_dept d <span class="keyword">where</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>实操</strong></p>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240208165030152.png" alt="image-20240208165030152"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 部门管理</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_dept</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">    name        <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;部门名称&#x27;</span>,</span><br><span class="line">    create_time datetime    <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    update_time datetime    <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_dept (id, name, create_time, update_time)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;学工部&#x27;</span>, now(), now()),</span><br><span class="line">       (<span class="number">2</span>, <span class="string">&#x27;教研部&#x27;</span>, now(), now()),</span><br><span class="line">       (<span class="number">3</span>, <span class="string">&#x27;咨询部&#x27;</span>, now(), now()),</span><br><span class="line">       (<span class="number">4</span>, <span class="string">&#x27;就业部&#x27;</span>, now(), now()),</span><br><span class="line">       (<span class="number">5</span>, <span class="string">&#x27;人事部&#x27;</span>, now(), now());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 员工管理</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_emp</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span> unsigned <span class="keyword">primary</span> key auto_increment comment <span class="string">&#x27;ID&#x27;</span>,</span><br><span class="line">    username    <span class="type">varchar</span>(<span class="number">20</span>)      <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    password    <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">default</span> <span class="string">&#x27;123456&#x27;</span> comment <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">    name        <span class="type">varchar</span>(<span class="number">10</span>)      <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    gender      tinyint unsigned <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;性别, 说明: 1 男, 2 女&#x27;</span>,</span><br><span class="line">    image       <span class="type">varchar</span>(<span class="number">300</span>) comment <span class="string">&#x27;图像&#x27;</span>,</span><br><span class="line">    job         tinyint unsigned comment <span class="string">&#x27;职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师&#x27;</span>,</span><br><span class="line">    entrydate   <span class="type">date</span> comment <span class="string">&#x27;入职时间&#x27;</span>,</span><br><span class="line">    dept_id     <span class="type">int</span> unsigned comment <span class="string">&#x27;部门ID&#x27;</span>,</span><br><span class="line">    create_time datetime         <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">    update_time datetime         <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;修改时间&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tb_emp</span><br><span class="line">(id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;jinyong&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;金庸&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;1.jpg&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;2000-01-01&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">2</span>, <span class="string">&#x27;zhangwuji&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;张无忌&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;2.jpg&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2015-01-01&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">3</span>, <span class="string">&#x27;yangxiao&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;杨逍&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;3.jpg&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2008-05-01&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">4</span>, <span class="string">&#x27;weiyixiao&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;韦一笑&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;4.jpg&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2007-01-01&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">5</span>, <span class="string">&#x27;changyuchun&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;常遇春&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;5.jpg&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2012-12-05&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">6</span>, <span class="string">&#x27;xiaozhao&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;小昭&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;6.jpg&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;2013-09-05&#x27;</span>, <span class="number">1</span>, now(), now()),</span><br><span class="line">       (<span class="number">7</span>, <span class="string">&#x27;jixiaofu&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;纪晓芙&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;7.jpg&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;2005-08-01&#x27;</span>, <span class="number">1</span>, now(), now()),</span><br><span class="line">       (<span class="number">8</span>, <span class="string">&#x27;zhouzhiruo&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;周芷若&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;8.jpg&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;2014-11-09&#x27;</span>, <span class="number">1</span>, now(), now()),</span><br><span class="line">       (<span class="number">9</span>, <span class="string">&#x27;dingminjun&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;丁敏君&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;9.jpg&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;2011-03-11&#x27;</span>, <span class="number">1</span>, now(), now()),</span><br><span class="line">       (<span class="number">10</span>, <span class="string">&#x27;zhaomin&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;赵敏&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;10.jpg&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;2013-09-05&#x27;</span>, <span class="number">1</span>, now(), now()),</span><br><span class="line">       (<span class="number">11</span>, <span class="string">&#x27;luzhangke&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;鹿杖客&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;11.jpg&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;2007-02-01&#x27;</span>, <span class="number">3</span>, now(), now()),</span><br><span class="line">       (<span class="number">12</span>, <span class="string">&#x27;hebiweng&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;鹤笔翁&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;12.jpg&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;2008-08-18&#x27;</span>, <span class="number">3</span>, now(), now()),</span><br><span class="line">       (<span class="number">13</span>, <span class="string">&#x27;fangdongbai&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;方东白&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;13.jpg&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;2012-11-01&#x27;</span>, <span class="number">3</span>, now(), now()),</span><br><span class="line">       (<span class="number">14</span>, <span class="string">&#x27;zhangsanfeng&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;张三丰&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;14.jpg&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2002-08-01&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">15</span>, <span class="string">&#x27;yulianzhou&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;俞莲舟&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;15.jpg&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2011-05-01&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">16</span>, <span class="string">&#x27;songyuanqiao&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;宋远桥&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;16.jpg&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;2007-01-01&#x27;</span>, <span class="number">2</span>, now(), now()),</span><br><span class="line">       (<span class="number">17</span>, <span class="string">&#x27;chenyouliang&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;陈友谅&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;17.jpg&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;2015-03-21&#x27;</span>, <span class="keyword">NULL</span>, now(), now());</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp,</span><br><span class="line">     tb_dept;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tb_emp.name, tb_dept.name</span><br><span class="line"><span class="keyword">from</span> tb_emp,</span><br><span class="line">     tb_dept</span><br><span class="line"><span class="keyword">where</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tb_emp.name, tb_dept.name</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line">         <span class="keyword">join</span> tb_dept <span class="keyword">on</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tb_emp.name, tb_dept.name</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line">         <span class="keyword">left</span> <span class="keyword">join</span> tb_dept <span class="keyword">on</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tb_emp.name, tb_dept.name</span><br><span class="line"><span class="keyword">from</span> tb_dept</span><br><span class="line">         <span class="keyword">left</span> <span class="keyword">join</span> tb_emp <span class="keyword">on</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tb_emp.name, tb_dept.name</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line">         <span class="keyword">right</span> <span class="keyword">join</span> tb_dept <span class="keyword">on</span> tb_emp.dept_id <span class="operator">=</span> tb_dept.id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> tb_dept.id</span><br><span class="line"><span class="keyword">from</span> tb_dept</span><br><span class="line"><span class="keyword">where</span> tb_dept.name <span class="operator">=</span> <span class="string">&#x27;教研部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> dept_id <span class="operator">=</span> (<span class="keyword">select</span> tb_dept.id <span class="keyword">from</span> tb_dept <span class="keyword">where</span> tb_dept.name <span class="operator">=</span> <span class="string">&#x27;教研部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> entrydate</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;方东白&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> entrydate <span class="operator">&gt;=</span> (<span class="keyword">select</span> entrydate <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;方东白&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> id</span><br><span class="line"><span class="keyword">from</span> tb_dept</span><br><span class="line"><span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;教研部&#x27;</span></span><br><span class="line">   <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;咨询部&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> dept_id <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> tb_dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;教研部&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;咨询部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> entrydate, job</span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;韦一笑&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> (entrydate, job) <span class="operator">=</span> (<span class="keyword">select</span> entrydate, job <span class="keyword">from</span> tb_emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;韦一笑&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> tb_emp</span><br><span class="line"><span class="keyword">where</span> entrydate <span class="operator">&gt;</span> <span class="string">&#x27;2006-01-01&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.name</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> entrydate <span class="operator">&gt;</span> <span class="string">&#x27;2006-01-01&#x27;</span>) e,</span><br><span class="line">     tb_dept d</span><br><span class="line"><span class="keyword">where</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. 查询价格低于10元的菜品的名称、价格及其菜品的分类名称。</span></span><br><span class="line"><span class="keyword">select</span> d.name, d.price, c.name</span><br><span class="line"><span class="keyword">from</span> dish d,</span><br><span class="line">     category c</span><br><span class="line"><span class="keyword">where</span> d.category_id <span class="operator">=</span> c.id</span><br><span class="line">  <span class="keyword">and</span> d.price <span class="operator">&lt;</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 查询所有价格在10元（含）到50元（含）之间且状态为起售的菜品，展示出菜品的名称、价格及其菜品的分类名称（及时菜品没有分类，也需要将菜品查询出来）</span></span><br><span class="line"><span class="keyword">select</span> d.name, d.price, c.name</span><br><span class="line"><span class="keyword">from</span> dish d</span><br><span class="line">         <span class="keyword">left</span> <span class="keyword">join</span> category c <span class="keyword">on</span> d.price <span class="keyword">between</span> <span class="number">10</span> <span class="keyword">and</span> <span class="number">50</span> <span class="keyword">and</span> d.status <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> c.id <span class="operator">=</span> d.category_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 查询每个分类下最贵的菜品，展示出分类的名称、最贵的菜品的价格。</span></span><br><span class="line"><span class="keyword">select</span> c.name, <span class="built_in">max</span>(d.price)</span><br><span class="line"><span class="keyword">from</span> dish d,</span><br><span class="line">     category c</span><br><span class="line"><span class="keyword">where</span> d.category_id <span class="operator">=</span> c.id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.name;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4.查询各个分类下，菜品状态为“起售”,并且该分类下菜品总数量大于等于3的分类名称。</span></span><br><span class="line"><span class="keyword">select</span> c.name, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> category c,</span><br><span class="line">     dish d</span><br><span class="line"><span class="keyword">where</span> c.id <span class="operator">=</span> d.category_id</span><br><span class="line">  <span class="keyword">and</span> d.status <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.name</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5.查询&quot;商务套餐A&quot;中包含了哪些菜品（展示出套餐名称、价格、包含的菜品名称、价格、份数）</span></span><br><span class="line"><span class="keyword">select</span> s.name, s.price, d.name, d.price, sd.copies</span><br><span class="line"><span class="keyword">from</span> setmeal s,</span><br><span class="line">     setmeal_dish sd,</span><br><span class="line">     dish d</span><br><span class="line"><span class="keyword">where</span> s.id <span class="operator">=</span> sd.setmeal_id</span><br><span class="line">  <span class="keyword">and</span> d.id <span class="operator">=</span> sd.dish_id</span><br><span class="line">  <span class="keyword">and</span> s.name <span class="operator">=</span> <span class="string">&#x27;商务套餐A&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6. 查询出低于菜品平均价格的菜品信息（展示出菜品名称、菜品价格）</span></span><br><span class="line"><span class="keyword">select</span> d.name, d.price</span><br><span class="line"><span class="keyword">from</span> dish d</span><br><span class="line"><span class="keyword">where</span> d.price <span class="operator">&lt;</span> (<span class="keyword">select</span> <span class="built_in">avg</span>(d.price) <span class="keyword">from</span> dish d);</span><br></pre></td></tr></table></figure>



<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><ul>
<li><p>概念</p>
<p>事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。</p>
<blockquote>
<p>注意事项，默认MySQL的事务是自动提交的，也就是说，当执行一条DML语句，MySQL会立即隐式的提交事务。</p>
</blockquote>
</li>
<li><p>事务控制</p>
<ul>
<li>开启事务：start transaction; &#x2F; begin；</li>
<li>提交事务：commit；</li>
<li>回滚事务：rollback；</li>
</ul>
</li>
<li><p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">start</span> transaction ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除学工部</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tb_dept <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除部门下的员工</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tb_emp <span class="keyword">where</span> dept_id <span class="operator">=</span><span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交事务</span></span><br><span class="line"><span class="keyword">commit</span> ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>特性</p>
<ul>
<li>原子性：事务是不可分割的最小单元，要么全部成功 ，要么全部失败</li>
<li>一致性：事务完成时，必须使所有的数据都保持一致状态</li>
<li>隔离性：数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行</li>
<li>持久性：事务一旦提交或回滚，它对数据库中的数据改变就是永久的</li>
</ul>
</li>
</ul>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><ul>
<li><p>概念：索引使帮助数据库高校获取数据的数据结构。</p>
</li>
<li><p>优点：</p>
<ul>
<li><p>提升数据库查询的效率，降低数据库的IO成本</p>
</li>
<li><p>通过索引对数据进行排序，降低数据排序的成本，降低CPU消耗</p>
</li>
</ul>
</li>
<li><p>缺点：</p>
<ul>
<li>索引会占用存储空间。（存储空间问题不大）</li>
<li>索引大大提高了查询效率，同时也降低了insert，update，delete的效率。（查询占据90%以上的工作量）</li>
</ul>
</li>
<li><p>结构：</p>
<p>MySQL数据库支持的索引结构有很多，如：Hash索引，B+Tree索引，Full-Text索引等。我们平常说的索引，如果没有特别指明 ，都是指默认的B+Tree结构组织的索引。</p>
<blockquote>
<p>采用二叉搜索树或红黑树，会导致大数据量情况下，层级深，检索速度慢。</p>
</blockquote>
<ul>
<li><p>B+ Tree(多路平衡搜索树)</p>
<ul>
<li>每一个节点，可以存储多个key(有n个key，就有n个指针)。</li>
<li>所有数据都存储在叶子节点，非叶子节点仅用于索引数据。</li>
<li>叶子节点形成一颗双向链表，便于数据的排序及区间范围查询。</li>
</ul>
<p><img src="/2024/02/06/javaweb-day03-mysql/image-20240208173844570.png" alt="image-20240208173844570"></p>
</li>
</ul>
</li>
<li><p>语法</p>
<ul>
<li><p>创建索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span>] index 索引名 <span class="keyword">on</span> 表名(字段名,...)；</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除索引</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> index 索引名 <span class="keyword">on</span> 表名;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>实例</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 创建：为 tb_emp表的name字段建立一个索引</span></span><br><span class="line"><span class="keyword">create</span> index idx_emp_name <span class="keyword">on</span> tb_emp(name);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询：查询tb_emp表的索引信息</span></span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> tb_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除：删除tb_emp表中name字段的索引</span></span><br><span class="line"><span class="keyword">drop</span> index idx_emp_name <span class="keyword">on</span> tb_emp;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意事项</p>
<ul>
<li>主键字段，在建表时，会自动创建主键索引。</li>
<li>添加唯一约束时，数据库实际上会添加唯一索引。</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>javaweb-day02-springbootweb请求响应</title>
    <url>/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205175737760.png" alt="image-20240205175737760"></p>
<ol>
<li><p>通过浏览器访问服务器，请求结束后返回响应结果</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205175907200.png" alt="image-20240205175907200"></p>
<p>之前编写的Controller只是简单的java类，没有实现任何的接口或者继承任何类，这个类Tomcat是不识别的，也不能直接运行，Tomcat虽然不识别自己编写的Controller，但是识别Servlet容器。</p>
<p>前段浏览器发起的请求都会经过DispatcherServlet，它会转给各个Controller，由Controller处理请求，将请求处理后的结果返回给DispatcherServlet，由于它的重要性，我们将其称为前端控制器。</p>
<ul>
<li>Web服务器将浏览器发来的数据进行解析，得到HttpServletRequest</li>
<li>将解析的处理结果处理为HttpServltResponse返回给浏览器</li>
</ul>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205180637734.png" alt="image-20240205180637734"></p>
</li>
<li><p>客户端通过HTTP协议与浏览器进行交流</p>
</li>
</ol>
<h1 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h1><h2 id="请求工具"><a href="#请求工具" class="headerlink" title="请求工具"></a>请求工具</h2><p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205181106830.png" alt="image-20240205181106830"></p>
<p><strong>postman</strong></p>
<p>postman是一款功能强大的网页调试与发送网页HTPP请求的Chrome插件。</p>
<p>作用：常用于进行接口测试。</p>
<h2 id="简单参数"><a href="#简单参数" class="headerlink" title="简单参数"></a>简单参数</h2><ul>
<li><p>原始方式</p>
<p>在原始的web程序中，获取请求参数，需要通过HttpServletRequest对象手动获取。</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205181550921.png" alt="image-20240205181550921"></p>
</li>
</ul>
<p>​		缺点：操作方式比较繁琐，需要将HttpServletRequest进行类型转换</p>
<ul>
<li><p>Springboot方式（下面左侧黄色部分是sprinboot接受简单参数的函数编写方式，右侧是postman分别使用get和post请求方式的发送效果），<font color="red">只要形参名和发送参数名一致就可自动接收成功。</font></p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205183539465.png" alt="image-20240205183539465"></p>
</li>
</ul>
<p>​	如果方法形参名称与请求参数名称不匹配，可以使用@RequestParam完成映射。</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205184136093.png" alt="image-20240205184136093"></p>
<p>注意事项：@RequestParam中的required属性默认为True，代表该请求参数必须传递，如果不传递将报错。如果该参数是可以选择的，可以将required的属性设置为false。</p>
<p>总结：</p>
<ol>
<li><p>原始方法获取请求参数</p>
<ul>
<li>Controller方法形参中声明HttpServletRequest对象</li>
<li>调用对象的getParameter(参数名)</li>
</ul>
</li>
<li><p>SpringBoot中接受简单参数</p>
<ul>
<li>请求参数名与方法形参变量名相同</li>
<li>会自动进行类型转换</li>
</ul>
</li>
<li><p>@RequestParam注解</p>
<ul>
<li>方法形参名称与请求参数名称不匹配</li>
<li>该注解的required属性默认是true，代表请求参数必须传递</li>
</ul>
</li>
</ol>
<h2 id="实体参数（应对简单参数数量过多的情况）"><a href="#实体参数（应对简单参数数量过多的情况）" class="headerlink" title="实体参数（应对简单参数数量过多的情况）"></a>实体参数（应对简单参数数量过多的情况）</h2><ul>
<li><p>简单实体对象：请求参数名与形参对象属性名相同，定义POJO接受即可。</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205185118298.png" alt="image-20240205185118298"></p>
</li>
</ul>
<h2 id="复杂实体参数（应对参数非简单类型的情况）"><a href="#复杂实体参数（应对参数非简单类型的情况）" class="headerlink" title="复杂实体参数（应对参数非简单类型的情况）"></a>复杂实体参数（应对参数非简单类型的情况）</h2><ul>
<li><p>复杂实体对象：请求参数名与形参对象属性名相同，按照对象层次结构关系即可接收嵌套POJO属性参数。（<font color="red">与简单实体参数一致，只要保证对应的嵌套关系不发生变化即可</font>）</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205190319798.png" alt="image-20240205190319798"></p>
</li>
</ul>
<h2 id="数组集合参数（形参可以是数组或者集合）"><a href="#数组集合参数（形参可以是数组或者集合）" class="headerlink" title="数组集合参数（形参可以是数组或者集合）"></a>数组集合参数（形参可以是数组或者集合）</h2><ul>
<li><p>数组参数：请求参数与形参数组名称相同且请求参数为多个，定义数组类型形参即可接收参数</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205190631950.png" alt="image-20240205190631950"></p>
</li>
<li><p>集合参数：请求参数名与形参集合名称相同且请求参数为多个，@RequestParam绑定参数关系。</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205191132398.png" alt="image-20240205191132398"></p>
</li>
</ul>
<h2 id="日期参数"><a href="#日期参数" class="headerlink" title="日期参数"></a>日期参数</h2><ul>
<li><p>日期参数：使用@DateTimeFormat注解完成日期参数格式转换</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205191314005.png" alt="image-20240205191314005"></p>
</li>
</ul>
<h2 id="Json参数"><a href="#Json参数" class="headerlink" title="Json参数"></a>Json参数</h2><ul>
<li><p>JSON参数：JSON数据键名与形参对象属性名相同，定义POJO类型形参即可接收参数，需要使用@RequestBody标识</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205192029505.png" alt="image-20240205192029505"></p>
</li>
</ul>
<h2 id="路径参数"><a href="#路径参数" class="headerlink" title="路径参数"></a>路径参数</h2><ul>
<li><p>路径参数：通过请求URL直接传递参数，使用{…}来表示该路径参数，需要使用@PathVariable获取路径参数</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205192557467.png" alt="image-20240205192557467"></p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205192747492.png" alt="image-20240205192747492"></p>
<h1 id="响应数据-允许返回各种类型的数据"><a href="#响应数据-允许返回各种类型的数据" class="headerlink" title="响应数据(允许返回各种类型的数据)"></a>响应数据(允许返回各种类型的数据)</h1><p>浏览器发起请求后服务器响应会返回响应的数据。</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205193201481.png" alt="image-20240205193201481"></p>
<p>@ResponseBody（将方法的返回值直接作为响应数据响应给客户端浏览器）</p>
<ul>
<li>类型：方法注解、类注解</li>
<li>位置：Controller方法上&#x2F;类上</li>
<li>作用：将方法返回值直接响应，<font color="red">如果返回值类型是实体对象&#x2F;集合，将会转化为JSON格式响应</font></li>
<li>说明：@RestController&#x3D;@Controller+@ResponseBody</li>
</ul>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205194650624.png" alt="image-20240205194650624"></p>
<p>由于不同页面的解析结果不同，为了便于管理，提出了以下的统一响应结果</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205194823402.png" alt="image-20240205194823402"></p>
<p><strong>总结</strong></p>
<ol>
<li><p>@ResponseBody</p>
<p>位置：Controller类上&#x2F;方法上</p>
<p>作用：将方法返回值直接响应，若返回值类型是实体对象&#x2F;集合，转JSON格式响应</p>
</li>
<li><p>统一响应结果</p>
<p>Result(code, msg, data)</p>
</li>
</ol>
<p><strong>案例</strong></p>
<p>获取员工数据，返回统一响应结果，在页面渲染展示</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205195526399.png" alt="image-20240205195526399"></p>
<p>步骤</p>
<ol>
<li>在pom.xml文件中引入dom4j的依赖，用于解析XML文件</li>
<li>引入资料中提供的解析XML的工具类XMLParserUtils，对应的实体类Emp，XML文件emp.xml</li>
<li>引入资料中提供的静态页面文件，放到resources下的static目录下</li>
<li>编写Controller程序，处理请求，响应数据</li>
</ol>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205200314718.png" alt="image-20240205200314718"></p>
<h1 id="分层解耦"><a href="#分层解耦" class="headerlink" title="分层解耦"></a>分层解耦</h1><h2 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h2><p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205220155037.png" alt="image-20240205220155037"></p>
<p>三层架构</p>
<ul>
<li><p>controller：控制层，接收前端发起的请求，对请求进行处理，并响应数据</p>
</li>
<li><p>service：业务逻辑层，处理具体的业务逻辑。</p>
</li>
<li><p>dao：数据访问层（Data Access Object）（持久层），负责数据访问操作，包括数据的增删改查。</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205220322441.png" alt="image-20240205220322441"></p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205221510610.png" alt="image-20240205221510610"></p>
</li>
</ul>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205221614917.png" alt="image-20240205221614917"></p>
<h2 id="分层解耦-1"><a href="#分层解耦-1" class="headerlink" title="分层解耦"></a>分层解耦</h2><ul>
<li>内聚：软件中各个功能模块内部的功能联系。</li>
<li>耦合：衡量软件中各个层&#x2F;模块之间的依赖、关联程度。</li>
<li>软件设计原则：高内聚低耦合。</li>
</ul>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205222503596.png" alt="image-20240205222503596"></p>
<p><font color="red">目前的controller层和service层是耦合的，service层发生变动会导致controller层的代码也要做出相应的调整。</font></p>
<p><font color="red">于是springboot出现了容器的概念，容器存放创建的对象，controller需要什么样的service对象就从容器中提取。要实现这一步，需要解决两个问题，如何将service层的对象装入容器中，如何从controller层读取容器的内容。分别对应了两个问题，控制反转和依赖注入。</font></p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205223108844.png" alt="image-20240205223108844"></p>
<p>控制反转：Inversion Of Control，简称<font color="red">IOC</font>。对象的创建控制权是由程序自身转移到外部（容器）这种思想称为控制反转。</p>
<p>依赖注入：Dependency Injection，简称<font color="red">DI</font>。容器为应用程序提供运行时，所依赖的资源，称为依赖注入。</p>
<p>Bean对象：IOC容器中创建、管理的对象，称之为<font color="red">bean</font>。</p>
<h2 id="IOC-DI-入门"><a href="#IOC-DI-入门" class="headerlink" title="IOC &amp;  DI 入门"></a>IOC &amp;  DI 入门</h2><ol>
<li>Service层及Dao层的实现类，交给IOC容器管理。</li>
<li>为Controller及Service注入运行时，依赖的对象。</li>
<li>运行测试。</li>
</ol>
<p>实现机制</p>
<p>给EmpServer层和EmpDao层对应的类加上注释@Component，表示将当前类交给IOC容器管理，称为IOC容器红的Bean对象。完成了控制反转。</p>
<p>给Controller层的service变量和EmpService层的dao对象加上@Autowired注释，表示运行时，IOC容器会提供该类型的Bean对象，并赋值给该变量，完成了依赖注入。</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205224114750.png" alt="image-20240205224114750"></p>
<h2 id="IOC详解（控制反转）"><a href="#IOC详解（控制反转）" class="headerlink" title="IOC详解（控制反转）"></a>IOC详解（控制反转）</h2><p>Bean的声明</p>
<p>要把某个对象交给IOC容器管理，需要在对应的类上加上如下的注释之一：</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
<th>位置</th>
</tr>
</thead>
<tbody><tr>
<td>@Component</td>
<td>声明bean的基础注解</td>
<td>不属于以下三类时，用此注解</td>
</tr>
<tr>
<td>@Controller</td>
<td>@Component的衍生注解</td>
<td>标注在控制器类上</td>
</tr>
<tr>
<td>@Service</td>
<td>@Component的衍生注解</td>
<td>标注在业务类上</td>
</tr>
<tr>
<td>@Repository</td>
<td>@Component的衍生注解</td>
<td>标注在数据访问类上（由于与mybatis整合，用的较少）</td>
</tr>
</tbody></table>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205230749072.png" alt="image-20240205230749072"></p>
<p>注意事项</p>
<ul>
<li>声明Bean的时候，可以通过value属性指定Bean的名字，如果没有指定，默认为类名首字母小写。</li>
<li>使用以上四个注释都可以声明bean，但是在springboot继承web开发中，Controller层声明的bean只能用Controller注释。</li>
</ul>
<p><strong>Bean组件扫描</strong></p>
<ul>
<li><p>前面声明bean的四大注解，要想生效，还需要被组件扫描注解@ComponentScan扫描。</p>
</li>
<li><p>@ComponentScan注解虽然没有显式配置，但是实际上已经包含在了启动类声明注解@SpringBootApplication中，默认扫描的范围时启动类所在包及其子包。</p>
<p>显式指定扫描范围的示例</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205231744806.png" alt="image-20240205231744806"></p>
</li>
</ul>
<h2 id="DI详解（出现多个同类型的Bean对象时该如何办）"><a href="#DI详解（出现多个同类型的Bean对象时该如何办）" class="headerlink" title="DI详解（出现多个同类型的Bean对象时该如何办）"></a>DI详解（出现多个同类型的Bean对象时该如何办）</h2><p>Bean注入</p>
<ul>
<li><p>Autowired注解，默认是按照类型进行，如果存在多个相同类型的bean，将会报以下错误：</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205232248743.png" alt="image-20240205232248743"></p>
</li>
<li><p>解决方法如下所示：</p>
<ul>
<li><p>@Primary（加在两个竞争的小类上方）</p>
</li>
<li><p>@Qualifier（加在大类的变量上方）（权限最高，比primary的权限高）</p>
</li>
<li><p>@Resource（去掉autowired，加在大类的变量上方）</p>
<p><img src="/2024/02/05/javaweb-day02-springbootweb%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94/image-20240205233023664.png" alt="image-20240205233023664"></p>
</li>
</ul>
</li>
</ul>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><ol>
<li>依赖注入的注解<ul>
<li>Autowired：默认按照类型自动装配。</li>
<li>如果同类型的bean存在多个：<ul>
<li>@Primary</li>
<li>@Autowired + @Qualified(“bean的名称”)</li>
<li>@Resource(name &#x3D; “bean的名称”)</li>
</ul>
</li>
</ul>
</li>
<li>@Resource和@Autowired的区别<ul>
<li>@Autowired是spring框架提供的注解，而@Resource是JDK提供的注解。</li>
<li>@Autowired默认是按照类型注入，而@Resource是默认按照名称注入，名称未指定的话默认是首字母小写的类名</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>javaweb_day01_maven_springbootweb入门</title>
    <url>/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h1 id="什么是maven"><a href="#什么是maven" class="headerlink" title="什么是maven?"></a>什么是maven?</h1><p>maven是apache旗下的一个开源项目，是一款用于管理和构建java项目的工具。</p>
<h1 id="maven的作用"><a href="#maven的作用" class="headerlink" title="maven的作用"></a>maven的作用</h1><ul>
<li><p>依赖管理</p>
<p>方便快捷的管理项目依赖的资源（jar包），避免版本冲突问题</p>
<p>创建maven项目后，要使用什么jar包，不用再单独导入，只要在pom.xml文件的dependencies下引入即可。</p>
</li>
<li><p>统一项目结构</p>
<p>  提供标准、统一的项目结构</p>
<blockquote>
<p>eclipse、myeclipse、intellij idea各个java编译器产生的java项目是不能直接互相导入的，通过maven可以提供标准、统一的项目结构</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240116155606951.png" alt="image-20240116155606951"></p>
</blockquote>
<p>  项目目录结构如下所示</p>
</li>
<li><p>项目构建</p>
<p>  标准跨平台（Linux、Windows、MacOS）的自动化项目构建方式</p>
<p>  <img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240116155754884.png" alt="image-20240116155754884"></p>
</li>
</ul>
<h1 id="Maven概述"><a href="#Maven概述" class="headerlink" title="Maven概述"></a>Maven概述</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li>Apache Maven是一个项目管理和构建工具，它基于项目对象模型（POM）的概念，通过一小段描述信息来管理项目的构建。(POM：project object model)</li>
<li>作用<ul>
<li>方便的依赖管理</li>
<li>统一的项目结构</li>
<li>标准的项目构建流程</li>
</ul>
</li>
<li>官网：<a href="http://maven.apache.org/">http://maven.apache.org/</a></li>
</ul>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240116161041259.png" alt="image-20240116161041259"></p>
<p>仓库：用于存储资源，管理各种jiar包。</p>
<ul>
<li>本地仓库：自己计算机上的一个目录。</li>
<li>中央仓库：由maven团队维护的全球唯一的。仓库地址：<a href="https://repo1/maven.org/maven2/">https://repo1/maven.org/maven2/</a></li>
<li>远程仓库（私服）：一般由公司团队搭建的私有仓库。</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li><p>安装步骤</p>
<ol>
<li><p>解压apche-maven-3.6.1-bin.zip</p>
</li>
<li><p>配置本地仓库：修改conf&#x2F;settings.xml中的&lt;localRepository&gt;为一个指定目录，</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>E:\module\apache-maven-3.6.1-bin\apache-maven-3.6.1\mvn_repo<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置阿里云私服：修改conf&#x2F;settings.xml中的&lt;mirrors&gt;标签，为其添加如下子标签：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/group/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置环境变量：MAVEN_HOME为maven的解压目录，并将其bin目录加入到PATH环境变量。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240116162338034.png" alt="image-20240116162338034"></p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240116162402754.png" alt="image-20240116162402754"></p>
</li>
</ol>
</li>
<li><p>测试</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240116162547523.png" alt="image-20240116162547523"></p>
</li>
</ul>
<h1 id="IDEA继承MAVEN"><a href="#IDEA继承MAVEN" class="headerlink" title="IDEA继承MAVEN"></a>IDEA继承MAVEN</h1><h2 id="全局配置Maven环境"><a href="#全局配置Maven环境" class="headerlink" title="全局配置Maven环境"></a>全局配置Maven环境</h2><ol>
<li>进入全局设置</li>
</ol>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117143305873.png" alt="image-20240117143305873"></p>
<ol start="2">
<li><p>配置maven三件套（本地目录，settings.xml，本地仓库）</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117143430051.png" alt="image-20240117143430051"></p>
</li>
<li><p>配置JRE版本</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117143458156.png" alt="image-20240117143458156"></p>
</li>
<li><p>配置字节码文件版本</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117143512837.png" alt="image-20240117143512837"></p>
</li>
</ol>
<h2 id="本地配置Maven环境"><a href="#本地配置Maven环境" class="headerlink" title="本地配置Maven环境"></a>本地配置Maven环境</h2><ul>
<li><p>选择IDEA中File–&gt;Settings–&gt;Build，Execution,Deployment–&gt;Build Tools–&gt;Maven</p>
</li>
<li><p>设置IDEA使用本地安装的Maven，并修改配置文件及本地仓库路径</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117141244693.png" alt="image-20240117141244693"></p>
</li>
<li><p>配置Runner，确保JRE是对应的版本</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117141340811.png" alt="image-20240117141340811"></p>
</li>
<li><p>配置JAVA语言的字节码版本为特定版本File–&gt;Settings–&gt;Build，Execution,Deployment–&gt;Complier–&gt;Java Complier</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117143111362.png" alt="image-20240117143111362"></p>
</li>
</ul>
<h2 id="本地从0开始创建Maven项目"><a href="#本地从0开始创建Maven项目" class="headerlink" title="本地从0开始创建Maven项目"></a>本地从0开始创建Maven项目</h2><ol>
<li><p>创建项目目录</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117142650306.png" alt="image-20240117142650306"></p>
</li>
<li><p>创建项目</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117142733138.png" alt="image-20240117142733138"></p>
</li>
<li><p>设置maven仓库File–&gt;Settings–&gt;Build，Execution,Deployment–&gt;Build Tools–&gt;Maven</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117142851099.png" alt="image-20240117142851099"></p>
</li>
<li><p>配置Runner，确定JRE的版本</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117143024667.png" alt="image-20240117143024667"></p>
</li>
<li><p>配置JAVA语言的字节码版本为特定版本File–&gt;Settings–&gt;Build，Execution,Deployment–&gt;Complier–&gt;Java Complier</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117143111362.png" alt="image-20240117143111362"></p>
</li>
</ol>
<h2 id="经过全局配置后通过模块创建项目"><a href="#经过全局配置后通过模块创建项目" class="headerlink" title="经过全局配置后通过模块创建项目"></a>经过全局配置后通过模块创建项目</h2><ol>
<li><p>创建模块，选择Maven，点击Next</p>
</li>
<li><p>填写模块名称，坐标信息，点击finish，创建完成</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117144720513.png" alt="image-20240117144720513"></p>
</li>
<li><p>观察生成的项目结构</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117145350061.png" alt="image-20240117145350061"></p>
<p>注意，main目录下存放的项目的资源，test目录下存放的是测试的相关资源，二者应该是一一对应的，但是刚生成的test目录下没有resources,这个时候选中test，右键new directory，它会提示你创建resouces。（上面的图示就是创建好的结果）</p>
<ul>
<li>java目录存放了运行代码。</li>
<li>resources目录下存放了配置信息。</li>
</ul>
</li>
<li><p>编写HelloWorld，File–&gt;New–&gt;Java Class–&gt;com.ithema.HelloWorld</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117145910982.png" alt="image-20240117145910982"></p>
</li>
<li><p>运行后产生target目录，它是Java编译后产生的字节码文件</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117150126244.png" alt="image-20240117150126244"></p>
</li>
</ol>
<h2 id="Maven坐标"><a href="#Maven坐标" class="headerlink" title="Maven坐标"></a>Maven坐标</h2><ul>
<li><p>什么是坐标？</p>
<ul>
<li>Maven中的坐标是资源的唯一标识，通过该坐标可以为一定为资源位置。</li>
<li>使用坐标来定义项目或引入项目中需要的依赖。（在porn.xml中添加坐标，相当于导包操作）</li>
</ul>
</li>
<li><p>Maven坐标主要组成</p>
<ul>
<li><p>groupId:定义当前Maven项目隶属组织名称（通常是域名反写，例如com.itheima）</p>
</li>
<li><p>artifactId：定义当前Maven项目名称（通常是模块名称，例如order-service、good-service）</p>
</li>
<li><p>version：定义当前项目版本号</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-project01<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="导入Maven项目"><a href="#导入Maven项目" class="headerlink" title="导入Maven项目"></a>导入Maven项目</h2><p>方式一：打开IDEA，选择右侧Maven面板，点击+号，选中对应项目的pom.xml文件，双击即可。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117152800780.png" alt="image-20240117152800780"></p>
<p>方法二：打开IDEA，File–&gt;Project Structure，选中Modules，选中对应项目的pom.xml文件，双击即可</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117155211325.png" alt="image-20240117155211325"></p>
<h2 id="移除Maven项目"><a href="#移除Maven项目" class="headerlink" title="移除Maven项目"></a>移除Maven项目</h2><p>方法一：右键-unlink maven projects</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117153019917.png" alt="image-20240117153019917"></p>
<p>方法二：选中，右键，remove module</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240117153148909.png" alt="image-20240117153148909"></p>
<h1 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h1><h2 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h2><ul>
<li><p>依赖：指当前项目运行所需要的jar包，一个项目中可以引入多个依赖。</p>
</li>
<li><p>配置：</p>
<ol>
<li><p>在pom.xml中编写<code>&lt;dependencies&gt;</code>标签</p>
</li>
<li><p>在<code>&lt;dependices&gt;</code>标签中，使用<code>&lt;dependency&gt;</code>引入坐标</p>
</li>
<li><p>定义坐标的groupId，artifactId，version</p>
</li>
<li><p>点击刷新按钮，引入最新加入的坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119152117196.png" alt="image-20240119152117196"></p>
</li>
</ol>
</li>
</ul>
<p>注意事项</p>
<ul>
<li>如果引入的依赖，在本地仓库不存在，将会链接远程仓库&#x2F;中央仓库，然后下载依赖。</li>
<li>如果不知道依赖的坐标信息，可以到<a href="https://mvnreposotory.com/%E4%B8%AD%E6%90%9C%E7%B4%A2%E3%80%82">https://mvnreposotory.com/中搜索。</a></li>
</ul>
<h2 id="依赖传递"><a href="#依赖传递" class="headerlink" title="依赖传递"></a>依赖传递</h2><ul>
<li><p>依赖具有传递性</p>
<ul>
<li><p>直接依赖：在当前项目中通过依赖配置建立的依赖关系</p>
</li>
<li><p>间接依赖：被依赖的资源如果依赖其他资源，当前项目间接依赖其他资源</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119153259194.png" alt="image-20240119153259194"></p>
</li>
</ul>
</li>
<li><p>排除依赖</p>
<p>排除依赖指主动断开依赖的资源，被排除的资源无需指定版本。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119154036910.png" alt="image-20240119154036910"></p>
</li>
</ul>
<h2 id="依赖范围"><a href="#依赖范围" class="headerlink" title="依赖范围"></a>依赖范围</h2><p>依赖的jar包，默认情况下，可以在任何地方使用。可以使用<code>&lt;scope&gt;...&lt;/scope&gt;</code>设置其作用范围。</p>
<p>作用范围：</p>
<ul>
<li>主程序范围有效。（main文件夹范围内）</li>
<li>测试程序范围有效。（test文件夹范围内）</li>
<li>是否参与打包运行。（package指令范围内）</li>
</ul>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119154350199.png" alt="image-20240119154350199"></p>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p>Maven的生命周期就是为了对所有的maven项目构建过程进行抽象和统一。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119155450407.png" alt="image-20240119155450407"></p>
<p>Maven有3套相互独立的生命周期：</p>
<ul>
<li>clean：清理工作。</li>
<li>default：核心工作，如：编译、测试、打包、安装、部署等。</li>
<li>site：生成报告、发布站点等。</li>
</ul>
<p>每套生命周期包含一些阶段（phase）,阶段是有顺序的，后面的阶段依赖于前面的阶段。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119155612088.png" alt="image-20240119155612088"></p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119160354799.png" alt="image-20240119160354799"></p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240119160447967.png" alt="image-20240119160447967"></p>
<h1 id="SpringBootWeb入门"><a href="#SpringBootWeb入门" class="headerlink" title="SpringBootWeb入门"></a>SpringBootWeb入门</h1><ul>
<li><p>Spring发展到今天已经形成了一种开发生态圈，Spring提供了若干子项目，每个项目用于完成特定的功能。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240120130721110.png" alt="image-20240120130721110"></p>
</li>
<li><p>Spring Framework是所有项目的基础框架，它有两大缺点，上手难度大，配置繁琐，因而出现了spring boot这样的简介配置的基础框架。</p>
</li>
<li><p>Spring Boot可以帮助我们非常快速的构建应用程序，简化开发，直接上手。</p>
</li>
</ul>
<p><strong>需求：使用SPringBoot开发一个web应用，浏览器发起请求&#x2F;hello后，给浏览器返回字符串“Hello World ~”</strong></p>
<ol>
<li><p>创建springboot工程，并勾选web开发相关依赖。</p>
</li>
<li><p>定义HelloController类，添加方法hello，并添加注释。</p>
</li>
<li><p>运行测试。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240120132028164.png" alt="image-20240120132028164"></p>
<p>添加依赖</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240120132128021.png" alt="image-20240120132128021"></p>
<p>创建完项目后删除无关的包</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240120133542924.png" alt="image-20240120133542924"></p>
<p>项目在main&#x2F;java&#x2F;com&#x2F;example目录下自动生成了启动类</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240120133951516.png" alt="image-20240120133951516"></p>
<p>编写请求类（浏览器请求&#x2F;hello页面，就会触发这个方法）</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240120135516970.png" alt="image-20240120135516970"></p>
<p>启动程序<br>运行main方法即可（访问localhost:8080&#x2F;hello或者127.0.0.1:8080&#x2F;hello即可)</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125151520066.png" alt="image-20240125151520066"></p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125151747850.png" alt="image-20240125151747850"></p>
</li>
</ol>
<h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><h2 id="HTTP-概述"><a href="#HTTP-概述" class="headerlink" title="HTTP-概述"></a>HTTP-概述</h2><ul>
<li><p>概念：Hyper Text Transfer Protocol，超文本传输协议，规定了浏览器和服务器之间传输数据的规则。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125152407065.png" alt="image-20240125152407065"></p>
</li>
<li><p>特点：</p>
<ol>
<li>基于TCP协议：，面向连接。安全。</li>
<li>基于请求-响应模型的：一次请求对应一次响应。</li>
<li>HTTP协议是无状态的协议：对于事务没有记忆能力。，每次请求-相应都是独立的。<ul>
<li>缺点：多次请求间不能共享数据。</li>
<li>优点：速度快。</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="HTTP-请求协议（请求数据的格式）"><a href="#HTTP-请求协议（请求数据的格式）" class="headerlink" title="HTTP-请求协议（请求数据的格式）"></a>HTTP-请求协议（请求数据的格式）</h2><p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125153407721.png" alt="image-20240125153407721"></p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125153322567.png" alt="image-20240125153322567"></p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125153911088.png" alt="image-20240125153911088"></p>
<h2 id="HTTP-响应协议"><a href="#HTTP-响应协议" class="headerlink" title="HTTP-响应协议"></a>HTTP-响应协议</h2><p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125154148318.png" alt="image-20240125154148318"></p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125154206959.png" alt="image-20240125154206959"></p>
<h2 id="HTTP-协议解析"><a href="#HTTP-协议解析" class="headerlink" title="HTTP-协议解析"></a>HTTP-协议解析</h2><p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125164522319.png" alt="image-20240125164522319"></p>
<p>服务器自动把要传输的协议解析过程封装，比较著名的有jetty:&#x2F;&#x2F;，weblogic,websphere</p>
<p>其中最著名的当属apache tomcat。</p>
<h2 id="Web服务器"><a href="#Web服务器" class="headerlink" title="Web服务器"></a>Web服务器</h2><p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125164749729.png" alt="image-20240125164749729"></p>
<p>启动服务器，就可以打开浏览器，直接访问部署在服务器的页面。</p>
<p>Web服务器</p>
<ul>
<li>对HTP协议操作进行封装。简化web程序开发。</li>
<li>部署web项目，对外提供网上信息浏览服务。</li>
</ul>
<p>Tomcat</p>
<ul>
<li>一个轻量级的Web服务器，支持servlet,jsp等少量javaEE规范。</li>
<li>也被称为web容器，servlet容器。</li>
</ul>
<p>将网页部署到tomcat服务器的具体操作如下所示：</p>
<ol>
<li><p>下载并安装tomcat</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125165029068.png" alt="image-20240125165029068"></p>
</li>
<li><p>将已经写好的前端文件放到对应的tomcat安装目录的webapps目录中</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240125165206796.png" alt="image-20240125165206796"></p>
</li>
<li><p>双击bin\startup.bat，启动tomcat。</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240126145251580.png" alt="image-20240126145251580"></p>
</li>
<li><p>进入浏览器，输入localhost:8080&#x2F;demo&#x2F;index.html</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240126145329204.png" alt="image-20240126145329204"></p>
</li>
</ol>
<h1 id="Web服务器-Tomcat"><a href="#Web服务器-Tomcat" class="headerlink" title="Web服务器-Tomcat"></a>Web服务器-Tomcat</h1><ul>
<li><p>简介</p>
<ul>
<li><p>概念：Tomcat是Apache软件基金会一个核心项目，是一个开源免费的轻量级Web服务器。支持少量Servlet、JSP少量JavaEE规范。</p>
</li>
<li><p>JavaEE：Java Enterprise Edition，Java企业版。指Java企业级开发的技术规范总和。包含13项技术规范：JDBC，JNDI，EJB（被Spring替代），RMI，JSP，Servlet（被基于Servlet的框架替代），XML，JMS，Java IDL，JTS，JTA，JavaMail，JAF。</p>
</li>
<li><p>Tomcat也被称为Web容器，Servlet容器。Servlet程序需要依赖于Tomcat才能运行。</p>
</li>
</ul>
</li>
<li><p>基本使用</p>
<ul>
<li><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240126143712623.png" alt="image-20240126143712623"></li>
<li><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240126144304052.png" alt="image-20240126144304052"></li>
<li><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240126144410282.png" alt="image-20240126144410282"></li>
</ul>
</li>
<li><p>入门程序解析</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240126144954387.png" alt="image-20240126144954387"></p>
<p>springbootweb在启动时回启动内置的tomcat服务器（以后用的基本是springboot内置的tomcat服务器）</p>
<p><img src="/2024/01/16/javaweb-day01-web%E5%BC%80%E5%8F%91/image-20240126150234575.png" alt="image-20240126150234575"></p>
</li>
</ul>
]]></content>
      <categories>
        <category>javaweb</category>
      </categories>
  </entry>
  <entry>
    <title>2. github远程部署hexo</title>
    <url>/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/</url>
    <content><![CDATA[<h2 id="1-搭建环境"><a href="#1-搭建环境" class="headerlink" title="1. 搭建环境"></a>1. 搭建环境</h2><p>Hexo 基于 Node.js，搭建过程中还需要使用 npm（Node.js 已带） 和 git，因此先搭建本地操作环境，安装 Node.js 和 Git。</p>
<ul>
<li>Node.js：<a href="https://link.zhihu.com/?target=https://nodejs.org/zh-cn">https://nodejs.org/zh-cn</a></li>
<li>Git：<a href="https://link.zhihu.com/?target=https://git-scm.com/downloads">https://git-scm.com/downloads</a></li>
</ul>
<p>下载 Node.js 和 Git 程序并安装，一路点 “下一步” 按默认配置完成安装。</p>
<p>安装完成后，Win+R 输入 cmd 并打开，依次输入 <code>node -v</code>、<code>npm -v</code> 和 <code>git --version</code> 并回车，如下图出现程序版本号即可。</p>
<p><img src="/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/image-20240115151405964.png" alt="image-20240115151405964"></p>
<h2 id="2-连接github"><a href="#2-连接github" class="headerlink" title="2. 连接github"></a>2. 连接github</h2><p>使用邮箱注册 <a href="https://link.zhihu.com/?target=https://github.com/">GitHub</a> 账户，选择免费账户（Free），并完成邮件验证。</p>
<p>右键 -&gt; Git Bash Here，<strong>设置用户名和邮箱</strong>：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;GitHub 用户名&quot;</span><br><span class="line">git config --global user.email &quot;GitHub 邮箱&quot;</span><br></pre></td></tr></table></figure>

<p><strong>查看本地已经设置好的用户名和邮箱</strong></p>
<ol>
<li><p>查看全局用户名：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.name</span><br></pre></td></tr></table></figure>

<p>这个命令会显示你设置的全局用户名。</p>
</li>
<li><p>查看全局邮箱：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global user.email</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>创建 SSH 密匙</strong>：</p>
<p>输入 <code>ssh-keygen -t rsa -C &quot;GitHub 邮箱&quot;</code>，然后一路回车。</p>
<p><strong>添加密匙：</strong></p>
<p>进入 [C:\Users\用户名.ssh] 目录（要勾选显示“隐藏的项目”），用记事本打开公钥 id_rsa.pub 文件并复制里面的内容。</p>
<p>登陆 GitHub ，进入 Settings 页面，选择左边栏的 SSH and GPG keys，点击 New SSH key。</p>
<p>Title 随便取个名字，粘贴复制的 id_rsa.pub 内容到 Key 中，点击 Add SSH key 完成添加。</p>
<p><img src="/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/image-20240115153151771.png" alt="image-20240115153151771"></p>
<p><strong>验证连接：</strong></p>
<p>打开 Git Bash，输入 <code>ssh -T git@github.com</code> 出现 “Are you sure……”，输入 yes 回车确认。</p>
<p><img src="/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/image-20240115153218063.png" alt="image-20240115153218063"></p>
<p>显示 “Hi xxx! You’ve successfully……” 即连接成功。</p>
<h2 id="3-创建-Github-Pages-仓库"><a href="#3-创建-Github-Pages-仓库" class="headerlink" title="3. 创建 Github Pages 仓库"></a>3. 创建 Github Pages 仓库</h2><p>GitHub 主页右上角加号 -&gt; New repository：</p>
<ul>
<li>Repository name 中输入 <code>用户名.github.io</code></li>
<li>勾选 “Initialize this repository with a README”</li>
<li>Description 选填</li>
</ul>
<p>填好后点击 Create repository 创建。</p>
<p><img src="/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/image-20240115153305115.png" alt="image-20240115153305115"></p>
<p>创建后默认自动启用 HTTPS，博客地址为：<code>https://用户名.github.io</code></p>
<h2 id="4-本地安装-Hexo-博客程序"><a href="#4-本地安装-Hexo-博客程序" class="headerlink" title="4. 本地安装 Hexo 博客程序"></a>4. 本地安装 Hexo 博客程序</h2><p>新建一个文件夹用来存放 Hexo 的程序文件，如 Hexo-Blog。打开该文件夹，右键 -&gt; Git Bash Here。</p>
<h3 id="4-1-安装-Hexo"><a href="#4-1-安装-Hexo" class="headerlink" title="4.1 安装 Hexo"></a>4.1 安装 Hexo</h3><p>使用 npm 一键安装 Hexo 博客程序：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>Mac 用户需要管理员权限（sudo），运行这条命令：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">sudo npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>安装时间有点久（真的很慢！），界面也没任何反应，<strong>耐心等待</strong>，安装完成后如下图。</p>
<p><img src="/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/image-20240115153349039.png" alt="image-20240115153349039"></p>
<h3 id="4-2-Hexo-初始化和本地预览"><a href="#4-2-Hexo-初始化和本地预览" class="headerlink" title="# 4.2 Hexo 初始化和本地预览"></a><strong># 4.2 Hexo 初始化和本地预览</strong></h3><p><strong>初始化并安装所需组件：</strong></p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">hexo init      # 初始化</span><br><span class="line">npm install    # 安装组件</span><br></pre></td></tr></table></figure>

<p>完成后依次输入下面命令，<strong>启动本地服务器进行预览</strong>：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">hexo g   # 生成页面</span><br><span class="line">hexo s   # 启动预览</span><br></pre></td></tr></table></figure>

<p><strong>访问</strong> <code>http://localhost:4000</code><strong>，出现 Hexo 默认页面，本地博客安装成功！</strong></p>
<h2 id="5-部署-Hexo-到-GitHub-Pages"><a href="#5-部署-Hexo-到-GitHub-Pages" class="headerlink" title="5. 部署 Hexo 到 GitHub Pages"></a>5. 部署 Hexo 到 GitHub Pages</h2><p>本地博客测试成功后，就是上传到 GitHub 进行部署，使其能够在网络上访问。</p>
<p>首先<strong>安装 hexo-deployer-git</strong>：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>然后<strong>修改 _config.yml</strong> 文件末尾的 Deployment 部分，修改成如下：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: git@github.com:用户名/用户名.github.io.git</span><br><span class="line">  branch: main</span><br></pre></td></tr></table></figure>

<p>完成后运行 <code>hexo d</code> 将网站上传部署到 GitHub Pages。</p>
<p>完成！这时访问我们的 GitHub 域名 <code>https://用户名.github.io</code> 就可以看到 Hexo 网站了。</p>
<h2 id="6-绑定域名（可选）"><a href="#6-绑定域名（可选）" class="headerlink" title="6. 绑定域名（可选）"></a>6. 绑定域名（可选）</h2><p>博客搭建完成使用的是 GitHub 的子域名（用户名.<a href="https://link.zhihu.com/?target=http://github.io">http://github.io</a>），我们可以为 Hexo 博客绑定自己的域名替换 GitHub 域名，更加个性化和专业，也利于 SEO。</p>
<p>我们使用 <a href="https://link.zhihu.com/?target=https://www.namesilo.com/?rid=d27fa32do">Namesilo</a> 进行注册，便宜好用没啥套路，使用优惠码 <code>okoff</code> 优惠一美元，com 域名大概 50 块一年。</p>
<h3 id="6-1-域名注册和解析"><a href="#6-1-域名注册和解析" class="headerlink" title="6.1 域名注册和解析"></a>6.1 域名注册和解析</h3><ul>
<li>域名注册和解析教程：<a href="https://zhuanlan.zhihu.com/p/33921436">Namesilo 域名购买及使用教程</a></li>
</ul>
<p>按上面教程注册并解析域名，在 DNS 设置部分，删除自带的记录，然后添加 CNAME 记录将 www 域名解析指向 <code>用户名.github.io</code>。</p>
<p><img src="/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/image-20240115154525174.png" alt="image-20240115154525174"></p>
<h3 id="6-2-绑定域名到-Hexo-博客"><a href="#6-2-绑定域名到-Hexo-博客" class="headerlink" title="6.2 绑定域名到 Hexo 博客"></a>6.2 绑定域名到 Hexo 博客</h3><p>进入本地博客文件夹的 source 目录，打开记事本，里面输入自己的域名，如 <a href="http://www.example.com,保存名称为/">http://www.example.com，保存名称为</a> “CNAME”，格式为 “所有文件”（无 .txt 后缀）。</p>
<p>清除缓存等文件并重新发布网站：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">hexo clean   # 清除缓存文件等</span><br><span class="line">hexo g       # 生成页面</span><br><span class="line">hexo s       # 启动预览</span><br></pre></td></tr></table></figure>

<p>现在就可以使用自己的域名访问 Hexo 博客了。</p>
<h3 id="6-3-开启-HTTPS"><a href="#6-3-开启-HTTPS" class="headerlink" title="6.3 开启 HTTPS"></a>6.3 开启 HTTPS</h3><p>配置自己的域名后，需要我们手动开启 HTTPS。打开博客所在 GitHub 仓库，Settings -&gt; 下拉找到 GitHub Pages -&gt; 勾选 Enforce HTTPS。</p>
<p><img src="/2024/01/15/github%E8%BF%9C%E7%A8%8B%E9%83%A8%E7%BD%B2hexo/image-20240115154742811.png" alt="image-20240115154742811"></p>
<p>HTTPS 证书部署成功需要一定时间，等大概几分钟再访问域名，就可以看到域名前面的小绿锁了，HTTPS 配置完成！</p>
<h2 id="7-至此，完成hexo-github"><a href="#7-至此，完成hexo-github" class="headerlink" title="7.至此，完成hexo + github!"></a>7.至此，完成hexo + github!</h2>]]></content>
      <categories>
        <category>博客</category>
      </categories>
  </entry>
  <entry>
    <title>hexo中插入图片教程</title>
    <url>/2024/01/15/hexo%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="1-解决方案"><a href="#1-解决方案" class="headerlink" title="1. 解决方案"></a>1. 解决方案</h2><h3 id="1-1-创建图片资源文件夹"><a href="#1-1-创建图片资源文件夹" class="headerlink" title="1.1 创建图片资源文件夹"></a>1.1 创建图片资源文件夹</h3><p>网上有关的解决方式几乎很大一部分会提到这一点：将_config.yml 文件中的post_asset_folder 选项设为 true 来打开。事实上这正是hexo官方文档给出的解决方案之一中的一个步骤。仔细阅读后会发现如下几点：</p>
<ol>
<li><p>该操作的作用就是在使用hexo new xxx指令新建博文时，在相同路径下同步创建一个xxx文件夹，而xxx文件夹的作用就是用来存放图片资源；</p>
</li>
<li><p>就我个人而言，我偏好于直接在source_posts文件夹下新建md文件，而不是通过hexo new xxx指令；</p>
</li>
<li><p>那么直接新建xxx.md再新建xxx文件夹，这种操作的最终效果和使用hexo new xxx指令新建博文的效果一样吗？经过实测，是一样的。</p>
</li>
</ol>
<p>基于以上3点，告诉大家几个结论：</p>
<ol>
<li>新建博文可以不用hexo new xxx指令，我较为推荐直接新建文件和文件夹的方式，只要达到一个md文件，一个同名文件夹的效果即可；</li>
<li>【将_config.yml 文件中的post_asset_folder 选项设为 true 】是必须的！理论上既然没用hexo new xxx指令，文件夹也是我自己新建的，这一步设置的意义似乎并不存在，但是后文介绍的插件必须在post_asset_folder 选项设为 true的情况下才能生效——本人亲测，大家记住这么设置即可！</li>
</ol>
<h3 id="1-2-typora中图像设置"><a href="#1-2-typora中图像设置" class="headerlink" title="1.2 typora中图像设置"></a>1.2 typora中图像设置</h3><p>一般来说，大家会现在typora里写好md格式的博客，然后通过hexo clean、hexo g、hexo s进行一下本地测试，确认无误后再发布到远端。</p>
<p>暂且不说hexo博客的图片插入是个问题，我相信当初单纯利用typora做笔记时，图片文件的管理就让很多人头疼过，typora官方似乎也意识到这个问题，所以偏好设置中图像是专门的一项，提供了很多选择。</p>
<p><img src="/2024/01/15/hexo%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%95%99%E7%A8%8B/image-20240115143136972.png" alt="image-20240115143136972"></p>
<p>我相信大多数同学写md时的图片很多可能是直接截图或者在其他地方copy的，然后在typora中直接粘贴就ok了。但是这么做之前最好把typora插入图片时采取何种操作配置好，否则md文件和图片相隔十万八千里，后续一旦移动md文件图片就识别不出来，相信大家用过typora都深有体会。</p>
<p>所以接下来讲一下typora如何设置。直接给结论：</p>
<p><img src="/2024/01/15/hexo%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%95%99%E7%A8%8B/image-20240115143150050.png" alt="image-20240115143150050"></p>
<p>的路径是：<code>./$&#123;filename&#125;</code>。<code>./</code>表示当前文件夹，<code>$&#123;filename&#125;</code>表示当前文件名。这么设置的好处：</p>
<ol>
<li>图片资源文件夹有了；</li>
<li>而且是同名文件夹！（2.1中的文件夹其实不用手动添加了）</li>
</ol>
<p>这么设置的结果就是：想写篇博客，在<code>source\_posts</code>文件夹下新建<code>xxx.md</code>文件，写着写着需要插一张图，从别处复制，然后在typora中直接粘贴，<code>bling!</code>图片资源文件夹自动搞定，并不用关心什么文件夹，只管专注于<code>md</code>文件即可。</p>
<h3 id="1-3-插件下载"><a href="#1-3-插件下载" class="headerlink" title="1.3 插件下载"></a>1.3 插件下载</h3><p>这个很多博客也有提到，插件的名字叫<code>hexo-asset-image</code>，相信在网上找了一波解决方案的同学一定对这个名字不陌生。</p>
<p>这个插件的不同版本可能会有不同的影响，我最终成功解决问题的版本是用如下命令下载的：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install https://github.com/CodeFalling/hexo-asset-image --save</span><br></pre></td></tr></table></figure>

<p>为什么需要这么插件呢？</p>
<p>因为我们虽然在<code>source\_posts</code>文件夹下写了md文件，也有了图片资源文件夹存了图片，但从我们前面typora中的设置不难知道，实际上md文件中的图片路径都是相对路径（<code>./$&#123;filename&#125;</code>）。而实际网上看到的博文显然不是md文件，而是html文件，从md到html的转变就是hexo帮我们做的，还记得<code>hexo g</code>命令吗？就是干这个的。转换后的html文件在<code>public</code>目录下，路径是通过日期指示的。</p>
<p>下面第一张图是存放md文件的地方，图片就在图中的jiangzhou文件夹中；第二张图是generate之后存在html和图片资源的地方。</p>
<p><img src="/2024/01/15/hexo%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%95%99%E7%A8%8B/image-20240115145940757.png" alt="image-20240115145940757"></p>
<p><img src="/2024/01/15/hexo%E4%B8%AD%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%95%99%E7%A8%8B/image-20240115145902744.png" alt="image-20240115145902744"></p>
<h2 id="1-4-完成部署"><a href="#1-4-完成部署" class="headerlink" title="1.4 完成部署"></a>1.4 完成部署</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br></pre></td></tr></table></figure>

<p>经过以上三步，在本地目录public目录下就会根据日期产生对应的网页，网页中图片的路径经过插件<code>https://github.com/CodeFalling/hexo-asset-image</code>之后已经正确转换为对应的路径。</p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
  </entry>
  <entry>
    <title>junit-reflex-proxy</title>
    <url>/2023/11/17/junit-reflex-proxy/</url>
    <content><![CDATA[<h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><h2 id="概述、Junit框架快速入门"><a href="#概述、Junit框架快速入门" class="headerlink" title="概述、Junit框架快速入门"></a>概述、Junit框架快速入门</h2><ul>
<li><p>针对最小的功能单元（方法），编写测试代码进行正确性测试</p>
</li>
<li><p><strong>具体步骤</strong></p>
<ol>
<li><p>将junit框架的jar包导入到项目中（注意：IDEA已经集成了Junit框架，不需要我们自己手动导入了）</p>
</li>
<li><p>为需要测试的业务类，定义对应的测试类，并为每个业务方法，编写对应的测试方法（<strong>必须：公共、无参、无返回值</strong>）</p>
</li>
<li><p>测试方法上必须声明@Test注解，然后在测试方法中，编写代码调用被测试的业务方法进行测试；</p>
</li>
<li><p>开始测试：选中测试方法，右键选择“JUnit”运行，如果测试通过则是绿色；如果测试失败，则是红色</p>
<p><strong>1. 编写业务类</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.d1_junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printNumber</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(name == <span class="literal">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;名字长度是&quot;</span> + name.length());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getMaxIndex</span><span class="params">(String data)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(data == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. 编写测试类（测试类和业务类方法一一对应）</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.d1_junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtilTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPrintNumber</span><span class="params">()</span> &#123;</span><br><span class="line">        StringUtil.printNumber(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        StringUtil.printNumber(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetMaxIndex</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(StringUtil.getMaxIndex(<span class="string">&quot;3&quot;</span>));</span><br><span class="line">        System.out.println(StringUtil.getMaxIndex(<span class="literal">null</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. 断言机制</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.d1_junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtilTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPrintNumber</span><span class="params">()</span> &#123;</span><br><span class="line">        StringUtil.printNumber(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        StringUtil.printNumber(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetMaxIndex</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(StringUtil.getMaxIndex(<span class="string">&quot;3&quot;</span>));</span><br><span class="line">        System.out.println(StringUtil.getMaxIndex(<span class="literal">null</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> StringUtil.getMaxIndex(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="comment">//断言机制：程序员可以通过预测业务方法的结果</span></span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;方法内部有bug!&quot;</span>,<span class="number">4</span>,index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Junit框架的常见注解"><a href="#Junit框架的常见注解" class="headerlink" title="Junit框架的常见注解"></a>Junit框架的常见注解</h2></li>
</ul>
<p><strong>Junit单元测试框架的常用注解（Junit 4.xxxx版本）</strong></p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Test</td>
<td>测试类中的方法必须用它修饰才能成为测试方法，才能启动执行。</td>
</tr>
<tr>
<td>@Before</td>
<td>用来修饰一个实例方法，该方法会在每一个测试方法执行之前执行一次。</td>
</tr>
<tr>
<td>@After</td>
<td>用来修饰一个实例方法，该方法会在每一个测试方法执行之后执行一次。</td>
</tr>
<tr>
<td>@BeforeClass</td>
<td>用来修饰一个静态方法，该方法会在所有测试方法之前执行一次。</td>
</tr>
<tr>
<td>@AfterClass</td>
<td>用来修饰一个静态方法，该方法会在所有测试方法之后执行一次。</td>
</tr>
</tbody></table>
<ul>
<li>在测试方法执行前执行的方法，常用于：初始化资源。</li>
<li>在测试方法执行完之后再执行的方法，常用于：释放资源。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.d1_junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtilTest</span> &#123;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----&gt; test1 Before执行了--------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----&gt;test2 After执行了--------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeClass</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----&gt;Before CLass执行了---------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterClass</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----&gt;After Class执行了---------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPrintNumber</span><span class="params">()</span> &#123;</span><br><span class="line">        StringUtil.printNumber(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        StringUtil.printNumber(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetMaxIndex</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(StringUtil.getMaxIndex(<span class="string">&quot;3&quot;</span>));</span><br><span class="line">        System.out.println(StringUtil.getMaxIndex(<span class="literal">null</span>));</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> StringUtil.getMaxIndex(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="comment">//断言机制：程序员可以通过预测业务方法的结果</span></span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;方法内部有bug!&quot;</span>, <span class="number">5</span>, index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果如下所示：</span><br><span class="line">----&gt;Before CLass执行了---------</span><br><span class="line">----&gt; test1 Before执行了--------</span><br><span class="line">名字长度是<span class="number">5</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">----&gt;test2 After执行了--------</span><br><span class="line">----&gt; test1 Before执行了--------</span><br><span class="line"><span class="number">1</span></span><br><span class="line">-<span class="number">1</span></span><br><span class="line">----&gt;test2 After执行了--------</span><br><span class="line">----&gt;After Class执行了---------</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>



<h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><h2 id="认识反射、获取类"><a href="#认识反射、获取类" class="headerlink" title="认识反射、获取类"></a>认识反射、获取类</h2><ul>
<li>概念&#x2F;是什么：加载类，并允许以编程的方式解剖类中的各种成分（成员变量、方法、构造器等）。</li>
</ul>
<p>​		类是由成员变量、构造器、成员方法组成的。<strong>我们学习反射，就是学习获取类的信息，操作它们。</strong></p>
<h2 id="获取类的构造器"><a href="#获取类的构造器" class="headerlink" title="获取类的构造器"></a>获取类的构造器</h2><p><strong>1、 反射第一步：加载类，获取类的字节码：Class对象（万物皆对象，类的字节码在Java中还是Class对象）</strong></p>
<p>Student.java——&gt;Student.class——&gt;字节码文件——&gt;内存</p>
<p>获取Class对象的三种方式</p>
<ul>
<li>Class c1 &#x3D; 类名.class</li>
<li>调用Class提供方法：public static Class forName(String package);</li>
<li>Object提供的方法：public Class getClass(); Class c3 &#x3D; 对象.getClass();</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.d2_reliect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1Class</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//第一种方式</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Student.class;</span><br><span class="line">        System.out.println(c1.getName()); <span class="comment">// 全类名</span></span><br><span class="line">        System.out.println(c1.getSimpleName());  <span class="comment">//简名：Student</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//第二种方式</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c2</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.itheima.d2_reliect.Student&quot;</span>);</span><br><span class="line">        System.out.println(c1 == c2);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//第三种方式</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c3</span> <span class="operator">=</span> s.getClass();</span><br><span class="line">        System.out.println(c3 == c1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、获取类的构造器：Constructor对象</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Constructor&lt;?&gt;[] getConstructors()</td>
<td>获取全部构造器（只能获取public修饰的）</td>
</tr>
<tr>
<td>Constructor&lt;?&gt;[] getDeclaredConstructors()</td>
<td>获取全部构造器（只要存在就能拿到）</td>
</tr>
<tr>
<td>Constructor&lt;?&gt;[] getConstructor(Class&lt;?&gt;… parameterTypes)</td>
<td>获取某个构造器（只能获取public修饰的）</td>
</tr>
<tr>
<td>Constructor&lt;?&gt;[] getDeclaredConstructor(Class&lt;?&gt;… parameterTypes)</td>
<td>获取某个构造器（只要存在就能拿到）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetConstructor2</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">// 1、反射第一步：必须先得到这个类的Class对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Cat.class;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、获取某个构造器，无参数构造器</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> c.getDeclaredConstructor();</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        System.out.println(constructor.getName() + <span class="string">&quot;===&gt;&quot;</span> + constructor.getParameterCount());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.1 通过无参构造器初始化实例</span></span><br><span class="line">        <span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> (Cat) constructor.newInstance();</span><br><span class="line">        System.out.println(cat);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、获取某个构造器，有参数构造器</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">constructor1</span> <span class="operator">=</span> c.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">        System.out.println(constructor1.getName() + <span class="string">&quot;===&gt;&quot;</span> + constructor1.getParameterCount());</span><br><span class="line">        <span class="comment">// 3.1 通过有参构造器初始化实例</span></span><br><span class="line">        <span class="type">Cat</span> <span class="variable">cat2</span> <span class="operator">=</span> (Cat) constructor1.newInstance(<span class="string">&quot;阿松大&quot;</span>,<span class="number">33</span>);</span><br><span class="line">        System.out.println(cat2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.1、获取类构造器的作用：初始化类对象</strong></p>
<table>
<thead>
<tr>
<th>Constructor提供的方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>T newInstance(Object … initargs)</td>
<td>调用此构造器对象表示的构造器，并传入参数，完成对象的初始化并返回</td>
</tr>
<tr>
<td>public void setAccessible(boolean flag)</td>
<td>设置为true，表示禁止检查访问控制（暴力反射）</td>
</tr>
</tbody></table>
<p><strong>实例</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、获取类的class对象</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Cat.class;</span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor1</span> <span class="operator">=</span> c.getDeclaredConstructor();</span><br><span class="line">System.out.println(constructor1.getName() + <span class="string">&quot;---&gt;&quot;</span> + constructor1.getParameterCount());</span><br><span class="line"><span class="comment">//设置访问权限禁止检查</span></span><br><span class="line">constructor1.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 直接用会报错，因为Cat类的无参构造函数是private的，默认是无法访问的</span></span><br><span class="line"><span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> (Cat) constructor1.newInstance();</span><br><span class="line">System.out.println(cat);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取有参数构造器</span></span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor2</span> <span class="operator">=</span> c.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">System.out.println(constructor2.getName() + <span class="string">&quot;---&gt;&quot;</span> + constructor2.getParameterCount());</span><br><span class="line"><span class="type">Cat</span> <span class="variable">cat2</span> <span class="operator">=</span> (Cat) constructor2.newInstance(<span class="string">&quot;叮当猫&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(cat2);</span><br></pre></td></tr></table></figure>

<p><strong>3、获取类的成员变量：Field对象</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>public Field[] getFields()</td>
<td>获取类的全部成员变量（只能获取public修饰的）</td>
</tr>
<tr>
<td>public Field[] getDeclaredFields()</td>
<td>获取类的全部成员变量（只能存在就能拿到）</td>
</tr>
<tr>
<td>public Field[] getField(String name)</td>
<td>获取类的某个成员变量（只能获取public修饰的）</td>
</tr>
<tr>
<td>public Field[] getDeclaredField(String name)</td>
<td>获取类的某个成员变量（只能存在就能拿到）</td>
</tr>
</tbody></table>
<p><strong>实例</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、获取类的class对象</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Cat.class;</span><br><span class="line"><span class="comment">// 2、获取类的全部成员变量</span></span><br><span class="line">Field[] declaredFields = c.getDeclaredFields();</span><br><span class="line"><span class="comment">// 3、遍历这个成员变量数组</span></span><br><span class="line"><span class="keyword">for</span> (Field declaredField : declaredFields) &#123;</span><br><span class="line">    System.out.println(declaredField);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4、定位某个成员变量</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">fName</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">System.out.println(fName.getName() + <span class="string">&quot;---&gt;&quot;</span> + fName.getType());</span><br><span class="line"></span><br><span class="line"><span class="type">Field</span> <span class="variable">fAge</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">System.out.println(fAge.getName() + <span class="string">&quot;---&gt;&quot;</span> + fAge.getType());</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>void set(Object obj, Object value)</td>
<td>赋值</td>
</tr>
<tr>
<td>Object get(Object obj)</td>
<td>取值</td>
</tr>
<tr>
<td>public void setAccessible(boolean flag)</td>
<td>设置为true，表示禁止检查访问控制（暴力反射）</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//赋值</span></span><br><span class="line"><span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line"><span class="comment">//定位某个成员变量</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">fName</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">System.out.println(fName.getName() + <span class="string">&quot;---&gt;&quot;</span> + fName.getType());</span><br><span class="line"><span class="comment">//暴力反射</span></span><br><span class="line">fName.setAccessible(<span class="literal">true</span>);</span><br><span class="line">fName.set(cat,<span class="string">&quot;加菲猫&quot;</span>);</span><br><span class="line">System.out.println(cat);</span><br><span class="line"></span><br><span class="line"><span class="comment">//取值</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String)fName.get(cat);</span><br><span class="line">System.out.println(name);</span><br></pre></td></tr></table></figure>

<p><strong>4、获取类的成员方法：Method对象</strong></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Method[] getMethods()</td>
<td>获取类的全部成员方法（只能获取public修饰的）</td>
</tr>
<tr>
<td>Method[] getDeclaredMethods()</td>
<td>获取类的全部成员方法（只要存在就能拿到）</td>
</tr>
<tr>
<td>Method getMethod(String name, Class&lt;?&gt;… parameterTypes)</td>
<td>获取类的某个成员方法（只能获取public修饰的）</td>
</tr>
<tr>
<td>Method getDeclaredMethod(String name, Class&lt;?&gt;… parameterTypes)</td>
<td>获取类的某个成员方法（只要存在就能拿到）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// 1、反射第一步，先得到类的CLass对象</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Cat.class;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、获取类的全部成员方法</span></span><br><span class="line">Method[] declaredMethods = c.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、遍历数组中的每个方法对象</span></span><br><span class="line"><span class="keyword">for</span> (Method declaredMethod : declaredMethods) &#123;</span><br><span class="line">    System.out.println(declaredMethod.getName() + <span class="string">&quot;---&gt;&quot;</span></span><br><span class="line">                       + declaredMethod.getParameterCount() + <span class="string">&quot;---&gt;&quot;</span></span><br><span class="line">                       + declaredMethod.getReturnType());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、获取某个方法对象</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">eat</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;eat&quot;</span>);</span><br><span class="line">System.out.println(eat.getName() + <span class="string">&quot;---&gt;&quot;</span> + eat.getParameterCount() + <span class="string">&quot;---&gt;&quot;</span> + eat.getReturnType());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、获取某个方法对象</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">eat2</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;eat&quot;</span>, String.class);</span><br><span class="line">System.out.println(eat2.getName() + <span class="string">&quot;---&gt;&quot;</span> + eat2.getParameterCount() + <span class="string">&quot;---&gt;&quot;</span> + eat2.getReturnType());</span><br></pre></td></tr></table></figure>

<p><strong>4.2、执行类的成员方法</strong></p>
<table>
<thead>
<tr>
<th>Method提供的方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>public Object invoke(Object obj, Object… args)</td>
<td>触发某个对象的该方法执行</td>
</tr>
<tr>
<td>public void setAccessible(boolean flag)</td>
<td>设置为true，表示禁止检查访问控制（暴力反射）</td>
</tr>
</tbody></table>
<p><strong>示例</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1、反射第一步，先得到类的CLass对象</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Cat.class;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2、获取某个方法对象</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">eat</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;eat&quot;</span>);</span><br><span class="line">System.out.println(eat.getName() + <span class="string">&quot;---&gt;&quot;</span> + eat.getParameterCount() + <span class="string">&quot;---&gt;&quot;</span> + eat.getReturnType());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3、获取某个方法对象</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">eat2</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;eat&quot;</span>, String.class);</span><br><span class="line">System.out.println(eat2.getName() + <span class="string">&quot;---&gt;&quot;</span> + eat2.getParameterCount() + <span class="string">&quot;---&gt;&quot;</span> + eat2.getReturnType());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4、出发run方法执行</span></span><br><span class="line"><span class="type">Cat</span> <span class="variable">cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">eat2.setAccessible(<span class="literal">true</span>);  <span class="comment">// 禁止检查访问权限</span></span><br><span class="line"><span class="type">String</span> <span class="variable">rs</span> <span class="operator">=</span> eat2.invoke(cat, <span class="string">&quot;shit&quot;</span>); <span class="comment">// 调用无参数的run方法，用cat对象触发调用的。</span></span><br><span class="line">System.out.println(rs);</span><br></pre></td></tr></table></figure>

<p><strong>5、反射的作用和应用场景</strong></p>
<p>反射的作用</p>
<ul>
<li><p>基本作用：可以得到一个类的全部成分然后操作。</p>
</li>
<li><p>可以破坏封装性。</p>
</li>
<li><p>最重要的用途是：适合做Java的框架，基本上，主流的框架都会基于反射设计出一些通用的功能。</p>
</li>
</ul>
<p>应用场景</p>
<p>需求： 对任意一个对象，该框架都可以把对象的字段名和对应的值，保存到文件中去。</p>
<p>实现步骤：</p>
<ol>
<li>定义一个方法，可以接受任意对象</li>
<li>每收到一个对象后，使用反射获取该对象的Class对象，然后获取全部的成员变量。</li>
<li>遍历成员变量，然后提取成员变量在该对象中的具体值。</li>
<li>把成员变量名，和其值，写到文件中即可。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ObjectFrame</span> &#123;</span><br><span class="line">    <span class="comment">// 目标：保存任意对象的字段及其数据到文件中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">saveObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IllegalAccessException, FileNotFoundException &#123;</span><br><span class="line">        <span class="type">PrintStream</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;src\\data.txt&quot;</span>, <span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、obj是任意对象，到底有多少个字段要保存。</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> obj.getClass();</span><br><span class="line">        <span class="type">String</span> <span class="variable">cName</span> <span class="operator">=</span> c.getSimpleName();</span><br><span class="line">        ps.println(<span class="string">&quot;------------------------------------&quot;</span> + cName + <span class="string">&quot;---------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// 2、从类中提取它的全部成员变量。</span></span><br><span class="line">        Field[] fields = c.getDeclaredFields();</span><br><span class="line">        <span class="comment">// 3、遍历每个成员变量</span></span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            <span class="comment">// 4、拿到成员变量的名字</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> field.getName();</span><br><span class="line">            <span class="comment">// 5、拿到这个成员变量在对象中的数据</span></span><br><span class="line">            field.setAccessible(<span class="literal">true</span>); <span class="comment">// 禁止检查访问控制</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> field.get(obj) + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            ps.println(name + <span class="string">&quot;=&quot;</span> + value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="注解（Annotation）"><a href="#注解（Annotation）" class="headerlink" title="注解（Annotation）"></a>注解（Annotation）</h1><h2 id="概述、自定义注解"><a href="#概述、自定义注解" class="headerlink" title="概述、自定义注解"></a>概述、自定义注解</h2><ul>
<li><p>就是Java代码中的特殊标记，比如：@Override，@Test等，作用是：让其他程序根据注解信息来决定怎么执行程序。</p>
</li>
<li><p>注意：注解可以用在类上、构造器上、方法上、成员变量上、参数上、等位置处。</p>
</li>
<li><p>自定义注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> 注解名称&#123;</span><br><span class="line">    <span class="keyword">public</span> 属性类型 属性名() <span class="keyword">default</span> 默认值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>特殊属性名：value</p>
<ul>
<li>如果注解中只有一个value属性，使用注释时，value名称可以不写！！</li>
</ul>
<p>示例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*AnnotationTest1.java*/</span></span><br><span class="line"><span class="meta">@MyTest1(aaa = &quot;牛魔王&quot;, ccc = &#123;&quot;html&quot;,&quot;java&quot;&#125;)</span></span><br><span class="line"><span class="comment">//@MyTest2(value=&quot;孙悟空&quot;)</span></span><br><span class="line"><span class="meta">@MyTest2(&quot;孙悟空&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest1</span> &#123;</span><br><span class="line">    <span class="meta">@MyTest1(aaa = &quot;铁扇公主&quot;, bbb = false, ccc = &#123;&quot;python&quot;,&quot;前端&quot;,&quot;java&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*Mytest1.java*/</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d3_annotation;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义注解</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyTest1 &#123;</span><br><span class="line">    String <span class="title function_">aaa</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">bbb</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">    String[] ccc();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*Mytest2.java*/</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d3_annotation;</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyTest2 &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>; <span class="comment">//特殊属性</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注解的原理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyTest1 &#123;</span><br><span class="line">    String <span class="title function_">aaa</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">bbb</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">    String[] ccc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行main函数得到编译文件，使用xjad反编译文件，得到结果</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyTest1</span> extend Annotation&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">aaa</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">bbb</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String[] ccc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注解本质上是一个接口，Java中所有注解都是继承Annotation接口的。</li>
<li>@注解(…)：其实就是一个实现类对象，实现了该注解以及Annotation接口。</li>
</ul>
</li>
</ul>
<h2 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h2><ul>
<li><p>指的是：修饰注解的注解。</p>
</li>
<li><p><strong>元注解一</strong></p>
<p>作用：声明被修饰的注解只能在哪些位置使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="number">1.</span> TYPE，类，接口</span><br><span class="line"><span class="number">2.</span> FIELD，成员变量</span><br><span class="line"><span class="number">3.</span> METHOD, 成员方法</span><br><span class="line"><span class="number">4.</span> PARAMETER, 方法参数</span><br><span class="line"><span class="number">5.</span> CONSTRUCTOR, 构造器</span><br><span class="line"><span class="number">6.</span> LOCAL_VARIABLE, 局部变量</span><br></pre></td></tr></table></figure>




<table>
<thead>
<tr>
<th>类型</th>
<th>作用范围</th>
</tr>
</thead>
<tbody><tr>
<td>TYPE</td>
<td>类，接口</td>
</tr>
<tr>
<td>FIELD</td>
<td>成员变量</td>
</tr>
<tr>
<td>METHOD</td>
<td>成员方法</td>
</tr>
<tr>
<td>PARAMETER</td>
<td>方法参数</td>
</tr>
<tr>
<td>CONSTRUCTOR</td>
<td>构造器</td>
</tr>
<tr>
<td>LOCAL_VARIABLE</td>
<td>局部变量</td>
</tr>
</tbody></table>
</li>
</ul>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE,ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyTest3 &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>元注解二</strong></p>
<p>作用：声明注解的保留周期</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy,RUNTIME)</span></span><br><span class="line"><span class="number">1.</span> SOURCE</span><br><span class="line">    只作用在源码阶段，字节码文件中不存在</span><br><span class="line"><span class="number">2.</span> CLASS（默认值）</span><br><span class="line">    保留到字节码文件姐阶段，运行阶段不存在</span><br><span class="line"><span class="number">3.</span> RUNTIME（开发常用）</span><br><span class="line">    一直保存到运行阶段</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="注解的解析"><a href="#注解的解析" class="headerlink" title="注解的解析"></a>注解的解析</h2><ul>
<li><p>就是判断类上面，方法上，成员变量上是否存在注解，并把注解里的内容解析出来</p>
</li>
<li><p>如何解析注解？</p>
<ul>
<li><p>指导思想：要解析谁上面的注解，就应该先拿到谁。</p>
</li>
<li><p>比如要解析类上面的注解，则应该先获取该类的对象，再通过Class对象解析其上面的注解。</p>
</li>
<li><p>比如要解析成员方法上面的注解，则应该先获取该成员方法的Method对象，再通过Method对象解析其上面的注解。</p>
</li>
<li><p>Class、Method、Field、Constructor都实现了AnnotatedElement接口，它们都拥有解析注解的能力。</p>
<table>
<thead>
<tr>
<th>AnnotatedElement接口提供了解析注解的方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>public Annotation[] getDeclaredAnnotations()</td>
<td>获取当前对象上面的注解</td>
</tr>
<tr>
<td>public T getDeclaredAnnotation(Class&lt;\T&gt; annotationClass)</td>
<td>获取指定的注解对象</td>
</tr>
<tr>
<td>public boolean isAnnotationPresent(Class&lt;Annotation&gt; annotationClass)</td>
<td>判断当前对象上是否存在某个注解</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p>解析注解的案例</p>
<p>定义注解MyTest4,要求如下所示</p>
<ol>
<li>包含属性：String value()</li>
<li>包含属性：double aaa()，默认值是100</li>
<li>包含属性：String[] bbb()</li>
<li>限制注解使用的位置：类和成员方法上</li>
<li>限制注解的有效范围：一直到运行时</li>
</ol>
<p>定义一个类：Demo，在类中定义一个test1方法，并在该类和其方法上使用MyTest4注解</p>
<p>定义一个AnnotationTest3测试类，解析Demo类中的全部注解</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// -------------------MyTest4.java-----------------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d3_annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE,ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyTest4 &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">aaa</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">100</span>;</span><br><span class="line">    String[] bbb();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------------Demo.java-------------------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d3_annotation;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@MyTest4(value = &quot;蜘蛛精&quot;, aaa = 99.5, bbb = &#123;&quot;至尊宝&quot;, &quot;黑马&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="meta">@MyTest4(value = &quot;至尊宝&quot;, aaa = 199.5, bbb = &#123;&quot;紫霞&quot;, &quot;牛夫人&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --------------AnnotationTest3.java-----------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d3_annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest3</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parseClass</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException &#123;</span><br><span class="line">        <span class="comment">// 1、先得到Class对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Demo.class;</span><br><span class="line">        <span class="comment">// 2、解析类上的注解</span></span><br><span class="line">        <span class="comment">// 判断类上是否包含了某个注解</span></span><br><span class="line">        <span class="keyword">if</span>(c.isAnnotationPresent(MyTest4.class)) &#123;</span><br><span class="line">            <span class="type">MyTest4</span> <span class="variable">myTest4</span> <span class="operator">=</span> (MyTest4) c.getDeclaredAnnotation(MyTest4.class);</span><br><span class="line">            System.out.println(myTest4.value());</span><br><span class="line">            System.out.println(myTest4.aaa());</span><br><span class="line">            System.out.println(Arrays.toString(myTest4.bbb()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parseMethod</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException &#123;</span><br><span class="line">        <span class="comment">// 1、先得到Class对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Demo.class;</span><br><span class="line">        <span class="comment">// 2、获取方法对象</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        <span class="comment">// 3、判断方法对象上是否包含了某个注释</span></span><br><span class="line">        <span class="keyword">if</span>(m.isAnnotationPresent(MyTest4.class))&#123;</span><br><span class="line">            <span class="type">MyTest4</span> <span class="variable">myTest4</span> <span class="operator">=</span> (MyTest4) m.getDeclaredAnnotation(MyTest4.class);</span><br><span class="line">            System.out.println(myTest4.value());</span><br><span class="line">            System.out.println(myTest4.aaa());</span><br><span class="line">            System.out.println(Arrays.toString(myTest4.bbb()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li><p>模拟Junit框架</p>
<p><strong>需求</strong>：定义若干个方法，只要加了MyTest注解，就会触发该方法的执行。</p>
<p><strong>分析</strong></p>
<ol>
<li>定义一个自定义注解MyTest，只能注解方法，存活范围是一直都在。</li>
<li>定义若干个方法，部分方法加上@MyTest修饰，部分方法不加。</li>
<li>模拟一个Junit程序，可以触发加了@MyTest注解的方法执行。</li>
</ol>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ---------------AnnotationTest4.java----------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d3_annotation;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationTest4</span> &#123;</span><br><span class="line">    <span class="meta">@MyTest</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----test1----&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@MyTest</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----test2----&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----test3----&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@MyTest</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----test4----&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        <span class="type">AnnotationTest4</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationTest4</span>();</span><br><span class="line">        <span class="comment">//启动程序！</span></span><br><span class="line">        <span class="comment">// 1、得到class对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> AnnotationTest4.class;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、提取这个类的全部成员方法</span></span><br><span class="line">        Method[] methods = c.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            <span class="comment">//3、遍历这个数组中的每个方法，看方法是否被@MyTest注释</span></span><br><span class="line">            <span class="keyword">if</span>(method.isAnnotationPresent(MyTest.class))&#123;</span><br><span class="line">                <span class="comment">//说明当前方法是存在@MyTest，触发方法执行</span></span><br><span class="line">                method.invoke(a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------MyTest4.java----------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d3_annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE,ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyTest4 &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">aaa</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">100</span>;</span><br><span class="line">    String[] bbb();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h1><ul>
<li><p>概述、快速入门</p>
<p>对象如果嫌身上干的事情太多的话，可以通过代理转移部分职责。</p>
<p>对象有什么方法想被代理，代理就一定要有对应的方法。</p>
</li>
<li><p>应用案例、使用代理的好处</p>
<p>转移对象的方法，优化类的逻辑结构</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ----------------------UserService.java------------------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d5_proxy2;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  用户业务接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// 登录功能</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String loginName,String passWord)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">    <span class="comment">// 删除用户</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUsers</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">    <span class="comment">// 查询用户，返回数组的形式。</span></span><br><span class="line">    String[] selectUsers() <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------UserServceImpl.java-----------------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d5_proxy2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户业务实现类（面向接口编程）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String loginName, String passWord)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>.equals(loginName) &amp;&amp; <span class="string">&quot;123456&quot;</span>.equals(passWord))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;您登录成功，欢迎光临本系统~&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;您登录失败，用户名或密码错误~&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUsers</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;成功删除了1万个用户~&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1500</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectUsers() <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;查询出了3个用户&quot;</span>);</span><br><span class="line">        String[] names = &#123;<span class="string">&quot;张全蛋&quot;</span>, <span class="string">&quot;李二狗&quot;</span>, <span class="string">&quot;牛爱花&quot;</span>&#125;;</span><br><span class="line">        Thread.sleep(<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> names;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------ProxyUtil.java------------------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d5_proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyUtil</span> &#123;</span><br><span class="line"><span class="comment">//    public static UserService createProxy(UserService userService)&#123;</span></span><br><span class="line"><span class="comment">//        UserService userServiceProxy = (UserService) Proxy.newProxyInstance(ProxyUtil.class.getClassLoader(),</span></span><br><span class="line"><span class="comment">//                new Class[]&#123;UserService.class&#125;, new InvocationHandler() &#123;</span></span><br><span class="line"><span class="comment">//                    @Override</span></span><br><span class="line"><span class="comment">//                    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                        if(method.getName().equals(&quot;login&quot;) || method.getName().equals(&quot;deleteUsers&quot;)||</span></span><br><span class="line"><span class="comment">//                               method.getName().equals(&quot;selectUsers&quot;))&#123;</span></span><br><span class="line"><span class="comment">//                            long startTime = System.currentTimeMillis();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                            Object rs = method.invoke(userService, args);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                            long endTime = System.currentTimeMillis();</span></span><br><span class="line"><span class="comment">//                            System.out.println(method.getName() + &quot;方法执行耗时：&quot; + (endTime - startTime)/ 1000.0 + &quot;s&quot;);</span></span><br><span class="line"><span class="comment">//                            return rs;</span></span><br><span class="line"><span class="comment">//                        &#125;else &#123;</span></span><br><span class="line"><span class="comment">//                            Object rs = method.invoke(userService, args);</span></span><br><span class="line"><span class="comment">//                            return rs;</span></span><br><span class="line"><span class="comment">//                        &#125;</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;);</span></span><br><span class="line"><span class="comment">//        return userServiceProxy;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title function_">createProxy</span><span class="params">(UserService userService)</span>&#123;</span><br><span class="line">        <span class="comment">//1、使用Proxy类调用静态方法newProxyInstance创建代理，代理要强转为UserService类型</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userServiceProxy</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(ProxyUtil.class.getClassLoader(),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;UserService.class&#125;, <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                    <span class="keyword">if</span>(method.getName().equals(<span class="string">&quot;login&quot;</span>) || method.getName().equals(<span class="string">&quot;deleteUsers&quot;</span>) || method.getName().equals(<span class="string">&quot;selectUsers&quot;</span>))&#123;</span><br><span class="line">                        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                        <span class="type">Object</span> <span class="variable">rs</span> <span class="operator">=</span> method.invoke(userService, args);</span><br><span class="line">                        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                        System.out.println(method.getName() + <span class="string">&quot;方法执行耗时：&quot;</span> + (endTime - startTime) / <span class="number">1000.0</span> + <span class="string">&quot;s&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> rs;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="type">Object</span> <span class="variable">rs</span> <span class="operator">=</span> method.invoke(userService, args);</span><br><span class="line">                        <span class="keyword">return</span> rs;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userServiceProxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -----------------------------Test.java----------------------------</span></span><br><span class="line"><span class="keyword">package</span> com.itheima.d5_proxy2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 目标：使用动态代理解决实际问题，并掌握使用代理的好处。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 1、创建用户业务对象。</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> ProxyUtil.createProxy(<span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、调用用户业务的功能。</span></span><br><span class="line">        userService.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        userService.deleteUsers();</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String[] names = userService.selectUsers();</span><br><span class="line">        System.out.println(<span class="string">&quot;查询到的用户是：&quot;</span> + Arrays.toString(names));</span><br><span class="line">        System.out.println(<span class="string">&quot;----------------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>javase</category>
      </categories>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2023/10/27/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
</search>
